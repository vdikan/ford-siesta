<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A first-principles materials simulation code using Density Functional Theory.">
    
    <meta name="author" content="SIESTA Group" >
    <link rel="icon" href="../favicon.png">

    <title>siesta_forces &ndash; SIESTA</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SIESTA <small>trunk-674--vdikan-ford-681</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Program Overview</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>siesta_forces
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 7.2% of total for procedures.">375 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/siesta_forces.F90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/siesta_forces.f90.html'>siesta_forces.F90</a></li>
    
     <li><a href='../module/m_siesta_forces.html'>m_siesta_forces</a></li>
    
  
     <li class="active">siesta_forces</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/siesta_forces.html#src">siesta_forces</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine siesta_forces(istep)
    
    
   
</h2>
    
  
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Uses</h3>
      </div>
      <ul class="list-group">
      
      <li class="list-group-item">
  <ul class="list-inline">
    
    <li>units</li>
    
    <li>precision</li>
    
    <li>sys</li>
    
    <li>files</li>
    
    <li>siesta_cml</li>
    
    <li><a href='../module/m_state_init.html'>m_state_init</a></li>
    
    <li><a href='../module/m_setup_hamiltonian.html'>m_setup_hamiltonian</a></li>
    
    <li><a href='../module/m_setup_h0.html'>m_setup_H0</a></li>
    
    <li><a href='../module/m_compute_dm.html'>m_compute_dm</a></li>
    
    <li><a href='../module/m_compute_max_diff.html'>m_compute_max_diff</a></li>
    
    <li>m_scfconvergence_test</li>
    
    <li>m_post_scf_work</li>
    
    <li>m_mixer</li>
    
    <li><a href='../module/m_mixing_scf.html'>m_mixing_scf</a></li>
    
    <li><a href='../module/m_mixing_scf.html'>m_mixing_scf</a></li>
    
    <li><a href='../module/m_mixing_scf.html'>m_mixing_scf</a></li>
    
    <li>m_rhog</li>
    
    <li>siesta_options</li>
    
    <li>parallel</li>
    
    <li><a href='../module/m_state_analysis.html'>m_state_analysis</a></li>
    
    <li>m_steps</li>
    
    <li>m_spin</li>
    
    <li>sparse_matrices</li>
    
    <li>sparse_matrices</li>
    
    <li>m_convergence</li>
    
    <li>m_convergence</li>
    
    <li>siesta_geom</li>
    
    <li>m_energies</li>
    
    <li>m_forces</li>
    
    <li>m_stress</li>
    
    <li>siesta_master</li>
    
    <li>siesta_master</li>
    
    <li>m_save_density_matrix</li>
    
    <li>m_iodm_old</li>
    
    <li>atomlist</li>
    
    <li>m_dm_charge</li>
    
    <li>m_pexsi_solver</li>
    
    <li>write_subs</li>
    
    <li>write_subs</li>
    
    <li>m_compute_energies</li>
    
    <li>m_mpi_utils</li>
    
    <li>fdf</li>
    
    <li>m_check_walltime</li>
    
    <li>m_energies</li>
    
    <li>m_ts_options</li>
    
    <li>m_ts_method</li>
    
    <li>m_ts_global_vars</li>
    
    <li>siesta_geom</li>
    
    <li>sparse_matrices</li>
    
    <li>sparse_matrices</li>
    
    <li>m_ts_charge</li>
    
    <li>m_ts_charge</li>
    
    <li>m_ts_charge</li>
    
    <li>m_ts_charge</li>
    
    <li>m_transiesta</li>
    
    <li>kpoint_scf_m</li>
    
    <li>m_energies</li>
    
    <li>m_initwf</li>
    
  </ul>
      </li>
      
      
      
      <li class="list-group-item">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: proc~~siesta_forces~~UsesGraph Pages: 1 -->
<svg id="procsiesta_forcesUsesGraph" width="555pt" height="1826pt"
 viewBox="0.00 0.00 555.00 1826.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~siesta_forces~~UsesGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 1822)">
<title>proc~~siesta_forces~~UsesGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1822 551,-1822 551,4 -4,4"/>
<!-- proc~siesta_forces -->
<g id="proc~~siesta_forces~~UsesGraph_node1" class="node">
<title>proc~siesta_forces</title>
<polygon fill="none" stroke="#000000" points="547,-923 471,-923 471,-899 547,-899 547,-923"/>
<text text-anchor="middle" x="509" y="-908.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">siesta_forces</text>
</g>
<!-- module~m_state_init -->
<g id="proc~~siesta_forces~~UsesGraph_node2" class="node">
<title>module~m_state_init</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node2"><a xlink:href=".././module/m_state_init.html" xlink:title="m_state_init">
<polygon fill="#337ab7" stroke="#337ab7" points="407,-1818 337,-1818 337,-1794 407,-1794 407,-1818"/>
<text text-anchor="middle" x="372" y="-1803.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_state_init</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_state_init -->
<g id="proc~~siesta_forces~~UsesGraph_edge1" class="edge">
<title>proc~siesta_forces&#45;&gt;module~m_state_init</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.7662,-923.2365C506.7394,-1023.9419 490.8578,-1714.0233 435,-1785 430.2941,-1790.9796 423.8273,-1795.2717 416.8203,-1798.3491"/>
<polygon fill="#000000" stroke="#000000" points="415.2873,-1795.1799 407.0451,-1801.837 417.6397,-1801.7728 415.2873,-1795.1799"/>
</g>
<!-- m_save_density_matrix -->
<g id="proc~~siesta_forces~~UsesGraph_node3" class="node">
<title>m_save_density_matrix</title>
<polygon fill="#337ab7" stroke="#337ab7" points="434.5,-1776 309.5,-1776 309.5,-1752 434.5,-1752 434.5,-1776"/>
<text text-anchor="middle" x="372" y="-1761.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_save_density_matrix</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_save_density_matrix -->
<g id="proc~~siesta_forces~~UsesGraph_edge5" class="edge">
<title>proc~siesta_forces&#45;&gt;m_save_density_matrix</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.6654,-923.1594C505.8936,-1020.3617 485.5623,-1669.2777 435,-1738 432.7276,-1741.0885 430.021,-1743.8118 427.0265,-1746.2127"/>
<polygon fill="#000000" stroke="#000000" points="424.9303,-1743.403 418.5282,-1751.8448 428.7973,-1749.238 424.9303,-1743.403"/>
</g>
<!-- module~m_compute_max_diff -->
<g id="proc~~siesta_forces~~UsesGraph_node4" class="node">
<title>module~m_compute_max_diff</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node4"><a xlink:href=".././module/m_compute_max_diff.html" xlink:title="m_compute_max_diff">
<polygon fill="#337ab7" stroke="#337ab7" points="273,-1614 158,-1614 158,-1590 273,-1590 273,-1614"/>
<text text-anchor="middle" x="215.5" y="-1599.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_compute_max_diff</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_compute_max_diff -->
<g id="proc~~siesta_forces~~UsesGraph_edge2" class="edge">
<title>proc~siesta_forces&#45;&gt;module~m_compute_max_diff</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.5735,-923.1271C505.4047,-1009.9409 484.2723,-1534.8641 435,-1583 394.0446,-1623.0108 325.9381,-1622.7276 276.4344,-1615.5921"/>
<polygon fill="#000000" stroke="#000000" points="276.9044,-1612.1232 266.4828,-1614.0307 275.8194,-1619.0386 276.9044,-1612.1232"/>
</g>
<!-- sys -->
<g id="proc~~siesta_forces~~UsesGraph_node5" class="node">
<title>sys</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-1696 345,-1696 345,-1672 399,-1672 399,-1696"/>
<text text-anchor="middle" x="372" y="-1681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">sys</text>
</g>
<!-- proc~siesta_forces&#45;&gt;sys -->
<g id="proc~~siesta_forces~~UsesGraph_edge4" class="edge">
<title>proc~siesta_forces&#45;&gt;sys</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.5895,-923.2372C505.386,-1015.703 483.2292,-1602.5683 435,-1663 428.5275,-1671.1101 418.8195,-1676.1133 408.9508,-1679.1917"/>
<polygon fill="#000000" stroke="#000000" points="407.979,-1675.8272 399.1425,-1681.6724 409.6954,-1682.6136 407.979,-1675.8272"/>
</g>
<!-- parallel -->
<g id="proc~~siesta_forces~~UsesGraph_node6" class="node">
<title>parallel</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-1654 345,-1654 345,-1630 399,-1630 399,-1654"/>
<text text-anchor="middle" x="372" y="-1639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel</text>
</g>
<!-- proc~siesta_forces&#45;&gt;parallel -->
<g id="proc~~siesta_forces~~UsesGraph_edge3" class="edge">
<title>proc~siesta_forces&#45;&gt;parallel</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.4745,-923.0019C504.5159,-1011.258 478.3399,-1558.0307 435,-1616 428.557,-1624.6178 418.7418,-1630.3939 408.7632,-1634.2597"/>
<polygon fill="#000000" stroke="#000000" points="407.6426,-1630.9438 399.2508,-1637.4112 409.8441,-1637.5886 407.6426,-1630.9438"/>
</g>
<!-- module~m_mixing_scf -->
<g id="proc~~siesta_forces~~UsesGraph_node7" class="node">
<title>module~m_mixing_scf</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node7"><a xlink:href=".././module/m_mixing_scf.html" xlink:title="m_mixing_scf">
<polygon fill="#337ab7" stroke="#337ab7" points="411,-860 333,-860 333,-836 411,-836 411,-860"/>
<text text-anchor="middle" x="372" y="-845.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_mixing_scf</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_mixing_scf -->
<g id="proc~~siesta_forces~~UsesGraph_edge6" class="edge">
<title>proc~siesta_forces&#45;&gt;module~m_mixing_scf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M490.0596,-898.8864C475.4171,-889.8616 454.432,-877.6543 435,-869 430.3791,-866.942 425.4917,-864.9727 420.5647,-863.1219"/>
<polygon fill="#000000" stroke="#000000" points="421.6953,-859.8091 411.1009,-859.7171 419.3255,-866.3958 421.6953,-859.8091"/>
</g>
<!-- atomlist -->
<g id="proc~~siesta_forces~~UsesGraph_node8" class="node">
<title>atomlist</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-1574 345,-1574 345,-1550 399,-1550 399,-1574"/>
<text text-anchor="middle" x="372" y="-1559.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">atomlist</text>
</g>
<!-- proc~siesta_forces&#45;&gt;atomlist -->
<g id="proc~~siesta_forces~~UsesGraph_edge7" class="edge">
<title>proc~siesta_forces&#45;&gt;atomlist</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.3552,-923.0512C503.816,-1006.0394 475.6589,-1491.0266 435,-1541 428.4514,-1549.0488 418.7208,-1554.0338 408.8548,-1557.1144"/>
<polygon fill="#000000" stroke="#000000" points="407.8871,-1553.749 399.0566,-1559.6032 409.6105,-1560.5335 407.8871,-1553.749"/>
</g>
<!-- m_ts_method -->
<g id="proc~~siesta_forces~~UsesGraph_node9" class="node">
<title>m_ts_method</title>
<polygon fill="#337ab7" stroke="#337ab7" points="411,-1532 333,-1532 333,-1508 411,-1508 411,-1532"/>
<text text-anchor="middle" x="372" y="-1517.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ts_method</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_ts_method -->
<g id="proc~~siesta_forces~~UsesGraph_edge8" class="edge">
<title>proc~siesta_forces&#45;&gt;m_ts_method</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.2523,-923.0067C503.1961,-1002.6204 473.0568,-1452.6178 435,-1499 431.1115,-1503.7392 426.1205,-1507.4156 420.6526,-1510.2663"/>
<polygon fill="#000000" stroke="#000000" points="418.9424,-1507.1903 411.111,-1514.3262 421.6831,-1513.6315 418.9424,-1507.1903"/>
</g>
<!-- module~m_compute_dm -->
<g id="proc~~siesta_forces~~UsesGraph_node10" class="node">
<title>module~m_compute_dm</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node10"><a xlink:href=".././module/m_compute_dm.html" xlink:title="m_compute_dm">
<polygon fill="#337ab7" stroke="#337ab7" points="417,-1490 327,-1490 327,-1466 417,-1466 417,-1490"/>
<text text-anchor="middle" x="372" y="-1475.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_compute_dm</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_compute_dm -->
<g id="proc~~siesta_forces~~UsesGraph_edge9" class="edge">
<title>proc~siesta_forces&#45;&gt;module~m_compute_dm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.1041,-923.3702C502.4122,-1000.5655 470.3965,-1414.2763 435,-1457 432.4256,-1460.1073 429.3776,-1462.7575 426.0335,-1465.0175"/>
<polygon fill="#000000" stroke="#000000" points="424.2875,-1461.9832 417.2124,-1469.8695 427.6612,-1468.1166 424.2875,-1461.9832"/>
</g>
<!-- m_scfconvergence_test -->
<g id="proc~~siesta_forces~~UsesGraph_node11" class="node">
<title>m_scfconvergence_test</title>
<polygon fill="#337ab7" stroke="#337ab7" points="435,-1448 309,-1448 309,-1424 435,-1424 435,-1448"/>
<text text-anchor="middle" x="372" y="-1433.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_scfconvergence_test</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_scfconvergence_test -->
<g id="proc~~siesta_forces~~UsesGraph_edge10" class="edge">
<title>proc~siesta_forces&#45;&gt;m_scfconvergence_test</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.8864,-923.1278C507.9998,-992.3414 500.3181,-1337.0435 435,-1415 434.2596,-1415.8837 433.4808,-1416.7304 432.6679,-1417.5417"/>
<polygon fill="#000000" stroke="#000000" points="430.2415,-1414.997 424.5408,-1423.9274 434.5664,-1420.5012 430.2415,-1414.997"/>
</g>
<!-- m_convergence -->
<g id="proc~~siesta_forces~~UsesGraph_node12" class="node">
<title>m_convergence</title>
<polygon fill="#337ab7" stroke="#337ab7" points="416.5,-1406 327.5,-1406 327.5,-1382 416.5,-1382 416.5,-1406"/>
<text text-anchor="middle" x="372" y="-1391.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_convergence</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_convergence -->
<g id="proc~~siesta_forces~~UsesGraph_edge11" class="edge">
<title>proc~siesta_forces&#45;&gt;m_convergence</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.7011,-923.3992C506.8603,-989.7272 495.0662,-1302.2538 435,-1373 432.3475,-1376.1241 429.217,-1378.7855 425.7923,-1381.0525"/>
<polygon fill="#000000" stroke="#000000" points="423.9184,-1378.0865 416.7782,-1385.9139 427.2412,-1384.2476 423.9184,-1378.0865"/>
</g>
<!-- m_dm_charge -->
<g id="proc~~siesta_forces~~UsesGraph_node13" class="node">
<title>m_dm_charge</title>
<polygon fill="#337ab7" stroke="#337ab7" points="413,-1364 331,-1364 331,-1340 413,-1340 413,-1364"/>
<text text-anchor="middle" x="372" y="-1349.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_dm_charge</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_dm_charge -->
<g id="proc~~siesta_forces~~UsesGraph_edge12" class="edge">
<title>proc~siesta_forces&#45;&gt;m_dm_charge</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.498,-923.0861C505.6884,-985.1103 490.0076,-1267.2253 435,-1331 431.5126,-1335.0432 427.2252,-1338.3108 422.5413,-1340.9511"/>
<polygon fill="#000000" stroke="#000000" points="420.7582,-1337.9195 413.1514,-1345.2943 423.6969,-1344.2728 420.7582,-1337.9195"/>
</g>
<!-- m_stress -->
<g id="proc~~siesta_forces~~UsesGraph_node14" class="node">
<title>m_stress</title>
<polygon fill="#337ab7" stroke="#337ab7" points="400,-1322 344,-1322 344,-1298 400,-1298 400,-1322"/>
<text text-anchor="middle" x="372" y="-1307.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_stress</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_stress -->
<g id="proc~~siesta_forces~~UsesGraph_edge13" class="edge">
<title>proc~siesta_forces&#45;&gt;m_stress</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.245,-923.0184C504.3661,-981.1018 484.8929,-1232.2497 435,-1289 428.5027,-1296.3903 419.3349,-1301.187 409.9995,-1304.2981"/>
<polygon fill="#000000" stroke="#000000" points="409.0253,-1300.936 400.3153,-1306.968 410.8859,-1307.6842 409.0253,-1300.936"/>
</g>
<!-- units -->
<g id="proc~~siesta_forces~~UsesGraph_node15" class="node">
<title>units</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-1280 345,-1280 345,-1256 399,-1256 399,-1280"/>
<text text-anchor="middle" x="372" y="-1265.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">units</text>
</g>
<!-- proc~siesta_forces&#45;&gt;units -->
<g id="proc~~siesta_forces~~UsesGraph_edge14" class="edge">
<title>proc~siesta_forces&#45;&gt;units</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M507.9183,-923.1068C502.8457,-977.3197 479.7579,-1197.2786 435,-1247 428.2447,-1254.5044 418.7383,-1259.332 409.1537,-1262.4359"/>
<polygon fill="#000000" stroke="#000000" points="408.0044,-1259.1203 399.2492,-1265.0866 409.8142,-1265.8823 408.0044,-1259.1203"/>
</g>
<!-- sparse_matrices -->
<g id="proc~~siesta_forces~~UsesGraph_node16" class="node">
<title>sparse_matrices</title>
<polygon fill="#337ab7" stroke="#337ab7" points="417.5,-1238 326.5,-1238 326.5,-1214 417.5,-1214 417.5,-1238"/>
<text text-anchor="middle" x="372" y="-1223.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">sparse_matrices</text>
</g>
<!-- proc~siesta_forces&#45;&gt;sparse_matrices -->
<g id="proc~~siesta_forces~~UsesGraph_edge15" class="edge">
<title>proc~siesta_forces&#45;&gt;sparse_matrices</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M507.4902,-923.2509C501.083,-973.3833 474.6405,-1162.2617 435,-1205 432.534,-1207.6587 429.723,-1209.9811 426.6889,-1212.0097"/>
<polygon fill="#000000" stroke="#000000" points="424.7228,-1209.0966 417.6489,-1216.984 428.0975,-1215.2294 424.7228,-1209.0966"/>
</g>
<!-- kpoint_scf_m -->
<g id="proc~~siesta_forces~~UsesGraph_node17" class="node">
<title>kpoint_scf_m</title>
<polygon fill="#337ab7" stroke="#337ab7" points="410,-1196 334,-1196 334,-1172 410,-1172 410,-1196"/>
<text text-anchor="middle" x="372" y="-1181.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">kpoint_scf_m</text>
</g>
<!-- proc~siesta_forces&#45;&gt;kpoint_scf_m -->
<g id="proc~~siesta_forces~~UsesGraph_edge16" class="edge">
<title>proc~siesta_forces&#45;&gt;kpoint_scf_m</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M506.9816,-923.0185C499.1746,-968.1916 469.6617,-1127.0629 435,-1163 430.7443,-1167.4123 425.5385,-1170.8977 419.961,-1173.6509"/>
<polygon fill="#000000" stroke="#000000" points="418.2342,-1170.5771 410.3256,-1177.6272 420.9046,-1177.0477 418.2342,-1170.5771"/>
</g>
<!-- files -->
<g id="proc~~siesta_forces~~UsesGraph_node18" class="node">
<title>files</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-1154 345,-1154 345,-1130 399,-1130 399,-1154"/>
<text text-anchor="middle" x="372" y="-1139.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">files</text>
</g>
<!-- proc~siesta_forces&#45;&gt;files -->
<g id="proc~~siesta_forces~~UsesGraph_edge17" class="edge">
<title>proc~siesta_forces&#45;&gt;files</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.3171,-923.1372C505.6592,-958.7369 493.0256,-1063.955 435,-1121 427.8608,-1128.0186 418.3162,-1132.6919 408.8194,-1135.8035"/>
<polygon fill="#000000" stroke="#000000" points="407.7445,-1132.4694 399.0429,-1138.5137 409.6145,-1139.2151 407.7445,-1132.4694"/>
</g>
<!-- siesta_options -->
<g id="proc~~siesta_forces~~UsesGraph_node19" class="node">
<title>siesta_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="412.5,-1112 331.5,-1112 331.5,-1088 412.5,-1088 412.5,-1112"/>
<text text-anchor="middle" x="372" y="-1097.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_options</text>
</g>
<!-- proc~siesta_forces&#45;&gt;siesta_options -->
<g id="proc~~siesta_forces~~UsesGraph_edge18" class="edge">
<title>proc~siesta_forces&#45;&gt;siesta_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M507.1102,-923.1076C501.697,-953.7396 483.2998,-1035.0023 435,-1079 431.1566,-1082.501 426.7125,-1085.4203 421.9985,-1087.854"/>
<polygon fill="#000000" stroke="#000000" points="420.4244,-1084.7229 412.6876,-1091.9612 423.2496,-1091.1275 420.4244,-1084.7229"/>
</g>
<!-- m_ts_options -->
<g id="proc~~siesta_forces~~UsesGraph_node20" class="node">
<title>m_ts_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="410,-1070 334,-1070 334,-1046 410,-1046 410,-1070"/>
<text text-anchor="middle" x="372" y="-1055.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ts_options</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_ts_options -->
<g id="proc~~siesta_forces~~UsesGraph_edge19" class="edge">
<title>proc~siesta_forces&#45;&gt;m_ts_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M505.0781,-923.3626C496.4895,-948.4718 473.6391,-1005.7055 435,-1037 430.4084,-1040.7188 425.1303,-1043.7903 419.6246,-1046.3246"/>
<polygon fill="#000000" stroke="#000000" points="418.1988,-1043.1255 410.225,-1050.1019 420.8089,-1049.6206 418.1988,-1043.1255"/>
</g>
<!-- siesta_cml -->
<g id="proc~~siesta_forces~~UsesGraph_node21" class="node">
<title>siesta_cml</title>
<polygon fill="#337ab7" stroke="#337ab7" points="403.5,-1028 340.5,-1028 340.5,-1004 403.5,-1004 403.5,-1028"/>
<text text-anchor="middle" x="372" y="-1013.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_cml</text>
</g>
<!-- proc~siesta_forces&#45;&gt;siesta_cml -->
<g id="proc~~siesta_forces~~UsesGraph_edge20" class="edge">
<title>proc~siesta_forces&#45;&gt;siesta_cml</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M501.4164,-923.1011C489.4489,-941.2485 464.4866,-975.4624 435,-995 428.3775,-999.388 420.7558,-1002.9353 413.1525,-1005.7765"/>
<polygon fill="#000000" stroke="#000000" points="411.9576,-1002.4858 403.6082,-1009.0078 414.2025,-1009.1161 411.9576,-1002.4858"/>
</g>
<!-- fdf -->
<g id="proc~~siesta_forces~~UsesGraph_node22" class="node">
<title>fdf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-986 345,-986 345,-962 399,-962 399,-986"/>
<text text-anchor="middle" x="372" y="-971.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fdf</text>
</g>
<!-- proc~siesta_forces&#45;&gt;fdf -->
<g id="proc~~siesta_forces~~UsesGraph_edge21" class="edge">
<title>proc~siesta_forces&#45;&gt;fdf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M490.0596,-923.1136C475.4171,-932.1384 454.432,-944.3457 435,-953 426.6593,-956.7147 417.4498,-960.1407 408.7074,-963.1013"/>
<polygon fill="#000000" stroke="#000000" points="407.526,-959.8051 399.1066,-966.2366 409.6991,-966.4593 407.526,-959.8051"/>
</g>
<!-- m_check_walltime -->
<g id="proc~~siesta_forces~~UsesGraph_node23" class="node">
<title>m_check_walltime</title>
<polygon fill="#337ab7" stroke="#337ab7" points="422,-944 322,-944 322,-920 422,-920 422,-944"/>
<text text-anchor="middle" x="372" y="-929.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_check_walltime</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_check_walltime -->
<g id="proc~~siesta_forces~~UsesGraph_edge22" class="edge">
<title>proc~siesta_forces&#45;&gt;m_check_walltime</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M470.8379,-916.8497C458.7873,-918.6968 445.167,-920.7846 431.9751,-922.8067"/>
<polygon fill="#000000" stroke="#000000" points="431.358,-919.3604 422.0038,-924.3352 432.4187,-926.2795 431.358,-919.3604"/>
</g>
<!-- m_forces -->
<g id="proc~~siesta_forces~~UsesGraph_node24" class="node">
<title>m_forces</title>
<polygon fill="#337ab7" stroke="#337ab7" points="400.5,-902 343.5,-902 343.5,-878 400.5,-878 400.5,-902"/>
<text text-anchor="middle" x="372" y="-887.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_forces</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_forces -->
<g id="proc~~siesta_forces~~UsesGraph_edge23" class="edge">
<title>proc~siesta_forces&#45;&gt;m_forces</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M470.8379,-905.1503C452.133,-902.2832 429.646,-898.8362 410.8497,-895.9551"/>
<polygon fill="#000000" stroke="#000000" points="411.2494,-892.4755 400.8345,-894.4199 410.1887,-899.3947 411.2494,-892.4755"/>
</g>
<!-- precision -->
<g id="proc~~siesta_forces~~UsesGraph_node25" class="node">
<title>precision</title>
<polygon fill="#337ab7" stroke="#337ab7" points="88.5,-1614 33.5,-1614 33.5,-1590 88.5,-1590 88.5,-1614"/>
<text text-anchor="middle" x="61" y="-1599.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">precision</text>
</g>
<!-- proc~siesta_forces&#45;&gt;precision -->
<g id="proc~~siesta_forces~~UsesGraph_edge24" class="edge">
<title>proc~siesta_forces&#45;&gt;precision</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.8305,-923.1593C507.3737,-1018.9554 495.5065,-1649.8704 435,-1705 330.8734,-1799.8734 147.2329,-1670.9582 83.5205,-1620.6095"/>
<polygon fill="#000000" stroke="#000000" points="85.3389,-1617.5815 75.3471,-1614.058 80.9608,-1623.0434 85.3389,-1617.5815"/>
</g>
<!-- m_pexsi_solver -->
<g id="proc~~siesta_forces~~UsesGraph_node26" class="node">
<title>m_pexsi_solver</title>
<polygon fill="#337ab7" stroke="#337ab7" points="415.5,-818 328.5,-818 328.5,-794 415.5,-794 415.5,-818"/>
<text text-anchor="middle" x="372" y="-803.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_pexsi_solver</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_pexsi_solver -->
<g id="proc~~siesta_forces~~UsesGraph_edge25" class="edge">
<title>proc~siesta_forces&#45;&gt;m_pexsi_solver</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M501.4164,-898.8989C489.4489,-880.7515 464.4866,-846.5376 435,-827 431.8855,-824.9363 428.55,-823.0586 425.0993,-821.3529"/>
<polygon fill="#000000" stroke="#000000" points="426.3303,-818.0704 415.7689,-817.2296 423.5008,-824.4731 426.3303,-818.0704"/>
</g>
<!-- m_initwf -->
<g id="proc~~siesta_forces~~UsesGraph_node27" class="node">
<title>m_initwf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-776 345,-776 345,-752 399,-752 399,-776"/>
<text text-anchor="middle" x="372" y="-761.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_initwf</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_initwf -->
<g id="proc~~siesta_forces~~UsesGraph_edge26" class="edge">
<title>proc~siesta_forces&#45;&gt;m_initwf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M505.0781,-898.6374C496.4895,-873.5282 473.6391,-816.2945 435,-785 427.4994,-778.9252 418.167,-774.5777 409.003,-771.4775"/>
<polygon fill="#000000" stroke="#000000" points="409.8022,-768.064 399.2199,-768.5803 407.8144,-774.7759 409.8022,-768.064"/>
</g>
<!-- m_ts_charge -->
<g id="proc~~siesta_forces~~UsesGraph_node28" class="node">
<title>m_ts_charge</title>
<polygon fill="#337ab7" stroke="#337ab7" points="409.5,-734 334.5,-734 334.5,-710 409.5,-710 409.5,-734"/>
<text text-anchor="middle" x="372" y="-719.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ts_charge</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_ts_charge -->
<g id="proc~~siesta_forces~~UsesGraph_edge27" class="edge">
<title>proc~siesta_forces&#45;&gt;m_ts_charge</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M507.1102,-898.8924C501.697,-868.2604 483.2998,-786.9977 435,-743 430.3576,-738.7711 424.8387,-735.3911 419.0264,-732.6901"/>
<polygon fill="#000000" stroke="#000000" points="420.32,-729.438 409.7351,-728.9804 417.7243,-735.939 420.32,-729.438"/>
</g>
<!-- module~m_setup_h0 -->
<g id="proc~~siesta_forces~~UsesGraph_node29" class="node">
<title>module~m_setup_h0</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node29"><a xlink:href=".././module/m_setup_h0.html" xlink:title="m_setup_H0">
<polygon fill="#337ab7" stroke="#337ab7" points="408.5,-692 335.5,-692 335.5,-668 408.5,-668 408.5,-692"/>
<text text-anchor="middle" x="372" y="-677.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_setup_H0</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_setup_h0 -->
<g id="proc~~siesta_forces~~UsesGraph_edge28" class="edge">
<title>proc~siesta_forces&#45;&gt;module~m_setup_h0</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.3171,-898.8628C505.6592,-863.2631 493.0256,-758.045 435,-701 430.306,-696.3854 424.5722,-692.7845 418.4959,-689.9749"/>
<polygon fill="#000000" stroke="#000000" points="419.3538,-686.5527 408.7656,-686.1788 416.8097,-693.074 419.3538,-686.5527"/>
</g>
<!-- m_post_scf_work -->
<g id="proc~~siesta_forces~~UsesGraph_node30" class="node">
<title>m_post_scf_work</title>
<polygon fill="#337ab7" stroke="#337ab7" points="420,-650 324,-650 324,-626 420,-626 420,-650"/>
<text text-anchor="middle" x="372" y="-635.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_post_scf_work</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_post_scf_work -->
<g id="proc~~siesta_forces~~UsesGraph_edge29" class="edge">
<title>proc~siesta_forces&#45;&gt;m_post_scf_work</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M506.9816,-898.9815C499.1746,-853.8084 469.6617,-694.9371 435,-659 433.1441,-657.0758 431.1076,-655.328 428.9384,-653.7402"/>
<polygon fill="#000000" stroke="#000000" points="430.389,-650.5285 420.0151,-648.3759 426.7823,-656.5279 430.389,-650.5285"/>
</g>
<!-- m_energies -->
<g id="proc~~siesta_forces~~UsesGraph_node31" class="node">
<title>m_energies</title>
<polygon fill="#337ab7" stroke="#337ab7" points="406.5,-608 337.5,-608 337.5,-584 406.5,-584 406.5,-608"/>
<text text-anchor="middle" x="372" y="-593.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_energies</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_energies -->
<g id="proc~~siesta_forces~~UsesGraph_edge30" class="edge">
<title>proc~siesta_forces&#45;&gt;m_energies</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M507.4902,-898.7491C501.083,-848.6167 474.6405,-659.7383 435,-617 429.8793,-611.4792 423.2709,-607.4085 416.267,-604.4074"/>
<polygon fill="#000000" stroke="#000000" points="417.1685,-601.0128 406.5739,-600.9421 414.8121,-607.6042 417.1685,-601.0128"/>
</g>
<!-- m_rhog -->
<g id="proc~~siesta_forces~~UsesGraph_node32" class="node">
<title>m_rhog</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-566 345,-566 345,-542 399,-542 399,-566"/>
<text text-anchor="middle" x="372" y="-551.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_rhog</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_rhog -->
<g id="proc~~siesta_forces~~UsesGraph_edge31" class="edge">
<title>proc~siesta_forces&#45;&gt;m_rhog</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M507.9183,-898.8932C502.8457,-844.6803 479.7579,-624.7214 435,-575 428.2447,-567.4956 418.7383,-562.668 409.1537,-559.5641"/>
<polygon fill="#000000" stroke="#000000" points="409.8142,-556.1177 399.2492,-556.9134 408.0044,-562.8797 409.8142,-556.1177"/>
</g>
<!-- m_steps -->
<g id="proc~~siesta_forces~~UsesGraph_node33" class="node">
<title>m_steps</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-524 345,-524 345,-500 399,-500 399,-524"/>
<text text-anchor="middle" x="372" y="-509.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_steps</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_steps -->
<g id="proc~~siesta_forces~~UsesGraph_edge32" class="edge">
<title>proc~siesta_forces&#45;&gt;m_steps</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.245,-898.9816C504.3661,-840.8982 484.8929,-589.7503 435,-533 428.2059,-525.2721 418.4918,-520.3802 408.7195,-517.2861"/>
<polygon fill="#000000" stroke="#000000" points="409.594,-513.8971 399.0337,-514.7528 407.8226,-520.6693 409.594,-513.8971"/>
</g>
<!-- m_mixer -->
<g id="proc~~siesta_forces~~UsesGraph_node34" class="node">
<title>m_mixer</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-482 345,-482 345,-458 399,-458 399,-482"/>
<text text-anchor="middle" x="372" y="-467.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_mixer</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_mixer -->
<g id="proc~~siesta_forces~~UsesGraph_edge33" class="edge">
<title>proc~siesta_forces&#45;&gt;m_mixer</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.498,-898.9139C505.6884,-836.8897 490.0076,-554.7747 435,-491 428.2794,-483.2082 418.5875,-478.2969 408.8129,-475.2047"/>
<polygon fill="#000000" stroke="#000000" points="409.6772,-471.8131 399.1178,-472.6796 407.9128,-478.5871 409.6772,-471.8131"/>
</g>
<!-- module~m_setup_hamiltonian -->
<g id="proc~~siesta_forces~~UsesGraph_node35" class="node">
<title>module~m_setup_hamiltonian</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node35"><a xlink:href=".././module/m_setup_hamiltonian.html" xlink:title="m_setup_hamiltonian">
<polygon fill="#337ab7" stroke="#337ab7" points="429.5,-440 314.5,-440 314.5,-416 429.5,-416 429.5,-440"/>
<text text-anchor="middle" x="372" y="-425.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_setup_hamiltonian</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_setup_hamiltonian -->
<g id="proc~~siesta_forces~~UsesGraph_edge34" class="edge">
<title>proc~siesta_forces&#45;&gt;module~m_setup_hamiltonian</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.7011,-898.6008C506.8603,-832.2728 495.0662,-519.7462 435,-449 434.2538,-448.1211 433.4698,-447.2789 432.652,-446.4717"/>
<polygon fill="#000000" stroke="#000000" points="434.5313,-443.499 424.4917,-440.114 430.2291,-449.0209 434.5313,-443.499"/>
</g>
<!-- m_iodm_old -->
<g id="proc~~siesta_forces~~UsesGraph_node36" class="node">
<title>m_iodm_old</title>
<polygon fill="#337ab7" stroke="#337ab7" points="407.5,-398 336.5,-398 336.5,-374 407.5,-374 407.5,-398"/>
<text text-anchor="middle" x="372" y="-383.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_iodm_old</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_iodm_old -->
<g id="proc~~siesta_forces~~UsesGraph_edge35" class="edge">
<title>proc~siesta_forces&#45;&gt;m_iodm_old</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.8864,-898.8722C507.9998,-829.6586 500.3181,-484.9565 435,-407 430.2658,-401.3498 423.9665,-397.2119 417.1793,-394.1835"/>
<polygon fill="#000000" stroke="#000000" points="418.3163,-390.8725 407.7228,-390.7037 415.8988,-397.4418 418.3163,-390.8725"/>
</g>
<!-- siesta_master -->
<g id="proc~~siesta_forces~~UsesGraph_node37" class="node">
<title>siesta_master</title>
<polygon fill="#337ab7" stroke="#337ab7" points="411.5,-356 332.5,-356 332.5,-332 411.5,-332 411.5,-356"/>
<text text-anchor="middle" x="372" y="-341.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_master</text>
</g>
<!-- proc~siesta_forces&#45;&gt;siesta_master -->
<g id="proc~~siesta_forces~~UsesGraph_edge36" class="edge">
<title>proc~siesta_forces&#45;&gt;siesta_master</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.1041,-898.6298C502.4122,-821.4345 470.3965,-407.7237 435,-365 431.1832,-360.3931 426.3253,-356.7911 421.0052,-353.9757"/>
<polygon fill="#000000" stroke="#000000" points="422.2841,-350.7154 411.7175,-349.942 419.4955,-357.136 422.2841,-350.7154"/>
</g>
<!-- siesta_geom -->
<g id="proc~~siesta_forces~~UsesGraph_node38" class="node">
<title>siesta_geom</title>
<polygon fill="#337ab7" stroke="#337ab7" points="408.5,-314 335.5,-314 335.5,-290 408.5,-290 408.5,-314"/>
<text text-anchor="middle" x="372" y="-299.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_geom</text>
</g>
<!-- proc~siesta_forces&#45;&gt;siesta_geom -->
<g id="proc~~siesta_forces~~UsesGraph_edge37" class="edge">
<title>proc~siesta_forces&#45;&gt;siesta_geom</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.2523,-898.9933C503.1961,-819.3796 473.0568,-369.3822 435,-323 430.5779,-317.6105 424.7298,-313.5954 418.3762,-310.6061"/>
<polygon fill="#000000" stroke="#000000" points="419.4026,-307.2507 408.8129,-306.9198 416.8849,-313.7823 419.4026,-307.2507"/>
</g>
<!-- m_compute_energies -->
<g id="proc~~siesta_forces~~UsesGraph_node39" class="node">
<title>m_compute_energies</title>
<polygon fill="#337ab7" stroke="#337ab7" points="430,-272 314,-272 314,-248 430,-248 430,-272"/>
<text text-anchor="middle" x="372" y="-257.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_compute_energies</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_compute_energies -->
<g id="proc~~siesta_forces~~UsesGraph_edge38" class="edge">
<title>proc~siesta_forces&#45;&gt;m_compute_energies</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.3552,-898.9488C503.816,-815.9606 475.6589,-330.9734 435,-281 434.2906,-280.1281 433.5438,-279.2921 432.7636,-278.4906"/>
<polygon fill="#000000" stroke="#000000" points="434.9194,-275.7327 424.9422,-272.1682 430.5189,-281.1766 434.9194,-275.7327"/>
</g>
<!-- write_subs -->
<g id="proc~~siesta_forces~~UsesGraph_node40" class="node">
<title>write_subs</title>
<polygon fill="#337ab7" stroke="#337ab7" points="247.5,-170 183.5,-170 183.5,-146 247.5,-146 247.5,-170"/>
<text text-anchor="middle" x="215.5" y="-155.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_subs</text>
</g>
<!-- proc~siesta_forces&#45;&gt;write_subs -->
<g id="proc~~siesta_forces~~UsesGraph_edge39" class="edge">
<title>proc~siesta_forces&#45;&gt;write_subs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.4655,-898.9726C504.5372,-812.8599 479.0469,-291.9593 435,-239 397.5978,-194.0299 363.7009,-221.7134 309,-201 288.5574,-193.2591 266.2993,-183.0961 248.6299,-174.594"/>
<polygon fill="#000000" stroke="#000000" points="249.8497,-171.2953 239.3263,-170.0675 246.7872,-177.5899 249.8497,-171.2953"/>
</g>
<!-- m_mpi_utils -->
<g id="proc~~siesta_forces~~UsesGraph_node41" class="node">
<title>m_mpi_utils</title>
<polygon fill="#337ab7" stroke="#337ab7" points="407,-192 337,-192 337,-168 407,-168 407,-192"/>
<text text-anchor="middle" x="372" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_mpi_utils</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_mpi_utils -->
<g id="proc~~siesta_forces~~UsesGraph_edge40" class="edge">
<title>proc~siesta_forces&#45;&gt;m_mpi_utils</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.4745,-898.9981C504.5159,-810.742 478.3399,-263.9693 435,-206 430.2176,-199.6033 423.5772,-194.7722 416.3911,-191.126"/>
<polygon fill="#000000" stroke="#000000" points="417.6639,-187.8632 407.0957,-187.1123 414.889,-194.2897 417.6639,-187.8632"/>
</g>
<!-- m_spin -->
<g id="proc~~siesta_forces~~UsesGraph_node42" class="node">
<title>m_spin</title>
<polygon fill="#337ab7" stroke="#337ab7" points="399,-150 345,-150 345,-126 399,-126 399,-150"/>
<text text-anchor="middle" x="372" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_spin</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_spin -->
<g id="proc~~siesta_forces~~UsesGraph_edge41" class="edge">
<title>proc~siesta_forces&#45;&gt;m_spin</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.5895,-898.7628C505.386,-806.297 483.2292,-219.4317 435,-159 428.5275,-150.8899 418.8195,-145.8867 408.9508,-142.8083"/>
<polygon fill="#000000" stroke="#000000" points="409.6954,-139.3864 399.1425,-140.3276 407.979,-146.1728 409.6954,-139.3864"/>
</g>
<!-- module~m_state_analysis -->
<g id="proc~~siesta_forces~~UsesGraph_node43" class="node">
<title>module~m_state_analysis</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node43"><a xlink:href=".././module/m_state_analysis.html" xlink:title="m_state_analysis">
<polygon fill="#337ab7" stroke="#337ab7" points="419.5,-108 324.5,-108 324.5,-84 419.5,-84 419.5,-108"/>
<text text-anchor="middle" x="372" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_state_analysis</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_state_analysis -->
<g id="proc~~siesta_forces~~UsesGraph_edge42" class="edge">
<title>proc~siesta_forces&#45;&gt;module~m_state_analysis</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.6632,-898.997C505.9094,-804.4127 485.8944,-181.1098 435,-117 433.0847,-114.5874 430.8829,-112.4496 428.4754,-110.5556"/>
<polygon fill="#000000" stroke="#000000" points="429.9477,-107.3481 419.614,-105.01 426.2341,-113.2819 429.9477,-107.3481"/>
</g>
<!-- m_transiesta -->
<g id="proc~~siesta_forces~~UsesGraph_node44" class="node">
<title>m_transiesta</title>
<polygon fill="#337ab7" stroke="#337ab7" points="409,-66 335,-66 335,-42 409,-42 409,-66"/>
<text text-anchor="middle" x="372" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_transiesta</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_transiesta -->
<g id="proc~~siesta_forces~~UsesGraph_edge43" class="edge">
<title>proc~siesta_forces&#45;&gt;m_transiesta</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.7221,-898.9879C506.3676,-801.5664 488.5201,-142.7396 435,-75 430.6781,-69.5298 424.8829,-65.4721 418.5516,-62.4649"/>
<polygon fill="#000000" stroke="#000000" points="419.5902,-59.1139 409.001,-58.7684 417.0635,-65.642 419.5902,-59.1139"/>
</g>
<!-- m_ts_global_vars -->
<g id="proc~~siesta_forces~~UsesGraph_node45" class="node">
<title>m_ts_global_vars</title>
<polygon fill="#337ab7" stroke="#337ab7" points="420.5,-24 323.5,-24 323.5,0 420.5,0 420.5,-24"/>
<text text-anchor="middle" x="372" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ts_global_vars</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_ts_global_vars -->
<g id="proc~~siesta_forces~~UsesGraph_edge44" class="edge">
<title>proc~siesta_forces&#45;&gt;m_ts_global_vars</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M508.77,-898.7077C506.7746,-797.5425 491.098,-104.31 435,-33 433.3159,-30.8593 431.4061,-28.9348 429.3266,-27.2049"/>
<polygon fill="#000000" stroke="#000000" points="430.8607,-24.0246 420.5831,-21.4514 427.0128,-29.8722 430.8607,-24.0246"/>
</g>
<!-- module~m_compute_max_diff&#45;&gt;precision -->
<g id="proc~~siesta_forces~~UsesGraph_edge45" class="edge">
<title>module~m_compute_max_diff&#45;&gt;precision</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M157.9699,-1602C138.2681,-1602 116.7323,-1602 98.971,-1602"/>
<polygon fill="#000000" stroke="#000000" points="98.7219,-1598.5001 88.7218,-1602 98.7218,-1605.5001 98.7219,-1598.5001"/>
</g>
<!-- class_Fstack_dData1D -->
<g id="proc~~siesta_forces~~UsesGraph_node46" class="node">
<title>class_Fstack_dData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="122,-860 0,-860 0,-836 122,-836 122,-860"/>
<text text-anchor="middle" x="61" y="-845.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">class_Fstack_dData1D</text>
</g>
<!-- module~m_mixing_scf&#45;&gt;class_Fstack_dData1D -->
<g id="proc~~siesta_forces~~UsesGraph_edge46" class="edge">
<title>module~m_mixing_scf&#45;&gt;class_Fstack_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M332.9265,-848C282.7017,-848 194.561,-848 132.2602,-848"/>
<polygon fill="#000000" stroke="#000000" points="132.1066,-844.5001 122.1066,-848 132.1065,-851.5001 132.1066,-844.5001"/>
</g>
<!-- module~m_mixing -->
<g id="proc~~siesta_forces~~UsesGraph_node47" class="node">
<title>module~m_mixing</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node47"><a xlink:href=".././module/m_mixing.html" xlink:title="m_mixing">
<polygon fill="#337ab7" stroke="#337ab7" points="244.5,-901 186.5,-901 186.5,-877 244.5,-877 244.5,-901"/>
<text text-anchor="middle" x="215.5" y="-886.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_mixing</text>
</a>
</g>
</g>
<!-- module~m_mixing_scf&#45;&gt;module~m_mixing -->
<g id="proc~~siesta_forces~~UsesGraph_edge47" class="edge">
<title>module~m_mixing_scf&#45;&gt;module~m_mixing</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M332.9121,-858.2403C308.9881,-864.5079 278.4837,-872.4995 254.564,-878.766"/>
<polygon fill="#000000" stroke="#000000" points="253.5408,-875.4158 244.7543,-881.3359 255.3149,-882.1873 253.5408,-875.4158"/>
</g>
<!-- module~m_state_analysis&#45;&gt;write_subs -->
<g id="proc~~siesta_forces~~UsesGraph_edge48" class="edge">
<title>module~m_state_analysis&#45;&gt;write_subs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M333.8216,-108.1025C325.5849,-110.8869 316.9619,-113.9347 309,-117 289.4607,-124.5225 268.0459,-133.8323 250.6465,-141.6783"/>
<polygon fill="#000000" stroke="#000000" points="249.0869,-138.5425 241.4307,-145.866 251.9828,-144.9155 249.0869,-138.5425"/>
</g>
<!-- module~m_mixing&#45;&gt;precision -->
<g id="proc~~siesta_forces~~UsesGraph_edge49" class="edge">
<title>module~m_mixing&#45;&gt;precision</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M212.8832,-901.0763C194.9033,-984.0515 89.6491,-1469.7878 65.8024,-1579.8373"/>
<polygon fill="#000000" stroke="#000000" points="62.3376,-1579.3004 63.6404,-1589.8148 69.1788,-1580.7829 62.3376,-1579.3004"/>
</g>
<!-- module~m_mixing&#45;&gt;class_Fstack_dData1D -->
<g id="proc~~siesta_forces~~UsesGraph_edge51" class="edge">
<title>module~m_mixing&#45;&gt;class_Fstack_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M186.4397,-881.2882C166.7065,-876.0516 139.9882,-868.9613 116.2808,-862.67"/>
<polygon fill="#000000" stroke="#000000" points="116.8972,-859.2125 106.3339,-860.0304 115.1016,-865.9783 116.8972,-859.2125"/>
</g>
<!-- class_dData1D -->
<g id="proc~~siesta_forces~~UsesGraph_node48" class="node">
<title>class_dData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="103.5,-902 18.5,-902 18.5,-878 103.5,-878 103.5,-902"/>
<text text-anchor="middle" x="61" y="-887.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">class_dData1D</text>
</g>
<!-- module~m_mixing&#45;&gt;class_dData1D -->
<g id="proc~~siesta_forces~~UsesGraph_edge50" class="edge">
<title>module~m_mixing&#45;&gt;class_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M186.4397,-889.1881C166.0181,-889.3203 138.1156,-889.5009 113.8112,-889.6582"/>
<polygon fill="#000000" stroke="#000000" points="113.6247,-886.1592 103.6476,-889.724 113.6701,-893.1591 113.6247,-886.1592"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="490pt" height="32pt"
 viewBox="0.00 0.00 489.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 485.5,-28 485.5,4 -4,4"/>
<!-- Module -->
<g id="node1" class="node">
<title>Module</title>
<polygon fill="#337ab7" stroke="#337ab7" points="54,-24 0,-24 0,0 54,0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Module</text>
</g>
<!-- Submodule -->
<g id="node2" class="node">
<title>Submodule</title>
<polygon fill="#5bc0de" stroke="#5bc0de" points="139.5,-24 72.5,-24 72.5,0 139.5,0 139.5,-24"/>
<text text-anchor="middle" x="106" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Submodule</text>
</g>
<!-- Subroutine -->
<g id="node3" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="222,-24 158,-24 158,0 222,0 222,-24"/>
<text text-anchor="middle" x="190" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Subroutine</text>
</g>
<!-- Function -->
<g id="node4" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="294,-24 240,-24 240,0 294,0 294,-24"/>
<text text-anchor="middle" x="267" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Function</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="366,-24 312,-24 312,0 366,0 366,-24"/>
<text text-anchor="middle" x="339" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="481.5,-24 384.5,-24 384.5,0 481.5,0 481.5,-24"/>
<text text-anchor="middle" x="433" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a submodule to the (sub)module which it is
    descended from. Dashed arrows point from a module or program unit to 
    modules which it uses.
    </p>
    </div></div></div></div>
      </li>
      
      </ul>
    </div>
    


    
    <p>This subroutine represents central SIESTA operation logic.</p>
<p></p><div class="alert alert-success" role="alert"><h4>Todo</h4><p>It might be better to split the two,
  putting the grid initialization into <strong>state_init (link!)</strong> and moving the
  calculation of <script type="math/tex"> H_0 </script> to the body of the loop, done <code>if first_scf=.true.</code>
  This would suit <em>analysis</em> runs in which <strong>nscf = 0</strong>
</p></div>
<p>
<p>The dHmax variable only has meaning for Hamiltonian
  mixing, or when requiring the Hamiltonian to be converged.</p>
<h1>SCF loop</h1>
<p>The current structure of the loop tries to reproduce the
  historical Siesta usage. It should be made more clear.</p>
<p>Two changes:</p>
<ol>
<li>The number of scf iterations performed is exactly
     equal to the number specified (i.e., the "forces"
     phase is not counted as a final scf step)</li>
<li>At the change to a TranSiesta GF run the variable "first_scf"
     is implicitly reset to "true".</li>
</ol>
<h2>Start of SCF cycle</h2>
<p>Conditions of exit:</p>
<ul>
<li>At the top, to catch a non-positive nscf and # of iterations</li>
<li>At the bottom, based on convergence</li>
</ul>
<p>Note implications for TranSiesta when mixing <script type="math/tex">H</script>.
  Now <script type="math/tex">H</script> will be recomputed instead of simply being
  inherited, however, this is required as if
  we have bias calculations as the electric
  field across the junction needs to be present.</p>
<p><strong>end of SCF cycle</strong></p>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-istep%7E3"></span>integer,</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>istep</strong></td><td></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: proc~~siesta_forces~~CallsGraph Pages: 1 -->
<svg id="procsiesta_forcesCallsGraph" width="525pt" height="4321pt"
 viewBox="0.00 0.00 525.00 4321.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~siesta_forces~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 4317)">
<title>proc~~siesta_forces~~CallsGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-4317 521,-4317 521,4 -4,4"/>
<!-- proc~siesta_forces -->
<g id="proc~~siesta_forces~~CallsGraph_node1" class="node">
<title>proc~siesta_forces</title>
<polygon fill="none" stroke="#000000" points="76,-566 0,-566 0,-542 76,-542 76,-566"/>
<text text-anchor="middle" x="38" y="-551.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">siesta_forces</text>
</g>
<!-- set_tolerance -->
<g id="proc~~siesta_forces~~CallsGraph_node2" class="node">
<title>set_tolerance</title>
<polygon fill="#777777" stroke="#777777" points="211,-3931 134,-3931 134,-3907 211,-3907 211,-3931"/>
<text text-anchor="middle" x="172.5" y="-3916.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">set_tolerance</text>
</g>
<!-- proc~siesta_forces&#45;&gt;set_tolerance -->
<g id="proc~~siesta_forces~~CallsGraph_edge1" class="edge">
<title>proc~siesta_forces&#45;&gt;set_tolerance</title>
<path fill="none" stroke="#000000" d="M38.0743,-566.167C39.4212,-782.9785 59.2552,-3825.5699 112,-3898 115.3134,-3902.55 119.6823,-3906.1217 124.5596,-3908.9241"/>
<polygon fill="#000000" stroke="#000000" points="123.2241,-3912.1625 133.7697,-3913.1826 126.1619,-3905.8088 123.2241,-3912.1625"/>
</g>
<!-- mix_rhog -->
<g id="proc~~siesta_forces~~CallsGraph_node3" class="node">
<title>mix_rhog</title>
<polygon fill="#777777" stroke="#777777" points="201,-3889 144,-3889 144,-3865 201,-3865 201,-3889"/>
<text text-anchor="middle" x="172.5" y="-3874.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mix_rhog</text>
</g>
<!-- proc~siesta_forces&#45;&gt;mix_rhog -->
<g id="proc~~siesta_forces~~CallsGraph_edge2" class="edge">
<title>proc~siesta_forces&#45;&gt;mix_rhog</title>
<path fill="none" stroke="#000000" d="M38.0894,-566.3158C39.6816,-782.6663 62.6061,-3777.8119 112,-3851 117.3072,-3858.8637 125.5308,-3864.3613 134.2225,-3868.2005"/>
<polygon fill="#000000" stroke="#000000" points="133.1292,-3871.5282 143.7218,-3871.7489 135.5788,-3864.9708 133.1292,-3871.5282"/>
</g>
<!-- bye -->
<g id="proc~~siesta_forces~~CallsGraph_node4" class="node">
<title>bye</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3683 317.5,-3683 317.5,-3659 371.5,-3659 371.5,-3683"/>
<text text-anchor="middle" x="344.5" y="-3668.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">bye</text>
</g>
<!-- proc~siesta_forces&#45;&gt;bye -->
<g id="proc~~siesta_forces~~CallsGraph_edge3" class="edge">
<title>proc~siesta_forces&#45;&gt;bye</title>
<path fill="none" stroke="#000000" d="M38.1587,-566.1239C40.7141,-759.8218 73.7753,-3211.4051 112,-3356 149.8589,-3499.2111 153.4273,-3557.3411 269,-3650 279.9118,-3658.7484 294.2341,-3663.857 307.4686,-3666.8384"/>
<polygon fill="#000000" stroke="#000000" points="306.8215,-3670.278 317.3025,-3668.7287 308.1429,-3663.4039 306.8215,-3670.278"/>
</g>
<!-- proc~setup_hamiltonian -->
<g id="proc~~siesta_forces~~CallsGraph_node5" class="node">
<title>proc~setup_hamiltonian</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node5"><a xlink:href=".././proc/setup_hamiltonian.html" xlink:title="setup_hamiltonian">
<polygon fill="#d9534f" stroke="#d9534f" points="222.5,-3347 122.5,-3347 122.5,-3323 222.5,-3323 222.5,-3347"/>
<text text-anchor="middle" x="172.5" y="-3332.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">setup_hamiltonian</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~setup_hamiltonian -->
<g id="proc~~siesta_forces~~CallsGraph_edge4" class="edge">
<title>proc~siesta_forces&#45;&gt;proc~setup_hamiltonian</title>
<path fill="none" stroke="#000000" d="M38.0123,-566.1137C38.2302,-731.7218 42.2062,-2547.9801 112,-3079 123.6006,-3167.2619 152.612,-3269.5372 165.7939,-3313.3123"/>
<polygon fill="#000000" stroke="#000000" points="162.4537,-3314.3585 168.713,-3322.9067 169.1506,-3312.3209 162.4537,-3314.3585"/>
</g>
<!-- compute_energies -->
<g id="proc~~siesta_forces~~CallsGraph_node6" class="node">
<title>compute_energies</title>
<polygon fill="#777777" stroke="#777777" points="223,-608 122,-608 122,-584 223,-584 223,-608"/>
<text text-anchor="middle" x="172.5" y="-593.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">compute_energies</text>
</g>
<!-- proc~siesta_forces&#45;&gt;compute_energies -->
<g id="proc~~siesta_forces~~CallsGraph_edge5" class="edge">
<title>proc~siesta_forces&#45;&gt;compute_energies</title>
<path fill="none" stroke="#000000" d="M76.1825,-565.9232C91.1038,-570.5826 108.3891,-575.9802 124.1632,-580.906"/>
<polygon fill="#000000" stroke="#000000" points="123.1662,-584.2613 133.7549,-583.9012 125.2528,-577.5795 123.1662,-584.2613"/>
</g>
<!-- post_scf_work -->
<g id="proc~~siesta_forces~~CallsGraph_node7" class="node">
<title>post_scf_work</title>
<polygon fill="#777777" stroke="#777777" points="213,-566 132,-566 132,-542 213,-542 213,-566"/>
<text text-anchor="middle" x="172.5" y="-551.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">post_scf_work</text>
</g>
<!-- proc~siesta_forces&#45;&gt;post_scf_work -->
<g id="proc~~siesta_forces~~CallsGraph_edge6" class="edge">
<title>proc~siesta_forces&#45;&gt;post_scf_work</title>
<path fill="none" stroke="#000000" d="M76.1825,-554C90.3174,-554 106.5738,-554 121.6573,-554"/>
<polygon fill="#000000" stroke="#000000" points="121.8719,-557.5001 131.8719,-554 121.8719,-550.5001 121.8719,-557.5001"/>
</g>
<!-- fdf_get -->
<g id="proc~~siesta_forces~~CallsGraph_node8" class="node">
<title>fdf_get</title>
<polygon fill="#777777" stroke="#777777" points="199.5,-524 145.5,-524 145.5,-500 199.5,-500 199.5,-524"/>
<text text-anchor="middle" x="172.5" y="-509.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fdf_get</text>
</g>
<!-- proc~siesta_forces&#45;&gt;fdf_get -->
<g id="proc~~siesta_forces~~CallsGraph_edge7" class="edge">
<title>proc~siesta_forces&#45;&gt;fdf_get</title>
<path fill="none" stroke="#000000" d="M76.1825,-542.0768C94.879,-536.2385 117.2871,-529.2412 135.7833,-523.4655"/>
<polygon fill="#000000" stroke="#000000" points="136.8304,-526.8052 145.3325,-520.4835 134.7438,-520.1234 136.8304,-526.8052"/>
</g>
<!-- scfconvergence_test -->
<g id="proc~~siesta_forces~~CallsGraph_node9" class="node">
<title>scfconvergence_test</title>
<polygon fill="#777777" stroke="#777777" points="228,-482 117,-482 117,-458 228,-458 228,-482"/>
<text text-anchor="middle" x="172.5" y="-467.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">scfconvergence_test</text>
</g>
<!-- proc~siesta_forces&#45;&gt;scfconvergence_test -->
<g id="proc~~siesta_forces~~CallsGraph_edge8" class="edge">
<title>proc~siesta_forces&#45;&gt;scfconvergence_test</title>
<path fill="none" stroke="#000000" d="M49.4991,-541.7751C63.216,-527.8096 87.3966,-505.0767 112,-491 115.1786,-489.1814 118.5408,-487.4831 121.9866,-485.9043"/>
<polygon fill="#000000" stroke="#000000" points="123.3813,-489.1148 131.2351,-482.0036 120.6609,-482.6649 123.3813,-489.1148"/>
</g>
<!-- timer -->
<g id="proc~~siesta_forces~~CallsGraph_node10" class="node">
<title>timer</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3141 317.5,-3141 317.5,-3117 371.5,-3117 371.5,-3141"/>
<text text-anchor="middle" x="344.5" y="-3126.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">timer</text>
</g>
<!-- proc~siesta_forces&#45;&gt;timer -->
<g id="proc~~siesta_forces~~CallsGraph_edge9" class="edge">
<title>proc~siesta_forces&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M38.0353,-566.2329C38.5204,-713.3609 44.9424,-2145.5033 112,-2564 151.8144,-2812.4758 90.2007,-2930.9231 269,-3108 279.0912,-3117.994 293.5068,-3123.3293 307.0419,-3126.1435"/>
<polygon fill="#000000" stroke="#000000" points="306.6928,-3129.6338 317.1346,-3127.8395 307.8529,-3122.7306 306.6928,-3129.6338"/>
</g>
<!-- message -->
<g id="proc~~siesta_forces~~CallsGraph_node11" class="node">
<title>message</title>
<polygon fill="#777777" stroke="#777777" points="200.5,-440 144.5,-440 144.5,-416 200.5,-416 200.5,-440"/>
<text text-anchor="middle" x="172.5" y="-425.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">message</text>
</g>
<!-- proc~siesta_forces&#45;&gt;message -->
<g id="proc~~siesta_forces~~CallsGraph_edge11" class="edge">
<title>proc~siesta_forces&#45;&gt;message</title>
<path fill="none" stroke="#000000" d="M43.4703,-541.7443C53.785,-519.9822 78.1524,-474.4909 112,-449 118.6929,-443.9595 126.688,-440.0668 134.6387,-437.083"/>
<polygon fill="#000000" stroke="#000000" points="135.8502,-440.3684 144.2243,-433.878 133.6305,-433.7297 135.8502,-440.3684"/>
</g>
<!-- proc~mixers_scf_history_init -->
<g id="proc~~siesta_forces~~CallsGraph_node12" class="node">
<title>proc~mixers_scf_history_init</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node12"><a xlink:href=".././proc/mixers_scf_history_init.html" xlink:title="mixers_scf_history_init">
<polygon fill="#d9534f" stroke="#d9534f" points="233,-2555 112,-2555 112,-2531 233,-2531 233,-2555"/>
<text text-anchor="middle" x="172.5" y="-2540.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mixers_scf_history_init</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~mixers_scf_history_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge12" class="edge">
<title>proc~siesta_forces&#45;&gt;proc~mixers_scf_history_init</title>
<path fill="none" stroke="#000000" d="M38.1644,-566.1038C39.6998,-672.8618 52.8229,-1464.8794 112,-2104 126.8551,-2264.4368 157.8941,-2456.172 168.6963,-2520.6268"/>
<polygon fill="#000000" stroke="#000000" points="165.3018,-2521.5466 170.4152,-2530.8258 172.2045,-2520.3831 165.3018,-2521.5466"/>
</g>
<!-- save_density_matrix -->
<g id="proc~~siesta_forces~~CallsGraph_node13" class="node">
<title>save_density_matrix</title>
<polygon fill="#777777" stroke="#777777" points="227.5,-398 117.5,-398 117.5,-374 227.5,-374 227.5,-398"/>
<text text-anchor="middle" x="172.5" y="-383.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">save_density_matrix</text>
</g>
<!-- proc~siesta_forces&#45;&gt;save_density_matrix -->
<g id="proc~~siesta_forces~~CallsGraph_edge13" class="edge">
<title>proc~siesta_forces&#45;&gt;save_density_matrix</title>
<path fill="none" stroke="#000000" d="M40.7968,-541.7993C47.817,-513.879 68.796,-444.8366 112,-407 113.5055,-405.6815 115.0985,-404.4446 116.7591,-403.2843"/>
<polygon fill="#000000" stroke="#000000" points="118.7059,-406.1994 125.5344,-398.0987 115.1446,-400.1729 118.7059,-406.1994"/>
</g>
<!-- initwf -->
<g id="proc~~siesta_forces~~CallsGraph_node14" class="node">
<title>initwf</title>
<polygon fill="#777777" stroke="#777777" points="199.5,-356 145.5,-356 145.5,-332 199.5,-332 199.5,-356"/>
<text text-anchor="middle" x="172.5" y="-341.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">initwf</text>
</g>
<!-- proc~siesta_forces&#45;&gt;initwf -->
<g id="proc~~siesta_forces~~CallsGraph_edge14" class="edge">
<title>proc~siesta_forces&#45;&gt;initwf</title>
<path fill="none" stroke="#000000" d="M39.2572,-541.9164C43.3371,-508.8212 59.1697,-415.8045 112,-365 118.5796,-358.6727 127.1616,-354.244 135.7849,-351.1467"/>
<polygon fill="#000000" stroke="#000000" points="136.9009,-354.4654 145.4339,-348.1854 134.847,-347.7735 136.9009,-354.4654"/>
</g>
<!-- check_walltime -->
<g id="proc~~siesta_forces~~CallsGraph_node15" class="node">
<title>check_walltime</title>
<polygon fill="#777777" stroke="#777777" points="215,-314 130,-314 130,-290 215,-290 215,-314"/>
<text text-anchor="middle" x="172.5" y="-299.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">check_walltime</text>
</g>
<!-- proc~siesta_forces&#45;&gt;check_walltime -->
<g id="proc~~siesta_forces~~CallsGraph_edge15" class="edge">
<title>proc~siesta_forces&#45;&gt;check_walltime</title>
<path fill="none" stroke="#000000" d="M40.4068,-541.8263C49.1047,-498.9402 80.0827,-355.6952 112,-323 114.6406,-320.295 117.647,-317.9381 120.8754,-315.8846"/>
<polygon fill="#000000" stroke="#000000" points="122.6486,-318.9059 129.841,-311.1264 119.3671,-312.7227 122.6486,-318.9059"/>
</g>
<!-- write_spmatrix -->
<g id="proc~~siesta_forces~~CallsGraph_node16" class="node">
<title>write_spmatrix</title>
<polygon fill="#777777" stroke="#777777" points="213.5,-272 131.5,-272 131.5,-248 213.5,-248 213.5,-272"/>
<text text-anchor="middle" x="172.5" y="-257.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_spmatrix</text>
</g>
<!-- proc~siesta_forces&#45;&gt;write_spmatrix -->
<g id="proc~~siesta_forces~~CallsGraph_edge16" class="edge">
<title>proc~siesta_forces&#45;&gt;write_spmatrix</title>
<path fill="none" stroke="#000000" d="M39.7438,-541.9905C46.8577,-494.5142 75.0686,-320.5874 112,-281 114.9437,-277.8446 118.3854,-275.1633 122.1065,-272.8849"/>
<polygon fill="#000000" stroke="#000000" points="123.8647,-275.9175 131.1932,-268.2661 120.6928,-269.6773 123.8647,-275.9175"/>
</g>
<!-- proc~state_analysis -->
<g id="proc~~siesta_forces~~CallsGraph_node17" class="node">
<title>proc~state_analysis</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node17"><a xlink:href=".././proc/state_analysis.html" xlink:title="state_analysis">
<polygon fill="#d9534f" stroke="#d9534f" points="212.5,-730 132.5,-730 132.5,-706 212.5,-706 212.5,-730"/>
<text text-anchor="middle" x="172.5" y="-715.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">state_analysis</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~state_analysis -->
<g id="proc~~siesta_forces~~CallsGraph_edge17" class="edge">
<title>proc~siesta_forces&#45;&gt;proc~state_analysis</title>
<path fill="none" stroke="#000000" d="M41.0067,-566.2808C48.3437,-593.7082 69.7365,-660.4022 112,-697 115.4014,-699.9454 119.2392,-702.4844 123.2906,-704.6718"/>
<polygon fill="#000000" stroke="#000000" points="121.8713,-707.8717 132.4141,-708.9202 124.8262,-701.5259 121.8713,-707.8717"/>
</g>
<!-- reset -->
<g id="proc~~siesta_forces~~CallsGraph_node18" class="node">
<title>reset</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-83 317.5,-83 317.5,-59 371.5,-59 371.5,-83"/>
<text text-anchor="middle" x="344.5" y="-68.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">reset</text>
</g>
<!-- proc~siesta_forces&#45;&gt;reset -->
<g id="proc~~siesta_forces~~CallsGraph_edge18" class="edge">
<title>proc~siesta_forces&#45;&gt;reset</title>
<path fill="none" stroke="#000000" d="M38.8909,-541.8859C43.2662,-485.5624 64.2249,-249.8036 112,-197 149.8178,-155.2017 188.9764,-194.2024 233,-159 257.8861,-139.1004 244.3884,-117.2381 269,-97 280.0073,-87.9487 294.3484,-81.9742 307.5712,-78.065"/>
<polygon fill="#000000" stroke="#000000" points="308.6219,-81.4074 317.3909,-75.4614 306.8279,-74.6412 308.6219,-81.4074"/>
</g>
<!-- barrier -->
<g id="proc~~siesta_forces~~CallsGraph_node19" class="node">
<title>barrier</title>
<polygon fill="#777777" stroke="#777777" points="199.5,-150 145.5,-150 145.5,-126 199.5,-126 199.5,-150"/>
<text text-anchor="middle" x="172.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">barrier</text>
</g>
<!-- proc~siesta_forces&#45;&gt;barrier -->
<g id="proc~~siesta_forces~~CallsGraph_edge19" class="edge">
<title>proc~siesta_forces&#45;&gt;barrier</title>
<path fill="none" stroke="#000000" d="M38.8026,-541.6901C42.9046,-482.1853 63.2622,-224.739 112,-164 118.1599,-156.3233 127.0191,-150.8694 136.0655,-147.0115"/>
<polygon fill="#000000" stroke="#000000" points="137.2877,-150.2912 145.4551,-143.5426 134.8618,-143.725 137.2877,-150.2912"/>
</g>
<!-- transiesta -->
<g id="proc~~siesta_forces~~CallsGraph_node20" class="node">
<title>transiesta</title>
<polygon fill="#777777" stroke="#777777" points="374,-4313 315,-4313 315,-4289 374,-4289 374,-4313"/>
<text text-anchor="middle" x="344.5" y="-4298.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">transiesta</text>
</g>
<!-- proc~siesta_forces&#45;&gt;transiesta -->
<g id="proc~~siesta_forces~~CallsGraph_edge20" class="edge">
<title>proc~siesta_forces&#45;&gt;transiesta</title>
<path fill="none" stroke="#000000" d="M38.0771,-566.2026C39.4554,-780.5641 59.4765,-3748.1264 112,-3818 145.8693,-3863.0573 197.7497,-3812.0148 233,-3856 292.1355,-3929.7891 208.6549,-4207.1969 269,-4280 277.7868,-4290.6007 291.4255,-4296.1019 304.7069,-4298.8788"/>
<polygon fill="#000000" stroke="#000000" points="304.2741,-4302.3544 314.7072,-4300.5106 305.4015,-4295.4458 304.2741,-4302.3544"/>
</g>
<!-- proc~compute_dm -->
<g id="proc~~siesta_forces~~CallsGraph_node21" class="node">
<title>proc~compute_dm</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node21"><a xlink:href=".././proc/compute_dm.html" xlink:title="compute_dm">
<polygon fill="#d9534f" stroke="#d9534f" points="210,-3809 135,-3809 135,-3785 210,-3785 210,-3809"/>
<text text-anchor="middle" x="172.5" y="-3794.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">compute_dm</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~compute_dm -->
<g id="proc~~siesta_forces~~CallsGraph_edge21" class="edge">
<title>proc~siesta_forces&#45;&gt;proc~compute_dm</title>
<path fill="none" stroke="#000000" d="M38.1493,-566.1471C40.5546,-760.3071 71.7582,-3221.1195 112,-3537 123.4436,-3626.827 152.6622,-3730.9942 165.8563,-3775.2841"/>
<polygon fill="#000000" stroke="#000000" points="162.54,-3776.4101 168.7742,-3784.9767 169.2429,-3774.3922 162.54,-3776.4101"/>
</g>
<!-- proc~mixing_scf_converged -->
<g id="proc~~siesta_forces~~CallsGraph_node22" class="node">
<title>proc~mixing_scf_converged</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node22"><a xlink:href=".././proc/mixing_scf_converged.html" xlink:title="mixing_scf_converged">
<polygon fill="#d9534f" stroke="#d9534f" points="232,-230 113,-230 113,-206 232,-206 232,-230"/>
<text text-anchor="middle" x="172.5" y="-215.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mixing_scf_converged</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~mixing_scf_converged -->
<g id="proc~~siesta_forces~~CallsGraph_edge26" class="edge">
<title>proc~siesta_forces&#45;&gt;proc~mixing_scf_converged</title>
<path fill="none" stroke="#000000" d="M39.281,-541.9656C45.0349,-490.0167 70.0563,-285.5195 112,-239 112.9004,-238.0014 113.8507,-237.0502 114.8443,-236.1443"/>
<polygon fill="#000000" stroke="#000000" points="117.1829,-238.7705 123.1961,-230.0474 113.0556,-233.1167 117.1829,-238.7705"/>
</g>
<!-- interface~compute_max_diff -->
<g id="proc~~siesta_forces~~CallsGraph_node23" class="node">
<title>interface~compute_max_diff</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node23"><a xlink:href=".././interface/compute_max_diff.html" xlink:title="compute_max_diff">
<polygon fill="#a7506f" stroke="#a7506f" points="222.5,-688 122.5,-688 122.5,-664 222.5,-664 222.5,-688"/>
<text text-anchor="middle" x="172.5" y="-673.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">compute_max_diff</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;interface~compute_max_diff -->
<g id="proc~~siesta_forces~~CallsGraph_edge22" class="edge">
<title>proc~siesta_forces&#45;&gt;interface~compute_max_diff</title>
<path fill="none" stroke="#000000" d="M44.637,-566.2251C56.0259,-586.1985 81.0788,-626.0023 112,-650 116.6286,-653.5923 121.8288,-656.7882 127.186,-659.6026"/>
<polygon fill="#000000" stroke="#000000" points="125.7489,-662.7952 136.2771,-663.9814 128.7865,-656.4886 125.7489,-662.7952"/>
</g>
<!-- dm_charge -->
<g id="proc~~siesta_forces~~CallsGraph_node24" class="node">
<title>dm_charge</title>
<polygon fill="#777777" stroke="#777777" points="206,-108 139,-108 139,-84 206,-84 206,-108"/>
<text text-anchor="middle" x="172.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dm_charge</text>
</g>
<!-- proc~siesta_forces&#45;&gt;dm_charge -->
<g id="proc~~siesta_forces~~CallsGraph_edge23" class="edge">
<title>proc~siesta_forces&#45;&gt;dm_charge</title>
<path fill="none" stroke="#000000" d="M38.4286,-541.8636C40.9078,-478.283 55.3397,-183.9668 112,-117 116.5838,-111.5824 122.6428,-107.5609 129.1565,-104.5761"/>
<polygon fill="#000000" stroke="#000000" points="130.7822,-107.7038 138.9062,-100.9028 128.3143,-101.1533 130.7822,-107.7038"/>
</g>
<!-- proc~state_init -->
<g id="proc~~siesta_forces~~CallsGraph_node25" class="node">
<title>proc~state_init</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node25"><a xlink:href=".././proc/state_init.html" xlink:title="state_init">
<polygon fill="#d9534f" stroke="#d9534f" points="200,-2095 145,-2095 145,-2071 200,-2071 200,-2095"/>
<text text-anchor="middle" x="172.5" y="-2080.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">state_init</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~state_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge24" class="edge">
<title>proc~siesta_forces&#45;&gt;proc~state_init</title>
<path fill="none" stroke="#000000" d="M39.0827,-566.3076C50.8506,-700.0859 154.8934,-1882.8472 170.535,-2060.6615"/>
<polygon fill="#000000" stroke="#000000" points="167.0547,-2061.0402 171.4176,-2070.695 174.0278,-2060.4268 167.0547,-2061.0402"/>
</g>
<!-- mixer -->
<g id="proc~~siesta_forces~~CallsGraph_node26" class="node">
<title>mixer</title>
<polygon fill="#777777" stroke="#777777" points="199.5,-66 145.5,-66 145.5,-42 199.5,-42 199.5,-66"/>
<text text-anchor="middle" x="172.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mixer</text>
</g>
<!-- proc~siesta_forces&#45;&gt;mixer -->
<g id="proc~~siesta_forces~~CallsGraph_edge25" class="edge">
<title>proc~siesta_forces&#45;&gt;mixer</title>
<path fill="none" stroke="#000000" d="M38.2369,-541.6087C39.7717,-473.8987 50.3013,-149.0007 112,-75 118.0652,-67.7254 126.7931,-62.9669 135.74,-59.8555"/>
<polygon fill="#000000" stroke="#000000" points="136.7683,-63.2018 145.4187,-57.0846 134.8416,-56.4722 136.7683,-63.2018"/>
</g>
<!-- die -->
<g id="proc~~siesta_forces~~CallsGraph_node27" class="node">
<title>die</title>
<polygon fill="#777777" stroke="#777777" points="513.5,-184 459.5,-184 459.5,-160 513.5,-160 513.5,-184"/>
<text text-anchor="middle" x="486.5" y="-169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">die</text>
</g>
<!-- proc~siesta_forces&#45;&gt;die -->
<g id="proc~~siesta_forces~~CallsGraph_edge10" class="edge">
<title>proc~siesta_forces&#45;&gt;die</title>
<path fill="none" stroke="#000000" d="M47.433,-566.1296C60.1636,-581.3999 84.4485,-606.8604 112,-617 162.4685,-635.5735 193.5966,-653.5981 233,-617 312.5116,-543.1491 189.4884,-203.8509 269,-130 318.1728,-84.328 355.5333,-111.3465 420,-130 436.0436,-134.6422 451.9369,-144.4361 464.1611,-153.3992"/>
<polygon fill="#000000" stroke="#000000" points="462.2993,-156.3823 472.3635,-159.6934 466.5608,-150.8289 462.2993,-156.3823"/>
</g>
<!-- compute_charge_diff -->
<g id="proc~~siesta_forces~~CallsGraph_node28" class="node">
<title>compute_charge_diff</title>
<polygon fill="#777777" stroke="#777777" points="229,-24 116,-24 116,0 229,0 229,-24"/>
<text text-anchor="middle" x="172.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">compute_charge_diff</text>
</g>
<!-- proc~siesta_forces&#45;&gt;compute_charge_diff -->
<g id="proc~~siesta_forces~~CallsGraph_edge27" class="edge">
<title>proc~siesta_forces&#45;&gt;compute_charge_diff</title>
<path fill="none" stroke="#000000" d="M38.98,-541.7192C45.0529,-466.8617 78.3887,-73.8161 112,-33 112.7244,-32.1203 113.4879,-31.2773 114.286,-30.4696"/>
<polygon fill="#000000" stroke="#000000" points="116.6375,-33.0715 122.2901,-24.1105 112.2831,-27.5907 116.6375,-33.0715"/>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;bye -->
<g id="proc~~siesta_forces~~CallsGraph_edge33" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;bye</title>
<path fill="none" stroke="#000000" d="M177.1126,-3347.1193C187.744,-3375.2836 214.476,-3447.4424 233,-3509 251.6371,-3570.9336 223.7563,-3603.7818 269,-3650 279.011,-3660.2267 293.5418,-3665.5947 307.188,-3668.3703"/>
<polygon fill="#000000" stroke="#000000" points="306.9292,-3671.8741 317.3614,-3670.0249 308.053,-3664.9649 306.9292,-3671.8741"/>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;timer -->
<g id="proc~~siesta_forces~~CallsGraph_edge35" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M175.6098,-3322.9696C184.5097,-3290.8999 213.1077,-3202.5731 269,-3155 279.8521,-3145.7632 294.1627,-3139.7522 307.4044,-3135.8656"/>
<polygon fill="#000000" stroke="#000000" points="308.4592,-3139.2075 317.2471,-3133.2895 306.6868,-3132.4357 308.4592,-3139.2075"/>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;die -->
<g id="proc~~siesta_forces~~CallsGraph_edge40" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;die</title>
<path fill="none" stroke="#000000" d="M176.8617,-3322.9081C187.7163,-3294.6035 218.7461,-3223.7414 269,-3188 325.395,-3147.891 376.8471,-3204.1014 420,-3150 468.9525,-3088.6275 484.8767,-462.9966 486.3797,-194.1595"/>
<polygon fill="#000000" stroke="#000000" points="489.8802,-194.0676 486.4356,-184.0484 482.8803,-194.0289 489.8802,-194.0676"/>
</g>
<!-- globalize_sum -->
<g id="proc~~siesta_forces~~CallsGraph_node41" class="node">
<title>globalize_sum</title>
<polygon fill="#777777" stroke="#777777" points="385,-3641 304,-3641 304,-3617 385,-3617 385,-3641"/>
<text text-anchor="middle" x="344.5" y="-3626.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">globalize_sum</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;globalize_sum -->
<g id="proc~~siesta_forces~~CallsGraph_edge30" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;globalize_sum</title>
<path fill="none" stroke="#000000" d="M176.7695,-3347.3205C195.1153,-3400.23 266.4395,-3605.6091 269,-3608 276.0113,-3614.5469 284.8877,-3619.0805 294.07,-3622.2132"/>
<polygon fill="#000000" stroke="#000000" points="293.1053,-3625.5775 303.6842,-3624.9963 295.0518,-3618.8536 293.1053,-3625.5775"/>
</g>
<!-- dhscf -->
<g id="proc~~siesta_forces~~CallsGraph_node49" class="node">
<title>dhscf</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3599 317.5,-3599 317.5,-3575 371.5,-3575 371.5,-3599"/>
<text text-anchor="middle" x="344.5" y="-3584.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dhscf</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;dhscf -->
<g id="proc~~siesta_forces~~CallsGraph_edge34" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;dhscf</title>
<path fill="none" stroke="#000000" d="M176.075,-3347.2772C188.8908,-3390.5131 233.6462,-3534.7924 269,-3566 279.5664,-3575.3272 293.9444,-3580.5444 307.319,-3583.4507"/>
<polygon fill="#000000" stroke="#000000" points="306.8076,-3586.9149 317.2712,-3585.2524 308.0547,-3580.0269 306.8076,-3586.9149"/>
</g>
<!-- update_e0 -->
<g id="proc~~siesta_forces~~CallsGraph_node66" class="node">
<title>update_e0</title>
<polygon fill="#777777" stroke="#777777" points="376.5,-3557 312.5,-3557 312.5,-3533 376.5,-3533 376.5,-3557"/>
<text text-anchor="middle" x="344.5" y="-3542.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update_e0</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;update_e0 -->
<g id="proc~~siesta_forces~~CallsGraph_edge29" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;update_e0</title>
<path fill="none" stroke="#000000" d="M175.1465,-3347.3285C183.0406,-3381.0494 209.6553,-3475.5171 269,-3524 278.5484,-3531.8007 290.798,-3536.7102 302.6397,-3539.7978"/>
<polygon fill="#000000" stroke="#000000" points="301.8997,-3543.2187 312.4226,-3541.9864 303.428,-3536.3876 301.8997,-3543.2187"/>
</g>
<!-- dscf -->
<g id="proc~~siesta_forces~~CallsGraph_node67" class="node">
<title>dscf</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3725 317.5,-3725 317.5,-3701 371.5,-3701 371.5,-3725"/>
<text text-anchor="middle" x="344.5" y="-3710.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dscf</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;dscf -->
<g id="proc~~siesta_forces~~CallsGraph_edge28" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;dscf</title>
<path fill="none" stroke="#000000" d="M174.1639,-3347.182C182.1318,-3403.8116 218.1129,-3640.7406 269,-3692 279.0825,-3702.1562 293.626,-3707.5117 307.2624,-3710.2969"/>
<polygon fill="#000000" stroke="#000000" points="306.99,-3713.7989 317.4245,-3711.9627 308.1224,-3706.8911 306.99,-3713.7989"/>
</g>
<!-- h -->
<g id="proc~~siesta_forces~~CallsGraph_node80" class="node">
<title>h</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3431 317.5,-3431 317.5,-3407 371.5,-3407 371.5,-3431"/>
<text text-anchor="middle" x="344.5" y="-3416.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">h</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;h -->
<g id="proc~~siesta_forces~~CallsGraph_edge36" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;h</title>
<path fill="none" stroke="#000000" d="M187.6861,-3347.0541C206.0054,-3361.0717 238.1927,-3384.0634 269,-3398 281.0085,-3403.4324 294.7401,-3407.7606 307.1711,-3411.0423"/>
<polygon fill="#000000" stroke="#000000" points="306.6911,-3414.5297 317.2409,-3413.5541 308.3853,-3407.7379 306.6911,-3414.5297"/>
</g>
<!-- hubbard_term -->
<g id="proc~~siesta_forces~~CallsGraph_node90" class="node">
<title>hubbard_term</title>
<polygon fill="#777777" stroke="#777777" points="384.5,-3389 304.5,-3389 304.5,-3365 384.5,-3365 384.5,-3389"/>
<text text-anchor="middle" x="344.5" y="-3374.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">hubbard_term</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;hubbard_term -->
<g id="proc~~siesta_forces~~CallsGraph_edge32" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;hubbard_term</title>
<path fill="none" stroke="#000000" d="M221.7883,-3347.0355C244.617,-3352.61 271.6946,-3359.2219 294.5986,-3364.8148"/>
<polygon fill="#000000" stroke="#000000" points="293.9204,-3368.2519 304.4652,-3367.2241 295.581,-3361.4517 293.9204,-3368.2519"/>
</g>
<!-- re_alloc -->
<g id="proc~~siesta_forces~~CallsGraph_node97" class="node">
<title>re_alloc</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3099 317.5,-3099 317.5,-3075 371.5,-3075 371.5,-3099"/>
<text text-anchor="middle" x="344.5" y="-3084.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">re_alloc</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;re_alloc -->
<g id="proc~~siesta_forces~~CallsGraph_edge31" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;re_alloc</title>
<path fill="none" stroke="#000000" d="M173.9863,-3322.7625C179.26,-3284.8029 200.5902,-3168.0073 269,-3108 279.5955,-3098.7059 293.9791,-3093.4949 307.3499,-3090.5845"/>
<polygon fill="#000000" stroke="#000000" points="308.0842,-3094.0085 317.2977,-3088.7777 306.8332,-3087.1211 308.0842,-3094.0085"/>
</g>
<!-- write_hsx -->
<g id="proc~~siesta_forces~~CallsGraph_node103" class="node">
<title>write_hsx</title>
<polygon fill="#777777" stroke="#777777" points="373.5,-3305 315.5,-3305 315.5,-3281 373.5,-3281 373.5,-3305"/>
<text text-anchor="middle" x="344.5" y="-3290.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_hsx</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;write_hsx -->
<g id="proc~~siesta_forces~~CallsGraph_edge39" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;write_hsx</title>
<path fill="none" stroke="#000000" d="M221.7883,-3322.9645C248.3117,-3316.4878 280.5704,-3308.6107 305.3555,-3302.5586"/>
<polygon fill="#000000" stroke="#000000" points="306.2555,-3305.9417 315.1398,-3300.1694 304.5949,-3299.1415 306.2555,-3305.9417"/>
</g>
<!-- hold -->
<g id="proc~~siesta_forces~~CallsGraph_node104" class="node">
<title>hold</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3263 317.5,-3263 317.5,-3239 371.5,-3239 371.5,-3263"/>
<text text-anchor="middle" x="344.5" y="-3248.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">hold</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;hold -->
<g id="proc~~siesta_forces~~CallsGraph_edge38" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;hold</title>
<path fill="none" stroke="#000000" d="M187.6861,-3322.9459C206.0054,-3308.9283 238.1927,-3285.9366 269,-3272 281.0085,-3266.5676 294.7401,-3262.2394 307.1711,-3258.9577"/>
<polygon fill="#000000" stroke="#000000" points="308.3853,-3262.2621 317.2409,-3256.4459 306.6911,-3255.4703 308.3853,-3262.2621"/>
</g>
<!-- val -->
<g id="proc~~siesta_forces~~CallsGraph_node106" class="node">
<title>val</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3347 317.5,-3347 317.5,-3323 371.5,-3323 371.5,-3347"/>
<text text-anchor="middle" x="344.5" y="-3332.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">val</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;val -->
<g id="proc~~siesta_forces~~CallsGraph_edge41" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;val</title>
<path fill="none" stroke="#000000" d="M222.7119,-3335C249.7816,-3335 282.6091,-3335 307.3581,-3335"/>
<polygon fill="#000000" stroke="#000000" points="307.4299,-3338.5001 317.4299,-3335 307.4298,-3331.5001 307.4299,-3338.5001"/>
</g>
<!-- de_alloc -->
<g id="proc~~siesta_forces~~CallsGraph_node120" class="node">
<title>de_alloc</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3221 317.5,-3221 317.5,-3197 371.5,-3197 371.5,-3221"/>
<text text-anchor="middle" x="344.5" y="-3206.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">de_alloc</text>
</g>
<!-- proc~setup_hamiltonian&#45;&gt;de_alloc -->
<g id="proc~~siesta_forces~~CallsGraph_edge37" class="edge">
<title>proc~setup_hamiltonian&#45;&gt;de_alloc</title>
<path fill="none" stroke="#000000" d="M180.2046,-3322.9059C194.8031,-3300.9887 228.671,-3254.6939 269,-3230 280.5358,-3222.9365 294.4989,-3218.192 307.2641,-3215.0307"/>
<polygon fill="#000000" stroke="#000000" points="308.1768,-3218.4133 317.1754,-3212.8208 306.6533,-3211.581 308.1768,-3218.4133"/>
</g>
<!-- proc~mixers_history_init -->
<g id="proc~~siesta_forces~~CallsGraph_node36" class="node">
<title>proc~mixers_history_init</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node36"><a xlink:href=".././proc/mixers_history_init.html" xlink:title="mixers_history_init">
<polygon fill="#d9534f" stroke="#d9534f" points="395,-2973 294,-2973 294,-2949 395,-2949 395,-2973"/>
<text text-anchor="middle" x="344.5" y="-2958.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mixers_history_init</text>
</a>
</g>
</g>
<!-- proc~mixers_scf_history_init&#45;&gt;proc~mixers_history_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge42" class="edge">
<title>proc~mixers_scf_history_init&#45;&gt;proc~mixers_history_init</title>
<path fill="none" stroke="#000000" d="M173.9162,-2555.0819C181.1204,-2614.6326 215.4639,-2876.3987 269,-2935 273.4181,-2939.8361 278.7772,-2943.7726 284.5796,-2946.9771"/>
<polygon fill="#000000" stroke="#000000" points="283.455,-2950.3171 293.9909,-2951.4339 286.4511,-2943.9906 283.455,-2950.3171"/>
</g>
<!-- proc~state_analysis&#45;&gt;timer -->
<g id="proc~~siesta_forces~~CallsGraph_edge54" class="edge">
<title>proc~state_analysis&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M173.1026,-730.2826C177.9564,-829.4287 211.056,-1509.4595 233,-2062 235.3074,-2120.0997 233.0314,-3062.3146 269,-3108 278.1427,-3119.6126 293.1214,-3125.1511 307.3367,-3127.6795"/>
<polygon fill="#000000" stroke="#000000" points="307.0828,-3131.1766 317.4584,-3129.0324 308.0103,-3124.2383 307.0828,-3131.1766"/>
</g>
<!-- volcel -->
<g id="proc~~siesta_forces~~CallsGraph_node29" class="node">
<title>volcel</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1045 317.5,-1045 317.5,-1021 371.5,-1021 371.5,-1045"/>
<text text-anchor="middle" x="344.5" y="-1030.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">volcel</text>
</g>
<!-- proc~state_analysis&#45;&gt;volcel -->
<g id="proc~~siesta_forces~~CallsGraph_edge44" class="edge">
<title>proc~state_analysis&#45;&gt;volcel</title>
<path fill="none" stroke="#000000" d="M174.8726,-730.0007C184.9767,-779.9675 225.8794,-970.813 269,-1012 279.2704,-1021.8098 293.719,-1027.1111 307.2304,-1029.9497"/>
<polygon fill="#000000" stroke="#000000" points="306.8479,-1033.4351 317.2954,-1031.6741 308.0301,-1026.5356 306.8479,-1033.4351"/>
</g>
<!-- slua_call -->
<g id="proc~~siesta_forces~~CallsGraph_node38" class="node">
<title>slua_call</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-961 317.5,-961 317.5,-937 371.5,-937 371.5,-961"/>
<text text-anchor="middle" x="344.5" y="-946.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">slua_call</text>
</g>
<!-- proc~state_analysis&#45;&gt;slua_call -->
<g id="proc~~siesta_forces~~CallsGraph_edge51" class="edge">
<title>proc~state_analysis&#45;&gt;slua_call</title>
<path fill="none" stroke="#000000" d="M174.4234,-730.0956C180.7888,-766.0364 204.5584,-873.094 269,-928 279.7282,-937.1407 294.137,-942.3224 307.491,-945.2524"/>
<polygon fill="#000000" stroke="#000000" points="306.9499,-948.7115 317.4187,-947.0823 308.2189,-941.8275 306.9499,-948.7115"/>
</g>
<!-- wallclock -->
<g id="proc~~siesta_forces~~CallsGraph_node47" class="node">
<title>wallclock</title>
<polygon fill="#777777" stroke="#777777" points="372,-919 317,-919 317,-895 372,-895 372,-919"/>
<text text-anchor="middle" x="344.5" y="-904.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">wallclock</text>
</g>
<!-- proc~state_analysis&#45;&gt;wallclock -->
<g id="proc~~siesta_forces~~CallsGraph_edge63" class="edge">
<title>proc~state_analysis&#45;&gt;wallclock</title>
<path fill="none" stroke="#000000" d="M175.9797,-730.3103C185.4212,-761.4177 214.542,-843.7044 269,-886 279.7678,-894.3629 293.6745,-899.3964 306.6128,-902.4256"/>
<polygon fill="#000000" stroke="#000000" points="306.2097,-905.9144 316.7029,-904.4506 307.5871,-899.0513 306.2097,-905.9144"/>
</g>
<!-- cmlendmodule -->
<g id="proc~~siesta_forces~~CallsGraph_node48" class="node">
<title>cmlendmodule</title>
<polygon fill="#777777" stroke="#777777" points="385.5,-877 303.5,-877 303.5,-853 385.5,-853 385.5,-877"/>
<text text-anchor="middle" x="344.5" y="-862.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">cmlendmodule</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmlendmodule -->
<g id="proc~~siesta_forces~~CallsGraph_edge64" class="edge">
<title>proc~state_analysis&#45;&gt;cmlendmodule</title>
<path fill="none" stroke="#000000" d="M178.3478,-730.1502C191.1241,-755.3772 224.025,-813.6091 269,-844 276.3714,-848.9811 284.903,-852.7876 293.5213,-855.6947"/>
<polygon fill="#000000" stroke="#000000" points="292.647,-859.0865 303.2311,-858.6094 294.6596,-852.3821 292.647,-859.0865"/>
</g>
<!-- siesta_write_stress_pressure -->
<g id="proc~~siesta_forces~~CallsGraph_node50" class="node">
<title>siesta_write_stress_pressure</title>
<polygon fill="#777777" stroke="#777777" points="420,-835 269,-835 269,-811 420,-811 420,-835"/>
<text text-anchor="middle" x="344.5" y="-820.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_write_stress_pressure</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_write_stress_pressure -->
<g id="proc~~siesta_forces~~CallsGraph_edge65" class="edge">
<title>proc~state_analysis&#45;&gt;siesta_write_stress_pressure</title>
<path fill="none" stroke="#000000" d="M183.1052,-730.1959C199.6467,-748.4671 233.4037,-782.8405 269,-802 272.5379,-803.9042 276.2642,-805.6486 280.0884,-807.2446"/>
<polygon fill="#000000" stroke="#000000" points="279.1533,-810.6334 289.7445,-810.9129 281.6393,-804.0897 279.1533,-810.6334"/>
</g>
<!-- update_freee -->
<g id="proc~~siesta_forces~~CallsGraph_node52" class="node">
<title>update_freee</title>
<polygon fill="#777777" stroke="#777777" points="382.5,-793 306.5,-793 306.5,-769 382.5,-769 382.5,-793"/>
<text text-anchor="middle" x="344.5" y="-778.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update_freee</text>
</g>
<!-- proc~state_analysis&#45;&gt;update_freee -->
<g id="proc~~siesta_forces~~CallsGraph_edge43" class="edge">
<title>proc~state_analysis&#45;&gt;update_freee</title>
<path fill="none" stroke="#000000" d="M197.5114,-730.0318C216.7695,-739.0139 244.2031,-751.2034 269,-760 277.7572,-763.1066 287.2155,-766.0503 296.3775,-768.6968"/>
<polygon fill="#000000" stroke="#000000" points="295.5817,-772.1087 306.1558,-771.4457 297.4761,-765.3699 295.5817,-772.1087"/>
</g>
<!-- cartesianforce_to_zmatforce -->
<g id="proc~~siesta_forces~~CallsGraph_node56" class="node">
<title>cartesianforce_to_zmatforce</title>
<polygon fill="#777777" stroke="#777777" points="418.5,-751 270.5,-751 270.5,-727 418.5,-727 418.5,-751"/>
<text text-anchor="middle" x="344.5" y="-736.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">cartesianforce_to_zmatforce</text>
</g>
<!-- proc~state_analysis&#45;&gt;cartesianforce_to_zmatforce -->
<g id="proc~~siesta_forces~~CallsGraph_edge48" class="edge">
<title>proc~state_analysis&#45;&gt;cartesianforce_to_zmatforce</title>
<path fill="none" stroke="#000000" d="M212.8264,-722.9236C227.0516,-724.6604 243.6256,-726.6839 260.1201,-728.6978"/>
<polygon fill="#000000" stroke="#000000" points="260.0078,-732.21 270.3583,-729.9478 260.8562,-725.2616 260.0078,-732.21"/>
</g>
<!-- born_charge -->
<g id="proc~~siesta_forces~~CallsGraph_node58" class="node">
<title>born_charge</title>
<polygon fill="#777777" stroke="#777777" points="381,-709 308,-709 308,-685 381,-685 381,-709"/>
<text text-anchor="middle" x="344.5" y="-694.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">born_charge</text>
</g>
<!-- proc~state_analysis&#45;&gt;born_charge -->
<g id="proc~~siesta_forces~~CallsGraph_edge52" class="edge">
<title>proc~state_analysis&#45;&gt;born_charge</title>
<path fill="none" stroke="#000000" d="M212.8264,-713.0764C238.2469,-709.9728 271.1678,-705.9534 297.7323,-702.71"/>
<polygon fill="#000000" stroke="#000000" points="298.4406,-706.1496 307.9427,-701.4634 297.5922,-699.2012 298.4406,-706.1496"/>
</g>
<!-- va -->
<g id="proc~~siesta_forces~~CallsGraph_node60" class="node">
<title>va</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-667 317.5,-667 317.5,-643 371.5,-643 371.5,-667"/>
<text text-anchor="middle" x="344.5" y="-652.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">va</text>
</g>
<!-- proc~state_analysis&#45;&gt;va -->
<g id="proc~~siesta_forces~~CallsGraph_edge53" class="edge">
<title>proc~state_analysis&#45;&gt;va</title>
<path fill="none" stroke="#000000" d="M211.027,-705.8858C218.4225,-703.2088 226.0303,-700.2056 233,-697 249.8286,-689.2599 251.9367,-683.2079 269,-676 281.1413,-670.8713 294.9052,-666.617 307.3251,-663.3097"/>
<polygon fill="#000000" stroke="#000000" points="308.5463,-666.6107 317.3765,-660.756 306.8226,-659.8263 308.5463,-666.6107"/>
</g>
<!-- remove_intramol_pressure -->
<g id="proc~~siesta_forces~~CallsGraph_node64" class="node">
<title>remove_intramol_pressure</title>
<polygon fill="#777777" stroke="#777777" points="415,-625 274,-625 274,-601 415,-601 415,-625"/>
<text text-anchor="middle" x="344.5" y="-610.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">remove_intramol_pressure</text>
</g>
<!-- proc~state_analysis&#45;&gt;remove_intramol_pressure -->
<g id="proc~~siesta_forces~~CallsGraph_edge55" class="edge">
<title>proc~state_analysis&#45;&gt;remove_intramol_pressure</title>
<path fill="none" stroke="#000000" d="M212.7352,-708.5984C219.9815,-705.6845 227.0974,-701.9002 233,-697 257.8129,-676.4009 243.5526,-653.8098 269,-634 270.8318,-632.574 272.7548,-631.2448 274.7487,-630.0059"/>
<polygon fill="#000000" stroke="#000000" points="276.7081,-632.9275 283.8824,-625.1312 273.4122,-626.7519 276.7081,-632.9275"/>
</g>
<!-- print_spin -->
<g id="proc~~siesta_forces~~CallsGraph_node68" class="node">
<title>print_spin</title>
<polygon fill="#777777" stroke="#777777" points="374,-583 315,-583 315,-559 374,-559 374,-583"/>
<text text-anchor="middle" x="344.5" y="-568.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">print_spin</text>
</g>
<!-- proc~state_analysis&#45;&gt;print_spin -->
<g id="proc~~siesta_forces~~CallsGraph_edge57" class="edge">
<title>proc~state_analysis&#45;&gt;print_spin</title>
<path fill="none" stroke="#000000" d="M212.579,-709.8383C220.0929,-706.8135 227.3503,-702.6712 233,-697 267.8176,-662.0499 233.1022,-625.8397 269,-592 278.6865,-582.8689 291.9975,-577.65 304.7475,-574.6866"/>
<polygon fill="#000000" stroke="#000000" points="305.6117,-578.0847 314.7724,-572.762 304.2919,-571.2103 305.6117,-578.0847"/>
</g>
<!-- kin_stress -->
<g id="proc~~siesta_forces~~CallsGraph_node70" class="node">
<title>kin_stress</title>
<polygon fill="#777777" stroke="#777777" points="375,-541 314,-541 314,-517 375,-517 375,-541"/>
<text text-anchor="middle" x="344.5" y="-526.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">kin_stress</text>
</g>
<!-- proc~state_analysis&#45;&gt;kin_stress -->
<g id="proc~~siesta_forces~~CallsGraph_edge59" class="edge">
<title>proc~state_analysis&#45;&gt;kin_stress</title>
<path fill="none" stroke="#000000" d="M212.6718,-710.3503C220.2696,-707.2889 227.5367,-703.0022 233,-697 278.2775,-647.2568 222.1829,-598.2971 269,-550 278.1906,-540.5189 291.2643,-535.2083 303.9558,-532.2688"/>
<polygon fill="#000000" stroke="#000000" points="304.7898,-535.6734 313.9706,-530.3854 303.496,-528.794 304.7898,-535.6734"/>
</g>
<!-- eggbox -->
<g id="proc~~siesta_forces~~CallsGraph_node75" class="node">
<title>eggbox</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-499 317.5,-499 317.5,-475 371.5,-475 371.5,-499"/>
<text text-anchor="middle" x="344.5" y="-484.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">eggbox</text>
</g>
<!-- proc~state_analysis&#45;&gt;eggbox -->
<g id="proc~~siesta_forces~~CallsGraph_edge62" class="edge">
<title>proc~state_analysis&#45;&gt;eggbox</title>
<path fill="none" stroke="#000000" d="M212.6018,-710.6904C220.2975,-707.6076 227.6217,-703.2262 233,-697 288.8979,-632.2897 211.0979,-570.9233 269,-508 278.7639,-497.3894 293.3838,-491.965 307.1653,-489.2514"/>
<polygon fill="#000000" stroke="#000000" points="308.0978,-492.6489 317.4464,-487.6636 307.0294,-485.7309 308.0978,-492.6489"/>
</g>
<!-- mulliken -->
<g id="proc~~siesta_forces~~CallsGraph_node96" class="node">
<title>mulliken</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3057 317.5,-3057 317.5,-3033 371.5,-3033 371.5,-3057"/>
<text text-anchor="middle" x="344.5" y="-3042.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mulliken</text>
</g>
<!-- proc~state_analysis&#45;&gt;mulliken -->
<g id="proc~~siesta_forces~~CallsGraph_edge58" class="edge">
<title>proc~state_analysis&#45;&gt;mulliken</title>
<path fill="none" stroke="#000000" d="M173.0885,-730.2832C177.8317,-829.4337 210.2268,-1509.4931 233,-2062 235.2025,-2115.4365 235.8533,-2982.0285 269,-3024 278.1601,-3035.5988 293.1414,-3041.1353 307.354,-3043.6659"/>
<polygon fill="#000000" stroke="#000000" points="307.0968,-3047.1626 317.4729,-3045.021 308.026,-3040.2245 307.0968,-3047.1626"/>
</g>
<!-- amass -->
<g id="proc~~siesta_forces~~CallsGraph_node99" class="node">
<title>amass</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-457 317.5,-457 317.5,-433 371.5,-433 371.5,-457"/>
<text text-anchor="middle" x="344.5" y="-442.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">amass</text>
</g>
<!-- proc~state_analysis&#45;&gt;amass -->
<g id="proc~~siesta_forces~~CallsGraph_edge60" class="edge">
<title>proc~state_analysis&#45;&gt;amass</title>
<path fill="none" stroke="#000000" d="M212.7617,-710.8262C220.4474,-707.7349 227.7271,-703.3157 233,-697 299.5918,-617.238 199.9367,-543.6318 269,-466 278.6781,-455.1211 293.4597,-449.668 307.386,-447.0055"/>
<polygon fill="#000000" stroke="#000000" points="307.9189,-450.4648 317.2902,-445.5222 306.8821,-443.542 307.9189,-450.4648"/>
</g>
<!-- update_freeeharris -->
<g id="proc~~siesta_forces~~CallsGraph_node107" class="node">
<title>update_freeeharris</title>
<polygon fill="#777777" stroke="#777777" points="396,-415 293,-415 293,-391 396,-391 396,-415"/>
<text text-anchor="middle" x="344.5" y="-400.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update_freeeharris</text>
</g>
<!-- proc~state_analysis&#45;&gt;update_freeeharris -->
<g id="proc~~siesta_forces~~CallsGraph_edge45" class="edge">
<title>proc~state_analysis&#45;&gt;update_freeeharris</title>
<path fill="none" stroke="#000000" d="M212.5632,-711.0442C220.3571,-707.9421 227.7314,-703.4634 233,-697 310.3252,-602.1391 188.7345,-516.3863 269,-424 273.0014,-419.3943 277.9177,-415.7579 283.3055,-412.8923"/>
<polygon fill="#000000" stroke="#000000" points="284.9824,-415.979 292.7397,-408.7627 282.1754,-409.5664 284.9824,-415.979"/>
</g>
<!-- cmlstartmodule -->
<g id="proc~~siesta_forces~~CallsGraph_node108" class="node">
<title>cmlstartmodule</title>
<polygon fill="#777777" stroke="#777777" points="387,-373 302,-373 302,-349 387,-349 387,-373"/>
<text text-anchor="middle" x="344.5" y="-358.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">cmlstartmodule</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmlstartmodule -->
<g id="proc~~siesta_forces~~CallsGraph_edge46" class="edge">
<title>proc~state_analysis&#45;&gt;cmlstartmodule</title>
<path fill="none" stroke="#000000" d="M212.6474,-711.1123C220.4366,-708.0063 227.7876,-703.5088 233,-697 321.0822,-587.0113 177.5077,-489.1689 269,-382 275.0332,-374.9331 283.2209,-370.1422 291.9841,-366.9159"/>
<polygon fill="#000000" stroke="#000000" points="293.085,-370.2396 301.6443,-363.9955 291.0593,-363.5391 293.085,-370.2396"/>
</g>
<!-- siesta_write_forces -->
<g id="proc~~siesta_forces~~CallsGraph_node110" class="node">
<title>siesta_write_forces</title>
<polygon fill="#777777" stroke="#777777" points="396.5,-331 292.5,-331 292.5,-307 396.5,-307 396.5,-331"/>
<text text-anchor="middle" x="344.5" y="-316.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_write_forces</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_write_forces -->
<g id="proc~~siesta_forces~~CallsGraph_edge47" class="edge">
<title>proc~state_analysis&#45;&gt;siesta_write_forces</title>
<path fill="none" stroke="#000000" d="M212.7124,-711.164C220.4979,-708.055 227.831,-703.5433 233,-697 331.8545,-571.8644 166.2652,-461.97 269,-340 272.8743,-335.4003 277.6617,-331.763 282.9312,-328.8927"/>
<polygon fill="#000000" stroke="#000000" points="284.4822,-332.0332 292.1788,-324.7522 281.6215,-325.6444 284.4822,-332.0332"/>
</g>
<!-- cmladdproperty -->
<g id="proc~~siesta_forces~~CallsGraph_node112" class="node">
<title>cmladdproperty</title>
<polygon fill="#777777" stroke="#777777" points="388,-289 301,-289 301,-265 388,-265 388,-289"/>
<text text-anchor="middle" x="344.5" y="-274.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">cmladdproperty</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmladdproperty -->
<g id="proc~~siesta_forces~~CallsGraph_edge49" class="edge">
<title>proc~state_analysis&#45;&gt;cmladdproperty</title>
<path fill="none" stroke="#000000" d="M212.7642,-711.2047C220.5467,-708.0934 227.8654,-703.5704 233,-697 287.8185,-626.8523 212.006,-366.3919 269,-298 274.7588,-291.0896 282.579,-286.3479 291.0118,-283.1157"/>
<polygon fill="#000000" stroke="#000000" points="292.2211,-286.4046 300.7156,-280.0726 290.1265,-279.7253 292.2211,-286.4046"/>
</g>
<!-- write_debug -->
<g id="proc~~siesta_forces~~CallsGraph_node113" class="node">
<title>write_debug</title>
<polygon fill="#777777" stroke="#777777" points="380,-1003 309,-1003 309,-979 380,-979 380,-1003"/>
<text text-anchor="middle" x="344.5" y="-988.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_debug</text>
</g>
<!-- proc~state_analysis&#45;&gt;write_debug -->
<g id="proc~~siesta_forces~~CallsGraph_edge50" class="edge">
<title>proc~state_analysis&#45;&gt;write_debug</title>
<path fill="none" stroke="#000000" d="M173.3997,-730.1052C177.0704,-770.5437 194.496,-902.2184 269,-970 277.3214,-977.5705 288.1439,-982.4414 298.9837,-985.5668"/>
<polygon fill="#000000" stroke="#000000" points="298.3282,-989.0094 308.8723,-987.9737 299.9837,-982.2079 298.3282,-989.0094"/>
</g>
<!-- fixed -->
<g id="proc~~siesta_forces~~CallsGraph_node118" class="node">
<title>fixed</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-247 317.5,-247 317.5,-223 371.5,-223 371.5,-247"/>
<text text-anchor="middle" x="344.5" y="-232.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fixed</text>
</g>
<!-- proc~state_analysis&#45;&gt;fixed -->
<g id="proc~~siesta_forces~~CallsGraph_edge56" class="edge">
<title>proc~state_analysis&#45;&gt;fixed</title>
<path fill="none" stroke="#000000" d="M212.8063,-711.2374C220.5863,-708.1242 227.8935,-703.5922 233,-697 293.2136,-619.2676 206.3755,-331.8035 269,-256 278.3436,-244.6901 293.2107,-239.1821 307.2906,-236.5949"/>
<polygon fill="#000000" stroke="#000000" points="307.8982,-240.044 317.3137,-235.1861 306.9238,-233.1121 307.8982,-240.044"/>
</g>
<!-- moments -->
<g id="proc~~siesta_forces~~CallsGraph_node121" class="node">
<title>moments</title>
<polygon fill="#777777" stroke="#777777" points="373,-3015 316,-3015 316,-2991 373,-2991 373,-3015"/>
<text text-anchor="middle" x="344.5" y="-3000.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">moments</text>
</g>
<!-- proc~state_analysis&#45;&gt;moments -->
<g id="proc~~siesta_forces~~CallsGraph_edge61" class="edge">
<title>proc~state_analysis&#45;&gt;moments</title>
<path fill="none" stroke="#000000" d="M173.0805,-730.2836C177.7608,-829.4367 209.7556,-1509.5127 233,-2062 235.1501,-2113.105 237.2641,-2941.8854 269,-2982 277.8119,-2993.1384 291.9915,-2998.6847 305.6959,-3001.3476"/>
<polygon fill="#000000" stroke="#000000" points="305.5823,-3004.8687 315.9863,-3002.8666 306.6046,-2997.9437 305.5823,-3004.8687"/>
</g>
<!-- proc~compute_dm&#45;&gt;bye -->
<g id="proc~~siesta_forces~~CallsGraph_edge68" class="edge">
<title>proc~compute_dm&#45;&gt;bye</title>
<path fill="none" stroke="#000000" d="M180.2046,-3784.9059C194.8031,-3762.9887 228.671,-3716.6939 269,-3692 280.5358,-3684.9365 294.4989,-3680.192 307.2641,-3677.0307"/>
<polygon fill="#000000" stroke="#000000" points="308.1768,-3680.4133 317.1754,-3674.8208 306.6533,-3673.581 308.1768,-3680.4133"/>
</g>
<!-- proc~compute_dm&#45;&gt;timer -->
<g id="proc~~siesta_forces~~CallsGraph_edge73" class="edge">
<title>proc~compute_dm&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M174.1635,-3784.8779C185.6419,-3701.4628 253.1086,-3214.9793 269,-3188 279.163,-3170.746 296.4616,-3156.6732 311.9382,-3146.6047"/>
<polygon fill="#000000" stroke="#000000" points="314.1055,-3149.3798 320.7724,-3141.1455 310.4256,-3143.4251 314.1055,-3149.3798"/>
</g>
<!-- proc~compute_dm&#45;&gt;transiesta -->
<g id="proc~~siesta_forces~~CallsGraph_edge80" class="edge">
<title>proc~compute_dm&#45;&gt;transiesta</title>
<path fill="none" stroke="#000000" d="M210.1583,-3805.8679C218.9699,-3809.7114 227.4065,-3815.194 233,-3823 292.336,-3905.8056 204.2297,-4201.3721 269,-4280 277.7544,-4290.6275 291.3865,-4296.1342 304.6714,-4298.9081"/>
<polygon fill="#000000" stroke="#000000" points="304.244,-4302.3845 314.6763,-4300.5362 305.3683,-4295.4754 304.244,-4302.3845"/>
</g>
<!-- escf -->
<g id="proc~~siesta_forces~~CallsGraph_node30" class="node">
<title>escf</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3515 317.5,-3515 317.5,-3491 371.5,-3491 371.5,-3515"/>
<text text-anchor="middle" x="344.5" y="-3500.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">escf</text>
</g>
<!-- proc~compute_dm&#45;&gt;escf -->
<g id="proc~~siesta_forces~~CallsGraph_edge66" class="edge">
<title>proc~compute_dm&#45;&gt;escf</title>
<path fill="none" stroke="#000000" d="M173.0019,-3784.8124C175.4343,-3742.1749 189.4533,-3598.2775 269,-3524 279.3807,-3514.307 293.8496,-3509.0272 307.3465,-3506.1732"/>
<polygon fill="#000000" stroke="#000000" points="308.1395,-3509.588 317.3943,-3504.4307 306.9433,-3502.691 308.1395,-3509.588"/>
</g>
<!-- compute_ebs_shift -->
<g id="proc~~siesta_forces~~CallsGraph_node35" class="node">
<title>compute_ebs_shift</title>
<polygon fill="#777777" stroke="#777777" points="396,-3977 293,-3977 293,-3953 396,-3953 396,-3977"/>
<text text-anchor="middle" x="344.5" y="-3962.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">compute_ebs_shift</text>
</g>
<!-- proc~compute_dm&#45;&gt;compute_ebs_shift -->
<g id="proc~~siesta_forces~~CallsGraph_edge69" class="edge">
<title>proc~compute_dm&#45;&gt;compute_ebs_shift</title>
<path fill="none" stroke="#000000" d="M210.0338,-3807.1391C218.5282,-3810.9379 226.8451,-3816.0813 233,-3823 270.2926,-3864.9203 228.9727,-3904.6825 269,-3944 273.2282,-3948.1532 278.2036,-3951.501 283.5495,-3954.1973"/>
<polygon fill="#000000" stroke="#000000" points="282.2576,-3957.4512 292.8295,-3958.147 284.9989,-3951.0103 282.2576,-3957.4512"/>
</g>
<!-- dminim -->
<g id="proc~~siesta_forces~~CallsGraph_node45" class="node">
<title>dminim</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3935 317.5,-3935 317.5,-3911 371.5,-3911 371.5,-3935"/>
<text text-anchor="middle" x="344.5" y="-3920.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dminim</text>
</g>
<!-- proc~compute_dm&#45;&gt;dminim -->
<g id="proc~~siesta_forces~~CallsGraph_edge78" class="edge">
<title>proc~compute_dm&#45;&gt;dminim</title>
<path fill="none" stroke="#000000" d="M210.0141,-3808.0414C218.3123,-3811.7893 226.5448,-3816.6834 233,-3823 260.5779,-3849.9861 239.6697,-3876.9296 269,-3902 279.7137,-3911.1576 294.1198,-3916.3426 307.4756,-3919.2704"/>
<polygon fill="#000000" stroke="#000000" points="306.9372,-3922.73 317.4055,-3921.0978 308.2042,-3915.8456 306.9372,-3922.73"/>
</g>
<!-- eold -->
<g id="proc~~siesta_forces~~CallsGraph_node46" class="node">
<title>eold</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3893 317.5,-3893 317.5,-3869 371.5,-3869 371.5,-3893"/>
<text text-anchor="middle" x="344.5" y="-3878.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">eold</text>
</g>
<!-- proc~compute_dm&#45;&gt;eold -->
<g id="proc~~siesta_forces~~CallsGraph_edge82" class="edge">
<title>proc~compute_dm&#45;&gt;eold</title>
<path fill="none" stroke="#000000" d="M207.0181,-3809.0692C215.8541,-3812.8879 225.0877,-3817.5579 233,-3823 251.904,-3836.0022 249.2644,-3848.2985 269,-3860 280.6352,-3866.8986 294.6205,-3871.6063 307.3756,-3874.7842"/>
<polygon fill="#000000" stroke="#000000" points="306.7476,-3878.2305 317.2728,-3877.0176 308.2885,-3871.4021 306.7476,-3878.2305"/>
</g>
<!-- write_dmh_netcdf -->
<g id="proc~~siesta_forces~~CallsGraph_node51" class="node">
<title>write_dmh_netcdf</title>
<polygon fill="#777777" stroke="#777777" points="393,-3851 296,-3851 296,-3827 393,-3827 393,-3851"/>
<text text-anchor="middle" x="344.5" y="-3836.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_dmh_netcdf</text>
</g>
<!-- proc~compute_dm&#45;&gt;write_dmh_netcdf -->
<g id="proc~~siesta_forces~~CallsGraph_edge85" class="edge">
<title>proc~compute_dm&#45;&gt;write_dmh_netcdf</title>
<path fill="none" stroke="#000000" d="M210.2461,-3806.2171C232.4204,-3811.6317 260.9227,-3818.5916 285.957,-3824.7046"/>
<polygon fill="#000000" stroke="#000000" points="285.1754,-3828.1165 295.7202,-3827.0887 286.8359,-3821.3163 285.1754,-3828.1165"/>
</g>
<!-- write_orb_indx -->
<g id="proc~~siesta_forces~~CallsGraph_node59" class="node">
<title>write_orb_indx</title>
<polygon fill="#777777" stroke="#777777" points="385.5,-3809 303.5,-3809 303.5,-3785 385.5,-3785 385.5,-3809"/>
<text text-anchor="middle" x="344.5" y="-3794.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_orb_indx</text>
</g>
<!-- proc~compute_dm&#45;&gt;write_orb_indx -->
<g id="proc~~siesta_forces~~CallsGraph_edge72" class="edge">
<title>proc~compute_dm&#45;&gt;write_orb_indx</title>
<path fill="none" stroke="#000000" d="M210.2461,-3797C234.5156,-3797 266.3655,-3797 292.9522,-3797"/>
<polygon fill="#000000" stroke="#000000" points="293.2317,-3800.5001 303.2316,-3797 293.2316,-3793.5001 293.2317,-3800.5001"/>
</g>
<!-- ordern -->
<g id="proc~~siesta_forces~~CallsGraph_node63" class="node">
<title>ordern</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3767 317.5,-3767 317.5,-3743 371.5,-3743 371.5,-3767"/>
<text text-anchor="middle" x="344.5" y="-3752.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ordern</text>
</g>
<!-- proc~compute_dm&#45;&gt;ordern -->
<g id="proc~~siesta_forces~~CallsGraph_edge74" class="edge">
<title>proc~compute_dm&#45;&gt;ordern</title>
<path fill="none" stroke="#000000" d="M210.2461,-3787.7829C239.0459,-3780.7504 278.5203,-3771.1113 307.2073,-3764.1064"/>
<polygon fill="#000000" stroke="#000000" points="308.364,-3767.4268 317.2483,-3761.6545 306.7035,-3760.6266 308.364,-3767.4268"/>
</g>
<!-- proc~compute_dm&#45;&gt;dscf -->
<g id="proc~~siesta_forces~~CallsGraph_edge75" class="edge">
<title>proc~compute_dm&#45;&gt;dscf</title>
<path fill="none" stroke="#000000" d="M187.6861,-3784.9459C206.0054,-3770.9283 238.1927,-3747.9366 269,-3734 281.0085,-3728.5676 294.7401,-3724.2394 307.1711,-3720.9577"/>
<polygon fill="#000000" stroke="#000000" points="308.3853,-3724.2621 317.2409,-3718.4459 306.6911,-3717.4703 308.3853,-3724.2621"/>
</g>
<!-- mpi_bcast -->
<g id="proc~~siesta_forces~~CallsGraph_node72" class="node">
<title>mpi_bcast</title>
<polygon fill="#777777" stroke="#777777" points="375,-4271 314,-4271 314,-4247 375,-4247 375,-4271"/>
<text text-anchor="middle" x="344.5" y="-4256.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mpi_bcast</text>
</g>
<!-- proc~compute_dm&#45;&gt;mpi_bcast -->
<g id="proc~~siesta_forces~~CallsGraph_edge79" class="edge">
<title>proc~compute_dm&#45;&gt;mpi_bcast</title>
<path fill="none" stroke="#000000" d="M210.1165,-3805.898C218.9284,-3809.7413 227.3756,-3815.2162 233,-3823 287.2156,-3898.0307 209.8614,-4166.7851 269,-4238 277.6579,-4248.4259 291.0088,-4253.9177 304.0898,-4256.7367"/>
<polygon fill="#000000" stroke="#000000" points="303.514,-4260.189 313.9582,-4258.4089 304.6835,-4253.2874 303.514,-4260.189"/>
</g>
<!-- diagon -->
<g id="proc~~siesta_forces~~CallsGraph_node76" class="node">
<title>diagon</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-4229 317.5,-4229 317.5,-4205 371.5,-4205 371.5,-4229"/>
<text text-anchor="middle" x="344.5" y="-4214.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">diagon</text>
</g>
<!-- proc~compute_dm&#45;&gt;diagon -->
<g id="proc~~siesta_forces~~CallsGraph_edge83" class="edge">
<title>proc~compute_dm&#45;&gt;diagon</title>
<path fill="none" stroke="#000000" d="M210.0655,-3805.935C218.8779,-3809.778 227.338,-3815.2436 233,-3823 282.0983,-3890.2601 215.4897,-4132.194 269,-4196 278.4268,-4207.2406 293.3071,-4212.7377 307.3743,-4215.3355"/>
<polygon fill="#000000" stroke="#000000" points="306.9917,-4218.8161 317.3841,-4216.7553 307.9748,-4211.8855 306.9917,-4218.8161"/>
</g>
<!-- zminim -->
<g id="proc~~siesta_forces~~CallsGraph_node83" class="node">
<title>zminim</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-4187 317.5,-4187 317.5,-4163 371.5,-4163 371.5,-4187"/>
<text text-anchor="middle" x="344.5" y="-4172.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">zminim</text>
</g>
<!-- proc~compute_dm&#45;&gt;zminim -->
<g id="proc~~siesta_forces~~CallsGraph_edge86" class="edge">
<title>proc~compute_dm&#45;&gt;zminim</title>
<path fill="none" stroke="#000000" d="M210.002,-3805.9816C218.8149,-3809.8243 227.2911,-3815.278 233,-3823 320.9707,-3941.9909 173.2264,-4041.1944 269,-4154 278.4948,-4165.1833 293.3857,-4170.6714 307.4426,-4173.2778"/>
<polygon fill="#000000" stroke="#000000" points="307.0471,-4176.7568 317.4417,-4174.7067 308.0374,-4169.8272 307.0471,-4176.7568"/>
</g>
<!-- proc~compute_dm&#45;&gt;mulliken -->
<g id="proc~~siesta_forces~~CallsGraph_edge77" class="edge">
<title>proc~compute_dm&#45;&gt;mulliken</title>
<path fill="none" stroke="#000000" d="M174.2419,-3784.7317C181.5992,-3732.825 210.7732,-3526.1148 233,-3356 241.4133,-3291.6082 226.5963,-3115.1835 269,-3066 278.5078,-3054.972 293.2614,-3049.4944 307.213,-3046.8539"/>
<polygon fill="#000000" stroke="#000000" points="307.7592,-3050.3114 317.1437,-3045.3939 306.7409,-3043.3858 307.7592,-3050.3114"/>
</g>
<!-- proc~compute_dm&#45;&gt;val -->
<g id="proc~~siesta_forces~~CallsGraph_edge87" class="edge">
<title>proc~compute_dm&#45;&gt;val</title>
<path fill="none" stroke="#000000" d="M173.5076,-3784.6569C179.0262,-3720.0075 207.6116,-3420.9172 269,-3356 278.8328,-3345.6019 293.3319,-3340.2033 307.0025,-3337.4513"/>
<polygon fill="#000000" stroke="#000000" points="307.8804,-3340.8556 317.204,-3335.8236 306.7775,-3333.943 307.8804,-3340.8556"/>
</g>
<!-- dold -->
<g id="proc~~siesta_forces~~CallsGraph_node109" class="node">
<title>dold</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-4145 317.5,-4145 317.5,-4121 371.5,-4121 371.5,-4145"/>
<text text-anchor="middle" x="344.5" y="-4130.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dold</text>
</g>
<!-- proc~compute_dm&#45;&gt;dold -->
<g id="proc~~siesta_forces~~CallsGraph_edge67" class="edge">
<title>proc~compute_dm&#45;&gt;dold</title>
<path fill="none" stroke="#000000" d="M210.2354,-3806.1801C218.9361,-3810.0142 227.2997,-3815.4142 233,-3823 310.7572,-3926.4784 184.4599,-4013.9849 269,-4112 278.5102,-4123.026 293.2642,-4128.5032 307.2154,-4131.144"/>
<polygon fill="#000000" stroke="#000000" points="306.7428,-4134.6121 317.1457,-4132.6044 307.7614,-4127.6866 306.7428,-4134.6121"/>
</g>
<!-- write_hs_formatted -->
<g id="proc~~siesta_forces~~CallsGraph_node111" class="node">
<title>write_hs_formatted</title>
<polygon fill="#777777" stroke="#777777" points="396.5,-4103 292.5,-4103 292.5,-4079 396.5,-4079 396.5,-4103"/>
<text text-anchor="middle" x="344.5" y="-4088.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_hs_formatted</text>
</g>
<!-- proc~compute_dm&#45;&gt;write_hs_formatted -->
<g id="proc~~siesta_forces~~CallsGraph_edge70" class="edge">
<title>proc~compute_dm&#45;&gt;write_hs_formatted</title>
<path fill="none" stroke="#000000" d="M210.1277,-3806.2619C218.8299,-3810.0949 227.2212,-3815.4739 233,-3823 300.5627,-3910.9911 195.6729,-3986.7516 269,-4070 272.9751,-4074.5129 277.8284,-4078.0934 283.1381,-4080.929"/>
<polygon fill="#000000" stroke="#000000" points="281.8688,-4084.1945 292.4305,-4085.0309 284.6956,-4077.7906 281.8688,-4084.1945"/>
</g>
<!-- pexsi_solver -->
<g id="proc~~siesta_forces~~CallsGraph_node115" class="node">
<title>pexsi_solver</title>
<polygon fill="#777777" stroke="#777777" points="380.5,-4061 308.5,-4061 308.5,-4037 380.5,-4037 380.5,-4061"/>
<text text-anchor="middle" x="344.5" y="-4046.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pexsi_solver</text>
</g>
<!-- proc~compute_dm&#45;&gt;pexsi_solver -->
<g id="proc~~siesta_forces~~CallsGraph_edge71" class="edge">
<title>proc~compute_dm&#45;&gt;pexsi_solver</title>
<path fill="none" stroke="#000000" d="M210.293,-3806.5174C218.8854,-3810.3388 227.1832,-3815.6484 233,-3823 290.399,-3895.5437 206.8524,-3959.4806 269,-4028 276.6279,-4036.41 287.3059,-4041.5685 298.2347,-4044.7017"/>
<polygon fill="#000000" stroke="#000000" points="297.7275,-4048.1774 308.2617,-4047.0449 299.3205,-4041.3611 297.7275,-4048.1774"/>
</g>
<!-- normalize_dm -->
<g id="proc~~siesta_forces~~CallsGraph_node119" class="node">
<title>normalize_dm</title>
<polygon fill="#777777" stroke="#777777" points="384.5,-3473 304.5,-3473 304.5,-3449 384.5,-3449 384.5,-3473"/>
<text text-anchor="middle" x="344.5" y="-3458.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">normalize_dm</text>
</g>
<!-- proc~compute_dm&#45;&gt;normalize_dm -->
<g id="proc~~siesta_forces~~CallsGraph_edge76" class="edge">
<title>proc~compute_dm&#45;&gt;normalize_dm</title>
<path fill="none" stroke="#000000" d="M174.6201,-3784.8652C183.9993,-3732.4974 223.3231,-3526.5052 269,-3482 276.0153,-3475.1647 285.0558,-3470.513 294.4276,-3467.3574"/>
<polygon fill="#000000" stroke="#000000" points="295.5728,-3470.6709 304.243,-3464.5817 293.6679,-3463.9351 295.5728,-3470.6709"/>
</g>
<!-- proc~compute_dm&#45;&gt;moments -->
<g id="proc~~siesta_forces~~CallsGraph_edge81" class="edge">
<title>proc~compute_dm&#45;&gt;moments</title>
<path fill="none" stroke="#000000" d="M174.3116,-3784.7405C181.9494,-3732.8694 212.0918,-3526.2819 233,-3356 242.0441,-3282.3429 220.9794,-3080.579 269,-3024 278.1202,-3013.2544 292.2225,-3007.7667 305.7812,-3005.0412"/>
<polygon fill="#000000" stroke="#000000" points="306.6115,-3008.454 315.9522,-3003.454 305.5322,-3001.5377 306.6115,-3008.454"/>
</g>
<!-- chess_wrapper -->
<g id="proc~~siesta_forces~~CallsGraph_node122" class="node">
<title>chess_wrapper</title>
<polygon fill="#777777" stroke="#777777" points="387,-4019 302,-4019 302,-3995 387,-3995 387,-4019"/>
<text text-anchor="middle" x="344.5" y="-4004.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">chess_wrapper</text>
</g>
<!-- proc~compute_dm&#45;&gt;chess_wrapper -->
<g id="proc~~siesta_forces~~CallsGraph_edge84" class="edge">
<title>proc~compute_dm&#45;&gt;chess_wrapper</title>
<path fill="none" stroke="#000000" d="M210.0731,-3806.6952C218.6698,-3810.5133 227.0245,-3815.7767 233,-3823 280.29,-3880.1652 217.9727,-3932.1445 269,-3986 275.2549,-3992.6016 283.3908,-3997.1875 291.999,-4000.3602"/>
<polygon fill="#000000" stroke="#000000" points="291.2569,-4003.7933 301.8435,-4003.3739 293.306,-3997.0999 291.2569,-4003.7933"/>
</g>
<!-- proc~mixing_scf_converged&#45;&gt;reset -->
<g id="proc~~siesta_forces~~CallsGraph_edge88" class="edge">
<title>proc~mixing_scf_converged&#45;&gt;reset</title>
<path fill="none" stroke="#000000" d="M213.1395,-205.9239C220.4352,-202.3443 227.4662,-197.7809 233,-192 264.2228,-159.3833 236.5883,-128.4356 269,-97 279.3883,-86.9245 293.8587,-80.7428 307.3545,-76.9547"/>
<polygon fill="#000000" stroke="#000000" points="308.5179,-80.2734 317.4012,-74.4996 306.8562,-73.4735 308.5179,-80.2734"/>
</g>
<!-- proc~compute_max_diff_2d -->
<g id="proc~~siesta_forces~~CallsGraph_node43" class="node">
<title>proc~compute_max_diff_2d</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node43"><a xlink:href=".././proc/compute_max_diff_2d.html" xlink:title="compute_max_diff_2d">
<polygon fill="#d9534f" stroke="#d9534f" points="403.5,-163 285.5,-163 285.5,-139 403.5,-139 403.5,-163"/>
<text text-anchor="middle" x="344.5" y="-148.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">compute_max_diff_2d</text>
</a>
</g>
</g>
<!-- interface~compute_max_diff&#45;&gt;proc~compute_max_diff_2d -->
<g id="proc~~siesta_forces~~CallsGraph_edge89" class="edge">
<title>interface~compute_max_diff&#45;&gt;proc~compute_max_diff_2d</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M216.6753,-663.9437C223.0257,-660.4129 228.8149,-655.8617 233,-650 294.8971,-563.3056 201.4129,-254.3356 269,-172 271.27,-169.2346 273.8703,-166.8158 276.7092,-164.7015"/>
<polygon fill="#000000" stroke="#000000" points="278.5282,-167.6917 285.2647,-159.5144 274.899,-161.7059 278.5282,-167.6917"/>
</g>
<!-- proc~compute_max_diff_1d -->
<g id="proc~~siesta_forces~~CallsGraph_node85" class="node">
<title>proc~compute_max_diff_1d</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node85"><a xlink:href=".././proc/compute_max_diff_1d.html" xlink:title="compute_max_diff_1d">
<polygon fill="#d9534f" stroke="#d9534f" points="403.5,-205 285.5,-205 285.5,-181 403.5,-181 403.5,-205"/>
<text text-anchor="middle" x="344.5" y="-190.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">compute_max_diff_1d</text>
</a>
</g>
</g>
<!-- interface~compute_max_diff&#45;&gt;proc~compute_max_diff_1d -->
<g id="proc~~siesta_forces~~CallsGraph_edge90" class="edge">
<title>interface~compute_max_diff&#45;&gt;proc~compute_max_diff_1d</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M216.6393,-663.9179C222.9939,-660.3901 228.7938,-655.8466 233,-650 289.7754,-571.0823 207.0459,-288.921 269,-214 271.28,-211.2428 273.8882,-208.8305 276.7332,-206.7213"/>
<polygon fill="#000000" stroke="#000000" points="278.5522,-209.7116 285.3019,-201.545 274.9327,-203.72 278.5522,-209.7116"/>
</g>
<!-- proc~state_init&#45;&gt;bye -->
<g id="proc~~siesta_forces~~CallsGraph_edge98" class="edge">
<title>proc~state_init&#45;&gt;bye</title>
<path fill="none" stroke="#000000" d="M174.6559,-2095.1679C183.6774,-2146.6594 218.5972,-2351.8113 233,-2522 238.2872,-2584.4752 230.2764,-3600.6888 269,-3650 278.1282,-3661.624 293.1046,-3667.1642 307.3223,-3669.6909"/>
<polygon fill="#000000" stroke="#000000" points="307.0712,-3673.1883 317.4463,-3671.0419 307.9972,-3666.2498 307.0712,-3673.1883"/>
</g>
<!-- proc~state_init&#45;&gt;timer -->
<g id="proc~~siesta_forces~~CallsGraph_edge116" class="edge">
<title>proc~state_init&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M174.5233,-2095.1801C183.0121,-2146.7206 216.0926,-2352.0418 233,-2522 239.4576,-2586.9135 227.9595,-3057.2937 269,-3108 278.2295,-3119.4032 293.0786,-3124.9259 307.176,-3127.4989"/>
<polygon fill="#000000" stroke="#000000" points="306.8307,-3130.9844 317.217,-3128.8929 307.7934,-3124.0509 306.8307,-3130.9844"/>
</g>
<!-- proc~state_init&#45;&gt;volcel -->
<g id="proc~~siesta_forces~~CallsGraph_edge91" class="edge">
<title>proc~state_init&#45;&gt;volcel</title>
<path fill="none" stroke="#000000" d="M172.8195,-2070.7323C175.8073,-1960.0697 200.2927,-1136.1528 269,-1054 278.4116,-1042.7466 293.2894,-1037.2475 307.359,-1034.6517"/>
<polygon fill="#000000" stroke="#000000" points="307.9608,-1038.1015 317.3712,-1033.2339 306.9793,-1031.1707 307.9608,-1038.1015"/>
</g>
<!-- proc~state_init&#45;&gt;escf -->
<g id="proc~~siesta_forces~~CallsGraph_edge92" class="edge">
<title>proc~state_init&#45;&gt;escf</title>
<path fill="none" stroke="#000000" d="M174.6308,-2095.1701C183.5513,-2146.6702 218.1226,-2351.8521 233,-2522 237.6489,-2575.168 235.9205,-3440.117 269,-3482 278.1606,-3493.5985 293.1419,-3499.1349 307.3545,-3501.6655"/>
<polygon fill="#000000" stroke="#000000" points="307.0972,-3505.1622 317.4733,-3503.0207 308.0264,-3498.2242 307.0972,-3505.1622"/>
</g>
<!-- setup_ordern_indexes -->
<g id="proc~~siesta_forces~~CallsGraph_node31" class="node">
<title>setup_ordern_indexes</title>
<polygon fill="#777777" stroke="#777777" points="404,-1843 285,-1843 285,-1819 404,-1819 404,-1843"/>
<text text-anchor="middle" x="344.5" y="-1828.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">setup_ordern_indexes</text>
</g>
<!-- proc~state_init&#45;&gt;setup_ordern_indexes -->
<g id="proc~~siesta_forces~~CallsGraph_edge94" class="edge">
<title>proc~state_init&#45;&gt;setup_ordern_indexes</title>
<path fill="none" stroke="#000000" d="M173.8788,-2070.8229C178.8799,-2032.4968 199.5957,-1913.2646 269,-1852 271.1993,-1850.0586 273.5638,-1848.2952 276.05,-1846.6937"/>
<polygon fill="#000000" stroke="#000000" points="277.8148,-1849.7179 284.9089,-1841.8486 274.4559,-1843.5764 277.8148,-1849.7179"/>
</g>
<!-- numh -->
<g id="proc~~siesta_forces~~CallsGraph_node32" class="node">
<title>numh</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1801 317.5,-1801 317.5,-1777 371.5,-1777 371.5,-1801"/>
<text text-anchor="middle" x="344.5" y="-1786.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">numh</text>
</g>
<!-- proc~state_init&#45;&gt;numh -->
<g id="proc~~siesta_forces~~CallsGraph_edge95" class="edge">
<title>proc~state_init&#45;&gt;numh</title>
<path fill="none" stroke="#000000" d="M173.0019,-2070.8124C175.4343,-2028.1749 189.4533,-1884.2775 269,-1810 279.3807,-1800.307 293.8496,-1795.0272 307.3465,-1792.1732"/>
<polygon fill="#000000" stroke="#000000" points="308.1395,-1795.588 317.3943,-1790.4307 306.9433,-1788.691 308.1395,-1795.588"/>
</g>
<!-- xij_offset -->
<g id="proc~~siesta_forces~~CallsGraph_node33" class="node">
<title>xij_offset</title>
<polygon fill="#777777" stroke="#777777" points="372,-1759 317,-1759 317,-1735 372,-1735 372,-1759"/>
<text text-anchor="middle" x="344.5" y="-1744.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">xij_offset</text>
</g>
<!-- proc~state_init&#45;&gt;xij_offset -->
<g id="proc~~siesta_forces~~CallsGraph_edge97" class="edge">
<title>proc~state_init&#45;&gt;xij_offset</title>
<path fill="none" stroke="#000000" d="M174.6201,-2070.8652C183.9993,-2018.4974 223.3231,-1812.5052 269,-1768 279.0947,-1758.1642 293.3828,-1752.85 306.8174,-1750.0086"/>
<polygon fill="#000000" stroke="#000000" points="307.5794,-1753.429 316.841,-1748.2838 306.3923,-1746.5304 307.5794,-1753.429"/>
</g>
<!-- nscold -->
<g id="proc~~siesta_forces~~CallsGraph_node34" class="node">
<title>nscold</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1717 317.5,-1717 317.5,-1693 371.5,-1693 371.5,-1717"/>
<text text-anchor="middle" x="344.5" y="-1702.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">nscold</text>
</g>
<!-- proc~state_init&#45;&gt;nscold -->
<g id="proc~~siesta_forces~~CallsGraph_edge99" class="edge">
<title>proc~state_init&#45;&gt;nscold</title>
<path fill="none" stroke="#000000" d="M174.1639,-2070.818C182.1318,-2014.1884 218.1129,-1777.2594 269,-1726 279.0825,-1715.8438 293.626,-1710.4883 307.2624,-1707.7031"/>
<polygon fill="#000000" stroke="#000000" points="308.1224,-1711.1089 317.4245,-1706.0373 306.99,-1704.2011 308.1224,-1711.1089"/>
</g>
<!-- proc~state_init&#45;&gt;proc~mixers_history_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge103" class="edge">
<title>proc~state_init&#45;&gt;proc~mixers_history_init</title>
<path fill="none" stroke="#000000" d="M174.4083,-2095.1923C182.4348,-2146.7818 213.9194,-2352.272 233,-2522 243.2919,-2613.5491 212.2947,-2862.3937 269,-2935 273.2425,-2940.4322 278.6849,-2944.735 284.7011,-2948.1423"/>
<polygon fill="#000000" stroke="#000000" points="283.3218,-2951.3623 293.8531,-2952.5209 286.3429,-2945.0478 283.3218,-2951.3623"/>
</g>
<!-- domaindecom -->
<g id="proc~~siesta_forces~~CallsGraph_node37" class="node">
<title>domaindecom</title>
<polygon fill="#777777" stroke="#777777" points="384.5,-1213 304.5,-1213 304.5,-1189 384.5,-1189 384.5,-1213"/>
<text text-anchor="middle" x="344.5" y="-1198.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">domaindecom</text>
</g>
<!-- proc~state_init&#45;&gt;domaindecom -->
<g id="proc~~siesta_forces~~CallsGraph_edge106" class="edge">
<title>proc~state_init&#45;&gt;domaindecom</title>
<path fill="none" stroke="#000000" d="M173.0461,-2070.9133C177.6436,-1971.4442 211.1476,-1289.9147 269,-1222 275.6168,-1214.2323 284.8368,-1209.2135 294.5668,-1205.9997"/>
<polygon fill="#000000" stroke="#000000" points="295.6445,-1209.3342 304.3892,-1203.3526 293.8229,-1202.5754 295.6445,-1209.3342"/>
</g>
<!-- dict_repopulate_md -->
<g id="proc~~siesta_forces~~CallsGraph_node39" class="node">
<title>dict_repopulate_md</title>
<polygon fill="#777777" stroke="#777777" points="398,-1171 291,-1171 291,-1147 398,-1147 398,-1171"/>
<text text-anchor="middle" x="344.5" y="-1156.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dict_repopulate_md</text>
</g>
<!-- proc~state_init&#45;&gt;dict_repopulate_md -->
<g id="proc~~siesta_forces~~CallsGraph_edge109" class="edge">
<title>proc~state_init&#45;&gt;dict_repopulate_md</title>
<path fill="none" stroke="#000000" d="M172.9777,-2070.9768C177.1304,-1969.0346 208.4159,-1251.4938 269,-1180 272.4839,-1175.8887 276.6972,-1172.5469 281.3307,-1169.8349"/>
<polygon fill="#000000" stroke="#000000" points="283.1702,-1172.8347 290.678,-1165.3591 280.1471,-1166.5212 283.1702,-1172.8347"/>
</g>
<!-- sporb_to_spatom -->
<g id="proc~~siesta_forces~~CallsGraph_node40" class="node">
<title>sporb_to_spatom</title>
<polygon fill="#777777" stroke="#777777" points="392.5,-1129 296.5,-1129 296.5,-1105 392.5,-1105 392.5,-1129"/>
<text text-anchor="middle" x="344.5" y="-1114.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">sporb_to_spatom</text>
</g>
<!-- proc~state_init&#45;&gt;sporb_to_spatom -->
<g id="proc~~siesta_forces~~CallsGraph_edge111" class="edge">
<title>proc~state_init&#45;&gt;sporb_to_spatom</title>
<path fill="none" stroke="#000000" d="M172.9259,-2070.7537C176.6971,-1965.3296 205.7385,-1213.0098 269,-1138 273.8242,-1132.2798 280.0605,-1128.0483 286.8793,-1124.9296"/>
<polygon fill="#000000" stroke="#000000" points="288.3297,-1128.1237 296.461,-1121.3316 285.8688,-1121.5705 288.3297,-1128.1237"/>
</g>
<!-- globalize_or -->
<g id="proc~~siesta_forces~~CallsGraph_node42" class="node">
<title>globalize_or</title>
<polygon fill="#777777" stroke="#777777" points="379.5,-1087 309.5,-1087 309.5,-1063 379.5,-1063 379.5,-1087"/>
<text text-anchor="middle" x="344.5" y="-1072.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">globalize_or</text>
</g>
<!-- proc~state_init&#45;&gt;globalize_or -->
<g id="proc~~siesta_forces~~CallsGraph_edge119" class="edge">
<title>proc~state_init&#45;&gt;globalize_or</title>
<path fill="none" stroke="#000000" d="M172.8657,-2070.8959C176.217,-1963.4192 202.9855,-1174.6166 269,-1096 276.6464,-1086.8938 287.8717,-1081.5577 299.341,-1078.4789"/>
<polygon fill="#000000" stroke="#000000" points="300.3582,-1081.8402 309.399,-1076.3162 298.8867,-1074.9966 300.3582,-1081.8402"/>
</g>
<!-- chess_init -->
<g id="proc~~siesta_forces~~CallsGraph_node44" class="node">
<title>chess_init</title>
<polygon fill="#777777" stroke="#777777" points="374.5,-2893 314.5,-2893 314.5,-2869 374.5,-2869 374.5,-2893"/>
<text text-anchor="middle" x="344.5" y="-2878.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">chess_init</text>
</g>
<!-- proc~state_init&#45;&gt;chess_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge123" class="edge">
<title>proc~state_init&#45;&gt;chess_init</title>
<path fill="none" stroke="#000000" d="M174.3223,-2095.2024C182.0031,-2146.8324 212.2941,-2352.4626 233,-2522 242.1573,-2596.9788 220.1764,-2802.3638 269,-2860 277.8296,-2870.4234 291.3473,-2875.9008 304.5173,-2878.7087"/>
<polygon fill="#000000" stroke="#000000" points="303.9959,-2882.17 314.4373,-2880.3731 305.1543,-2875.2665 303.9959,-2882.17"/>
</g>
<!-- setup_kpoint_grid -->
<g id="proc~~siesta_forces~~CallsGraph_node53" class="node">
<title>setup_kpoint_grid</title>
<polygon fill="#777777" stroke="#777777" points="393,-2851 296,-2851 296,-2827 393,-2827 393,-2851"/>
<text text-anchor="middle" x="344.5" y="-2836.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">setup_kpoint_grid</text>
</g>
<!-- proc~state_init&#45;&gt;setup_kpoint_grid -->
<g id="proc~~siesta_forces~~CallsGraph_edge96" class="edge">
<title>proc~state_init&#45;&gt;setup_kpoint_grid</title>
<path fill="none" stroke="#000000" d="M174.2554,-2095.2108C181.6674,-2146.8747 211.0301,-2352.6218 233,-2522 241.5234,-2587.712 225.7944,-2767.7606 269,-2818 273.649,-2823.4059 279.5586,-2827.4785 286.0178,-2830.5372"/>
<polygon fill="#000000" stroke="#000000" points="285.2029,-2833.9752 295.7917,-2834.3302 287.7354,-2827.4494 285.2029,-2833.9752"/>
</g>
<!-- ts_write_tshs -->
<g id="proc~~siesta_forces~~CallsGraph_node54" class="node">
<title>ts_write_tshs</title>
<polygon fill="#777777" stroke="#777777" points="382,-2809 307,-2809 307,-2785 382,-2785 382,-2809"/>
<text text-anchor="middle" x="344.5" y="-2794.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ts_write_tshs</text>
</g>
<!-- proc~state_init&#45;&gt;ts_write_tshs -->
<g id="proc~~siesta_forces~~CallsGraph_edge101" class="edge">
<title>proc~state_init&#45;&gt;ts_write_tshs</title>
<path fill="none" stroke="#000000" d="M174.1882,-2095.2908C186.9297,-2188.0323 267.5266,-2774.3164 269,-2776 276.2717,-2784.3088 286.5207,-2789.4601 297.1283,-2792.6207"/>
<polygon fill="#000000" stroke="#000000" points="296.3518,-2796.0338 306.8958,-2794.9972 298.0067,-2789.2322 296.3518,-2796.0338"/>
</g>
<!-- overlap -->
<g id="proc~~siesta_forces~~CallsGraph_node55" class="node">
<title>overlap</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2767 317.5,-2767 317.5,-2743 371.5,-2743 371.5,-2767"/>
<text text-anchor="middle" x="344.5" y="-2752.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">overlap</text>
</g>
<!-- proc~state_init&#45;&gt;overlap -->
<g id="proc~~siesta_forces~~CallsGraph_edge102" class="edge">
<title>proc~state_init&#45;&gt;overlap</title>
<path fill="none" stroke="#000000" d="M174.1173,-2095.1693C185.8604,-2183.3602 257.8926,-2721.4207 269,-2734 278.6376,-2744.9148 293.4125,-2750.3738 307.3448,-2753.031"/>
<polygon fill="#000000" stroke="#000000" points="306.8485,-2756.4956 317.2554,-2754.5087 307.8809,-2749.5722 306.8485,-2756.4956"/>
</g>
<!-- proximity_check -->
<g id="proc~~siesta_forces~~CallsGraph_node57" class="node">
<title>proximity_check</title>
<polygon fill="#777777" stroke="#777777" points="389,-2725 300,-2725 300,-2701 389,-2701 389,-2725"/>
<text text-anchor="middle" x="344.5" y="-2710.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">proximity_check</text>
</g>
<!-- proc~state_init&#45;&gt;proximity_check -->
<g id="proc~~siesta_forces~~CallsGraph_edge104" class="edge">
<title>proc~state_init&#45;&gt;proximity_check</title>
<path fill="none" stroke="#000000" d="M174.0538,-2095.2021C184.7911,-2179.158 248.1582,-2668.6325 269,-2692 274.7279,-2698.422 282.2342,-2702.9526 290.2905,-2706.1343"/>
<polygon fill="#000000" stroke="#000000" points="289.3344,-2709.504 299.9269,-2709.2823 291.5081,-2702.85 289.3344,-2709.504"/>
</g>
<!-- ioxv -->
<g id="proc~~siesta_forces~~CallsGraph_node61" class="node">
<title>ioxv</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2683 317.5,-2683 317.5,-2659 371.5,-2659 371.5,-2683"/>
<text text-anchor="middle" x="344.5" y="-2668.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ioxv</text>
</g>
<!-- proc~state_init&#45;&gt;ioxv -->
<g id="proc~~siesta_forces~~CallsGraph_edge115" class="edge">
<title>proc~state_init&#45;&gt;ioxv</title>
<path fill="none" stroke="#000000" d="M174.1888,-2095.1255C185.423,-2175.4557 249.4976,-2628.3841 269,-2650 278.7539,-2660.811 293.5479,-2666.2529 307.463,-2668.9255"/>
<polygon fill="#000000" stroke="#000000" points="306.9449,-2672.3869 317.3555,-2670.4193 307.9902,-2665.4654 306.9449,-2672.3869"/>
</g>
<!-- get_chess_parameter -->
<g id="proc~~siesta_forces~~CallsGraph_node62" class="node">
<title>get_chess_parameter</title>
<polygon fill="#777777" stroke="#777777" points="403,-2641 286,-2641 286,-2617 403,-2617 403,-2641"/>
<text text-anchor="middle" x="344.5" y="-2626.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">get_chess_parameter</text>
</g>
<!-- proc~state_init&#45;&gt;get_chess_parameter -->
<g id="proc~~siesta_forces~~CallsGraph_edge118" class="edge">
<title>proc~state_init&#45;&gt;get_chess_parameter</title>
<path fill="none" stroke="#000000" d="M173.988,-2095.4175C183.1598,-2171.1031 232.8095,-2568.416 269,-2608 271.4141,-2610.6405 274.129,-2612.9601 277.0572,-2614.9969"/>
<polygon fill="#000000" stroke="#000000" points="275.3877,-2618.0742 285.8024,-2620.0198 278.8741,-2612.0042 275.3877,-2618.0742"/>
</g>
<!-- init_val -->
<g id="proc~~siesta_forces~~CallsGraph_node65" class="node">
<title>init_val</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2599 317.5,-2599 317.5,-2575 371.5,-2575 371.5,-2599"/>
<text text-anchor="middle" x="344.5" y="-2584.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">init_val</text>
</g>
<!-- proc~state_init&#45;&gt;init_val -->
<g id="proc~~siesta_forces~~CallsGraph_edge120" class="edge">
<title>proc~state_init&#45;&gt;init_val</title>
<path fill="none" stroke="#000000" d="M173.2417,-2095.1437C177.6216,-2162.9336 202.233,-2494.0934 269,-2566 278.8114,-2576.5667 293.4395,-2581.9835 307.2143,-2584.7034"/>
<polygon fill="#000000" stroke="#000000" points="307.0692,-2588.2227 317.4877,-2586.2983 308.143,-2581.3056 307.0692,-2588.2227"/>
</g>
<!-- madelung -->
<g id="proc~~siesta_forces~~CallsGraph_node69" class="node">
<title>madelung</title>
<polygon fill="#777777" stroke="#777777" points="374.5,-2557 314.5,-2557 314.5,-2533 374.5,-2533 374.5,-2557"/>
<text text-anchor="middle" x="344.5" y="-2542.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">madelung</text>
</g>
<!-- proc~state_init&#45;&gt;madelung -->
<g id="proc~~siesta_forces~~CallsGraph_edge127" class="edge">
<title>proc~state_init&#45;&gt;madelung</title>
<path fill="none" stroke="#000000" d="M173.5076,-2095.3431C179.0262,-2159.9925 207.6116,-2459.0828 269,-2524 278.1464,-2533.6721 291.3301,-2539.0185 304.129,-2541.9328"/>
<polygon fill="#000000" stroke="#000000" points="303.7591,-2545.4233 314.2265,-2543.7848 305.022,-2538.5381 303.7591,-2545.4233"/>
</g>
<!-- newdspdata1d -->
<g id="proc~~siesta_forces~~CallsGraph_node71" class="node">
<title>newdspdata1d</title>
<polygon fill="#777777" stroke="#777777" points="385.5,-2515 303.5,-2515 303.5,-2491 385.5,-2491 385.5,-2515"/>
<text text-anchor="middle" x="344.5" y="-2500.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">newdspdata1d</text>
</g>
<!-- proc~state_init&#45;&gt;newdspdata1d -->
<g id="proc~~siesta_forces~~CallsGraph_edge128" class="edge">
<title>proc~state_init&#45;&gt;newdspdata1d</title>
<path fill="none" stroke="#000000" d="M173.8144,-2095.362C180.5311,-2156.2839 212.9068,-2423.967 269,-2482 275.6668,-2488.8974 284.3885,-2493.5884 293.5274,-2496.7652"/>
<polygon fill="#000000" stroke="#000000" points="292.5539,-2500.127 303.1334,-2499.5566 294.5073,-2493.4051 292.5539,-2500.127"/>
</g>
<!-- iotdxv -->
<g id="proc~~siesta_forces~~CallsGraph_node73" class="node">
<title>iotdxv</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2431 317.5,-2431 317.5,-2407 371.5,-2407 371.5,-2431"/>
<text text-anchor="middle" x="344.5" y="-2416.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">iotdxv</text>
</g>
<!-- proc~state_init&#45;&gt;iotdxv -->
<g id="proc~~siesta_forces~~CallsGraph_edge131" class="edge">
<title>proc~state_init&#45;&gt;iotdxv</title>
<path fill="none" stroke="#000000" d="M174.6201,-2095.1348C183.9993,-2147.5026 223.3231,-2353.4948 269,-2398 279.1724,-2407.9114 293.6029,-2413.2315 307.1273,-2416.0566"/>
<polygon fill="#000000" stroke="#000000" points="306.763,-2419.5447 317.2074,-2417.7653 307.933,-2412.6431 306.763,-2419.5447"/>
</g>
<!-- outcoor -->
<g id="proc~~siesta_forces~~CallsGraph_node74" class="node">
<title>outcoor</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2389 317.5,-2389 317.5,-2365 371.5,-2365 371.5,-2389"/>
<text text-anchor="middle" x="344.5" y="-2374.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">outcoor</text>
</g>
<!-- proc~state_init&#45;&gt;outcoor -->
<g id="proc~~siesta_forces~~CallsGraph_edge133" class="edge">
<title>proc~state_init&#45;&gt;outcoor</title>
<path fill="none" stroke="#000000" d="M173.0019,-2095.1876C175.4343,-2137.8251 189.4533,-2281.7225 269,-2356 279.3807,-2365.693 293.8496,-2370.9728 307.3465,-2373.8268"/>
<polygon fill="#000000" stroke="#000000" points="306.9433,-2377.309 317.3943,-2375.5693 308.1395,-2370.412 306.9433,-2377.309"/>
</g>
<!-- listhptr -->
<g id="proc~~siesta_forces~~CallsGraph_node77" class="node">
<title>listhptr</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2473 317.5,-2473 317.5,-2449 371.5,-2449 371.5,-2473"/>
<text text-anchor="middle" x="344.5" y="-2458.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">listhptr</text>
</g>
<!-- proc~state_init&#45;&gt;listhptr -->
<g id="proc~~siesta_forces~~CallsGraph_edge135" class="edge">
<title>proc~state_init&#45;&gt;listhptr</title>
<path fill="none" stroke="#000000" d="M174.1639,-2095.182C182.1318,-2151.8116 218.1129,-2388.7406 269,-2440 279.0825,-2450.1562 293.626,-2455.5117 307.2624,-2458.2969"/>
<polygon fill="#000000" stroke="#000000" points="306.99,-2461.7989 317.4245,-2459.9627 308.1224,-2454.8911 306.99,-2461.7989"/>
</g>
<!-- crtsparsity_sc -->
<g id="proc~~siesta_forces~~CallsGraph_node78" class="node">
<title>crtsparsity_sc</title>
<polygon fill="#777777" stroke="#777777" points="383.5,-2347 305.5,-2347 305.5,-2323 383.5,-2323 383.5,-2347"/>
<text text-anchor="middle" x="344.5" y="-2332.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">crtsparsity_sc</text>
</g>
<!-- proc~state_init&#45;&gt;crtsparsity_sc -->
<g id="proc~~siesta_forces~~CallsGraph_edge137" class="edge">
<title>proc~state_init&#45;&gt;crtsparsity_sc</title>
<path fill="none" stroke="#000000" d="M173.8788,-2095.1771C178.8799,-2133.5032 199.5957,-2252.7354 269,-2314 276.4188,-2320.5487 285.7166,-2325.0714 295.2268,-2328.1907"/>
<polygon fill="#000000" stroke="#000000" points="294.5716,-2331.6416 305.1444,-2330.9594 296.4538,-2324.8993 294.5716,-2331.6416"/>
</g>
<!-- mscell -->
<g id="proc~~siesta_forces~~CallsGraph_node79" class="node">
<title>mscell</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2305 317.5,-2305 317.5,-2281 371.5,-2281 371.5,-2305"/>
<text text-anchor="middle" x="344.5" y="-2290.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mscell</text>
</g>
<!-- proc~state_init&#45;&gt;mscell -->
<g id="proc~~siesta_forces~~CallsGraph_edge138" class="edge">
<title>proc~state_init&#45;&gt;mscell</title>
<path fill="none" stroke="#000000" d="M175.1465,-2095.3285C183.0406,-2129.0494 209.6553,-2223.5171 269,-2272 279.8308,-2280.8484 294.1372,-2285.9768 307.3816,-2288.9459"/>
<polygon fill="#000000" stroke="#000000" points="306.7491,-2292.3883 317.2274,-2290.8214 308.059,-2285.5119 306.7491,-2292.3883"/>
</g>
<!-- setup_dmhs_netcdf_file -->
<g id="proc~~siesta_forces~~CallsGraph_node81" class="node">
<title>setup_dmhs_netcdf_file</title>
<polygon fill="#777777" stroke="#777777" points="407.5,-2263 281.5,-2263 281.5,-2239 407.5,-2239 407.5,-2263"/>
<text text-anchor="middle" x="344.5" y="-2248.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">setup_dmhs_netcdf_file</text>
</g>
<!-- proc~state_init&#45;&gt;setup_dmhs_netcdf_file -->
<g id="proc~~siesta_forces~~CallsGraph_edge139" class="edge">
<title>proc~state_init&#45;&gt;setup_dmhs_netcdf_file</title>
<path fill="none" stroke="#000000" d="M176.9212,-2095.0092C187.9046,-2123.1353 219.1923,-2193.6394 269,-2230 271.1153,-2231.5442 273.3394,-2232.9749 275.644,-2234.3005"/>
<polygon fill="#000000" stroke="#000000" points="274.3617,-2237.5723 284.8718,-2238.9096 277.4896,-2231.31 274.3617,-2237.5723"/>
</g>
<!-- write_zmatrix -->
<g id="proc~~siesta_forces~~CallsGraph_node82" class="node">
<title>write_zmatrix</title>
<polygon fill="#777777" stroke="#777777" points="382.5,-2221 306.5,-2221 306.5,-2197 382.5,-2197 382.5,-2221"/>
<text text-anchor="middle" x="344.5" y="-2206.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_zmatrix</text>
</g>
<!-- proc~state_init&#45;&gt;write_zmatrix -->
<g id="proc~~siesta_forces~~CallsGraph_edge140" class="edge">
<title>proc~state_init&#45;&gt;write_zmatrix</title>
<path fill="none" stroke="#000000" d="M180.2046,-2095.0941C194.8031,-2117.0113 228.671,-2163.3061 269,-2188 277.3532,-2193.1147 286.9791,-2197.0135 296.5013,-2199.9758"/>
<polygon fill="#000000" stroke="#000000" points="295.7553,-2203.4016 306.3291,-2202.7354 297.6477,-2196.6622 295.7553,-2203.4016"/>
</g>
<!-- delete -->
<g id="proc~~siesta_forces~~CallsGraph_node84" class="node">
<title>delete</title>
<polygon fill="#777777" stroke="#777777" points="513.5,-2932 459.5,-2932 459.5,-2908 513.5,-2908 513.5,-2932"/>
<text text-anchor="middle" x="486.5" y="-2917.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">delete</text>
</g>
<!-- proc~state_init&#45;&gt;delete -->
<g id="proc~~siesta_forces~~CallsGraph_edge93" class="edge">
<title>proc~state_init&#45;&gt;delete</title>
<path fill="none" stroke="#000000" d="M174.3746,-2095.1962C182.2656,-2146.8011 213.2824,-2352.3449 233,-2522 237.8962,-2564.1277 238.833,-2872.1894 269,-2902 316.3026,-2948.7438 400.9808,-2939.8528 449.5496,-2929.642"/>
<polygon fill="#000000" stroke="#000000" points="450.3387,-2933.0521 459.3391,-2927.4627 448.8175,-2926.2194 450.3387,-2933.0521"/>
</g>
<!-- sp_to_spglobal -->
<g id="proc~~siesta_forces~~CallsGraph_node86" class="node">
<title>sp_to_spglobal</title>
<polygon fill="#777777" stroke="#777777" points="387,-2179 302,-2179 302,-2155 387,-2155 387,-2179"/>
<text text-anchor="middle" x="344.5" y="-2164.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">sp_to_spglobal</text>
</g>
<!-- proc~state_init&#45;&gt;sp_to_spglobal -->
<g id="proc~~siesta_forces~~CallsGraph_edge100" class="edge">
<title>proc~state_init&#45;&gt;sp_to_spglobal</title>
<path fill="none" stroke="#000000" d="M187.6861,-2095.0541C206.0054,-2109.0717 238.1927,-2132.0634 269,-2146 276.2341,-2149.2726 284.0936,-2152.1444 291.9174,-2154.6282"/>
<polygon fill="#000000" stroke="#000000" points="291.1752,-2158.0592 301.7586,-2157.5676 293.1786,-2151.352 291.1752,-2158.0592"/>
</g>
<!-- file_exist -->
<g id="proc~~siesta_forces~~CallsGraph_node87" class="node">
<title>file_exist</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2137 317.5,-2137 317.5,-2113 371.5,-2113 371.5,-2137"/>
<text text-anchor="middle" x="344.5" y="-2122.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">file_exist</text>
</g>
<!-- proc~state_init&#45;&gt;file_exist -->
<g id="proc~~siesta_forces~~CallsGraph_edge105" class="edge">
<title>proc~state_init&#45;&gt;file_exist</title>
<path fill="none" stroke="#000000" d="M200.1348,-2089.748C229.1831,-2096.8412 275.0522,-2108.0418 307.2743,-2115.91"/>
<polygon fill="#000000" stroke="#000000" points="306.673,-2119.366 317.2179,-2118.3381 308.3336,-2112.5658 306.673,-2119.366"/>
</g>
<!-- fname_tshs -->
<g id="proc~~siesta_forces~~CallsGraph_node88" class="node">
<title>fname_tshs</title>
<polygon fill="#777777" stroke="#777777" points="378.5,-2095 310.5,-2095 310.5,-2071 378.5,-2071 378.5,-2095"/>
<text text-anchor="middle" x="344.5" y="-2080.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fname_tshs</text>
</g>
<!-- proc~state_init&#45;&gt;fname_tshs -->
<g id="proc~~siesta_forces~~CallsGraph_edge113" class="edge">
<title>proc~state_init&#45;&gt;fname_tshs</title>
<path fill="none" stroke="#000000" d="M200.1348,-2083C227.095,-2083 268.5448,-2083 300.1255,-2083"/>
<polygon fill="#000000" stroke="#000000" points="300.422,-2086.5001 310.422,-2083 300.422,-2079.5001 300.422,-2086.5001"/>
</g>
<!-- newdspdata2d -->
<g id="proc~~siesta_forces~~CallsGraph_node89" class="node">
<title>newdspdata2d</title>
<polygon fill="#777777" stroke="#777777" points="385.5,-2053 303.5,-2053 303.5,-2029 385.5,-2029 385.5,-2053"/>
<text text-anchor="middle" x="344.5" y="-2038.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">newdspdata2d</text>
</g>
<!-- proc~state_init&#45;&gt;newdspdata2d -->
<g id="proc~~siesta_forces~~CallsGraph_edge112" class="edge">
<title>proc~state_init&#45;&gt;newdspdata2d</title>
<path fill="none" stroke="#000000" d="M200.1348,-2076.252C225.218,-2070.127 262.8436,-2060.9394 293.3943,-2053.4793"/>
<polygon fill="#000000" stroke="#000000" points="294.5711,-2056.7949 303.4554,-2051.0225 292.9105,-2049.9947 294.5711,-2056.7949"/>
</g>
<!-- ts_sparse_init -->
<g id="proc~~siesta_forces~~CallsGraph_node91" class="node">
<title>ts_sparse_init</title>
<polygon fill="#777777" stroke="#777777" points="384,-2011 305,-2011 305,-1987 384,-1987 384,-2011"/>
<text text-anchor="middle" x="344.5" y="-1996.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ts_sparse_init</text>
</g>
<!-- proc~state_init&#45;&gt;ts_sparse_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge114" class="edge">
<title>proc~state_init&#45;&gt;ts_sparse_init</title>
<path fill="none" stroke="#000000" d="M187.6861,-2070.9459C206.0054,-2056.9283 238.1927,-2033.9366 269,-2020 277.1958,-2016.2924 286.1942,-2013.0991 295.034,-2010.4019"/>
<polygon fill="#000000" stroke="#000000" points="296.2524,-2013.6934 304.8958,-2007.5663 294.318,-2006.966 296.2524,-2013.6934"/>
</g>
<!-- setup_ts_kpoint_grid -->
<g id="proc~~siesta_forces~~CallsGraph_node92" class="node">
<title>setup_ts_kpoint_grid</title>
<polygon fill="#777777" stroke="#777777" points="400.5,-1969 288.5,-1969 288.5,-1945 400.5,-1945 400.5,-1969"/>
<text text-anchor="middle" x="344.5" y="-1954.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">setup_ts_kpoint_grid</text>
</g>
<!-- proc~state_init&#45;&gt;setup_ts_kpoint_grid -->
<g id="proc~~siesta_forces~~CallsGraph_edge121" class="edge">
<title>proc~state_init&#45;&gt;setup_ts_kpoint_grid</title>
<path fill="none" stroke="#000000" d="M180.2046,-2070.9059C194.8031,-2048.9887 228.671,-2002.6939 269,-1978 272.1437,-1976.0751 275.4676,-1974.3224 278.8984,-1972.7271"/>
<polygon fill="#000000" stroke="#000000" points="280.2938,-1975.9374 288.1792,-1968.8613 277.6022,-1969.4755 280.2938,-1975.9374"/>
</g>
<!-- superc -->
<g id="proc~~siesta_forces~~CallsGraph_node93" class="node">
<title>superc</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1927 317.5,-1927 317.5,-1903 371.5,-1903 371.5,-1927"/>
<text text-anchor="middle" x="344.5" y="-1912.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">superc</text>
</g>
<!-- proc~state_init&#45;&gt;superc -->
<g id="proc~~siesta_forces~~CallsGraph_edge122" class="edge">
<title>proc~state_init&#45;&gt;superc</title>
<path fill="none" stroke="#000000" d="M176.9212,-2070.9908C187.9046,-2042.8647 219.1923,-1972.3606 269,-1936 280.0986,-1927.8978 294.1916,-1922.92 307.1888,-1919.8624"/>
<polygon fill="#000000" stroke="#000000" points="308.201,-1923.2281 317.2991,-1917.7989 306.8012,-1916.3695 308.201,-1923.2281"/>
</g>
<!-- time_io -->
<g id="proc~~siesta_forces~~CallsGraph_node94" class="node">
<title>time_io</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1885 317.5,-1885 317.5,-1861 371.5,-1861 371.5,-1885"/>
<text text-anchor="middle" x="344.5" y="-1870.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">time_io</text>
</g>
<!-- proc~state_init&#45;&gt;time_io -->
<g id="proc~~siesta_forces~~CallsGraph_edge124" class="edge">
<title>proc~state_init&#45;&gt;time_io</title>
<path fill="none" stroke="#000000" d="M175.1465,-2070.6715C183.0406,-2036.9506 209.6553,-1942.4829 269,-1894 279.8308,-1885.1516 294.1372,-1880.0232 307.3816,-1877.0541"/>
<polygon fill="#000000" stroke="#000000" points="308.059,-1880.4881 317.2274,-1875.1786 306.7491,-1873.6117 308.059,-1880.4881"/>
</g>
<!-- nsc -->
<g id="proc~~siesta_forces~~CallsGraph_node95" class="node">
<title>nsc</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1675 317.5,-1675 317.5,-1651 371.5,-1651 371.5,-1675"/>
<text text-anchor="middle" x="344.5" y="-1660.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">nsc</text>
</g>
<!-- proc~state_init&#45;&gt;nsc -->
<g id="proc~~siesta_forces~~CallsGraph_edge125" class="edge">
<title>proc~state_init&#45;&gt;nsc</title>
<path fill="none" stroke="#000000" d="M173.8144,-2070.638C180.5311,-2009.7161 212.9068,-1742.033 269,-1684 278.946,-1673.7101 293.4652,-1668.3308 307.1203,-1665.5639"/>
<polygon fill="#000000" stroke="#000000" points="307.9899,-1668.9689 317.304,-1663.9192 306.8738,-1662.0584 307.9899,-1668.9689"/>
</g>
<!-- proc~state_init&#45;&gt;re_alloc -->
<g id="proc~~siesta_forces~~CallsGraph_edge129" class="edge">
<title>proc~state_init&#45;&gt;re_alloc</title>
<path fill="none" stroke="#000000" d="M174.5021,-2095.1823C182.9055,-2146.7314 215.6912,-2352.0822 233,-2522 239.1389,-2582.2648 230.7784,-3019.0039 269,-3066 278.2564,-3077.3814 293.1098,-3082.9007 307.203,-3085.4769"/>
<polygon fill="#000000" stroke="#000000" points="306.8527,-3088.9618 317.2398,-3086.8744 307.8181,-3082.0287 306.8527,-3088.9618"/>
</g>
<!-- newddata2d -->
<g id="proc~~siesta_forces~~CallsGraph_node98" class="node">
<title>newddata2d</title>
<polygon fill="#777777" stroke="#777777" points="380,-1633 309,-1633 309,-1609 380,-1609 380,-1633"/>
<text text-anchor="middle" x="344.5" y="-1618.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">newddata2d</text>
</g>
<!-- proc~state_init&#45;&gt;newddata2d -->
<g id="proc~~siesta_forces~~CallsGraph_edge130" class="edge">
<title>proc~state_init&#45;&gt;newddata2d</title>
<path fill="none" stroke="#000000" d="M173.5076,-2070.6569C179.0262,-2006.0075 207.6116,-1706.9172 269,-1642 276.953,-1633.5898 287.9587,-1628.4502 299.1096,-1625.3363"/>
<polygon fill="#000000" stroke="#000000" points="299.9125,-1628.7431 308.8732,-1623.0899 298.343,-1621.9213 299.9125,-1628.7431"/>
</g>
<!-- setup_dm_netcdf_file -->
<g id="proc~~siesta_forces~~CallsGraph_node100" class="node">
<title>setup_dm_netcdf_file</title>
<polygon fill="#777777" stroke="#777777" points="402,-1591 287,-1591 287,-1567 402,-1567 402,-1591"/>
<text text-anchor="middle" x="344.5" y="-1576.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">setup_dm_netcdf_file</text>
</g>
<!-- proc~state_init&#45;&gt;setup_dm_netcdf_file -->
<g id="proc~~siesta_forces~~CallsGraph_edge132" class="edge">
<title>proc~state_init&#45;&gt;setup_dm_netcdf_file</title>
<path fill="none" stroke="#000000" d="M173.2417,-2070.8563C177.6216,-2003.0664 202.233,-1671.9066 269,-1600 271.7338,-1597.0557 274.8416,-1594.5113 278.2007,-1592.3136"/>
<polygon fill="#000000" stroke="#000000" points="279.8816,-1595.3836 286.9983,-1587.5348 276.5403,-1589.2325 279.8816,-1595.3836"/>
</g>
<!-- siesta_write_positions -->
<g id="proc~~siesta_forces~~CallsGraph_node101" class="node">
<title>siesta_write_positions</title>
<polygon fill="#777777" stroke="#777777" points="403,-1549 286,-1549 286,-1525 403,-1525 403,-1549"/>
<text text-anchor="middle" x="344.5" y="-1534.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_write_positions</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_write_positions -->
<g id="proc~~siesta_forces~~CallsGraph_edge134" class="edge">
<title>proc~state_init&#45;&gt;siesta_write_positions</title>
<path fill="none" stroke="#000000" d="M173.0365,-2070.7569C176.4098,-1999.3228 196.9316,-1636.826 269,-1558 271.4141,-1555.3595 274.129,-1553.0399 277.0572,-1551.0031"/>
<polygon fill="#000000" stroke="#000000" points="278.8741,-1553.9958 285.8024,-1545.9802 275.3877,-1547.9258 278.8741,-1553.9958"/>
</g>
<!-- newsparsity -->
<g id="proc~~siesta_forces~~CallsGraph_node102" class="node">
<title>newsparsity</title>
<polygon fill="#777777" stroke="#777777" points="379,-1507 310,-1507 310,-1483 379,-1483 379,-1507"/>
<text text-anchor="middle" x="344.5" y="-1492.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">newsparsity</text>
</g>
<!-- proc~state_init&#45;&gt;newsparsity -->
<g id="proc~~siesta_forces~~CallsGraph_edge136" class="edge">
<title>proc~state_init&#45;&gt;newsparsity</title>
<path fill="none" stroke="#000000" d="M172.855,-2070.7724C175.2674,-1996.0913 191.5757,-1601.8148 269,-1516 276.9653,-1507.1714 288.2918,-1501.9234 299.756,-1498.8401"/>
<polygon fill="#000000" stroke="#000000" points="300.7608,-1502.2033 309.785,-1496.6522 299.2687,-1495.3641 300.7608,-1502.2033"/>
</g>
<!-- isc_off -->
<g id="proc~~siesta_forces~~CallsGraph_node105" class="node">
<title>isc_off</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1465 317.5,-1465 317.5,-1441 371.5,-1441 371.5,-1465"/>
<text text-anchor="middle" x="344.5" y="-1450.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">isc_off</text>
</g>
<!-- proc~state_init&#45;&gt;isc_off -->
<g id="proc~~siesta_forces~~CallsGraph_edge142" class="edge">
<title>proc~state_init&#45;&gt;isc_off</title>
<path fill="none" stroke="#000000" d="M172.6962,-2070.8944C174.1961,-1993.3737 186.1674,-1566.8708 269,-1474 278.692,-1463.1335 293.4758,-1457.6824 307.4001,-1455.018"/>
<polygon fill="#000000" stroke="#000000" points="307.932,-1458.4775 317.3022,-1453.5328 306.8936,-1451.5549 307.932,-1458.4775"/>
</g>
<!-- proc~state_init&#45;&gt;val -->
<g id="proc~~siesta_forces~~CallsGraph_edge143" class="edge">
<title>proc~state_init&#45;&gt;val</title>
<path fill="none" stroke="#000000" d="M174.595,-2095.1733C183.3719,-2146.6863 217.4471,-2351.9125 233,-2522 241.0216,-2609.7249 214.1267,-3245.0876 269,-3314 278.1384,-3325.4764 292.9731,-3331.0106 307.0844,-3333.5724"/>
<polygon fill="#000000" stroke="#000000" points="306.7563,-3337.0601 317.1399,-3334.9549 307.7098,-3330.1254 306.7563,-3337.0601"/>
</g>
<!-- proc~state_init&#45;&gt;write_debug -->
<g id="proc~~siesta_forces~~CallsGraph_edge107" class="edge">
<title>proc~state_init&#45;&gt;write_debug</title>
<path fill="none" stroke="#000000" d="M172.7673,-2070.9468C175.3608,-1958.6606 197.5188,-1097.7868 269,-1012 276.5444,-1002.9457 287.6279,-997.6145 298.9914,-994.5234"/>
<polygon fill="#000000" stroke="#000000" points="299.9439,-997.898 308.9678,-992.3464 298.4515,-991.0589 299.9439,-997.898"/>
</g>
<!-- ucell -->
<g id="proc~~siesta_forces~~CallsGraph_node114" class="node">
<title>ucell</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1423 317.5,-1423 317.5,-1399 371.5,-1399 371.5,-1423"/>
<text text-anchor="middle" x="344.5" y="-1408.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ucell</text>
</g>
<!-- proc~state_init&#45;&gt;ucell -->
<g id="proc~~siesta_forces~~CallsGraph_edge108" class="edge">
<title>proc~state_init&#45;&gt;ucell</title>
<path fill="none" stroke="#000000" d="M173.5123,-2070.7872C180.6755,-1985.6027 224.7124,-1482.1567 269,-1432 278.6376,-1421.0852 293.4125,-1415.6262 307.3448,-1412.969"/>
<polygon fill="#000000" stroke="#000000" points="307.8809,-1416.4278 317.2554,-1411.4913 306.8485,-1409.5044 307.8809,-1416.4278"/>
</g>
<!-- new_dm -->
<g id="proc~~siesta_forces~~CallsGraph_node116" class="node">
<title>new_dm</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1381 317.5,-1381 317.5,-1357 371.5,-1357 371.5,-1381"/>
<text text-anchor="middle" x="344.5" y="-1366.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">new_dm</text>
</g>
<!-- proc~state_init&#45;&gt;new_dm -->
<g id="proc~~siesta_forces~~CallsGraph_edge110" class="edge">
<title>proc~state_init&#45;&gt;new_dm</title>
<path fill="none" stroke="#000000" d="M173.3927,-2070.8593C179.9717,-1982.7787 221.9998,-1443.7032 269,-1390 278.5895,-1379.0429 293.3565,-1373.577 307.2959,-1370.926"/>
<polygon fill="#000000" stroke="#000000" points="307.8357,-1374.3843 317.2139,-1369.4549 306.8086,-1367.4601 307.8357,-1374.3843"/>
</g>
<!-- attach -->
<g id="proc~~siesta_forces~~CallsGraph_node117" class="node">
<title>attach</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1339 317.5,-1339 317.5,-1315 371.5,-1315 371.5,-1339"/>
<text text-anchor="middle" x="344.5" y="-1324.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">attach</text>
</g>
<!-- proc~state_init&#45;&gt;attach -->
<g id="proc~~siesta_forces~~CallsGraph_edge117" class="edge">
<title>proc~state_init&#45;&gt;attach</title>
<path fill="none" stroke="#000000" d="M173.3016,-2070.7159C179.3799,-1979.1614 219.3212,-1405.2134 269,-1348 278.5466,-1337.0055 293.3066,-1331.5335 307.2524,-1328.888"/>
<polygon fill="#000000" stroke="#000000" points="307.7955,-1332.3459 317.177,-1327.4227 306.773,-1325.4209 307.7955,-1332.3459"/>
</g>
<!-- proc~state_init&#45;&gt;normalize_dm -->
<g id="proc~~siesta_forces~~CallsGraph_edge126" class="edge">
<title>proc~state_init&#45;&gt;normalize_dm</title>
<path fill="none" stroke="#000000" d="M174.6231,-2095.1708C183.5126,-2146.6736 217.9768,-2351.8649 233,-2522 237.4894,-2572.8414 237.3313,-3399.9738 269,-3440 275.3946,-3448.0822 284.6154,-3453.22 294.4299,-3456.4483"/>
<polygon fill="#000000" stroke="#000000" points="293.7969,-3459.9013 304.3597,-3459.0785 295.5892,-3453.1346 293.7969,-3459.9013"/>
</g>
<!-- ts_tri_analyze -->
<g id="proc~~siesta_forces~~CallsGraph_node123" class="node">
<title>ts_tri_analyze</title>
<polygon fill="#777777" stroke="#777777" points="384,-1297 305,-1297 305,-1273 384,-1273 384,-1297"/>
<text text-anchor="middle" x="344.5" y="-1282.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ts_tri_analyze</text>
</g>
<!-- proc~state_init&#45;&gt;ts_tri_analyze -->
<g id="proc~~siesta_forces~~CallsGraph_edge141" class="edge">
<title>proc~state_init&#45;&gt;ts_tri_analyze</title>
<path fill="none" stroke="#000000" d="M173.1984,-2070.9254C178.7261,-1977.1179 216.5741,-1366.8046 269,-1306 275.7298,-1298.1947 285.0873,-1293.1698 294.9284,-1289.9634"/>
<polygon fill="#000000" stroke="#000000" points="296.0849,-1293.2777 304.8511,-1287.3275 294.2877,-1286.5123 296.0849,-1293.2777"/>
</g>
<!-- hsparse -->
<g id="proc~~siesta_forces~~CallsGraph_node124" class="node">
<title>hsparse</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1255 317.5,-1255 317.5,-1231 371.5,-1231 371.5,-1255"/>
<text text-anchor="middle" x="344.5" y="-1240.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">hsparse</text>
</g>
<!-- proc~state_init&#45;&gt;hsparse -->
<g id="proc~~siesta_forces~~CallsGraph_edge144" class="edge">
<title>proc~state_init&#45;&gt;hsparse</title>
<path fill="none" stroke="#000000" d="M173.1197,-2070.8953C178.1756,-1974.1389 213.8671,-1328.3516 269,-1264 278.5447,-1252.8593 293.4435,-1247.378 307.4928,-1244.765"/>
<polygon fill="#000000" stroke="#000000" points="308.0834,-1248.2161 317.484,-1243.3294 307.0878,-1241.2873 308.0834,-1248.2161"/>
</g>
<!-- proc~mixers_history_init&#45;&gt;delete -->
<g id="proc~~siesta_forces~~CallsGraph_edge147" class="edge">
<title>proc~mixers_history_init&#45;&gt;delete</title>
<path fill="none" stroke="#000000" d="M386.3367,-2948.9204C406.4004,-2943.1273 430.2249,-2936.2484 449.6038,-2930.6531"/>
<polygon fill="#000000" stroke="#000000" points="450.6524,-2933.9934 459.289,-2927.8567 448.7105,-2927.2681 450.6524,-2933.9934"/>
</g>
<!-- proc~current_itt -->
<g id="proc~~siesta_forces~~CallsGraph_node125" class="node">
<title>proc~current_itt</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node125"><a xlink:href=".././proc/current_itt.html" xlink:title="current_itt">
<polygon fill="#d94e8f" stroke="#d94e8f" points="517,-3016 456,-3016 456,-2992 517,-2992 517,-3016"/>
<text text-anchor="middle" x="486.5" y="-3001.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">current_itt</text>
</a>
</g>
</g>
<!-- proc~mixers_history_init&#45;&gt;proc~current_itt -->
<g id="proc~~siesta_forces~~CallsGraph_edge145" class="edge">
<title>proc~mixers_history_init&#45;&gt;proc~current_itt</title>
<path fill="none" stroke="#000000" d="M389.3168,-2973.082C399.435,-2975.9162 410.1079,-2978.9899 420,-2982 428.5372,-2984.5978 437.6443,-2987.514 446.293,-2990.3526"/>
<polygon fill="#000000" stroke="#000000" points="445.2148,-2993.6824 455.8081,-2993.5034 447.4153,-2987.0373 445.2148,-2993.6824"/>
</g>
<!-- new -->
<g id="proc~~siesta_forces~~CallsGraph_node126" class="node">
<title>new</title>
<polygon fill="#777777" stroke="#777777" points="513.5,-2974 459.5,-2974 459.5,-2950 513.5,-2950 513.5,-2974"/>
<text text-anchor="middle" x="486.5" y="-2959.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">new</text>
</g>
<!-- proc~mixers_history_init&#45;&gt;new -->
<g id="proc~~siesta_forces~~CallsGraph_edge146" class="edge">
<title>proc~mixers_history_init&#45;&gt;new</title>
<path fill="none" stroke="#000000" d="M395.3642,-2961.3582C413.1207,-2961.4832 432.7089,-2961.6212 449.1601,-2961.737"/>
<polygon fill="#000000" stroke="#000000" points="449.4427,-2965.239 459.4671,-2961.8096 449.492,-2958.2392 449.4427,-2965.239"/>
</g>
<!-- proc~compute_max_diff_2d&#45;&gt;die -->
<g id="proc~~siesta_forces~~CallsGraph_edge148" class="edge">
<title>proc~compute_max_diff_2d&#45;&gt;die</title>
<path fill="none" stroke="#000000" d="M403.898,-159.7842C419.2808,-162.0591 435.4103,-164.4445 449.2922,-166.4974"/>
<polygon fill="#000000" stroke="#000000" points="449.0155,-169.9945 459.42,-167.9952 450.0397,-163.0698 449.0155,-169.9945"/>
</g>
<!-- proc~compute_max_diff_1d&#45;&gt;die -->
<g id="proc~~siesta_forces~~CallsGraph_edge149" class="edge">
<title>proc~compute_max_diff_1d&#45;&gt;die</title>
<path fill="none" stroke="#000000" d="M403.898,-184.2158C419.2808,-181.9409 435.4103,-179.5555 449.2922,-177.5026"/>
<polygon fill="#000000" stroke="#000000" points="450.0397,-180.9302 459.42,-176.0048 449.0155,-174.0055 450.0397,-180.9302"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,0 64,0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,0 136,0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,0 209.5,0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,0 364,0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,0 436,0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="551.5,-24 454.5,-24 454.5,0 551.5,0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/siesta_forces.html#src">siesta_forces</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>  <span class="k">subroutine </span><span class="n">siesta_forces</span><span class="p">(</span><span class="n">istep</span><span class="p">)</span>
  <span class="c">!! This subroutine represents central SIESTA operation logic.</span>

<span class="cp">#ifdef MPI</span>
    <span class="k">use </span><span class="n">mpi_siesta</span>
<span class="cp">#endif</span>
    <span class="k">use </span><span class="n">units</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">eV</span><span class="p">,</span> <span class="n">Ang</span>
    <span class="k">use </span><span class="nb">precision</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">dp</span>
    <span class="k">use </span><span class="n">sys</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">bye</span>

    <span class="k">use </span><span class="n">files</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">slabel</span>
    <span class="k">use </span><span class="n">siesta_cml</span>
<span class="cp">#ifdef SIESTA__FLOOK</span>
    <span class="k">use </span><span class="n">flook_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">slua_call</span>
    <span class="k">use </span><span class="n">flook_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">LUA_INIT_MD</span><span class="p">,</span> <span class="n">LUA_SCF_LOOP</span>
    <span class="k">use </span><span class="n">siesta_dicts</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">dict_variable_add</span>
    <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ts_scf_mixs</span>
    <span class="k">use </span><span class="n">variable</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cunpack</span>
<span class="cp">#ifndef NCDF_4</span>
    <span class="k">use </span><span class="n">dictionary</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="k">assign</span>
<span class="cp">#endif</span>
    <span class="k">use </span><span class="n">m_mixing</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mixers_history_init</span>
<span class="cp">#endif</span>
    <span class="k">use </span><span class="n">m_state_init</span>
    <span class="k">use </span><span class="n">m_setup_hamiltonian</span>
    <span class="k">use </span><span class="n">m_setup_H0</span>
    <span class="k">use </span><span class="n">m_compute_dm</span>
    <span class="k">use </span><span class="n">m_compute_max_diff</span>
    <span class="k">use </span><span class="n">m_scfconvergence_test</span>
    <span class="k">use </span><span class="n">m_post_scf_work</span>
    <span class="k">use </span><span class="n">m_mixer</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">mixer</span>
    <span class="k">use </span><span class="n">m_mixing_scf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">mixing_scf_converged</span>
    <span class="k">use </span><span class="n">m_mixing_scf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">mixers_scf_history_init</span>
    <span class="k">use </span><span class="n">m_mixing_scf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">scf_mixs</span><span class="p">,</span> <span class="n">scf_mix</span>

    <span class="k">use </span><span class="n">m_rhog</span><span class="p">,</span>                <span class="n">only</span><span class="p">:</span> <span class="n">mix_rhog</span><span class="p">,</span> <span class="n">compute_charge_diff</span>
    <span class="k">use </span><span class="n">siesta_options</span>
    <span class="k">use </span><span class="n">parallel</span><span class="p">,</span>     <span class="n">only</span> <span class="p">:</span> <span class="n">IOnode</span><span class="p">,</span> <span class="n">SIESTA_worker</span>
    <span class="k">use </span><span class="n">m_state_analysis</span>
    <span class="k">use </span><span class="n">m_steps</span>
    <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>                <span class="n">only</span><span class="p">:</span> <span class="n">spin</span>
    <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">DM_2D</span><span class="p">,</span> <span class="n">S_1D</span>
    <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">H</span><span class="p">,</span> <span class="n">Hold</span><span class="p">,</span> <span class="n">Dold</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">Eold</span><span class="p">,</span> <span class="n">Escf</span><span class="p">,</span> <span class="n">maxnh</span>
    <span class="k">use </span><span class="n">m_convergence</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">converger_t</span>
    <span class="k">use </span><span class="n">m_convergence</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">reset</span><span class="p">,</span> <span class="n">set_tolerance</span>
    <span class="k">use </span><span class="n">siesta_geom</span><span class="p">,</span>   <span class="n">only</span><span class="p">:</span> <span class="n">na_u</span>           <span class="c">! Number of atoms in unit cell</span>
    <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span>    <span class="n">only</span><span class="p">:</span> <span class="n">Etot</span>           <span class="c">! Total energy</span>
    <span class="k">use </span><span class="n">m_forces</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">fa</span><span class="p">,</span> <span class="n">cfa</span>        <span class="c">! Forces and constrained forces</span>
    <span class="k">use </span><span class="n">m_stress</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">cstress</span>        <span class="c">! Constrained stress tensor</span>
    <span class="k">use </span><span class="n">siesta_master</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">forcesToMaster</span> <span class="c">! Send forces to master prog</span>
    <span class="k">use </span><span class="n">siesta_master</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">siesta_server</span>  <span class="c">! Is siesta a server?</span>
    <span class="k">use </span><span class="n">m_save_density_matrix</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">save_density_matrix</span>
    <span class="k">use </span><span class="n">m_iodm_old</span><span class="p">,</span>    <span class="n">only</span><span class="p">:</span> <span class="n">write_spmatrix</span>

    <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">Qtot</span>
    <span class="k">use </span><span class="n">m_dm_charge</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">dm_charge</span>

    <span class="k">use </span><span class="n">m_pexsi_solver</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">prevDmax</span>
    <span class="k">use </span><span class="n">write_subs</span><span class="p">,</span>            <span class="n">only</span><span class="p">:</span> <span class="n">siesta_write_forces</span>
    <span class="k">use </span><span class="n">write_subs</span><span class="p">,</span>            <span class="n">only</span><span class="p">:</span> <span class="n">siesta_write_stress_pressure</span>

<span class="cp">#ifdef NCDF_4</span>
    <span class="k">use </span><span class="n">dictionary</span>
    <span class="k">use </span><span class="n">m_ncdf_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cdf_init_file</span><span class="p">,</span> <span class="n">cdf_save_settings</span>
    <span class="k">use </span><span class="n">m_ncdf_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cdf_save_state</span><span class="p">,</span> <span class="n">cdf_save_basis</span>
<span class="cp">#endif</span>
    <span class="k">use </span><span class="n">m_compute_energies</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">compute_energies</span>

    <span class="k">use </span><span class="n">m_mpi_utils</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">broadcast</span><span class="p">,</span> <span class="n">barrier</span>
    <span class="k">use </span><span class="n">fdf</span>
<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="k">use </span><span class="n">m_pexsi</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">pexsi_finalize_scfloop</span>
<span class="cp">#endif</span>
    <span class="k">use </span><span class="n">m_check_walltime</span>

    <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">DE_NEGF</span>
    <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">N_Elec</span>
    <span class="k">use </span><span class="n">m_ts_method</span>
    <span class="k">use </span><span class="n">m_ts_global_vars</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">TSmode</span><span class="p">,</span> <span class="n">TSinit</span><span class="p">,</span> <span class="n">TSrun</span>
    <span class="k">use </span><span class="n">siesta_geom</span><span class="p">,</span>           <span class="n">only</span><span class="p">:</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">isc_off</span>
    <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">sparse_pattern</span><span class="p">,</span> <span class="n">block_dist</span>
    <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">S</span>
    <span class="k">use </span><span class="n">m_ts_charge</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ts_get_charges</span>
    <span class="k">use </span><span class="n">m_ts_charge</span><span class="p">,</span>           <span class="n">only</span><span class="p">:</span> <span class="n">TS_RHOCORR_METHOD</span>
    <span class="k">use </span><span class="n">m_ts_charge</span><span class="p">,</span>           <span class="n">only</span><span class="p">:</span> <span class="n">TS_RHOCORR_FERMI</span>
    <span class="k">use </span><span class="n">m_ts_charge</span><span class="p">,</span>           <span class="n">only</span><span class="p">:</span> <span class="n">TS_RHOCORR_FERMI_TOLERANCE</span>
    <span class="k">use </span><span class="n">m_transiesta</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">transiesta</span>
    <span class="k">use </span><span class="n">kpoint_scf_m</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gamma_scf</span>
    <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">Ef</span>

    <span class="k">use </span><span class="n">m_initwf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">initwf</span>

    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">istep</span>

    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">iscf</span>
    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">first_scf</span><span class="p">,</span> <span class="n">SCFconverged</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dDmax</span> <span class="c">! Max. change in DM elements</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dHmax</span> <span class="c">! Max. change in H elements</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dEmax</span> <span class="c">! Max. change in EDM elements</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">drhog</span> <span class="c">! Max. change in rho(G) (experimental)</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">G2max</span> <span class="c">! actually used meshcutoff</span>
    <span class="k">type</span><span class="p">(</span><span class="n">converger_t</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">conv_harris</span><span class="p">,</span> <span class="n">conv_freeE</span>

    <span class="c">! For initwf</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">istpp</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
    <span class="c">! len=24 from m_mixing.F90</span>
    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">next_mixer</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nnext_mixer</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">imix</span>
<span class="cp">#endif</span>

    <span class="kt">logical</span>               <span class="kd">::</span> <span class="n">time_is_up</span>
    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">tmp_str</span>

    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Qcur</span>
<span class="cp">#ifdef NCDF_4</span>
    <span class="k">type</span><span class="p">(</span><span class="n">dict</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d_sav</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef MPI</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">MPIerror</span>
<span class="cp">#endif</span>

    <span class="k">external</span> <span class="kd">::</span> <span class="n">die</span><span class="p">,</span> <span class="n">message</span>

<span class="cp">#ifdef DEBUG</span>
    <span class="k">call </span><span class="n">write_debug</span><span class="p">(</span> <span class="s1">&#39;    PRE siesta_forces&#39;</span> <span class="p">)</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="c">! Broadcast relevant things for program logic</span>
    <span class="c">! These were set in read_options, called only by &quot;SIESTA_workers&quot;.</span>
    <span class="k">call </span><span class="n">broadcast</span><span class="p">(</span><span class="n">nscf</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="n">true_MPI_Comm_World</span><span class="p">)</span>
<span class="cp">#endif</span>

    <span class="c">!  Initialization tasks for a given geometry:</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">SIESTA_worker</span> <span class="p">)</span>  <span class="k">then</span>
<span class="k">       call </span><span class="n">state_init</span><span class="p">(</span> <span class="n">istep</span> <span class="p">)</span>
    <span class="k">end if</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">call </span><span class="n">memory_snapshot</span><span class="p">(</span><span class="s2">&quot;after state_init&quot;</span><span class="p">)</span>
<span class="cp">#endif</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;Sonly&quot;</span><span class="p">,.</span><span class="n">false</span><span class="p">.)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       if</span> <span class="p">(</span> <span class="n">SIESTA_worker</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
          <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
       <span class="k">end if</span>
<span class="k">       call </span><span class="n">bye</span><span class="p">(</span><span class="s2">&quot;S only&quot;</span><span class="p">)</span>
    <span class="k">end if</span>

<span class="k">    </span><span class="n">Qcur</span> <span class="o">=</span> <span class="n">Qtot</span>
    
<span class="cp">#ifdef SIESTA__FLOOK</span>
    <span class="c">! Add the iscf constant to the list of variables</span>
    <span class="c">! that are available only in this part of the routine.</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.iteration&#39;</span><span class="p">,</span><span class="n">iscf</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.converged&#39;</span><span class="p">,</span><span class="n">SCFconverged</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.charge&#39;</span><span class="p">,</span><span class="n">Qcur</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.dD&#39;</span><span class="p">,</span><span class="n">dDmax</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.dH&#39;</span><span class="p">,</span><span class="n">dHmax</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.dE&#39;</span><span class="p">,</span><span class="n">dEmax</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.drhoG&#39;</span><span class="p">,</span><span class="n">drhog</span><span class="p">)</span>
    <span class="c">! We have to set the meshcutoff here</span>
    <span class="c">! because the asked and required ones are not</span>
    <span class="c">! necessarily the same</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;Mesh.Cutoff.Minimum&#39;</span><span class="p">,</span><span class="n">G2cut</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;Mesh.Cutoff.Used&#39;</span><span class="p">,</span><span class="n">G2max</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">      call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Weight&#39;</span><span class="p">,</span> <span class="n">wmix</span><span class="p">)</span>
    <span class="k">else</span>
<span class="k">      call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Weight&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">w</span><span class="p">)</span>
      <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Restart&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">restart</span><span class="p">)</span>
      <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Iterations&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">n_itt</span><span class="p">)</span>
      
      <span class="c">! Just to populate the table in the dictionary</span>
      <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Switch&#39;</span><span class="p">,</span><span class="n">next_mixer</span><span class="p">)</span>
    <span class="k">end if</span>

    <span class="c">! Initialize to no switch</span>
    <span class="n">next_mixer</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
<span class="cp">#endif</span>

    <span class="c">!  This call computes the **non-scf** part of \( H \) and initializes the</span>
    <span class="c">!  real-space grid structures:</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">SIESTA_worker</span> <span class="p">)</span> <span class="k">call </span><span class="n">setup_H0</span><span class="p">(</span><span class="n">G2max</span><span class="p">)</span>
    <span class="c">!!@todo</span>
    <span class="c">!* It might be better to split the two,</span>
    <span class="c">!  putting the grid initialization into **state_init (link!)** and moving the</span>
    <span class="c">!  calculation of \( H_0 \) to the body of the loop, done `if first_scf=.true.`</span>
    <span class="c">!  This would suit _analysis_ runs in which **nscf = 0**</span>
    <span class="c">!!@endtodo</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">call </span><span class="n">memory_snapshot</span><span class="p">(</span><span class="s2">&quot;after setup_H0&quot;</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
    <span class="c">! Communicate with lua, just before entering the SCF loop</span>
    <span class="c">! This is mainly to be able to communicate</span>
    <span class="c">! mesh-related quantities (g2max)</span>
    <span class="k">call </span><span class="n">slua_call</span><span class="p">(</span><span class="n">LUA</span><span class="p">,</span> <span class="n">LUA_INIT_MD</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef NCDF_4</span>
    <span class="c">! Initialize the NC file</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">write_cdf</span> <span class="p">)</span> <span class="k">then</span>

       <span class="c">! Initialize the file...</span>
       <span class="k">call </span><span class="n">cdf_init_file</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span><span class="n">is_MD</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.)</span>
<span class="cp">#ifdef MPI</span>
       <span class="k">call </span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_Comm_World</span><span class="p">,</span><span class="n">MPIerror</span><span class="p">)</span>
<span class="cp">#endif</span>

       <span class="c">! Save the settings</span>
       <span class="k">call </span><span class="n">cdf_save_settings</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.nc&#39;</span><span class="p">)</span>
<span class="cp">#ifdef MPI</span>
       <span class="k">call </span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_Comm_World</span><span class="p">,</span><span class="n">MPIerror</span><span class="p">)</span>
<span class="cp">#endif</span>
       
       <span class="n">d_sav</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;sp&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
       <span class="n">d_sav</span> <span class="o">=</span> <span class="n">d_sav</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;nsc&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;xij&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
       <span class="n">d_sav</span> <span class="o">=</span> <span class="n">d_sav</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;xa&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;cell&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
       <span class="n">d_sav</span> <span class="o">=</span> <span class="n">d_sav</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;isc_off&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
       <span class="k">call </span><span class="n">cdf_save_state</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span><span class="n">d_sav</span><span class="p">)</span>
       <span class="k">call </span><span class="n">delete</span><span class="p">(</span><span class="n">d_sav</span><span class="p">)</span>

       <span class="c">! Save the basis set</span>
       <span class="k">call </span><span class="n">cdf_save_basis</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.nc&#39;</span><span class="p">)</span>

    <span class="k">end if</span>
<span class="cp">#endif</span>

    <span class="c">!* The dHmax variable only has meaning for Hamiltonian</span>
    <span class="c">!  mixing, or when requiring the Hamiltonian to be converged.</span>
    <span class="n">dDmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1._dp</span>
    <span class="n">dHmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1._dp</span>
    <span class="n">dEmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1._dp</span>
    <span class="n">drhog</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1._dp</span>

    <span class="c">! Setup convergence criteria:</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">SIESTA_worker</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       if</span> <span class="p">(</span> <span class="n">converge_Eharr</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">reset</span><span class="p">(</span><span class="n">conv_harris</span><span class="p">)</span>
          <span class="k">call </span><span class="n">set_tolerance</span><span class="p">(</span><span class="n">conv_harris</span><span class="p">,</span><span class="n">tolerance_Eharr</span><span class="p">)</span>
       <span class="k">end if</span>
<span class="k">       if</span> <span class="p">(</span> <span class="n">converge_FreeE</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">reset</span><span class="p">(</span><span class="n">conv_FreeE</span><span class="p">)</span>
          <span class="k">call </span><span class="n">set_tolerance</span><span class="p">(</span><span class="n">conv_FreeE</span><span class="p">,</span><span class="n">tolerance_FreeE</span><span class="p">)</span>
       <span class="k">end if</span>
<span class="k">    end if</span>

    <span class="c">!!# SCF loop</span>
    <span class="c">!* The current structure of the loop tries to reproduce the</span>
    <span class="c">!  historical Siesta usage. It should be made more clear.</span>

    <span class="c">!* Two changes:</span>
    <span class="c">!</span>
    <span class="c">!  1. The number of scf iterations performed is exactly</span>
    <span class="c">!     equal to the number specified (i.e., the &quot;forces&quot;</span>
    <span class="c">!     phase is not counted as a final scf step)</span>
    <span class="c">!  2. At the change to a TranSiesta GF run the variable &quot;first_scf&quot;</span>
    <span class="c">!     is implicitly reset to &quot;true&quot;.</span>
    <span class="c">!</span>

    <span class="c">!!## Start of SCF cycle</span>
    <span class="c">!</span>
    <span class="c">!* Conditions of exit:</span>
    <span class="c">!</span>
    <span class="c">!  * At the top, to catch a non-positive nscf and # of iterations</span>
    <span class="c">!  * At the bottom, based on convergence</span>
    <span class="c">!</span>
    <span class="n">iscf</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">do while</span> <span class="p">(</span> <span class="n">iscf</span> <span class="o">&lt;</span> <span class="n">nscf</span> <span class="p">)</span>

       <span class="n">iscf</span> <span class="o">=</span> <span class="n">iscf</span> <span class="o">+</span> <span class="mi">1</span>

       <span class="c">!* Note implications for TranSiesta when mixing \(H\).</span>
       <span class="c">!  Now \(H\) will be recomputed instead of simply being</span>
       <span class="c">!  inherited, however, this is required as if</span>
       <span class="c">!  we have bias calculations as the electric</span>
       <span class="c">!  field across the junction needs to be present.</span>

       <span class="n">first_scf</span> <span class="o">=</span> <span class="p">(</span><span class="n">iscf</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

       <span class="k">if</span> <span class="p">(</span> <span class="n">SIESTA_worker</span> <span class="p">)</span> <span class="k">then</span>

          <span class="c">! Check whether we are short of time to continue</span>
          <span class="k">call </span><span class="n">check_walltime</span><span class="p">(</span><span class="n">time_is_up</span><span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">time_is_up</span> <span class="p">)</span> <span class="k">then</span>
             <span class="c">! Save DM/H if we were not saving it...</span>
             <span class="c">!   Do any other bookeeping not done by &quot;die&quot;</span>
             <span class="k">call </span><span class="n">timer</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
             <span class="k">call </span><span class="n">timer</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
             <span class="k">call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;WARNING&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                  <span class="s1">&#39;SCF_NOT_CONV: SCF did not converge&#39;</span><span class="o">//</span> <span class="p">&amp;</span>
                  <span class="s1">&#39; before wall time exhaustion&#39;</span><span class="p">)</span>
             <span class="k">write</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">,</span><span class="s2">&quot;(2(i5,tr1),f12.6)&quot;</span><span class="p">)</span> <span class="n">istep</span><span class="p">,</span> <span class="n">iscf</span><span class="p">,</span> <span class="n">prevDmax</span>
             <span class="k">call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39; (info)&#39;</span><span class="p">,</span><span class="s2">&quot;Geom step, scf iteration, dmax:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">))</span>
             
             <span class="k">call </span><span class="n">barrier</span><span class="p">()</span> <span class="c">! A non-root node might get first to the &#39;die&#39; call</span>
             <span class="k">call </span><span class="n">die</span><span class="p">(</span><span class="s2">&quot;OUT_OF_TIME: Time is up.&quot;</span><span class="p">)</span>

          <span class="k">end if</span>

<span class="k">          call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;IterSCF&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="p">&amp;</span>
               <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span> <span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">iscf</span> <span class="p">)</span>

          <span class="k">if</span> <span class="p">(</span> <span class="n">mixH</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">             if</span> <span class="p">(</span> <span class="n">first_scf</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                if</span> <span class="p">(</span><span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;Read-H-from-file&quot;</span><span class="p">,.</span><span class="n">false</span><span class="p">.))</span> <span class="k">then</span>
<span class="k">                   call </span><span class="n">get_H_from_file</span><span class="p">()</span>
                <span class="k">else</span>
<span class="k">                   call </span><span class="n">setup_hamiltonian</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
                <span class="k">end if</span>
<span class="k">             end if</span>

<span class="k">             call </span><span class="n">compute_DM</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>

             <span class="c">! Maybe set Dold to zero if reading charge or H...</span>
             <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Dold</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">dDmax</span><span class="p">)</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">converge_EDM</span> <span class="p">)</span> <span class="p">&amp;</span>
                  <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Eold</span><span class="p">,</span> <span class="n">Escf</span><span class="p">,</span> <span class="n">dEmax</span><span class="p">)</span>
             <span class="k">call </span><span class="n">setup_hamiltonian</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
             <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Hold</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dHmax</span><span class="p">)</span>

          <span class="k">else</span>

<span class="k">             call </span><span class="n">setup_hamiltonian</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
             <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Hold</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dHmax</span><span class="p">)</span>

             <span class="k">call </span><span class="n">compute_DM</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>

             <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Dold</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">dDmax</span><span class="p">)</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">converge_EDM</span> <span class="p">)</span> <span class="p">&amp;</span>
                  <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Eold</span><span class="p">,</span> <span class="n">Escf</span><span class="p">,</span> <span class="n">dEmax</span><span class="p">)</span>

          <span class="k">end if</span>

          <span class="c">! This iteration has completed calculating the new DM</span>

          <span class="k">call </span><span class="n">compute_energies</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             call </span><span class="n">compute_charge_diff</span><span class="p">(</span> <span class="n">drhog</span> <span class="p">)</span>
          <span class="k">end if</span>

          <span class="c">! Note: For DM and H convergence checks. At this point:</span>
          <span class="c">! If mixing the DM:</span>
          <span class="c">!        Dscf=DM_out, Dold=DM_in(mixed), H=H_in, Hold=H_in(prev step)</span>
          <span class="c">!        dDmax=maxdiff(DM_out,DM_in)</span>
          <span class="c">!        dHmax=maxdiff(H_in - H_in(prev step))</span>
          <span class="c">! If mixing the Hamiltonian:</span>
          <span class="c">!        Dscf=DM_out, Dold=DM_in, H=H_(DM_out), Hold=H_in(mixed)</span>
          <span class="c">!        dDmax=maxdiff(DM_out,DM_in)</span>
          <span class="c">!        dHmax=maxdiff(H(DM_out),H_in)</span>
          <span class="k">call </span><span class="n">scfconvergence_test</span><span class="p">(</span> <span class="n">first_scf</span><span class="p">,</span> <span class="n">iscf</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">dDmax</span><span class="p">,</span> <span class="n">dHmax</span><span class="p">,</span> <span class="n">dEmax</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">conv_harris</span><span class="p">,</span> <span class="n">conv_freeE</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">SCFconverged</span> <span class="p">)</span>

          <span class="c">! ** Check this heuristic</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">mixH</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             </span><span class="n">prevDmax</span> <span class="o">=</span> <span class="n">dHmax</span>
          <span class="k">else</span>
<span class="k">             </span><span class="n">prevDmax</span> <span class="o">=</span> <span class="n">dDmax</span>
          <span class="k">end if</span>

          <span class="c">! Calculate current charge based on the density matrix</span>
          <span class="k">call </span><span class="n">dm_charge</span><span class="p">(</span><span class="n">spin</span><span class="p">,</span> <span class="n">DM_2D</span><span class="p">,</span> <span class="n">S_1D</span><span class="p">,</span> <span class="n">Qcur</span><span class="p">)</span>


          <span class="c">! Check whether we should step to the next mixer</span>
          <span class="k">call </span><span class="n">mixing_scf_converged</span><span class="p">(</span> <span class="n">SCFconverged</span> <span class="p">)</span>

          <span class="k">if</span> <span class="p">(</span> <span class="n">SCFconverged</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">iscf</span> <span class="o">&lt;</span> <span class="n">min_nscf</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             </span><span class="n">SCFconverged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="p">&amp;</span>
                     <span class="s2">&quot;SCF cycle continued for minimum number of iterations: &quot;</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">min_nscf</span>
             <span class="k">end if</span>
<span class="k">          end if</span>

          <span class="c">! In case the user has requested a Fermi-level correction</span>
          <span class="c">! Then we start by correcting the fermi-level</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">TSrun</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">SCFconverged</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
               <span class="n">TS_RHOCORR_METHOD</span> <span class="o">==</span> <span class="n">TS_RHOCORR_FERMI</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">             if</span> <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Qcur</span> <span class="o">-</span> <span class="n">Qtot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TS_RHOCORR_FERMI_TOLERANCE</span> <span class="p">)</span> <span class="k">then</span>

                <span class="c">! Call transiesta with fermi-correct</span>
                <span class="k">call </span><span class="n">transiesta</span><span class="p">(</span><span class="n">iscf</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">block_dist</span><span class="p">,</span> <span class="n">sparse_pattern</span><span class="p">,</span> <span class="n">Gamma_Scf</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">isc_off</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">Dscf</span><span class="p">,</span> <span class="n">Escf</span><span class="p">,</span> <span class="n">Ef</span><span class="p">,</span> <span class="n">Qtot</span><span class="p">,</span> <span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">DE_NEGF</span><span class="p">)</span>

                <span class="c">! We will not have not converged as we have just</span>
                <span class="c">! changed the Fermi-level</span>
                <span class="n">SCFconverged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>

             <span class="k">end if</span>

<span class="k">          end if</span>

<span class="k">          if</span> <span class="p">(</span> <span class="n">monitor_forces_in_scf</span> <span class="p">)</span> <span class="k">call </span><span class="n">compute_forces</span><span class="p">()</span>

          <span class="c">! Mix_after_convergence preserves the old behavior of</span>
          <span class="c">! the program.</span>
          <span class="k">if</span> <span class="p">(</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SCFconverged</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">mix_after_convergence</span><span class="p">)</span> <span class="k">then</span>

             <span class="c">! Mix for next step</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                call </span><span class="n">mix_rhog</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
             <span class="k">else</span>
<span class="k">                call </span><span class="n">mixer</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
             <span class="k">end if</span>

             <span class="c">! Save for possible restarts</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">mixH</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                call </span><span class="n">write_spmatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;H_MIXED&quot;</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="n">writeH</span><span class="p">)</span>
                <span class="k">call </span><span class="n">save_density_matrix</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;DM_OUT&quot;</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="n">writeDM</span><span class="p">)</span>
             <span class="k">else</span>
<span class="k">                call </span><span class="n">save_density_matrix</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;DM_MIXED&quot;</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="n">writeDM</span><span class="p">)</span>
                <span class="k">call </span><span class="n">write_spmatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;H_DMGEN&quot;</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="n">writeH</span><span class="p">)</span>
             <span class="k">end if</span>
<span class="k">          end if</span>

<span class="k">          call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;IterSCF&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
          <span class="k">call </span><span class="n">print_timings</span><span class="p">(</span> <span class="n">first_scf</span><span class="p">,</span> <span class="n">istep</span> <span class="o">==</span> <span class="n">inicoor</span> <span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlEndStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">)</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
          <span class="c">! Communicate with lua</span>
          <span class="k">call </span><span class="n">slua_call</span><span class="p">(</span><span class="n">LUA</span><span class="p">,</span> <span class="n">LUA_SCF_LOOP</span><span class="p">)</span>

          <span class="c">! Retrieve an easy character string</span>
          <span class="n">nnext_mixer</span> <span class="o">=</span> <span class="n">cunpack</span><span class="p">(</span><span class="n">next_mixer</span><span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">nnext_mixer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             if</span> <span class="p">(</span> <span class="n">TSrun</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                do </span><span class="n">imix</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">ts_scf_mixs</span><span class="p">)</span>
                   <span class="k">if</span> <span class="p">(</span> <span class="n">ts_scf_mixs</span><span class="p">(</span><span class="n">imix</span><span class="p">)%</span><span class="n">name</span> <span class="o">==</span> <span class="n">nnext_mixer</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                      call </span><span class="n">mixers_history_init</span><span class="p">(</span><span class="n">ts_scf_mixs</span><span class="p">)</span>
                      <span class="n">scf_mix</span> <span class="o">=&gt;</span> <span class="n">ts_scf_mixs</span><span class="p">(</span><span class="n">imix</span><span class="p">)</span>
                      <span class="k">exit</span>
<span class="k">                   end if</span>
<span class="k">                end do</span>
<span class="k">             else</span>
<span class="k">                do </span><span class="n">imix</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">scf_mixs</span><span class="p">)</span>
                   <span class="k">if</span> <span class="p">(</span> <span class="n">scf_mixs</span><span class="p">(</span><span class="n">imix</span><span class="p">)%</span><span class="n">name</span> <span class="o">==</span> <span class="n">nnext_mixer</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                      call </span><span class="n">mixers_history_init</span><span class="p">(</span><span class="n">scf_mixs</span><span class="p">)</span>
                      <span class="n">scf_mix</span> <span class="o">=&gt;</span> <span class="n">scf_mixs</span><span class="p">(</span><span class="n">imix</span><span class="p">)</span>
                      <span class="k">exit</span>
<span class="k">                   end if</span>
<span class="k">                end do</span>
<span class="k">             end if</span>

             <span class="c">! Check that we indeed have changed the mixer</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">scf_mix</span><span class="p">%</span><span class="n">name</span> <span class="o">/=</span> <span class="n">nnext_mixer</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(2a)&#39;</span><span class="p">)</span> <span class="s1">&#39;siesta-lua: WARNING: trying to change &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="s1">&#39;to a non-existing mixer! Not changing anything!&#39;</span>

             <span class="k">else if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(2a)&#39;</span><span class="p">)</span> <span class="s1">&#39;siesta-lua: Switching mixer method to: &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="nb">trim</span><span class="p">(</span><span class="n">nnext_mixer</span><span class="p">)</span>

             <span class="k">end if</span>
             <span class="c">! Reset for next loop</span>
             <span class="n">next_mixer</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

             <span class="c">! Update the references</span>
             <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Weight&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">w</span><span class="p">)</span>
             <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Restart&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">restart</span><span class="p">)</span>
             <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Iterations&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">n_itt</span><span class="p">)</span>

          <span class="k">end if</span>
<span class="cp">#endif</span>

          <span class="c">! ... except that we might continue for TranSiesta</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">SCFconverged</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             call </span><span class="n">transiesta_switch</span><span class="p">()</span>
             <span class="c">! might reset SCFconverged and iscf</span>
          <span class="k">end if</span>

<span class="k">       else</span>

          <span class="c">! non-siesta worker</span>
          <span class="k">call </span><span class="n">compute_DM</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>

       <span class="k">end if</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
       <span class="k">call </span><span class="n">broadcast</span><span class="p">(</span><span class="n">iscf</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="n">true_MPI_Comm_World</span><span class="p">)</span>
       <span class="k">call </span><span class="n">broadcast</span><span class="p">(</span><span class="n">SCFconverged</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="n">true_MPI_Comm_World</span><span class="p">)</span>
<span class="cp">#endif</span>

       <span class="c">!  Exit if converged:</span>
       <span class="k">if</span> <span class="p">(</span> <span class="n">SCFconverged</span> <span class="p">)</span> <span class="k">exit</span>

<span class="k">    end do</span>
    <span class="c">!! **end of SCF cycle**</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">isolve</span> <span class="o">==</span> <span class="n">SOLVE_PEXSI</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       call </span><span class="n">pexsi_finalize_scfloop</span><span class="p">()</span>
    <span class="k">end if</span>
<span class="cp">#endif</span>

    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SIESTA_worker</span> <span class="p">)</span> <span class="k">return</span>

<span class="k">    call </span><span class="n">end_of_cycle_save_operations</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SCFconverged</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       if</span> <span class="p">(</span> <span class="n">SCFMustConverge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;FATAL&#39;</span><span class="p">,</span><span class="s1">&#39;SCF_NOT_CONV: SCF did not converge&#39;</span> <span class="o">//</span> <span class="p">&amp;</span>
               <span class="s1">&#39; in maximum number of steps (required).&#39;</span><span class="p">)</span>
          <span class="k">write</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">,</span><span class="s2">&quot;(2(i5,tr1),f12.6)&quot;</span><span class="p">)</span> <span class="n">istep</span><span class="p">,</span> <span class="n">iscf</span><span class="p">,</span> <span class="n">prevDmax</span>
          <span class="k">call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39; (info)&#39;</span><span class="p">,</span><span class="s2">&quot;Geom step, scf iteration, dmax:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">))</span>
          <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span> <span class="c">! New call to close the tree</span>
          <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
          <span class="k">call </span><span class="n">barrier</span><span class="p">()</span>
          <span class="k">call </span><span class="n">die</span><span class="p">(</span><span class="s1">&#39;ABNORMAL_TERMINATION&#39;</span><span class="p">)</span>
       <span class="k">else if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">harrisfun</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;WARNING&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="s1">&#39;SCF_NOT_CONV: SCF did not converge  in maximum number of steps.&#39;</span><span class="p">)</span>
          <span class="k">write</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">,</span><span class="s2">&quot;(2(i5,tr1),f12.6)&quot;</span><span class="p">)</span> <span class="n">istep</span><span class="p">,</span> <span class="n">iscf</span><span class="p">,</span> <span class="n">prevDmax</span>
          <span class="k">call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39; (info)&#39;</span><span class="p">,</span><span class="s2">&quot;Geom step, scf iteration, dmax:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">))</span>
       <span class="k">end if</span>
<span class="k">    end if</span>

    <span class="c">! To write the initial wavefunctions to be used in a</span>
    <span class="c">! consequent TDDFT run.</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">writetdwf</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       </span><span class="n">istpp</span> <span class="o">=</span> <span class="mi">0</span>
       <span class="k">call </span><span class="n">initwf</span><span class="p">(</span><span class="n">istpp</span><span class="p">,</span><span class="n">totime</span><span class="p">)</span>
    <span class="k">end if</span>
<span class="k">    </span>
<span class="k">    if</span> <span class="p">(</span> <span class="n">TSmode</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">TSinit</span><span class="p">.</span><span class="nb">and</span><span class="p">.(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SCFConverged</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
       <span class="c">! Signal that the DM hasn&#39;t converged, so we cannot</span>
       <span class="c">! continue to the transiesta routines</span>
       <span class="k">call </span><span class="n">die</span><span class="p">(</span><span class="s1">&#39;ABNORMAL_TERMINATION&#39;</span><span class="p">)</span>
    <span class="k">end if</span>
    
    <span class="c">! Clean-up here to limit memory usage</span>
    <span class="k">call </span><span class="n">mixers_scf_history_init</span><span class="p">(</span> <span class="p">)</span>
    
    <span class="c">! End of standard SCF loop.</span>
    <span class="c">! Do one more pass to compute forces and stresses</span>
    
    <span class="c">! Note that this call will no longer overwrite H while computing the</span>
    <span class="c">! final energies, forces and stresses...</span>
    
    <span class="k">if</span> <span class="p">(</span> <span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;compute-forces&quot;</span><span class="p">,.</span><span class="n">true</span><span class="p">.)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       call </span><span class="n">post_scf_work</span><span class="p">(</span> <span class="n">istep</span><span class="p">,</span> <span class="n">iscf</span> <span class="p">,</span> <span class="n">SCFconverged</span> <span class="p">)</span>
<span class="cp">#ifdef SIESTA__PEXSI</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">call </span><span class="n">memory_snapshot</span><span class="p">(</span><span class="s2">&quot;after post_scf_work&quot;</span><span class="p">)</span>
<span class="cp">#endif</span>
    <span class="k">end if</span>
    
    <span class="c">! ... so H at this point is the latest generator of the DM, except</span>
    <span class="c">! if mixing H beyond self-consistency or terminating the scf loop</span>
    <span class="c">! without convergence while mixing H</span>
    
    <span class="k">call </span><span class="n">state_analysis</span><span class="p">(</span> <span class="n">istep</span> <span class="p">)</span>
<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">call </span><span class="n">memory_snapshot</span><span class="p">(</span><span class="s2">&quot;after state_analysis&quot;</span><span class="p">)</span>
<span class="cp">#endif</span>

    <span class="c">! If siesta is running as a subroutine, send forces to master program</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">siesta_server</span><span class="p">)</span> <span class="p">&amp;</span>
         <span class="k">call </span><span class="n">forcesToMaster</span><span class="p">(</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">Etot</span><span class="p">,</span> <span class="n">cfa</span><span class="p">,</span> <span class="n">cstress</span> <span class="p">)</span>

<span class="cp">#ifdef DEBUG</span>
    <span class="k">call </span><span class="n">write_debug</span><span class="p">(</span> <span class="s1">&#39;    POS siesta_forces&#39;</span> <span class="p">)</span>
<span class="cp">#endif</span>
    
  <span class="k">contains</span>

    <span class="c">! Read the Hamiltonian from a file</span>
    <span class="k">subroutine </span><span class="n">get_H_from_file</span><span class="p">()</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">listhptr</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">no_l</span>
      <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">spin</span>
      <span class="k">use </span><span class="n">m_iodm_old</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">read_spmatrix</span>

      <span class="kt">logical</span> <span class="kd">::</span> <span class="n">found</span>

      <span class="k">call </span><span class="n">read_spmatrix</span><span class="p">(</span><span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="p">&amp;</span>
           <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">userfile</span><span class="o">=</span><span class="s2">&quot;H_IN&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">found</span><span class="p">)</span> <span class="k">call </span><span class="n">die</span><span class="p">(</span><span class="s2">&quot;Could not find H_IN&quot;</span><span class="p">)</span>

    <span class="k">end subroutine </span><span class="n">get_H_from_file</span>

    <span class="c">! Computes forces and stresses with the current DM_out</span>
    <span class="k">subroutine </span><span class="n">compute_forces</span><span class="p">()</span>

      <span class="k">use </span><span class="n">siesta_options</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">recompute_H_after_scf</span>
      <span class="k">use </span><span class="n">m_final_H_f_stress</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">final_H_f_stress</span>
      <span class="k">use </span><span class="n">write_subs</span>

      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">fa_old</span><span class="p">(:,:),</span> <span class="n">Hsave</span><span class="p">(:,:)</span>

      <span class="k">allocate</span><span class="p">(</span><span class="n">fa_old</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span><span class="nb">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span><span class="nb">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
      <span class="n">fa_old</span><span class="p">(:,:)</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(:,:)</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">recompute_H_after_scf</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         allocate</span><span class="p">(</span><span class="n">Hsave</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="nb">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="nb">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
         <span class="n">Hsave</span><span class="p">(:,:)</span> <span class="o">=</span> <span class="n">H</span><span class="p">(:,:)</span>
      <span class="k">end if</span>
<span class="k">      call </span><span class="n">final_H_f_stress</span><span class="p">(</span> <span class="n">istep</span> <span class="p">,</span> <span class="n">iscf</span> <span class="p">,</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">recompute_H_after_scf</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         </span><span class="n">H</span><span class="p">(:,:)</span> <span class="o">=</span> <span class="n">Hsave</span><span class="p">(:,:)</span>
         <span class="k">deallocate</span><span class="p">(</span><span class="n">Hsave</span><span class="p">)</span>
      <span class="k">end if</span>
<span class="k">      if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         print</span> <span class="o">*</span><span class="p">,</span> <span class="s2">&quot;Max diff in force (eV/Ang): &quot;</span><span class="p">,</span> <span class="p">&amp;</span>
              <span class="nb">maxval</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">fa</span><span class="o">-</span><span class="n">fa_old</span><span class="p">))</span><span class="o">*</span><span class="n">Ang</span><span class="o">/</span><span class="n">eV</span>
         <span class="k">call </span><span class="n">siesta_write_forces</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
         <span class="k">call </span><span class="n">siesta_write_stress_pressure</span><span class="p">()</span>
      <span class="n">endif</span>
      <span class="k">deallocate</span><span class="p">(</span><span class="n">fa_old</span><span class="p">)</span>

    <span class="k">end subroutine </span><span class="n">compute_forces</span>

    <span class="c">! Print out timings of the first SCF loop only</span>
    <span class="k">subroutine </span><span class="n">print_timings</span><span class="p">(</span><span class="n">first_scf</span><span class="p">,</span> <span class="n">first_md</span><span class="p">)</span>
      <span class="k">use </span><span class="n">timer_options</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">use_tree_timer</span>
      <span class="k">use </span><span class="n">m_ts_global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">TSrun</span>
      <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">first_scf</span><span class="p">,</span> <span class="n">first_md</span>
      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="kd">::</span> <span class="n">routine</span>

      <span class="c">! If this is not the first iteration,</span>
      <span class="c">! we immediately return.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">first_scf</span> <span class="p">)</span> <span class="k">return</span>
<span class="k">      if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">first_md</span> <span class="p">)</span> <span class="k">return</span>

<span class="k">      </span><span class="n">routine</span> <span class="o">=</span> <span class="s1">&#39;IterSCF&#39;</span>

      <span class="k">if</span> <span class="p">(</span> <span class="n">TSrun</span> <span class="p">)</span> <span class="k">then</span>
         <span class="c">! with Green function generation</span>
         <span class="c">! The tree-timer requires direct</span>
         <span class="c">! children of the routine to be</span>
         <span class="c">! queried.</span>
         <span class="c">! This is not obeyed in the TS case... :(</span>
         <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">use_tree_timer</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            </span><span class="n">routine</span> <span class="o">=</span> <span class="s1">&#39;TS&#39;</span>
         <span class="k">end if</span>
<span class="k">      </span><span class="n">endif</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="n">routine</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

    <span class="k">end subroutine </span><span class="n">print_timings</span>

    <span class="c">! Depending on various conditions, save the DMin</span>
    <span class="c">! or the DMout, and possibly keep a copy of H</span>

    <span class="c">! NOTE: Only if the scf cycle converged before exit it</span>
    <span class="c">! is guaranteed that the DM is &quot;pure out&quot; and that</span>
    <span class="c">! we can recover the right H if mixing H.</span>
    <span class="c">!</span>
    <span class="k">subroutine </span><span class="n">end_of_cycle_save_operations</span><span class="p">()</span>

      <span class="kt">logical</span> <span class="kd">::</span> <span class="n">DM_write</span><span class="p">,</span> <span class="n">H_write</span>

      <span class="c">! Depending on the option we should overwrite the</span>
      <span class="c">! Hamiltonian</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">mixH</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">mix_after_convergence</span> <span class="p">)</span> <span class="k">then</span>
         <span class="c">! Make sure that we keep the H actually used</span>
         <span class="c">! to generate the last DM, if needed.</span>
         <span class="n">H</span> <span class="o">=</span> <span class="n">Hold</span>
      <span class="k">end if</span>

<span class="k">      </span><span class="n">DM_write</span> <span class="o">=</span> <span class="n">write_DM_at_end_of_cycle</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
           <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">writeDM</span>
      <span class="n">H_write</span> <span class="o">=</span> <span class="n">write_H_at_end_of_cycle</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
           <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">writeH</span>

      <span class="k">if</span> <span class="p">(</span> <span class="n">mix_after_convergence</span> <span class="p">)</span> <span class="k">then</span>
         <span class="c">! If we have been saving them, there is no point in doing</span>
         <span class="c">! it one more time</span>
         <span class="k">if</span> <span class="p">(</span> <span class="n">mixH</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            call </span><span class="n">save_density_matrix</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;DM_OUT&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">DM_write</span><span class="p">)</span>
            <span class="k">call </span><span class="n">write_spmatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;H_MIXED&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">H_write</span><span class="p">)</span>
         <span class="k">else</span>
<span class="k">            call </span><span class="n">save_density_matrix</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;DM_MIXED&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">DM_write</span><span class="p">)</span>
            <span class="k">call </span><span class="n">write_spmatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;H_DMGEN&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">H_write</span><span class="p">)</span>
         <span class="k">end if</span>
<span class="k">      else</span>
<span class="k">         call </span><span class="n">save_density_matrix</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;DM_OUT&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">DM_write</span><span class="p">)</span>
         <span class="k">call </span><span class="n">write_spmatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;H_DMGEN&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">H_write</span><span class="p">)</span>
      <span class="k">end if</span>

<span class="k">    end subroutine </span><span class="n">end_of_cycle_save_operations</span>

    <span class="k">subroutine </span><span class="n">transiesta_switch</span><span class="p">()</span>

      <span class="k">use </span><span class="nb">precision</span><span class="p">,</span>             <span class="n">only</span><span class="p">:</span> <span class="n">dp</span>
      <span class="k">use </span><span class="n">parallel</span><span class="p">,</span>              <span class="n">only</span><span class="p">:</span> <span class="n">IONode</span>
      <span class="k">use </span><span class="n">class_dSpData2D</span>
      <span class="k">use </span><span class="n">class_Fstack_dData1D</span>
      <span class="k">use </span><span class="n">densematrix</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">resetDenseMatrix</span>

      <span class="k">use </span><span class="n">siesta_options</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">fire_mix</span><span class="p">,</span> <span class="n">broyden_maxit</span>
      <span class="k">use </span><span class="n">siesta_options</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">dDtol</span><span class="p">,</span> <span class="n">dHtol</span>

      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">DM_2D</span><span class="p">,</span> <span class="n">EDM_2D</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">lasto</span>
      <span class="k">use </span><span class="n">siesta_geom</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">isc_off</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">ucell</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">Ef</span>
      <span class="k">use </span><span class="n">m_mixing</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">mixers_history_init</span>
      <span class="k">use </span><span class="n">m_mixing_scf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">scf_mix</span><span class="p">,</span> <span class="n">scf_mixs</span>
      <span class="k">use </span><span class="n">m_rhog</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">resetRhoG</span>

      <span class="k">use </span><span class="n">m_ts_global_vars</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">TSinit</span><span class="p">,</span> <span class="n">TSrun</span>
      <span class="k">use </span><span class="n">m_ts_global_vars</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">ts_print_transiesta</span>
      <span class="k">use </span><span class="n">m_ts_method</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">N_Elec</span><span class="p">,</span> <span class="n">Elecs</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">DM_bulk</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">val_swap</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">ts_Dtol</span><span class="p">,</span> <span class="n">ts_Htol</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">ts_hist_keep</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">ts_siesta_stop</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">ts_scf_mixs</span>
      <span class="k">use </span><span class="n">m_ts_electype</span>

      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span> <span class="n">na_a</span>
      <span class="kt">integer</span><span class="p">,</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">allowed_a</span><span class="p">(:)</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">DM</span><span class="p">(:,:),</span> <span class="n">EDM</span><span class="p">(:,:)</span>

      <span class="c">! We are done with the initial diagon run</span>
      <span class="c">! Now we start the TRANSIESTA (Green functions) run</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">TSmode</span> <span class="p">)</span> <span class="k">return</span>
<span class="k">      if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">TSinit</span> <span class="p">)</span> <span class="k">return</span>

      <span class="c">! whether we are in siesta initialization step</span>
      <span class="n">TSinit</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
      <span class="c">! whether transiesta is running</span>
      <span class="n">TSrun</span>  <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>

      <span class="c">! If transiesta should stop immediately</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">ts_siesta_stop</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">         if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span> <span class="s1">&#39;ts: Stopping transiesta (user option)!&#39;</span>
         <span class="k">end if</span>

<span class="k">         return</span>

<span class="k">      end if</span>

      <span class="c">! Reduce memory requirements</span>
      <span class="k">call </span><span class="n">resetDenseMatrix</span><span class="p">()</span>

      <span class="c">! Signal to continue...</span>
      <span class="c">! These two variables are from the top-level</span>
      <span class="c">! routine (siesta_forces)</span>
      <span class="n">SCFconverged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
      <span class="n">iscf</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="c">! DANGER (when/if going back to the DIAGON run, we should</span>
      <span class="c">! re-instantiate the original mixing value)</span>
      <span class="k">call </span><span class="n">val_swap</span><span class="p">(</span><span class="n">dDtol</span><span class="p">,</span> <span class="n">ts_Dtol</span><span class="p">)</span>
      <span class="k">call </span><span class="n">val_swap</span><span class="p">(</span><span class="n">dHtol</span><span class="p">,</span> <span class="n">ts_Htol</span><span class="p">)</span>

      <span class="c">! Clean up mixing history</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">resetRhoG</span><span class="p">(.</span><span class="n">true</span><span class="p">.)</span>
      <span class="k">else</span>
<span class="k">        if</span> <span class="p">(</span> <span class="nb">associated</span><span class="p">(</span><span class="n">ts_scf_mixs</span><span class="p">,</span> <span class="k">target</span><span class="o">=</span><span class="n">scf_mixs</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          do </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">stack</span><span class="p">)</span>
            <span class="k">call </span><span class="n">reset</span><span class="p">(</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">stack</span><span class="p">(</span><span class="n">iel</span><span class="p">),</span> <span class="o">-</span><span class="n">ts_hist_keep</span><span class="p">)</span>
            <span class="c">! Reset iteration count as certain</span>
            <span class="c">! mixing schemes require this for consistency</span>
            <span class="n">scf_mix</span><span class="p">%</span><span class="n">cur_itt</span> <span class="o">=</span> <span class="n">n_items</span><span class="p">(</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">stack</span><span class="p">(</span><span class="n">iel</span><span class="p">))</span>
          <span class="k">end do</span>
<span class="k">        else</span>
<span class="k">          call </span><span class="n">mixers_history_init</span><span class="p">(</span><span class="n">scf_mixs</span><span class="p">)</span>
        <span class="k">end if</span>
<span class="k">      end if</span>
      
      <span class="c">! Transfer scf_mixing to the transiesta mixing routine</span>
      <span class="n">scf_mix</span> <span class="o">=&gt;</span> <span class="n">ts_scf_mixs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Weight&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">w</span><span class="p">)</span>
         <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Restart&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">restart</span><span class="p">)</span>
         <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Iterations&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">n_itt</span><span class="p">)</span>
      <span class="k">end if</span>
<span class="cp">#endif</span>

      <span class="k">call </span><span class="n">ts_print_transiesta</span><span class="p">()</span>

      <span class="c">! In case of transiesta and DM_bulk.</span>
      <span class="c">! In case we ask for initialization of the DM in bulk</span>
      <span class="c">! we read in the DM files from the electrodes and</span>
      <span class="c">! initialize the bulk to those values</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">DM_bulk</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">         if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(/,2a)&#39;</span><span class="p">)</span> <span class="s1">&#39;transiesta: &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                 <span class="s1">&#39;Initializing bulk DM in electrodes.&#39;</span>
         <span class="k">end if</span>

<span class="k">         </span><span class="n">na_a</span> <span class="o">=</span> <span class="mi">0</span>
         <span class="k">do </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">na_u</span>
            <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">a_isDev</span><span class="p">(</span><span class="n">iEl</span><span class="p">)</span> <span class="p">)</span> <span class="n">na_a</span> <span class="o">=</span> <span class="n">na_a</span> <span class="o">+</span> <span class="mi">1</span>
         <span class="k">end do</span>
<span class="k">         allocate</span><span class="p">(</span><span class="n">allowed_a</span><span class="p">(</span><span class="n">na_a</span><span class="p">))</span>
         <span class="n">na_a</span> <span class="o">=</span> <span class="mi">0</span>
         <span class="k">do </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">na_u</span>
            <span class="c">! We allow the buffer atoms as well (this will even out the</span>
            <span class="c">! potential around the back of the electrode)</span>
            <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">a_isDev</span><span class="p">(</span><span class="n">iEl</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">               </span><span class="n">na_a</span> <span class="o">=</span> <span class="n">na_a</span> <span class="o">+</span> <span class="mi">1</span>
               <span class="n">allowed_a</span><span class="p">(</span><span class="n">na_a</span><span class="p">)</span> <span class="o">=</span> <span class="n">iEl</span>
            <span class="k">end if</span>
<span class="k">         end do</span>

<span class="k">         do </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">N_Elec</span>

            <span class="k">if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">               write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(/,2a)&#39;</span><span class="p">)</span> <span class="s1">&#39;transiesta: &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                    <span class="s1">&#39;Reading in electrode TSDE for &#39;</span><span class="o">//</span> <span class="p">&amp;</span>
                    <span class="nb">trim</span><span class="p">(</span><span class="n">Elecs</span><span class="p">(</span><span class="n">iEl</span><span class="p">)%</span><span class="n">Name</span><span class="p">)</span>
            <span class="k">end if</span>

            <span class="c">! Copy over the DM in the lead</span>
            <span class="c">! Notice that the EDM matrix that is copied over</span>
            <span class="c">! will be equivalent at Ef == 0</span>
            <span class="k">call </span><span class="n">copy_DM</span><span class="p">(</span><span class="n">Elecs</span><span class="p">(</span><span class="n">iEl</span><span class="p">),</span><span class="n">na_u</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">lasto</span><span class="p">,</span><span class="n">nsc</span><span class="p">,</span><span class="n">isc_off</span><span class="p">,</span> <span class="p">&amp;</span>
                 <span class="n">ucell</span><span class="p">,</span> <span class="n">DM_2D</span><span class="p">,</span> <span class="n">EDM_2D</span><span class="p">,</span> <span class="n">na_a</span><span class="p">,</span> <span class="n">allowed_a</span><span class="p">)</span>

         <span class="k">end do</span>

         <span class="c">! Clean-up</span>
         <span class="k">deallocate</span><span class="p">(</span><span class="n">allowed_a</span><span class="p">)</span>

         <span class="k">if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="c">! new-line</span>
         <span class="k">end if</span>

         <span class="c">! The electrode EDM is aligned at Ef == 0</span>
         <span class="c">! We need to align the energy matrix</span>
         <span class="n">DM</span>  <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">DM_2D</span><span class="p">)</span>
         <span class="n">EDM</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">EDM_2D</span><span class="p">)</span>
         <span class="n">iEl</span> <span class="o">=</span>  <span class="n">size</span><span class="p">(</span><span class="n">DM</span><span class="p">)</span>
         <span class="k">call </span><span class="n">daxpy</span><span class="p">(</span><span class="n">iEl</span><span class="p">,</span><span class="n">Ef</span><span class="p">,</span><span class="n">DM</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">EDM</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

      <span class="k">end if</span>

<span class="k">    end subroutine </span><span class="n">transiesta_switch</span>

  <span class="k">end subroutine </span><span class="n">siesta_forces</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SIESTA was developed by SIESTA Group</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>