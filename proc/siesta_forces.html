<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="A first-principles materials simulation code using Density Functional Theory.">
    
    <meta name="author" content="SIESTA Group" >
    <link rel="icon" href="../favicon.png">

    <title>siesta_forces &ndash; SIESTA</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SIESTA <small>trunk-674</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li><a href='../page/index.html'>Program Overview</a></li>
	    
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>siesta_forces
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title="14.0% of total for procedures.">369 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/siesta_forces.F90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li><a href='../sourcefile/siesta_forces.f90.html'>siesta_forces.F90</a></li>
  
     <li><a href='../module/m_siesta_forces.html'>m_siesta_forces</a></li>
  
     <li class="active">siesta_forces</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  




















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/siesta_forces.html#src">siesta_forces</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprocs-0">All Procedures</a></h3></div>
  <div id="allprocs-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../proc/current_itt.html">current_itt</a>
      
      <a class="list-group-item" href="../proc/getstackval.html">getstackval</a>
      
      <a class="list-group-item" href="../proc/inverse.html">inverse</a>
      
      <a class="list-group-item" href="../proc/is_next.html">is_next</a>
      
      <a class="list-group-item" href="../proc/mix_method.html">mix_method</a>
      
      <a class="list-group-item" href="../proc/mix_method_variant.html">mix_method_variant</a>
      
      <a class="list-group-item" href="../proc/mixer_init.html">mixer_init</a>
      
      <a class="list-group-item" href="../proc/mixers_history_init.html">mixers_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_init.html">mixers_init</a>
      
      <a class="list-group-item" href="../proc/mixers_print.html">mixers_print</a>
      
      <a class="list-group-item" href="../proc/mixers_print_block.html">mixers_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_reset.html">mixers_reset</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_history_init.html">mixers_scf_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_init.html">mixers_scf_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print.html">mixers_scf_print</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print_block.html">mixers_scf_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_reset.html">mixers_scf_reset</a>
      
      <a class="list-group-item" href="../interface/mixing.html">mixing</a>
      
      <a class="list-group-item" href="../proc/mixing_1d.html">mixing_1d</a>
      
      <a class="list-group-item" href="../proc/mixing_2d.html">mixing_2d</a>
      
      <a class="list-group-item" href="../proc/mixing_calc_next.html">mixing_calc_next</a>
      
      <a class="list-group-item" href="../proc/mixing_coeff.html">mixing_coeff</a>
      
      <a class="list-group-item" href="../proc/mixing_finalize.html">mixing_finalize</a>
      
      <a class="list-group-item" href="../proc/mixing_init.html">mixing_init</a>
      
      <a class="list-group-item" href="../proc/mixing_ncoeff.html">mixing_ncoeff</a>
      
      <a class="list-group-item" href="../proc/mixing_scf_converged.html">mixing_scf_converged</a>
      
      <a class="list-group-item" href="../proc/mixing_step.html">mixing_step</a>
      
      <a class="list-group-item" href="../proc/norm.html">norm</a>
      
      <a class="list-group-item" href="../proc/push_diff.html">push_diff</a>
      
      <a class="list-group-item" href="../proc/push_f.html">push_F</a>
      
      <a class="list-group-item" href="../proc/push_stack_data.html">push_stack_data</a>
      
      <a class="list-group-item" href="../proc/setup_h0.html">setup_H0</a>
      
      <a class="list-group-item" href="../proc/siesta_analysis.html">siesta_analysis</a>
      
      <a class="list-group-item" href="../proc/siesta_forces.html">siesta_forces</a>
      
      <a class="list-group-item" href="../proc/stack_check.html">stack_check</a>
      
      <a class="list-group-item" href="../proc/state_analysis.html">state_analysis</a>
      
      <a class="list-group-item" href="../proc/state_init.html">state_init</a>
      
      <a class="list-group-item" href="../proc/svd.html">svd</a>
      
      <a class="list-group-item" href="../proc/update_f.html">update_F</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine siesta_forces(istep)
    
    
	 
</h2>
    
  
    <div class="panel panel-default">
      <div class="panel-heading">
	<h3 class="panel-title">Uses</h3>
      </div>
      <ul class="list-group">
      
      <li class="list-group-item">
	<ul class="list-inline">
	  
	  <li>units</li>
	  
	  <li>precision</li>
	  
	  <li>sys</li>
	  
	  <li>files</li>
	  
	  <li>siesta_cml</li>
	  
	  <li><a href='../module/m_state_init.html'>m_state_init</a></li>
	  
	  <li>m_setup_hamiltonian</li>
	  
	  <li><a href='../module/m_setup_h0.html'>m_setup_H0</a></li>
	  
	  <li>m_compute_dm</li>
	  
	  <li>m_compute_max_diff</li>
	  
	  <li>m_scfconvergence_test</li>
	  
	  <li>m_post_scf_work</li>
	  
	  <li>m_mixer</li>
	  
	  <li><a href='../module/m_mixing_scf.html'>m_mixing_scf</a></li>
	  
	  <li><a href='../module/m_mixing_scf.html'>m_mixing_scf</a></li>
	  
	  <li><a href='../module/m_mixing_scf.html'>m_mixing_scf</a></li>
	  
	  <li>m_rhog</li>
	  
	  <li>siesta_options</li>
	  
	  <li>parallel</li>
	  
	  <li><a href='../module/m_state_analysis.html'>m_state_analysis</a></li>
	  
	  <li>m_steps</li>
	  
	  <li>m_spin</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>m_convergence</li>
	  
	  <li>m_convergence</li>
	  
	  <li>siesta_geom</li>
	  
	  <li>m_energies</li>
	  
	  <li>m_forces</li>
	  
	  <li>m_stress</li>
	  
	  <li>siesta_master</li>
	  
	  <li>siesta_master</li>
	  
	  <li>m_save_density_matrix</li>
	  
	  <li>m_iodm_old</li>
	  
	  <li>atomlist</li>
	  
	  <li>m_dm_charge</li>
	  
	  <li>m_pexsi_solver</li>
	  
	  <li>write_subs</li>
	  
	  <li>write_subs</li>
	  
	  <li>m_compute_energies</li>
	  
	  <li>m_mpi_utils</li>
	  
	  <li>fdf</li>
	  
	  <li>m_check_walltime</li>
	  
	  <li>m_energies</li>
	  
	  <li>m_ts_options</li>
	  
	  <li>m_ts_method</li>
	  
	  <li>m_ts_global_vars</li>
	  
	  <li>siesta_geom</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>m_ts_charge</li>
	  
	  <li>m_ts_charge</li>
	  
	  <li>m_ts_charge</li>
	  
	  <li>m_ts_charge</li>
	  
	  <li>m_transiesta</li>
	  
	  <li>kpoint_grid</li>
	  
	  <li>m_energies</li>
	  
	  <li>m_initwf</li>
	  
	</ul>
      </li>
      
      
      
      <li class="list-group-item">
	<div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~siesta_forces~~UsesGraph Pages: 1 -->
<svg id="procsiesta_forcesUsesGraph" width="504pt" height="1830pt"
 viewBox="0.00 0.00 504.00 1830.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~siesta_forces~~UsesGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 1826)">
<title>proc~~siesta_forces~~UsesGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-1826 500,-1826 500,4 -4,4"/>
<!-- proc~siesta_forces -->
<g id="proc~~siesta_forces~~UsesGraph_node1" class="node"><title>proc~siesta_forces</title>
<polygon fill="none" stroke="black" points="496,-927 420,-927 420,-903 496,-903 496,-927"/>
<text text-anchor="middle" x="458" y="-912.6" font-family="Helvetica,sans-Serif" font-size="10.50">siesta_forces</text>
</g>
<!-- sparse_matrices -->
<g id="proc~~siesta_forces~~UsesGraph_node2" class="node"><title>sparse_matrices</title>
<polygon fill="#337ab7" stroke="#337ab7" points="366.5,-1822 275.5,-1822 275.5,-1798 366.5,-1798 366.5,-1822"/>
<text text-anchor="middle" x="321" y="-1807.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sparse_matrices</text>
</g>
<!-- proc~siesta_forces&#45;&gt;sparse_matrices -->
<g id="proc~~siesta_forces~~UsesGraph_edge1" class="edge"><title>proc~siesta_forces&#45;&gt;sparse_matrices</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.778,-927.234C454.849,-1027.92 439.64,-1717.86 384,-1789 381.619,-1792.04 378.778,-1794.65 375.639,-1796.88"/>
<polygon fill="#000000" stroke="#000000" points="373.703,-1793.95 366.751,-1801.95 377.171,-1800.03 373.703,-1793.95"/>
</g>
<!-- kpoint_grid -->
<g id="proc~~siesta_forces~~UsesGraph_node3" class="node"><title>kpoint_grid</title>
<polygon fill="#337ab7" stroke="#337ab7" points="353.5,-1780 288.5,-1780 288.5,-1756 353.5,-1756 353.5,-1780"/>
<text text-anchor="middle" x="321" y="-1765.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">kpoint_grid</text>
</g>
<!-- proc~siesta_forces&#45;&gt;kpoint_grid -->
<g id="proc~~siesta_forces~~UsesGraph_edge2" class="edge"><title>proc~siesta_forces&#45;&gt;kpoint_grid</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.723,-927.261C454.407,-1025.27 437.015,-1679.51 384,-1747 378.702,-1753.74 371.139,-1758.34 363.108,-1761.46"/>
<polygon fill="#000000" stroke="#000000" points="362.04,-1758.13 353.572,-1764.49 364.162,-1764.8 362.04,-1758.13"/>
</g>
<!-- m_ts_charge -->
<g id="proc~~siesta_forces~~UsesGraph_node4" class="node"><title>m_ts_charge</title>
<polygon fill="#337ab7" stroke="#337ab7" points="358.5,-1738 283.5,-1738 283.5,-1714 358.5,-1714 358.5,-1738"/>
<text text-anchor="middle" x="321" y="-1723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_charge</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_ts_charge -->
<g id="proc~~siesta_forces~~UsesGraph_edge3" class="edge"><title>proc~siesta_forces&#45;&gt;m_ts_charge</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.618,-927.132C453.552,-1021.4 431.837,-1634.83 384,-1700 379.824,-1705.69 374.161,-1710.14 367.947,-1713.62"/>
<polygon fill="#000000" stroke="#000000" points="366.103,-1710.62 358.558,-1718.06 369.095,-1716.95 366.103,-1710.62"/>
</g>
<!-- precision -->
<g id="proc~~siesta_forces~~UsesGraph_node5" class="node"><title>precision</title>
<polygon fill="#337ab7" stroke="#337ab7" points="88.5,-1407 33.5,-1407 33.5,-1383 88.5,-1383 88.5,-1407"/>
<text text-anchor="middle" x="61" y="-1392.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">precision</text>
</g>
<!-- proc~siesta_forces&#45;&gt;precision -->
<g id="proc~~siesta_forces~~UsesGraph_edge4" class="edge"><title>proc~siesta_forces&#45;&gt;precision</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.782,-927.1C454.993,-1019.78 441.306,-1614.99 384,-1667 342.533,-1704.64 309.525,-1688.94 258,-1667 147.819,-1620.09 88.1425,-1472.9 68.9571,-1416.91"/>
<polygon fill="#000000" stroke="#000000" points="72.2285,-1415.66 65.7496,-1407.27 65.5867,-1417.87 72.2285,-1415.66"/>
</g>
<!-- module~m_state_analysis -->
<g id="proc~~siesta_forces~~UsesGraph_node6" class="node"><title>module~m_state_analysis</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node6"><a xlink:href=".././module/m_state_analysis.html" xlink:title="m_state_analysis">
<polygon fill="#337ab7" stroke="#337ab7" points="368.5,-1658 273.5,-1658 273.5,-1634 368.5,-1634 368.5,-1658"/>
<text text-anchor="middle" x="321" y="-1643.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_state_analysis</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_state_analysis -->
<g id="proc~~siesta_forces~~UsesGraph_edge5" class="edge"><title>proc~siesta_forces&#45;&gt;module~m_state_analysis</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.535,-927.115C453.013,-1016.2 429.446,-1568.03 384,-1625 382.073,-1627.42 379.856,-1629.55 377.433,-1631.45"/>
<polygon fill="#000000" stroke="#000000" points="375.162,-1628.74 368.518,-1636.99 378.858,-1634.68 375.162,-1628.74"/>
</g>
<!-- m_stress -->
<g id="proc~~siesta_forces~~UsesGraph_node7" class="node"><title>m_stress</title>
<polygon fill="#337ab7" stroke="#337ab7" points="349,-1616 293,-1616 293,-1592 349,-1592 349,-1616"/>
<text text-anchor="middle" x="321" y="-1601.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_stress</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_stress -->
<g id="proc~~siesta_forces~~UsesGraph_edge6" class="edge"><title>proc~siesta_forces&#45;&gt;m_stress</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.448,-927.215C452.446,-1013.53 426.821,-1529.67 384,-1583 377.769,-1590.76 368.545,-1595.67 359.105,-1598.77"/>
<polygon fill="#000000" stroke="#000000" points="358.063,-1595.42 349.306,-1601.39 359.871,-1602.19 358.063,-1595.42"/>
</g>
<!-- m_ts_options -->
<g id="proc~~siesta_forces~~UsesGraph_node8" class="node"><title>m_ts_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="359,-1574 283,-1574 283,-1550 359,-1550 359,-1574"/>
<text text-anchor="middle" x="321" y="-1559.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_options</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_ts_options -->
<g id="proc~~siesta_forces~~UsesGraph_edge7" class="edge"><title>proc~siesta_forces&#45;&gt;m_ts_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M457.285,-927.103C458.888,-1005.56 464.082,-1442 384,-1541 379.919,-1546.04 374.575,-1549.88 368.734,-1552.8"/>
<polygon fill="#000000" stroke="#000000" points="367.188,-1549.65 359.255,-1556.68 369.836,-1556.13 367.188,-1549.65"/>
</g>
<!-- m_convergence -->
<g id="proc~~siesta_forces~~UsesGraph_node9" class="node"><title>m_convergence</title>
<polygon fill="#337ab7" stroke="#337ab7" points="365.5,-1532 276.5,-1532 276.5,-1508 365.5,-1508 365.5,-1532"/>
<text text-anchor="middle" x="321" y="-1517.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_convergence</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_convergence -->
<g id="proc~~siesta_forces~~UsesGraph_edge8" class="edge"><title>proc~siesta_forces&#45;&gt;m_convergence</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M457.171,-927.014C458.002,-1002.15 458.923,-1407.16 384,-1499 381.293,-1502.32 378.039,-1505.12 374.458,-1507.47"/>
<polygon fill="#000000" stroke="#000000" points="372.775,-1504.4 365.612,-1512.21 376.08,-1510.57 372.775,-1504.4"/>
</g>
<!-- m_forces -->
<g id="proc~~siesta_forces~~UsesGraph_node10" class="node"><title>m_forces</title>
<polygon fill="#337ab7" stroke="#337ab7" points="349.5,-1490 292.5,-1490 292.5,-1466 349.5,-1466 349.5,-1490"/>
<text text-anchor="middle" x="321" y="-1475.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_forces</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_forces -->
<g id="proc~~siesta_forces~~UsesGraph_edge9" class="edge"><title>proc~siesta_forces&#45;&gt;m_forces</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.936,-927.362C456.331,-999.513 450.004,-1365.97 384,-1452 377.831,-1460.04 368.713,-1465.62 359.357,-1469.48"/>
<polygon fill="#000000" stroke="#000000" points="357.899,-1466.28 349.634,-1472.91 360.229,-1472.88 357.899,-1466.28"/>
</g>
<!-- write_subs -->
<g id="proc~~siesta_forces~~UsesGraph_node11" class="node"><title>write_subs</title>
<polygon fill="#337ab7" stroke="#337ab7" points="222,-1554 158,-1554 158,-1530 222,-1530 222,-1554"/>
<text text-anchor="middle" x="190" y="-1539.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_subs</text>
</g>
<!-- proc~siesta_forces&#45;&gt;write_subs -->
<g id="proc~~siesta_forces~~UsesGraph_edge11" class="edge"><title>proc~siesta_forces&#45;&gt;write_subs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.947,-927.156C456.401,-996.526 450.342,-1341.95 384,-1419 345.835,-1463.32 306.338,-1424.07 258,-1457 233.579,-1473.64 213.878,-1501.91 202.313,-1521.25"/>
<polygon fill="#000000" stroke="#000000" points="199.27,-1519.52 197.305,-1529.93 205.333,-1523.02 199.27,-1519.52"/>
</g>
<!-- siesta_cml -->
<g id="proc~~siesta_forces~~UsesGraph_node12" class="node"><title>siesta_cml</title>
<polygon fill="#337ab7" stroke="#337ab7" points="352.5,-1410 289.5,-1410 289.5,-1386 352.5,-1386 352.5,-1410"/>
<text text-anchor="middle" x="321" y="-1395.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_cml</text>
</g>
<!-- proc~siesta_forces&#45;&gt;siesta_cml -->
<g id="proc~~siesta_forces~~UsesGraph_edge10" class="edge"><title>proc~siesta_forces&#45;&gt;siesta_cml</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.724,-927.393C455.006,-993.688 443.8,-1306.07 384,-1377 378.366,-1383.68 370.522,-1388.24 362.304,-1391.36"/>
<polygon fill="#000000" stroke="#000000" points="361.098,-1388.07 352.595,-1394.39 363.183,-1394.75 361.098,-1388.07"/>
</g>
<!-- module~m_state_init -->
<g id="proc~~siesta_forces~~UsesGraph_node13" class="node"><title>module~m_state_init</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node13"><a xlink:href=".././module/m_state_init.html" xlink:title="m_state_init">
<polygon fill="#337ab7" stroke="#337ab7" points="356,-1368 286,-1368 286,-1344 356,-1344 356,-1368"/>
<text text-anchor="middle" x="321" y="-1353.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_state_init</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_state_init -->
<g id="proc~~siesta_forces~~UsesGraph_edge12" class="edge"><title>proc~siesta_forces&#45;&gt;module~m_state_init</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.523,-927.08C453.843,-989.072 438.757,-1271.06 384,-1335 379.121,-1340.7 372.637,-1344.85 365.7,-1347.88"/>
<polygon fill="#000000" stroke="#000000" points="364.287,-1344.67 356.067,-1351.36 366.661,-1351.26 364.287,-1344.67"/>
</g>
<!-- parallel -->
<g id="proc~~siesta_forces~~UsesGraph_node14" class="node"><title>parallel</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-1326 294,-1326 294,-1302 348,-1302 348,-1326"/>
<text text-anchor="middle" x="321" y="-1311.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">parallel</text>
</g>
<!-- proc~siesta_forces&#45;&gt;parallel -->
<g id="proc~~siesta_forces~~UsesGraph_edge13" class="edge"><title>proc~siesta_forces&#45;&gt;parallel</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.273,-927.012C452.532,-985.065 433.659,-1236.09 384,-1293 377.345,-1300.63 367.817,-1305.49 358.219,-1308.59"/>
<polygon fill="#000000" stroke="#000000" points="357.077,-1305.27 348.311,-1311.22 358.874,-1312.03 357.077,-1305.27"/>
</g>
<!-- m_save_density_matrix -->
<g id="proc~~siesta_forces~~UsesGraph_node15" class="node"><title>m_save_density_matrix</title>
<polygon fill="#337ab7" stroke="#337ab7" points="383.5,-1284 258.5,-1284 258.5,-1260 383.5,-1260 383.5,-1284"/>
<text text-anchor="middle" x="321" y="-1269.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_save_density_matrix</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_save_density_matrix -->
<g id="proc~~siesta_forces~~UsesGraph_edge14" class="edge"><title>proc~siesta_forces&#45;&gt;m_save_density_matrix</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M455.951,-927.1C451.025,-981.285 428.539,-1201.14 384,-1251 383.106,-1252 382.162,-1252.95 381.175,-1253.86"/>
<polygon fill="#000000" stroke="#000000" points="378.853,-1251.23 372.875,-1259.97 383.003,-1256.86 378.853,-1251.23"/>
</g>
<!-- m_mpi_utils -->
<g id="proc~~siesta_forces~~UsesGraph_node16" class="node"><title>m_mpi_utils</title>
<polygon fill="#337ab7" stroke="#337ab7" points="356,-1242 286,-1242 286,-1218 356,-1218 356,-1242"/>
<text text-anchor="middle" x="321" y="-1227.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mpi_utils</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_mpi_utils -->
<g id="proc~~siesta_forces~~UsesGraph_edge15" class="edge"><title>proc~siesta_forces&#45;&gt;m_mpi_utils</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M455.529,-927.244C449.28,-977.35 423.437,-1166.14 384,-1209 378.974,-1214.46 372.477,-1218.5 365.587,-1221.5"/>
<polygon fill="#000000" stroke="#000000" points="364.255,-1218.26 356.049,-1224.96 366.643,-1224.84 364.255,-1218.26"/>
</g>
<!-- siesta_geom -->
<g id="proc~~siesta_forces~~UsesGraph_node17" class="node"><title>siesta_geom</title>
<polygon fill="#337ab7" stroke="#337ab7" points="357.5,-1200 284.5,-1200 284.5,-1176 357.5,-1176 357.5,-1200"/>
<text text-anchor="middle" x="321" y="-1185.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_geom</text>
</g>
<!-- proc~siesta_forces&#45;&gt;siesta_geom -->
<g id="proc~~siesta_forces~~UsesGraph_edge16" class="edge"><title>proc~siesta_forces&#45;&gt;siesta_geom</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M457.191,-927.153C457.144,-967.188 451.527,-1096.39 384,-1167 379.303,-1171.91 373.418,-1175.67 367.155,-1178.56"/>
<polygon fill="#000000" stroke="#000000" points="365.863,-1175.3 357.805,-1182.18 368.394,-1181.83 365.863,-1175.3"/>
</g>
<!-- m_dm_charge -->
<g id="proc~~siesta_forces~~UsesGraph_node18" class="node"><title>m_dm_charge</title>
<polygon fill="#337ab7" stroke="#337ab7" points="362,-1158 280,-1158 280,-1134 362,-1134 362,-1158"/>
<text text-anchor="middle" x="321" y="-1143.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_dm_charge</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_dm_charge -->
<g id="proc~~siesta_forces~~UsesGraph_edge17" class="edge"><title>proc~siesta_forces&#45;&gt;m_dm_charge</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.368,-927.12C453.86,-962.674 441.681,-1067.78 384,-1125 380.313,-1128.66 375.966,-1131.68 371.313,-1134.17"/>
<polygon fill="#000000" stroke="#000000" points="369.746,-1131.04 362.079,-1138.35 372.633,-1137.42 369.746,-1131.04"/>
</g>
<!-- m_mixer -->
<g id="proc~~siesta_forces~~UsesGraph_node19" class="node"><title>m_mixer</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-1116 294,-1116 294,-1092 348,-1092 348,-1116"/>
<text text-anchor="middle" x="321" y="-1101.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mixer</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_mixer -->
<g id="proc~~siesta_forces~~UsesGraph_edge18" class="edge"><title>proc~siesta_forces&#45;&gt;m_mixer</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M455.175,-927.091C449.928,-957.684 431.978,-1038.86 384,-1083 376.675,-1089.74 367.106,-1094.32 357.685,-1097.44"/>
<polygon fill="#000000" stroke="#000000" points="356.685,-1094.09 348.022,-1100.19 358.598,-1100.82 356.685,-1094.09"/>
</g>
<!-- files -->
<g id="proc~~siesta_forces~~UsesGraph_node20" class="node"><title>files</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-1074 294,-1074 294,-1050 348,-1050 348,-1074"/>
<text text-anchor="middle" x="321" y="-1059.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">files</text>
</g>
<!-- proc~siesta_forces&#45;&gt;files -->
<g id="proc~~siesta_forces~~UsesGraph_edge19" class="edge"><title>proc~siesta_forces&#45;&gt;files</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M453.168,-927.346C444.762,-952.426 422.338,-1009.61 384,-1041 376.51,-1047.13 367.139,-1051.51 357.969,-1054.62"/>
<polygon fill="#000000" stroke="#000000" points="356.786,-1051.32 348.195,-1057.52 358.778,-1058.03 356.786,-1051.32"/>
</g>
<!-- module~m_mixing_scf -->
<g id="proc~~siesta_forces~~UsesGraph_node21" class="node"><title>module~m_mixing_scf</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node21"><a xlink:href=".././module/m_mixing_scf.html" xlink:title="m_mixing_scf">
<polygon fill="#337ab7" stroke="#337ab7" points="360,-1032 282,-1032 282,-1008 360,-1008 360,-1032"/>
<text text-anchor="middle" x="321" y="-1017.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mixing_scf</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_mixing_scf -->
<g id="proc~~siesta_forces~~UsesGraph_edge20" class="edge"><title>proc~siesta_forces&#45;&gt;module~m_mixing_scf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M449.547,-927.088C437.778,-945.217 413.2,-979.408 384,-999 379.629,-1001.93 374.811,-1004.49 369.85,-1006.72"/>
<polygon fill="#000000" stroke="#000000" points="368.186,-1003.61 360.214,-1010.59 370.798,-1010.11 368.186,-1003.61"/>
</g>
<!-- m_ts_global_vars -->
<g id="proc~~siesta_forces~~UsesGraph_node22" class="node"><title>m_ts_global_vars</title>
<polygon fill="#337ab7" stroke="#337ab7" points="369.5,-990 272.5,-990 272.5,-966 369.5,-966 369.5,-990"/>
<text text-anchor="middle" x="321" y="-975.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_global_vars</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_ts_global_vars -->
<g id="proc~~siesta_forces~~UsesGraph_edge21" class="edge"><title>proc~siesta_forces&#45;&gt;m_ts_global_vars</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M438.326,-927.105C423.887,-936.126 403.188,-948.331 384,-957 379.869,-958.866 375.519,-960.661 371.121,-962.361"/>
<polygon fill="#000000" stroke="#000000" points="369.645,-959.175 361.476,-965.922 372.07,-965.742 369.645,-959.175"/>
</g>
<!-- m_initwf -->
<g id="proc~~siesta_forces~~UsesGraph_node23" class="node"><title>m_initwf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-948 294,-948 294,-924 348,-924 348,-948"/>
<text text-anchor="middle" x="321" y="-933.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_initwf</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_initwf -->
<g id="proc~~siesta_forces~~UsesGraph_edge22" class="edge"><title>proc~siesta_forces&#45;&gt;m_initwf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M419.753,-920.794C400.525,-923.785 377.167,-927.419 358.106,-930.384"/>
<polygon fill="#000000" stroke="#000000" points="357.355,-926.958 348.012,-931.954 358.431,-933.875 357.355,-926.958"/>
</g>
<!-- m_compute_energies -->
<g id="proc~~siesta_forces~~UsesGraph_node24" class="node"><title>m_compute_energies</title>
<polygon fill="#337ab7" stroke="#337ab7" points="379,-906 263,-906 263,-882 379,-882 379,-906"/>
<text text-anchor="middle" x="321" y="-891.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_compute_energies</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_compute_energies -->
<g id="proc~~siesta_forces~~UsesGraph_edge23" class="edge"><title>proc~siesta_forces&#45;&gt;m_compute_energies</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M419.753,-909.206C410.231,-907.725 399.696,-906.086 389.172,-904.449"/>
<polygon fill="#000000" stroke="#000000" points="389.538,-900.964 379.118,-902.885 388.462,-907.881 389.538,-900.964"/>
</g>
<!-- sys -->
<g id="proc~~siesta_forces~~UsesGraph_node25" class="node"><title>sys</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-864 294,-864 294,-840 348,-840 348,-864"/>
<text text-anchor="middle" x="321" y="-849.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sys</text>
</g>
<!-- proc~siesta_forces&#45;&gt;sys -->
<g id="proc~~siesta_forces~~UsesGraph_edge24" class="edge"><title>proc~siesta_forces&#45;&gt;sys</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M438.326,-902.895C423.887,-893.874 403.188,-881.669 384,-873 375.648,-869.226 366.404,-865.746 357.661,-862.749"/>
<polygon fill="#000000" stroke="#000000" points="358.668,-859.396 348.075,-859.581 356.472,-866.043 358.668,-859.396"/>
</g>
<!-- module~m_setup_h0 -->
<g id="proc~~siesta_forces~~UsesGraph_node26" class="node"><title>module~m_setup_h0</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node26"><a xlink:href=".././module/m_setup_h0.html" xlink:title="m_setup_H0">
<polygon fill="#337ab7" stroke="#337ab7" points="357.5,-822 284.5,-822 284.5,-798 357.5,-798 357.5,-822"/>
<text text-anchor="middle" x="321" y="-807.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_setup_H0</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;module~m_setup_h0 -->
<g id="proc~~siesta_forces~~UsesGraph_edge25" class="edge"><title>proc~siesta_forces&#45;&gt;module~m_setup_h0</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M449.547,-902.912C437.778,-884.783 413.2,-850.592 384,-831 378.798,-827.51 372.961,-824.549 367.005,-822.051"/>
<polygon fill="#000000" stroke="#000000" points="368.211,-818.765 357.619,-818.498 365.732,-825.312 368.211,-818.765"/>
</g>
<!-- m_spin -->
<g id="proc~~siesta_forces~~UsesGraph_node27" class="node"><title>m_spin</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-780 294,-780 294,-756 348,-756 348,-780"/>
<text text-anchor="middle" x="321" y="-765.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_spin</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_spin -->
<g id="proc~~siesta_forces~~UsesGraph_edge26" class="edge"><title>proc~siesta_forces&#45;&gt;m_spin</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M453.168,-902.654C444.762,-877.574 422.338,-820.393 384,-789 376.51,-782.866 367.139,-778.49 357.969,-775.379"/>
<polygon fill="#000000" stroke="#000000" points="358.778,-771.969 348.195,-772.479 356.786,-778.679 358.778,-771.969"/>
</g>
<!-- m_iodm_old -->
<g id="proc~~siesta_forces~~UsesGraph_node28" class="node"><title>m_iodm_old</title>
<polygon fill="#337ab7" stroke="#337ab7" points="356.5,-738 285.5,-738 285.5,-714 356.5,-714 356.5,-738"/>
<text text-anchor="middle" x="321" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_iodm_old</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_iodm_old -->
<g id="proc~~siesta_forces~~UsesGraph_edge27" class="edge"><title>proc~siesta_forces&#45;&gt;m_iodm_old</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M455.175,-902.909C449.928,-872.316 431.978,-791.138 384,-747 378.886,-742.296 372.679,-738.641 366.192,-735.802"/>
<polygon fill="#000000" stroke="#000000" points="367.174,-732.432 356.582,-732.2 364.717,-738.987 367.174,-732.432"/>
</g>
<!-- siesta_options -->
<g id="proc~~siesta_forces~~UsesGraph_node29" class="node"><title>siesta_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="361.5,-696 280.5,-696 280.5,-672 361.5,-672 361.5,-696"/>
<text text-anchor="middle" x="321" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_options</text>
</g>
<!-- proc~siesta_forces&#45;&gt;siesta_options -->
<g id="proc~~siesta_forces~~UsesGraph_edge28" class="edge"><title>proc~siesta_forces&#45;&gt;siesta_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.368,-902.88C453.86,-867.326 441.681,-762.223 384,-705 380.264,-701.293 375.85,-698.24 371.126,-695.726"/>
<polygon fill="#000000" stroke="#000000" points="372.314,-692.423 361.757,-691.524 369.45,-698.81 372.314,-692.423"/>
</g>
<!-- m_scfconvergence_test -->
<g id="proc~~siesta_forces~~UsesGraph_node30" class="node"><title>m_scfconvergence_test</title>
<polygon fill="#337ab7" stroke="#337ab7" points="384,-654 258,-654 258,-630 384,-630 384,-654"/>
<text text-anchor="middle" x="321" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_scfconvergence_test</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_scfconvergence_test -->
<g id="proc~~siesta_forces~~UsesGraph_edge29" class="edge"><title>proc~siesta_forces&#45;&gt;m_scfconvergence_test</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M457.191,-902.847C457.144,-862.812 451.527,-733.61 384,-663 382.945,-661.896 381.829,-660.851 380.663,-659.86"/>
<polygon fill="#000000" stroke="#000000" points="382.539,-656.902 372.325,-654.087 378.554,-662.657 382.539,-656.902"/>
</g>
<!-- siesta_master -->
<g id="proc~~siesta_forces~~UsesGraph_node31" class="node"><title>siesta_master</title>
<polygon fill="#337ab7" stroke="#337ab7" points="360.5,-612 281.5,-612 281.5,-588 360.5,-588 360.5,-612"/>
<text text-anchor="middle" x="321" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_master</text>
</g>
<!-- proc~siesta_forces&#45;&gt;siesta_master -->
<g id="proc~~siesta_forces~~UsesGraph_edge30" class="edge"><title>proc~siesta_forces&#45;&gt;siesta_master</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M455.529,-902.756C449.28,-852.65 423.437,-663.863 384,-621 380.007,-616.66 375.086,-613.217 369.776,-610.485"/>
<polygon fill="#000000" stroke="#000000" points="371.138,-607.261 360.569,-606.527 368.373,-613.692 371.138,-607.261"/>
</g>
<!-- m_setup_hamiltonian -->
<g id="proc~~siesta_forces~~UsesGraph_node32" class="node"><title>m_setup_hamiltonian</title>
<polygon fill="#337ab7" stroke="#337ab7" points="378.5,-570 263.5,-570 263.5,-546 378.5,-546 378.5,-570"/>
<text text-anchor="middle" x="321" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_setup_hamiltonian</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_setup_hamiltonian -->
<g id="proc~~siesta_forces~~UsesGraph_edge31" class="edge"><title>proc~siesta_forces&#45;&gt;m_setup_hamiltonian</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M455.951,-902.9C451.025,-848.715 428.539,-628.862 384,-579 383.106,-577.999 382.162,-577.045 381.175,-576.137"/>
<polygon fill="#000000" stroke="#000000" points="383.003,-573.137 372.875,-570.027 378.853,-578.774 383.003,-573.137"/>
</g>
<!-- units -->
<g id="proc~~siesta_forces~~UsesGraph_node33" class="node"><title>units</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-528 294,-528 294,-504 348,-504 348,-528"/>
<text text-anchor="middle" x="321" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">units</text>
</g>
<!-- proc~siesta_forces&#45;&gt;units -->
<g id="proc~~siesta_forces~~UsesGraph_edge32" class="edge"><title>proc~siesta_forces&#45;&gt;units</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.273,-902.988C452.532,-844.935 433.659,-593.906 384,-537 377.345,-529.374 367.817,-524.512 358.219,-521.415"/>
<polygon fill="#000000" stroke="#000000" points="358.874,-517.967 348.311,-518.783 357.077,-524.733 358.874,-517.967"/>
</g>
<!-- m_ts_method -->
<g id="proc~~siesta_forces~~UsesGraph_node34" class="node"><title>m_ts_method</title>
<polygon fill="#337ab7" stroke="#337ab7" points="360,-486 282,-486 282,-462 360,-462 360,-486"/>
<text text-anchor="middle" x="321" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_method</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_ts_method -->
<g id="proc~~siesta_forces~~UsesGraph_edge33" class="edge"><title>proc~siesta_forces&#45;&gt;m_ts_method</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.523,-902.92C453.843,-840.928 438.757,-558.945 384,-495 380.07,-490.41 375.097,-486.821 369.685,-484.015"/>
<polygon fill="#000000" stroke="#000000" points="370.84,-480.702 360.269,-479.993 368.09,-487.14 370.84,-480.702"/>
</g>
<!-- m_compute_max_diff -->
<g id="proc~~siesta_forces~~UsesGraph_node35" class="node"><title>m_compute_max_diff</title>
<polygon fill="#337ab7" stroke="#337ab7" points="378.5,-444 263.5,-444 263.5,-420 378.5,-420 378.5,-444"/>
<text text-anchor="middle" x="321" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_compute_max_diff</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_compute_max_diff -->
<g id="proc~~siesta_forces~~UsesGraph_edge34" class="edge"><title>proc~siesta_forces&#45;&gt;m_compute_max_diff</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.724,-902.607C455.006,-836.312 443.8,-523.93 384,-453 383.155,-451.998 382.261,-451.044 381.323,-450.135"/>
<polygon fill="#000000" stroke="#000000" points="383.441,-447.349 373.383,-444.019 379.169,-452.894 383.441,-447.349"/>
</g>
<!-- m_compute_dm -->
<g id="proc~~siesta_forces~~UsesGraph_node36" class="node"><title>m_compute_dm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="366,-402 276,-402 276,-378 366,-378 366,-402"/>
<text text-anchor="middle" x="321" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_compute_dm</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_compute_dm -->
<g id="proc~~siesta_forces~~UsesGraph_edge35" class="edge"><title>proc~siesta_forces&#45;&gt;m_compute_dm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.906,-902.878C456.135,-833.699 449.035,-489.155 384,-411 381.416,-407.895 378.354,-405.247 374.997,-402.989"/>
<polygon fill="#000000" stroke="#000000" points="376.6,-399.877 366.148,-398.144 373.238,-406.017 376.6,-399.877"/>
</g>
<!-- m_check_walltime -->
<g id="proc~~siesta_forces~~UsesGraph_node37" class="node"><title>m_check_walltime</title>
<polygon fill="#337ab7" stroke="#337ab7" points="371,-360 271,-360 271,-336 371,-336 371,-360"/>
<text text-anchor="middle" x="321" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_check_walltime</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_check_walltime -->
<g id="proc~~siesta_forces~~UsesGraph_edge36" class="edge"><title>proc~siesta_forces&#45;&gt;m_check_walltime</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M457.056,-902.836C457.147,-830.225 454.189,-454.292 384,-369 382.673,-367.388 381.217,-365.898 379.658,-364.523"/>
<polygon fill="#000000" stroke="#000000" points="381.316,-361.412 371.115,-358.552 377.306,-367.15 381.316,-361.412"/>
</g>
<!-- atomlist -->
<g id="proc~~siesta_forces~~UsesGraph_node38" class="node"><title>atomlist</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-318 294,-318 294,-294 348,-294 348,-318"/>
<text text-anchor="middle" x="321" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">atomlist</text>
</g>
<!-- proc~siesta_forces&#45;&gt;atomlist -->
<g id="proc~~siesta_forces~~UsesGraph_edge37" class="edge"><title>proc~siesta_forces&#45;&gt;atomlist</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M457.183,-902.904C458.09,-827.261 459.389,-419.494 384,-327 377.484,-319.006 367.797,-314.04 358.005,-310.961"/>
<polygon fill="#000000" stroke="#000000" points="358.849,-307.564 348.292,-308.468 357.108,-314.344 358.849,-307.564"/>
</g>
<!-- m_pexsi_solver -->
<g id="proc~~siesta_forces~~UsesGraph_node39" class="node"><title>m_pexsi_solver</title>
<polygon fill="#337ab7" stroke="#337ab7" points="364.5,-276 277.5,-276 277.5,-252 364.5,-252 364.5,-276"/>
<text text-anchor="middle" x="321" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_pexsi_solver</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_pexsi_solver -->
<g id="proc~~siesta_forces~~UsesGraph_edge38" class="edge"><title>proc~siesta_forces&#45;&gt;m_pexsi_solver</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.372,-902.951C451.952,-819.981 424.491,-335.094 384,-285 381.109,-281.423 377.582,-278.453 373.694,-275.986"/>
<polygon fill="#000000" stroke="#000000" points="375.2,-272.825 364.708,-271.35 371.991,-279.046 375.2,-272.825"/>
</g>
<!-- fdf -->
<g id="proc~~siesta_forces~~UsesGraph_node40" class="node"><title>fdf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-234 294,-234 294,-210 348,-210 348,-234"/>
<text text-anchor="middle" x="321" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">fdf</text>
</g>
<!-- proc~siesta_forces&#45;&gt;fdf -->
<g id="proc~~siesta_forces~~UsesGraph_edge39" class="edge"><title>proc~siesta_forces&#45;&gt;fdf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.466,-902.988C452.54,-816.986 427.103,-296.716 384,-243 377.492,-234.89 367.716,-229.894 357.839,-226.823"/>
<polygon fill="#000000" stroke="#000000" points="358.598,-223.405 348.046,-224.349 356.884,-230.192 358.598,-223.405"/>
</g>
<!-- m_transiesta -->
<g id="proc~~siesta_forces~~UsesGraph_node41" class="node"><title>m_transiesta</title>
<polygon fill="#337ab7" stroke="#337ab7" points="358,-192 284,-192 284,-168 358,-168 358,-192"/>
<text text-anchor="middle" x="321" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_transiesta</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_transiesta -->
<g id="proc~~siesta_forces~~UsesGraph_edge40" class="edge"><title>proc~siesta_forces&#45;&gt;m_transiesta</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.539,-902.817C453.051,-813.234 429.683,-258.302 384,-201 379.669,-195.567 373.87,-191.531 367.551,-188.535"/>
<polygon fill="#000000" stroke="#000000" points="368.622,-185.197 358.033,-184.848 366.093,-191.724 368.622,-185.197"/>
</g>
<!-- m_rhog -->
<g id="proc~~siesta_forces~~UsesGraph_node42" class="node"><title>m_rhog</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-150 294,-150 294,-126 348,-126 348,-150"/>
<text text-anchor="middle" x="321" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_rhog</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_rhog -->
<g id="proc~~siesta_forces~~UsesGraph_edge41" class="edge"><title>proc~siesta_forces&#45;&gt;m_rhog</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.618,-902.995C453.59,-811.016 432.326,-219.968 384,-159 377.541,-150.851 367.778,-145.844 357.899,-142.775"/>
<polygon fill="#000000" stroke="#000000" points="358.651,-139.355 348.099,-140.307 356.941,-146.143 358.651,-139.355"/>
</g>
<!-- m_steps -->
<g id="proc~~siesta_forces~~UsesGraph_node43" class="node"><title>m_steps</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-108 294,-108 294,-84 348,-84 348,-108"/>
<text text-anchor="middle" x="321" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_steps</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_steps -->
<g id="proc~~siesta_forces~~UsesGraph_edge42" class="edge"><title>proc~siesta_forces&#45;&gt;m_steps</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.68,-902.939C454.062,-807.9 434.932,-181.589 384,-117 377.561,-108.835 367.805,-103.824 357.925,-100.755"/>
<polygon fill="#000000" stroke="#000000" points="358.673,-97.3343 348.122,-98.289 356.966,-104.123 358.673,-97.3343"/>
</g>
<!-- m_energies -->
<g id="proc~~siesta_forces~~UsesGraph_node44" class="node"><title>m_energies</title>
<polygon fill="#337ab7" stroke="#337ab7" points="355.5,-66 286.5,-66 286.5,-42 355.5,-42 355.5,-66"/>
<text text-anchor="middle" x="321" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_energies</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_energies -->
<g id="proc~~siesta_forces~~UsesGraph_edge43" class="edge"><title>proc~siesta_forces&#45;&gt;m_energies</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.738,-902.933C454.515,-805.067 437.549,-143.227 384,-75 379.116,-68.7771 372.304,-64.3856 364.973,-61.2898"/>
<polygon fill="#000000" stroke="#000000" points="366.112,-57.9802 355.517,-58.021 363.825,-64.5961 366.112,-57.9802"/>
</g>
<!-- m_post_scf_work -->
<g id="proc~~siesta_forces~~UsesGraph_node45" class="node"><title>m_post_scf_work</title>
<polygon fill="#337ab7" stroke="#337ab7" points="369,-24 273,-24 273,-0 369,-0 369,-24"/>
<text text-anchor="middle" x="321" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_post_scf_work</text>
</g>
<!-- proc~siesta_forces&#45;&gt;m_post_scf_work -->
<g id="proc~~siesta_forces~~UsesGraph_edge44" class="edge"><title>proc~siesta_forces&#45;&gt;m_post_scf_work</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.792,-902.974C454.95,-802.518 440.178,-104.88 384,-33 382.163,-30.6495 380.051,-28.5603 377.739,-26.7034"/>
<polygon fill="#000000" stroke="#000000" points="379.529,-23.6936 369.222,-21.2434 375.752,-29.5867 379.529,-23.6936"/>
</g>
<!-- module~m_state_analysis&#45;&gt;write_subs -->
<g id="proc~~siesta_forces~~UsesGraph_edge45" class="edge"><title>module~m_state_analysis&#45;&gt;write_subs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M274.513,-1633.97C268.702,-1631.48 263.033,-1628.51 258,-1625 234.483,-1608.59 214.903,-1581.67 203.101,-1562.95"/>
<polygon fill="#000000" stroke="#000000" points="205.996,-1560.98 197.804,-1554.26 200.019,-1564.62 205.996,-1560.98"/>
</g>
<!-- class_Fstack_dData1D -->
<g id="proc~~siesta_forces~~UsesGraph_node46" class="node"><title>class_Fstack_dData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="122,-1032 -7.10543e-15,-1032 -7.10543e-15,-1008 122,-1008 122,-1032"/>
<text text-anchor="middle" x="61" y="-1017.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_Fstack_dData1D</text>
</g>
<!-- module~m_mixing_scf&#45;&gt;class_Fstack_dData1D -->
<g id="proc~~siesta_forces~~UsesGraph_edge46" class="edge"><title>module~m_mixing_scf&#45;&gt;class_Fstack_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M281.931,-1020C242.673,-1020 180.553,-1020 132.331,-1020"/>
<polygon fill="#000000" stroke="#000000" points="132.266,-1016.5 122.266,-1020 132.266,-1023.5 132.266,-1016.5"/>
</g>
<!-- module~m_mixing -->
<g id="proc~~siesta_forces~~UsesGraph_node47" class="node"><title>module~m_mixing</title>
<g id="a_proc~~siesta_forces~~UsesGraph_node47"><a xlink:href=".././module/m_mixing.html" xlink:title="m_mixing">
<polygon fill="#337ab7" stroke="#337ab7" points="219,-1073 161,-1073 161,-1049 219,-1049 219,-1073"/>
<text text-anchor="middle" x="190" y="-1058.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mixing</text>
</a>
</g>
</g>
<!-- module~m_mixing_scf&#45;&gt;module~m_mixing -->
<g id="proc~~siesta_forces~~UsesGraph_edge47" class="edge"><title>module~m_mixing_scf&#45;&gt;module~m_mixing</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M281.993,-1032.08C265.376,-1037.36 245.919,-1043.55 229.271,-1048.84"/>
<polygon fill="#000000" stroke="#000000" points="227.79,-1045.63 219.32,-1052 229.91,-1052.31 227.79,-1045.63"/>
</g>
<!-- module~m_mixing&#45;&gt;precision -->
<g id="proc~~siesta_forces~~UsesGraph_edge48" class="edge"><title>module~m_mixing&#45;&gt;precision</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M184.329,-1073.28C165.423,-1123.01 94.4259,-1309.72 70.1772,-1373.49"/>
<polygon fill="#000000" stroke="#000000" points="66.8619,-1372.37 66.5792,-1382.96 73.4048,-1374.85 66.8619,-1372.37"/>
</g>
<!-- module~m_mixing&#45;&gt;class_Fstack_dData1D -->
<g id="proc~~siesta_forces~~UsesGraph_edge49" class="edge"><title>module~m_mixing&#45;&gt;class_Fstack_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M160.815,-1051.9C145.665,-1047.01 126.583,-1040.85 109.237,-1035.25"/>
<polygon fill="#000000" stroke="#000000" points="109.859,-1031.77 99.2675,-1032.03 107.709,-1038.43 109.859,-1031.77"/>
</g>
<!-- class_dData1D -->
<g id="proc~~siesta_forces~~UsesGraph_node48" class="node"><title>class_dData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="103.5,-1074 18.5,-1074 18.5,-1050 103.5,-1050 103.5,-1074"/>
<text text-anchor="middle" x="61" y="-1059.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dData1D</text>
</g>
<!-- module~m_mixing&#45;&gt;class_dData1D -->
<g id="proc~~siesta_forces~~UsesGraph_edge50" class="edge"><title>module~m_mixing&#45;&gt;class_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M160.815,-1061.22C147.027,-1061.33 129.983,-1061.46 113.954,-1061.59"/>
<polygon fill="#000000" stroke="#000000" points="113.584,-1058.09 103.612,-1061.67 113.639,-1065.09 113.584,-1058.09"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="490pt" height="32pt"
 viewBox="0.00 0.00 489.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 485.5,-28 485.5,4 -4,4"/>
<!-- Module -->
<g id="node1" class="node"><title>Module</title>
<polygon fill="#337ab7" stroke="#337ab7" points="54,-24 0,-24 0,-0 54,-0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Module</text>
</g>
<!-- Submodule -->
<g id="node2" class="node"><title>Submodule</title>
<polygon fill="#5bc0de" stroke="#5bc0de" points="139.5,-24 72.5,-24 72.5,-0 139.5,-0 139.5,-24"/>
<text text-anchor="middle" x="106" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Submodule</text>
</g>
<!-- Subroutine -->
<g id="node3" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="222,-24 158,-24 158,-0 222,-0 222,-24"/>
<text text-anchor="middle" x="190" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node4" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="294,-24 240,-24 240,-0 294,-0 294,-24"/>
<text text-anchor="middle" x="267" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="366,-24 312,-24 312,-0 366,-0 366,-24"/>
<text text-anchor="middle" x="339" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="481.5,-24 384.5,-24 384.5,-0 481.5,-0 481.5,-24"/>
<text text-anchor="middle" x="433" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a submodule to the (sub)module which it is
    descended from. Dashed arrows point from a module or program unit to 
    modules which it uses.
    </p>
    </div></div></div></div>
      </li>
      
      </ul>
    </div>
    


    
    <p>This subroutine represents central SIESTA operation logic.</p>
<p>Initialization tasks for a given geometry:
<pre></p>
<p>if ( SIESTA_worker )  then
call state_init( istep )
end if
</pre>
<p>This call computes the <strong>non-scf</strong> part of <script type="math/tex"> H </script> and initializes the
  real-space grid structures:
<pre></p>
<p>if ( SIESTA_worker ) call setup_H0(G2max)
</pre><div class="alert alert-success" role="alert"><h4>Todo</h4><p>It might be better to split the two,
  putting the grid initialization into <strong>state_init (link!)</strong> and moving the
  calculation of <script type="math/tex"> H_0 </script> to the body of the loop, done <code>if first_scf=.true.</code>
  This would suit <em>analysis</em> runs in which <strong>nscf = 0</strong>
</p></div>
<p>
<p>The dHmax variable only has meaning for Hamiltonian
  mixing, or when requiring the Hamiltonian to be converged.</p>
<h1>SCF loop</h1>
<p>The current structure of the loop tries to reproduce the
  historical Siesta usage. It should be made more clear.</p>
<p>Two changes:</p>
<ol>
<li>The number of scf iterations performed is exactly
     equal to the number specified (i.e., the "forces"
     phase is not counted as a final scf step)</li>
<li>At the change to a TranSiesta GF run the variable "first_scf"
     is implicitly reset to "true".</li>
</ol>
<h2>Start of SCF cycle</h2>
<p>Conditions of exit:</p>
<ul>
<li>At the top, to catch a non-positive nscf and # of iterations</li>
<li>At the bottom, based on convergence</li>
</ul>
<p><pre></p>
<p>iscf = 0
do while ( iscf &lt; nscf )
</pre>
<p>Note implications for TranSiesta when mixing <script type="math/tex">H</script>.
  Now <script type="math/tex">H</script> will be recomputed instead of simply being
  inherited, however, this is required as if
  we have bias calculations as the electric
  field across the junction needs to be present.</p>
<p>Exit if converged:
<pre></p>
<p>if ( SCFconverged ) exit
</pre>
<p><strong>end of SCF cycle</strong></p>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-istep%7E3"></span>integer,</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>istep</strong></td><td></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
	<h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
	<div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~siesta_forces~~CallsGraph Pages: 1 -->
<svg id="procsiesta_forcesCallsGraph" width="525pt" height="3136pt"
 viewBox="0.00 0.00 525.00 3136.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~siesta_forces~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 3132)">
<title>proc~~siesta_forces~~CallsGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-3132 521,-3132 521,4 -4,4"/>
<!-- proc~siesta_forces -->
<g id="proc~~siesta_forces~~CallsGraph_node1" class="node"><title>proc~siesta_forces</title>
<polygon fill="none" stroke="black" points="76,-1953 0,-1953 0,-1929 76,-1929 76,-1953"/>
<text text-anchor="middle" x="38" y="-1938.6" font-family="Helvetica,sans-Serif" font-size="10.50">siesta_forces</text>
</g>
<!-- proc~mixers_scf_history_init -->
<g id="proc~~siesta_forces~~CallsGraph_node2" class="node"><title>proc~mixers_scf_history_init</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node2"><a xlink:href=".././proc/mixers_scf_history_init.html" xlink:title="mixers_scf_history_init">
<polygon fill="#d9534f" stroke="#d9534f" points="233,-1890 112,-1890 112,-1866 233,-1866 233,-1890"/>
<text text-anchor="middle" x="172.5" y="-1875.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mixers_scf_history_init</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~mixers_scf_history_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge2" class="edge"><title>proc~siesta_forces&#45;&gt;proc~mixers_scf_history_init</title>
<path fill="none" stroke="#000000" d="M57.7058,-1928.96C72.1617,-1919.98 92.8678,-1907.79 112,-1899 116.028,-1897.15 120.27,-1895.36 124.557,-1893.66"/>
<polygon fill="#000000" stroke="#000000" points="125.849,-1896.91 133.948,-1890.08 123.357,-1890.37 125.849,-1896.91"/>
</g>
<!-- transiesta -->
<g id="proc~~siesta_forces~~CallsGraph_node3" class="node"><title>transiesta</title>
<polygon fill="#777777" stroke="#777777" points="202,-2428 143,-2428 143,-2404 202,-2404 202,-2428"/>
<text text-anchor="middle" x="172.5" y="-2413.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">transiesta</text>
</g>
<!-- proc~siesta_forces&#45;&gt;transiesta -->
<g id="proc~~siesta_forces~~CallsGraph_edge1" class="edge"><title>proc~siesta_forces&#45;&gt;transiesta</title>
<path fill="none" stroke="#000000" d="M39.4478,-1953.39C42.0205,-2018.29 56.8002,-2318.88 112,-2390 117.524,-2397.12 125.398,-2402.33 133.616,-2406.12"/>
<polygon fill="#000000" stroke="#000000" points="132.349,-2409.38 142.935,-2409.83 134.941,-2402.88 132.349,-2409.38"/>
</g>
<!-- proc~state_analysis -->
<g id="proc~~siesta_forces~~CallsGraph_node4" class="node"><title>proc~state_analysis</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node4"><a xlink:href=".././proc/state_analysis.html" xlink:title="state_analysis">
<polygon fill="#d9534f" stroke="#d9534f" points="212.5,-2645 132.5,-2645 132.5,-2621 212.5,-2621 212.5,-2645"/>
<text text-anchor="middle" x="172.5" y="-2630.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">state_analysis</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~state_analysis -->
<g id="proc~~siesta_forces~~CallsGraph_edge3" class="edge"><title>proc~siesta_forces&#45;&gt;proc~state_analysis</title>
<path fill="none" stroke="#000000" d="M40.1032,-1953.02C45.3454,-2008.63 69.2757,-2246.33 112,-2437 126.437,-2501.43 151.231,-2575.5 163.764,-2611.34"/>
<polygon fill="#000000" stroke="#000000" points="160.47,-2612.52 167.096,-2620.79 167.071,-2610.19 160.47,-2612.52"/>
</g>
<!-- message -->
<g id="proc~~siesta_forces~~CallsGraph_node5" class="node"><title>message</title>
<polygon fill="#777777" stroke="#777777" points="200.5,-2348 144.5,-2348 144.5,-2324 200.5,-2324 200.5,-2348"/>
<text text-anchor="middle" x="172.5" y="-2333.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">message</text>
</g>
<!-- proc~siesta_forces&#45;&gt;message -->
<g id="proc~~siesta_forces~~CallsGraph_edge4" class="edge"><title>proc~siesta_forces&#45;&gt;message</title>
<path fill="none" stroke="#000000" d="M39.7861,-1953.26C43.7442,-2011.35 63.2587,-2258.54 112,-2315 117.929,-2321.87 126.25,-2326.49 134.794,-2329.6"/>
<polygon fill="#000000" stroke="#000000" points="133.836,-2332.97 144.421,-2332.51 135.861,-2326.27 133.836,-2332.97"/>
</g>
<!-- setup_hamiltonian -->
<g id="proc~~siesta_forces~~CallsGraph_node6" class="node"><title>setup_hamiltonian</title>
<polygon fill="#777777" stroke="#777777" points="222.5,-2306 122.5,-2306 122.5,-2282 222.5,-2282 222.5,-2306"/>
<text text-anchor="middle" x="172.5" y="-2291.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_hamiltonian</text>
</g>
<!-- proc~siesta_forces&#45;&gt;setup_hamiltonian -->
<g id="proc~~siesta_forces~~CallsGraph_edge5" class="edge"><title>proc~siesta_forces&#45;&gt;setup_hamiltonian</title>
<path fill="none" stroke="#000000" d="M40.2321,-1953.05C45.8625,-2006.02 70.6616,-2217.83 112,-2268 114.702,-2271.28 117.898,-2274.16 121.384,-2276.68"/>
<polygon fill="#000000" stroke="#000000" points="119.595,-2279.69 129.948,-2281.94 123.261,-2273.72 119.595,-2279.69"/>
</g>
<!-- bye -->
<g id="proc~~siesta_forces~~CallsGraph_node7" class="node"><title>bye</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2078 317.5,-2078 317.5,-2054 371.5,-2054 371.5,-2078"/>
<text text-anchor="middle" x="344.5" y="-2063.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">bye</text>
</g>
<!-- proc~siesta_forces&#45;&gt;bye -->
<g id="proc~~siesta_forces~~CallsGraph_edge6" class="edge"><title>proc~siesta_forces&#45;&gt;bye</title>
<path fill="none" stroke="#000000" d="M39.6742,-1928.9C43.0212,-1873.75 59.8313,-1647.05 112,-1605 153.869,-1571.25 193.436,-1568.58 233,-1605 304.36,-1670.7 209.622,-1963.3 269,-2040 278.178,-2051.85 293.123,-2058.33 307.228,-2061.85"/>
<polygon fill="#000000" stroke="#000000" points="306.753,-2065.32 317.256,-2063.93 308.175,-2058.47 306.753,-2065.32"/>
</g>
<!-- scfconvergence_test -->
<g id="proc~~siesta_forces~~CallsGraph_node8" class="node"><title>scfconvergence_test</title>
<polygon fill="#777777" stroke="#777777" points="228,-2226 117,-2226 117,-2202 228,-2202 228,-2226"/>
<text text-anchor="middle" x="172.5" y="-2211.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">scfconvergence_test</text>
</g>
<!-- proc~siesta_forces&#45;&gt;scfconvergence_test -->
<g id="proc~~siesta_forces~~CallsGraph_edge7" class="edge"><title>proc~siesta_forces&#45;&gt;scfconvergence_test</title>
<path fill="none" stroke="#000000" d="M38.845,-1953.12C39.0018,-1993.05 44.9227,-2121.96 112,-2193 113.034,-2194.1 114.129,-2195.13 115.275,-2196.12"/>
<polygon fill="#000000" stroke="#000000" points="113.277,-2198.99 123.477,-2201.86 117.291,-2193.26 113.277,-2198.99"/>
</g>
<!-- initwf -->
<g id="proc~~siesta_forces~~CallsGraph_node9" class="node"><title>initwf</title>
<polygon fill="#777777" stroke="#777777" points="199.5,-2184 145.5,-2184 145.5,-2160 199.5,-2160 199.5,-2184"/>
<text text-anchor="middle" x="172.5" y="-2169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">initwf</text>
</g>
<!-- proc~siesta_forces&#45;&gt;initwf -->
<g id="proc~~siesta_forces~~CallsGraph_edge8" class="edge"><title>proc~siesta_forces&#45;&gt;initwf</title>
<path fill="none" stroke="#000000" d="M39.6667,-1953.09C42.2692,-1988.54 54.6843,-2093.41 112,-2151 118.457,-2157.49 127.037,-2161.98 135.667,-2165.08"/>
<polygon fill="#000000" stroke="#000000" points="134.735,-2168.46 145.321,-2168.03 136.78,-2161.76 134.735,-2168.46"/>
</g>
<!-- check_walltime -->
<g id="proc~~siesta_forces~~CallsGraph_node10" class="node"><title>check_walltime</title>
<polygon fill="#777777" stroke="#777777" points="215,-2142 130,-2142 130,-2118 215,-2118 215,-2142"/>
<text text-anchor="middle" x="172.5" y="-2127.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">check_walltime</text>
</g>
<!-- proc~siesta_forces&#45;&gt;check_walltime -->
<g id="proc~~siesta_forces~~CallsGraph_edge9" class="edge"><title>proc~siesta_forces&#45;&gt;check_walltime</title>
<path fill="none" stroke="#000000" d="M40.8584,-1953.05C46.1846,-1983.56 64.3034,-2064.56 112,-2109 114.725,-2111.54 117.776,-2113.77 121.017,-2115.74"/>
<polygon fill="#000000" stroke="#000000" points="119.46,-2118.88 129.953,-2120.35 122.667,-2112.65 119.46,-2118.88"/>
</g>
<!-- save_density_matrix -->
<g id="proc~~siesta_forces~~CallsGraph_node11" class="node"><title>save_density_matrix</title>
<polygon fill="#777777" stroke="#777777" points="227.5,-2100 117.5,-2100 117.5,-2076 227.5,-2076 227.5,-2100"/>
<text text-anchor="middle" x="172.5" y="-2085.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">save_density_matrix</text>
</g>
<!-- proc~siesta_forces&#45;&gt;save_density_matrix -->
<g id="proc~~siesta_forces~~CallsGraph_edge10" class="edge"><title>proc~siesta_forces&#45;&gt;save_density_matrix</title>
<path fill="none" stroke="#000000" d="M42.8655,-1953.31C51.3318,-1978.31 73.8626,-2035.36 112,-2067 113.581,-2068.31 115.249,-2069.54 116.984,-2070.7"/>
<polygon fill="#000000" stroke="#000000" points="115.688,-2073.99 126.112,-2075.88 119.144,-2067.9 115.688,-2073.99"/>
</g>
<!-- proc~mixing_scf_converged -->
<g id="proc~~siesta_forces~~CallsGraph_node12" class="node"><title>proc~mixing_scf_converged</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node12"><a xlink:href=".././proc/mixing_scf_converged.html" xlink:title="mixing_scf_converged">
<polygon fill="#d9534f" stroke="#d9534f" points="232,-2058 113,-2058 113,-2034 232,-2034 232,-2058"/>
<text text-anchor="middle" x="172.5" y="-2043.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mixing_scf_converged</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~mixing_scf_converged -->
<g id="proc~~siesta_forces~~CallsGraph_edge11" class="edge"><title>proc~siesta_forces&#45;&gt;proc~mixing_scf_converged</title>
<path fill="none" stroke="#000000" d="M46.4843,-1953.04C58.2944,-1971.11 82.9249,-2005.22 112,-2025 114.378,-2026.62 116.893,-2028.12 119.494,-2029.52"/>
<polygon fill="#000000" stroke="#000000" points="118.054,-2032.72 128.583,-2033.89 121.086,-2026.41 118.054,-2032.72"/>
</g>
<!-- compute_energies -->
<g id="proc~~siesta_forces~~CallsGraph_node13" class="node"><title>compute_energies</title>
<polygon fill="#777777" stroke="#777777" points="223,-2016 122,-2016 122,-1992 223,-1992 223,-2016"/>
<text text-anchor="middle" x="172.5" y="-2001.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">compute_energies</text>
</g>
<!-- proc~siesta_forces&#45;&gt;compute_energies -->
<g id="proc~~siesta_forces~~CallsGraph_edge12" class="edge"><title>proc~siesta_forces&#45;&gt;compute_energies</title>
<path fill="none" stroke="#000000" d="M57.7058,-1953.04C72.1617,-1962.02 92.8678,-1974.21 112,-1983 116.028,-1984.85 120.27,-1986.64 124.557,-1988.34"/>
<polygon fill="#000000" stroke="#000000" points="123.357,-1991.63 133.948,-1991.92 125.849,-1985.09 123.357,-1991.63"/>
</g>
<!-- dm_charge -->
<g id="proc~~siesta_forces~~CallsGraph_node14" class="node"><title>dm_charge</title>
<polygon fill="#777777" stroke="#777777" points="206,-1974 139,-1974 139,-1950 206,-1950 206,-1974"/>
<text text-anchor="middle" x="172.5" y="-1959.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dm_charge</text>
</g>
<!-- proc~siesta_forces&#45;&gt;dm_charge -->
<g id="proc~~siesta_forces~~CallsGraph_edge13" class="edge"><title>proc~siesta_forces&#45;&gt;dm_charge</title>
<path fill="none" stroke="#000000" d="M76.2612,-1946.91C92.4884,-1949.48 111.606,-1952.51 128.438,-1955.18"/>
<polygon fill="#000000" stroke="#000000" points="128.152,-1958.67 138.577,-1956.78 129.248,-1951.76 128.152,-1958.67"/>
</g>
<!-- post_scf_work -->
<g id="proc~~siesta_forces~~CallsGraph_node15" class="node"><title>post_scf_work</title>
<polygon fill="#777777" stroke="#777777" points="213,-1932 132,-1932 132,-1908 213,-1908 213,-1932"/>
<text text-anchor="middle" x="172.5" y="-1917.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">post_scf_work</text>
</g>
<!-- proc~siesta_forces&#45;&gt;post_scf_work -->
<g id="proc~~siesta_forces~~CallsGraph_edge14" class="edge"><title>proc~siesta_forces&#45;&gt;post_scf_work</title>
<path fill="none" stroke="#000000" d="M76.2612,-1935.09C90.3165,-1932.87 106.54,-1930.3 121.569,-1927.91"/>
<polygon fill="#000000" stroke="#000000" points="122.413,-1931.32 131.741,-1926.3 121.317,-1924.41 122.413,-1931.32"/>
</g>
<!-- timer -->
<g id="proc~~siesta_forces~~CallsGraph_node16" class="node"><title>timer</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2204 317.5,-2204 317.5,-2180 371.5,-2180 371.5,-2204"/>
<text text-anchor="middle" x="344.5" y="-2189.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">timer</text>
</g>
<!-- proc~siesta_forces&#45;&gt;timer -->
<g id="proc~~siesta_forces~~CallsGraph_edge15" class="edge"><title>proc~siesta_forces&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M39.1379,-1953.33C40.1276,-2016.53 48.1277,-2303.36 112,-2357 153.182,-2391.58 190.612,-2390.1 233,-2357 284.998,-2316.4 223.052,-2260.34 269,-2213 278.994,-2202.7 293.613,-2197.34 307.259,-2194.59"/>
<polygon fill="#000000" stroke="#000000" points="308.095,-2198 317.412,-2192.96 306.983,-2191.09 308.095,-2198"/>
</g>
<!-- fdf_get -->
<g id="proc~~siesta_forces~~CallsGraph_node17" class="node"><title>fdf_get</title>
<polygon fill="#777777" stroke="#777777" points="199.5,-1848 145.5,-1848 145.5,-1824 199.5,-1824 199.5,-1848"/>
<text text-anchor="middle" x="172.5" y="-1833.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">fdf_get</text>
</g>
<!-- proc~siesta_forces&#45;&gt;fdf_get -->
<g id="proc~~siesta_forces~~CallsGraph_edge16" class="edge"><title>proc~siesta_forces&#45;&gt;fdf_get</title>
<path fill="none" stroke="#000000" d="M46.4843,-1928.96C58.2944,-1910.89 82.9249,-1876.78 112,-1857 119.083,-1852.18 127.391,-1848.35 135.515,-1845.35"/>
<polygon fill="#000000" stroke="#000000" points="136.869,-1848.58 145.238,-1842.09 134.644,-1841.95 136.869,-1848.58"/>
</g>
<!-- compute_charge_diff -->
<g id="proc~~siesta_forces~~CallsGraph_node18" class="node"><title>compute_charge_diff</title>
<polygon fill="#777777" stroke="#777777" points="229,-1806 116,-1806 116,-1782 229,-1782 229,-1806"/>
<text text-anchor="middle" x="172.5" y="-1791.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">compute_charge_diff</text>
</g>
<!-- proc~siesta_forces&#45;&gt;compute_charge_diff -->
<g id="proc~~siesta_forces~~CallsGraph_edge17" class="edge"><title>proc~siesta_forces&#45;&gt;compute_charge_diff</title>
<path fill="none" stroke="#000000" d="M42.8655,-1928.69C51.3318,-1903.69 73.8626,-1846.64 112,-1815 113.581,-1813.69 115.249,-1812.46 116.984,-1811.3"/>
<polygon fill="#000000" stroke="#000000" points="119.144,-1814.1 126.112,-1806.12 115.688,-1808.01 119.144,-1814.1"/>
</g>
<!-- mixer -->
<g id="proc~~siesta_forces~~CallsGraph_node19" class="node"><title>mixer</title>
<polygon fill="#777777" stroke="#777777" points="199.5,-1764 145.5,-1764 145.5,-1740 199.5,-1740 199.5,-1764"/>
<text text-anchor="middle" x="172.5" y="-1749.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mixer</text>
</g>
<!-- proc~siesta_forces&#45;&gt;mixer -->
<g id="proc~~siesta_forces~~CallsGraph_edge18" class="edge"><title>proc~siesta_forces&#45;&gt;mixer</title>
<path fill="none" stroke="#000000" d="M40.8584,-1928.95C46.1846,-1898.44 64.3034,-1817.44 112,-1773 118.638,-1766.81 127.21,-1762.43 135.768,-1759.34"/>
<polygon fill="#000000" stroke="#000000" points="136.817,-1762.68 145.322,-1756.36 134.733,-1755.99 136.817,-1762.68"/>
</g>
<!-- die -->
<g id="proc~~siesta_forces~~CallsGraph_node20" class="node"><title>die</title>
<polygon fill="#777777" stroke="#777777" points="199.5,-1722 145.5,-1722 145.5,-1698 199.5,-1698 199.5,-1722"/>
<text text-anchor="middle" x="172.5" y="-1707.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">die</text>
</g>
<!-- proc~siesta_forces&#45;&gt;die -->
<g id="proc~~siesta_forces~~CallsGraph_edge19" class="edge"><title>proc~siesta_forces&#45;&gt;die</title>
<path fill="none" stroke="#000000" d="M39.6667,-1928.91C42.2692,-1893.46 54.6843,-1788.59 112,-1731 118.457,-1724.51 127.037,-1720.02 135.667,-1716.92"/>
<polygon fill="#000000" stroke="#000000" points="136.78,-1720.24 145.321,-1713.97 134.735,-1713.54 136.78,-1720.24"/>
</g>
<!-- set_tolerance -->
<g id="proc~~siesta_forces~~CallsGraph_node21" class="node"><title>set_tolerance</title>
<polygon fill="#777777" stroke="#777777" points="211,-1680 134,-1680 134,-1656 211,-1656 211,-1680"/>
<text text-anchor="middle" x="172.5" y="-1665.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">set_tolerance</text>
</g>
<!-- proc~siesta_forces&#45;&gt;set_tolerance -->
<g id="proc~~siesta_forces~~CallsGraph_edge20" class="edge"><title>proc~siesta_forces&#45;&gt;set_tolerance</title>
<path fill="none" stroke="#000000" d="M38.845,-1928.88C39.0018,-1888.95 44.9227,-1760.04 112,-1689 115.575,-1685.21 119.873,-1682.11 124.503,-1679.57"/>
<polygon fill="#000000" stroke="#000000" points="126.091,-1682.69 133.713,-1675.33 123.166,-1676.33 126.091,-1682.69"/>
</g>
<!-- compute_dm -->
<g id="proc~~siesta_forces~~CallsGraph_node22" class="node"><title>compute_dm</title>
<polygon fill="#777777" stroke="#777777" points="210,-1638 135,-1638 135,-1614 210,-1614 210,-1638"/>
<text text-anchor="middle" x="172.5" y="-1623.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">compute_dm</text>
</g>
<!-- proc~siesta_forces&#45;&gt;compute_dm -->
<g id="proc~~siesta_forces~~CallsGraph_edge21" class="edge"><title>proc~siesta_forces&#45;&gt;compute_dm</title>
<path fill="none" stroke="#000000" d="M40.4862,-1928.77C46.7941,-1878.72 72.8362,-1690.11 112,-1647 115.775,-1642.84 120.423,-1639.51 125.443,-1636.84"/>
<polygon fill="#000000" stroke="#000000" points="127.05,-1639.95 134.774,-1632.7 124.214,-1633.55 127.05,-1639.95"/>
</g>
<!-- proc~state_init -->
<g id="proc~~siesta_forces~~CallsGraph_node23" class="node"><title>proc~state_init</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node23"><a xlink:href=".././proc/state_init.html" xlink:title="state_init">
<polygon fill="#d9534f" stroke="#d9534f" points="200,-1179 145,-1179 145,-1155 200,-1155 200,-1179"/>
<text text-anchor="middle" x="172.5" y="-1164.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">state_init</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~state_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge22" class="edge"><title>proc~siesta_forces&#45;&gt;proc~state_init</title>
<path fill="none" stroke="#000000" d="M40.7936,-1928.95C48.6805,-1876.14 81.2536,-1659.9 112,-1483 131.237,-1372.32 156.996,-1240.39 167.137,-1189"/>
<polygon fill="#000000" stroke="#000000" points="170.602,-1189.52 169.108,-1179.03 163.735,-1188.16 170.602,-1189.52"/>
</g>
<!-- compute_max_diff -->
<g id="proc~~siesta_forces~~CallsGraph_node24" class="node"><title>compute_max_diff</title>
<polygon fill="#777777" stroke="#777777" points="222.5,-1558 122.5,-1558 122.5,-1534 222.5,-1534 222.5,-1558"/>
<text text-anchor="middle" x="172.5" y="-1543.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">compute_max_diff</text>
</g>
<!-- proc~siesta_forces&#45;&gt;compute_max_diff -->
<g id="proc~~siesta_forces~~CallsGraph_edge23" class="edge"><title>proc~siesta_forces&#45;&gt;compute_max_diff</title>
<path fill="none" stroke="#000000" d="M39.8973,-1928.98C44.3664,-1871.99 65.8698,-1629.39 112,-1572 114.549,-1568.83 117.562,-1566.03 120.858,-1563.57"/>
<polygon fill="#000000" stroke="#000000" points="122.925,-1566.41 129.528,-1558.12 119.2,-1560.48 122.925,-1566.41"/>
</g>
<!-- mix_rhog -->
<g id="proc~~siesta_forces~~CallsGraph_node25" class="node"><title>mix_rhog</title>
<polygon fill="#777777" stroke="#777777" points="201,-1516 144,-1516 144,-1492 201,-1492 201,-1516"/>
<text text-anchor="middle" x="172.5" y="-1501.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mix_rhog</text>
</g>
<!-- proc~siesta_forces&#45;&gt;mix_rhog -->
<g id="proc~~siesta_forces~~CallsGraph_edge24" class="edge"><title>proc~siesta_forces&#45;&gt;mix_rhog</title>
<path fill="none" stroke="#000000" d="M39.5277,-1928.64C42.4176,-1866.48 58.2193,-1588.51 112,-1525 117.698,-1518.27 125.697,-1513.7 133.984,-1510.59"/>
<polygon fill="#000000" stroke="#000000" points="135.21,-1513.87 143.727,-1507.57 133.139,-1507.19 135.21,-1513.87"/>
</g>
<!-- reset -->
<g id="proc~~siesta_forces~~CallsGraph_node26" class="node"><title>reset</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2162 317.5,-2162 317.5,-2138 371.5,-2138 371.5,-2162"/>
<text text-anchor="middle" x="344.5" y="-2147.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">reset</text>
</g>
<!-- proc~siesta_forces&#45;&gt;reset -->
<g id="proc~~siesta_forces~~CallsGraph_edge25" class="edge"><title>proc~siesta_forces&#45;&gt;reset</title>
<path fill="none" stroke="#000000" d="M40.0876,-1953.28C44.8885,-2004.36 66.016,-2199.04 112,-2235 154.361,-2268.13 186.579,-2262.15 233,-2235 261.171,-2218.52 243.35,-2191.18 269,-2171 279.917,-2162.41 294.164,-2157.33 307.272,-2154.33"/>
<polygon fill="#000000" stroke="#000000" points="308.312,-2157.7 317.455,-2152.35 306.97,-2150.83 308.312,-2157.7"/>
</g>
<!-- write_spmatrix -->
<g id="proc~~siesta_forces~~CallsGraph_node27" class="node"><title>write_spmatrix</title>
<polygon fill="#777777" stroke="#777777" points="213.5,-1137 131.5,-1137 131.5,-1113 213.5,-1113 213.5,-1137"/>
<text text-anchor="middle" x="172.5" y="-1122.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_spmatrix</text>
</g>
<!-- proc~siesta_forces&#45;&gt;write_spmatrix -->
<g id="proc~~siesta_forces~~CallsGraph_edge26" class="edge"><title>proc~siesta_forces&#45;&gt;write_spmatrix</title>
<path fill="none" stroke="#000000" d="M39.3298,-1928.99C42.0281,-1834.35 61.6569,-1210.66 112,-1146 114.84,-1142.35 118.361,-1139.34 122.261,-1136.84"/>
<polygon fill="#000000" stroke="#000000" points="124.01,-1139.88 131.286,-1132.18 120.796,-1133.66 124.01,-1139.88"/>
</g>
<!-- proc~mixers_history_init -->
<g id="proc~~siesta_forces~~CallsGraph_node96" class="node"><title>proc~mixers_history_init</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node96"><a xlink:href=".././proc/mixers_history_init.html" xlink:title="mixers_history_init">
<polygon fill="#d9534f" stroke="#d9534f" points="395,-2120 294,-2120 294,-2096 395,-2096 395,-2120"/>
<text text-anchor="middle" x="344.5" y="-2105.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mixers_history_init</text>
</a>
</g>
</g>
<!-- proc~mixers_scf_history_init&#45;&gt;proc~mixers_history_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge27" class="edge"><title>proc~mixers_scf_history_init&#45;&gt;proc~mixers_history_init</title>
<path fill="none" stroke="#000000" d="M222.149,-1890.01C226.21,-1892.46 229.928,-1895.43 233,-1899 288.477,-1963.5 211.471,-2024.33 269,-2087 273.353,-2091.74 278.686,-2095.45 284.48,-2098.33"/>
<polygon fill="#000000" stroke="#000000" points="283.31,-2101.64 293.888,-2102.23 285.988,-2095.17 283.31,-2101.64"/>
</g>
<!-- proc~state_analysis&#45;&gt;timer -->
<g id="proc~~siesta_forces~~CallsGraph_edge43" class="edge"><title>proc~state_analysis&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M177.846,-2620.77C188.583,-2590.18 216.671,-2507.68 233,-2437 255.697,-2338.75 201.931,-2288.29 269,-2213 278.616,-2202.21 293.306,-2196.77 307.108,-2194.11"/>
<polygon fill="#000000" stroke="#000000" points="308.021,-2197.51 317.39,-2192.56 306.981,-2190.59 308.021,-2197.51"/>
</g>
<!-- amass -->
<g id="proc~~siesta_forces~~CallsGraph_node29" class="node"><title>amass</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2918 317.5,-2918 317.5,-2894 371.5,-2894 371.5,-2918"/>
<text text-anchor="middle" x="344.5" y="-2903.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">amass</text>
</g>
<!-- proc~state_analysis&#45;&gt;amass -->
<g id="proc~~siesta_forces~~CallsGraph_edge28" class="edge"><title>proc~state_analysis&#45;&gt;amass</title>
<path fill="none" stroke="#000000" d="M174.357,-2645.09C177.882,-2685.49 194.829,-2817.05 269,-2885 279.423,-2894.55 293.858,-2899.8 307.249,-2902.66"/>
<polygon fill="#000000" stroke="#000000" points="306.745,-2906.13 317.202,-2904.43 307.965,-2899.24 306.745,-2906.13"/>
</g>
<!-- siesta_write_stress_pressure -->
<g id="proc~~siesta_forces~~CallsGraph_node30" class="node"><title>siesta_write_stress_pressure</title>
<polygon fill="#777777" stroke="#777777" points="420,-2876 269,-2876 269,-2852 420,-2852 420,-2876"/>
<text text-anchor="middle" x="344.5" y="-2861.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_write_stress_pressure</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_write_stress_pressure -->
<g id="proc~~siesta_forces~~CallsGraph_edge29" class="edge"><title>proc~state_analysis&#45;&gt;siesta_write_stress_pressure</title>
<path fill="none" stroke="#000000" d="M175.371,-2645.08C181.58,-2680.99 204.878,-2787.96 269,-2843 270.529,-2844.31 272.135,-2845.54 273.804,-2846.7"/>
<polygon fill="#000000" stroke="#000000" points="272.202,-2849.82 282.599,-2851.86 275.743,-2843.78 272.202,-2849.82"/>
</g>
<!-- remove_intramol_pressure -->
<g id="proc~~siesta_forces~~CallsGraph_node32" class="node"><title>remove_intramol_pressure</title>
<polygon fill="#777777" stroke="#777777" points="415,-2834 274,-2834 274,-2810 415,-2810 415,-2834"/>
<text text-anchor="middle" x="344.5" y="-2819.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">remove_intramol_pressure</text>
</g>
<!-- proc~state_analysis&#45;&gt;remove_intramol_pressure -->
<g id="proc~~siesta_forces~~CallsGraph_edge30" class="edge"><title>proc~state_analysis&#45;&gt;remove_intramol_pressure</title>
<path fill="none" stroke="#000000" d="M176.913,-2645.3C186.185,-2676.38 214.85,-2758.6 269,-2801 270.848,-2802.45 272.791,-2803.79 274.807,-2805.05"/>
<polygon fill="#000000" stroke="#000000" points="273.577,-2808.36 284.048,-2809.98 276.871,-2802.18 273.577,-2808.36"/>
</g>
<!-- wallclock -->
<g id="proc~~siesta_forces~~CallsGraph_node34" class="node"><title>wallclock</title>
<polygon fill="#777777" stroke="#777777" points="372,-2792 317,-2792 317,-2768 372,-2768 372,-2792"/>
<text text-anchor="middle" x="344.5" y="-2777.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">wallclock</text>
</g>
<!-- proc~state_analysis&#45;&gt;wallclock -->
<g id="proc~~siesta_forces~~CallsGraph_edge31" class="edge"><title>proc~state_analysis&#45;&gt;wallclock</title>
<path fill="none" stroke="#000000" d="M179.261,-2645.14C191.855,-2670.34 224.326,-2728.54 269,-2759 280.213,-2766.65 294.175,-2771.53 306.971,-2774.64"/>
<polygon fill="#000000" stroke="#000000" points="306.397,-2778.09 316.908,-2776.77 307.865,-2771.25 306.397,-2778.09"/>
</g>
<!-- cartesianforce_to_zmatforce -->
<g id="proc~~siesta_forces~~CallsGraph_node38" class="node"><title>cartesianforce_to_zmatforce</title>
<polygon fill="#777777" stroke="#777777" points="418.5,-2750 270.5,-2750 270.5,-2726 418.5,-2726 418.5,-2750"/>
<text text-anchor="middle" x="344.5" y="-2735.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cartesianforce_to_zmatforce</text>
</g>
<!-- proc~state_analysis&#45;&gt;cartesianforce_to_zmatforce -->
<g id="proc~~siesta_forces~~CallsGraph_edge32" class="edge"><title>proc~state_analysis&#45;&gt;cartesianforce_to_zmatforce</title>
<path fill="none" stroke="#000000" d="M183.976,-2645.19C200.321,-2663.44 233.696,-2697.8 269,-2717 272.486,-2718.9 276.16,-2720.63 279.93,-2722.23"/>
<polygon fill="#000000" stroke="#000000" points="278.863,-2725.56 289.453,-2725.88 281.374,-2719.03 278.863,-2725.56"/>
</g>
<!-- write_debug -->
<g id="proc~~siesta_forces~~CallsGraph_node39" class="node"><title>write_debug</title>
<polygon fill="#777777" stroke="#777777" points="380,-2288 309,-2288 309,-2264 380,-2264 380,-2288"/>
<text text-anchor="middle" x="344.5" y="-2273.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_debug</text>
</g>
<!-- proc~state_analysis&#45;&gt;write_debug -->
<g id="proc~~siesta_forces~~CallsGraph_edge33" class="edge"><title>proc~state_analysis&#45;&gt;write_debug</title>
<path fill="none" stroke="#000000" d="M177.445,-2620.67C187.265,-2589.84 213.426,-2506.85 233,-2437 250.335,-2375.14 224.098,-2342.95 269,-2297 276.982,-2288.83 287.874,-2283.77 298.865,-2280.66"/>
<polygon fill="#000000" stroke="#000000" points="299.965,-2284 308.906,-2278.31 298.372,-2277.18 299.965,-2284"/>
</g>
<!-- mulliken -->
<g id="proc~~siesta_forces~~CallsGraph_node40" class="node"><title>mulliken</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2708 317.5,-2708 317.5,-2684 371.5,-2684 371.5,-2708"/>
<text text-anchor="middle" x="344.5" y="-2693.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mulliken</text>
</g>
<!-- proc~state_analysis&#45;&gt;mulliken -->
<g id="proc~~siesta_forces~~CallsGraph_edge34" class="edge"><title>proc~state_analysis&#45;&gt;mulliken</title>
<path fill="none" stroke="#000000" d="M198.247,-2645.02C217.303,-2654 244.451,-2666.19 269,-2675 281.352,-2679.43 295.121,-2683.54 307.429,-2686.92"/>
<polygon fill="#000000" stroke="#000000" points="306.795,-2690.38 317.361,-2689.59 308.609,-2683.62 306.795,-2690.38"/>
</g>
<!-- update_freeeharris -->
<g id="proc~~siesta_forces~~CallsGraph_node44" class="node"><title>update_freeeharris</title>
<polygon fill="#777777" stroke="#777777" points="396,-2666 293,-2666 293,-2642 396,-2642 396,-2666"/>
<text text-anchor="middle" x="344.5" y="-2651.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">update_freeeharris</text>
</g>
<!-- proc~state_analysis&#45;&gt;update_freeeharris -->
<g id="proc~~siesta_forces~~CallsGraph_edge36" class="edge"><title>proc~state_analysis&#45;&gt;update_freeeharris</title>
<path fill="none" stroke="#000000" d="M212.501,-2637.82C233.251,-2640.38 259.235,-2643.59 282.578,-2646.47"/>
<polygon fill="#000000" stroke="#000000" points="282.388,-2649.98 292.742,-2647.73 283.246,-2643.03 282.388,-2649.98"/>
</g>
<!-- print_spin -->
<g id="proc~~siesta_forces~~CallsGraph_node45" class="node"><title>print_spin</title>
<polygon fill="#777777" stroke="#777777" points="374,-2624 315,-2624 315,-2600 374,-2600 374,-2624"/>
<text text-anchor="middle" x="344.5" y="-2609.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">print_spin</text>
</g>
<!-- proc~state_analysis&#45;&gt;print_spin -->
<g id="proc~~siesta_forces~~CallsGraph_edge35" class="edge"><title>proc~state_analysis&#45;&gt;print_spin</title>
<path fill="none" stroke="#000000" d="M212.501,-2628.18C240.143,-2624.77 277.071,-2620.21 304.673,-2616.8"/>
<polygon fill="#000000" stroke="#000000" points="305.261,-2620.25 314.756,-2615.55 304.403,-2613.3 305.261,-2620.25"/>
</g>
<!-- cmlendmodule -->
<g id="proc~~siesta_forces~~CallsGraph_node48" class="node"><title>cmlendmodule</title>
<polygon fill="#777777" stroke="#777777" points="385.5,-2582 303.5,-2582 303.5,-2558 385.5,-2558 385.5,-2582"/>
<text text-anchor="middle" x="344.5" y="-2567.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cmlendmodule</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmlendmodule -->
<g id="proc~~siesta_forces~~CallsGraph_edge37" class="edge"><title>proc~state_analysis&#45;&gt;cmlendmodule</title>
<path fill="none" stroke="#000000" d="M198.247,-2620.98C217.303,-2612 244.451,-2599.81 269,-2591 276.909,-2588.16 285.399,-2585.46 293.715,-2582.99"/>
<polygon fill="#000000" stroke="#000000" points="294.714,-2586.34 303.352,-2580.21 292.773,-2579.62 294.714,-2586.34"/>
</g>
<!-- moments -->
<g id="proc~~siesta_forces~~CallsGraph_node54" class="node"><title>moments</title>
<polygon fill="#777777" stroke="#777777" points="373,-2540 316,-2540 316,-2516 373,-2516 373,-2540"/>
<text text-anchor="middle" x="344.5" y="-2525.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">moments</text>
</g>
<!-- proc~state_analysis&#45;&gt;moments -->
<g id="proc~~siesta_forces~~CallsGraph_edge38" class="edge"><title>proc~state_analysis&#45;&gt;moments</title>
<path fill="none" stroke="#000000" d="M183.976,-2620.81C200.321,-2602.56 233.696,-2568.2 269,-2549 280.344,-2542.83 293.669,-2538.33 305.889,-2535.12"/>
<polygon fill="#000000" stroke="#000000" points="306.929,-2538.47 315.826,-2532.72 305.284,-2531.67 306.929,-2538.47"/>
</g>
<!-- update_freee -->
<g id="proc~~siesta_forces~~CallsGraph_node57" class="node"><title>update_freee</title>
<polygon fill="#777777" stroke="#777777" points="382.5,-2498 306.5,-2498 306.5,-2474 382.5,-2474 382.5,-2498"/>
<text text-anchor="middle" x="344.5" y="-2483.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">update_freee</text>
</g>
<!-- proc~state_analysis&#45;&gt;update_freee -->
<g id="proc~~siesta_forces~~CallsGraph_edge39" class="edge"><title>proc~state_analysis&#45;&gt;update_freee</title>
<path fill="none" stroke="#000000" d="M179.261,-2620.86C191.855,-2595.66 224.326,-2537.46 269,-2507 277.158,-2501.44 286.77,-2497.34 296.329,-2494.32"/>
<polygon fill="#000000" stroke="#000000" points="297.525,-2497.62 306.209,-2491.55 295.636,-2490.88 297.525,-2497.62"/>
</g>
<!-- cmladdproperty -->
<g id="proc~~siesta_forces~~CallsGraph_node58" class="node"><title>cmladdproperty</title>
<polygon fill="#777777" stroke="#777777" points="388,-2456 301,-2456 301,-2432 388,-2432 388,-2456"/>
<text text-anchor="middle" x="344.5" y="-2441.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cmladdproperty</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmladdproperty -->
<g id="proc~~siesta_forces~~CallsGraph_edge40" class="edge"><title>proc~state_analysis&#45;&gt;cmladdproperty</title>
<path fill="none" stroke="#000000" d="M176.913,-2620.7C186.185,-2589.62 214.85,-2507.4 269,-2465 275.544,-2459.88 283.275,-2456 291.237,-2453.07"/>
<polygon fill="#000000" stroke="#000000" points="292.542,-2456.33 300.999,-2449.95 290.408,-2449.66 292.542,-2456.33"/>
</g>
<!-- slua_call -->
<g id="proc~~siesta_forces~~CallsGraph_node60" class="node"><title>slua_call</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2414 317.5,-2414 317.5,-2390 371.5,-2390 371.5,-2414"/>
<text text-anchor="middle" x="344.5" y="-2399.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">slua_call</text>
</g>
<!-- proc~state_analysis&#45;&gt;slua_call -->
<g id="proc~~siesta_forces~~CallsGraph_edge41" class="edge"><title>proc~state_analysis&#45;&gt;slua_call</title>
<path fill="none" stroke="#000000" d="M175.371,-2620.92C181.58,-2585.01 204.878,-2478.04 269,-2423 279.725,-2413.79 294.215,-2408.61 307.564,-2405.69"/>
<polygon fill="#000000" stroke="#000000" points="308.264,-2409.12 317.469,-2403.88 307.002,-2402.24 308.264,-2409.12"/>
</g>
<!-- siesta_write_forces -->
<g id="proc~~siesta_forces~~CallsGraph_node66" class="node"><title>siesta_write_forces</title>
<polygon fill="#777777" stroke="#777777" points="396.5,-2372 292.5,-2372 292.5,-2348 396.5,-2348 396.5,-2372"/>
<text text-anchor="middle" x="344.5" y="-2357.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_write_forces</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_write_forces -->
<g id="proc~~siesta_forces~~CallsGraph_edge42" class="edge"><title>proc~state_analysis&#45;&gt;siesta_write_forces</title>
<path fill="none" stroke="#000000" d="M176.541,-2620.9C188.191,-2575.42 231.225,-2415.61 269,-2381 273.149,-2377.2 277.934,-2374.08 283.036,-2371.52"/>
<polygon fill="#000000" stroke="#000000" points="284.664,-2374.63 292.493,-2367.49 281.922,-2368.19 284.664,-2374.63"/>
</g>
<!-- born_charge -->
<g id="proc~~siesta_forces~~CallsGraph_node76" class="node"><title>born_charge</title>
<polygon fill="#777777" stroke="#777777" points="381,-2330 308,-2330 308,-2306 381,-2306 381,-2330"/>
<text text-anchor="middle" x="344.5" y="-2315.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">born_charge</text>
</g>
<!-- proc~state_analysis&#45;&gt;born_charge -->
<g id="proc~~siesta_forces~~CallsGraph_edge44" class="edge"><title>proc~state_analysis&#45;&gt;born_charge</title>
<path fill="none" stroke="#000000" d="M177.096,-2620.86C193.175,-2566.7 258.168,-2349.41 269,-2339 276.855,-2331.45 287.208,-2326.57 297.689,-2323.44"/>
<polygon fill="#000000" stroke="#000000" points="298.848,-2326.76 307.699,-2320.93 297.149,-2319.96 298.848,-2326.76"/>
</g>
<!-- cmlstartmodule -->
<g id="proc~~siesta_forces~~CallsGraph_node77" class="node"><title>cmlstartmodule</title>
<polygon fill="#777777" stroke="#777777" points="387,-3128 302,-3128 302,-3104 387,-3104 387,-3128"/>
<text text-anchor="middle" x="344.5" y="-3113.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cmlstartmodule</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmlstartmodule -->
<g id="proc~~siesta_forces~~CallsGraph_edge45" class="edge"><title>proc~state_analysis&#45;&gt;cmlstartmodule</title>
<path fill="none" stroke="#000000" d="M174.33,-2645.04C179.099,-2710.84 205.08,-3026.38 269,-3095 275.189,-3101.64 283.301,-3106.24 291.89,-3109.42"/>
<polygon fill="#000000" stroke="#000000" points="291.126,-3112.84 301.713,-3112.42 293.175,-3106.15 291.126,-3112.84"/>
</g>
<!-- eggbox -->
<g id="proc~~siesta_forces~~CallsGraph_node79" class="node"><title>eggbox</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3086 317.5,-3086 317.5,-3062 371.5,-3062 371.5,-3086"/>
<text text-anchor="middle" x="344.5" y="-3071.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">eggbox</text>
</g>
<!-- proc~state_analysis&#45;&gt;eggbox -->
<g id="proc~~siesta_forces~~CallsGraph_edge46" class="edge"><title>proc~state_analysis&#45;&gt;eggbox</title>
<path fill="none" stroke="#000000" d="M174.609,-2645.16C180.535,-2707.58 210.412,-2991.33 269,-3053 278.884,-3063.4 293.484,-3068.78 307.146,-3071.52"/>
<polygon fill="#000000" stroke="#000000" points="306.892,-3075.02 317.318,-3073.13 307.991,-3068.11 306.892,-3075.02"/>
</g>
<!-- volcel -->
<g id="proc~~siesta_forces~~CallsGraph_node80" class="node"><title>volcel</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-2246 317.5,-2246 317.5,-2222 371.5,-2222 371.5,-2246"/>
<text text-anchor="middle" x="344.5" y="-2231.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">volcel</text>
</g>
<!-- proc~state_analysis&#45;&gt;volcel -->
<g id="proc~~siesta_forces~~CallsGraph_edge47" class="edge"><title>proc~state_analysis&#45;&gt;volcel</title>
<path fill="none" stroke="#000000" d="M177.689,-2620.74C188.068,-2590.05 215.403,-2507.38 233,-2437 253.001,-2357.01 213.057,-2315.58 269,-2255 278.735,-2244.46 293.311,-2239.06 306.995,-2236.34"/>
<polygon fill="#000000" stroke="#000000" points="307.851,-2239.75 317.191,-2234.75 306.771,-2232.84 307.851,-2239.75"/>
</g>
<!-- fixed -->
<g id="proc~~siesta_forces~~CallsGraph_node84" class="node"><title>fixed</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3044 317.5,-3044 317.5,-3020 371.5,-3020 371.5,-3044"/>
<text text-anchor="middle" x="344.5" y="-3029.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">fixed</text>
</g>
<!-- proc~state_analysis&#45;&gt;fixed -->
<g id="proc~~siesta_forces~~CallsGraph_edge48" class="edge"><title>proc~state_analysis&#45;&gt;fixed</title>
<path fill="none" stroke="#000000" d="M174.93,-2645.1C182.069,-2703.56 215.659,-2956.18 269,-3011 279.007,-3021.28 293.628,-3026.64 307.272,-3029.4"/>
<polygon fill="#000000" stroke="#000000" points="306.994,-3032.9 317.423,-3031.03 308.107,-3025.98 306.994,-3032.9"/>
</g>
<!-- va -->
<g id="proc~~siesta_forces~~CallsGraph_node85" class="node"><title>va</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-3002 317.5,-3002 317.5,-2978 371.5,-2978 371.5,-3002"/>
<text text-anchor="middle" x="344.5" y="-2987.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">va</text>
</g>
<!-- proc~state_analysis&#45;&gt;va -->
<g id="proc~~siesta_forces~~CallsGraph_edge49" class="edge"><title>proc~state_analysis&#45;&gt;va</title>
<path fill="none" stroke="#000000" d="M173.039,-2645.14C171.897,-2693.53 174.343,-2874.55 269,-2969 279.082,-2979.06 293.585,-2984.39 307.12,-2987.18"/>
<polygon fill="#000000" stroke="#000000" points="306.754,-2990.67 317.193,-2988.86 307.904,-2983.76 306.754,-2990.67"/>
</g>
<!-- kin_stress -->
<g id="proc~~siesta_forces~~CallsGraph_node95" class="node"><title>kin_stress</title>
<polygon fill="#777777" stroke="#777777" points="375,-2960 314,-2960 314,-2936 375,-2936 375,-2960"/>
<text text-anchor="middle" x="344.5" y="-2945.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">kin_stress</text>
</g>
<!-- proc~state_analysis&#45;&gt;kin_stress -->
<g id="proc~~siesta_forces~~CallsGraph_edge50" class="edge"><title>proc~state_analysis&#45;&gt;kin_stress</title>
<path fill="none" stroke="#000000" d="M173.613,-2645.15C174.71,-2689.73 184.662,-2845.92 269,-2927 278.402,-2936.04 291.383,-2941.24 303.878,-2944.22"/>
<polygon fill="#000000" stroke="#000000" points="303.228,-2947.66 313.717,-2946.16 304.583,-2940.79 303.228,-2947.66"/>
</g>
<!-- proc~mixing_scf_converged&#45;&gt;reset -->
<g id="proc~~siesta_forces~~CallsGraph_edge51" class="edge"><title>proc~mixing_scf_converged&#45;&gt;reset</title>
<path fill="none" stroke="#000000" d="M218.885,-2058.12C223.943,-2060.57 228.783,-2063.51 233,-2067 257.534,-2087.33 243.823,-2109.47 269,-2129 279.892,-2137.45 294.017,-2142.5 307.035,-2145.52"/>
<polygon fill="#000000" stroke="#000000" points="306.664,-2149.01 317.155,-2147.53 308.029,-2142.15 306.664,-2149.01"/>
</g>
<!-- proc~state_init&#45;&gt;bye -->
<g id="proc~~siesta_forces~~CallsGraph_edge61" class="edge"><title>proc~state_init&#45;&gt;bye</title>
<path fill="none" stroke="#000000" d="M176.367,-1179.26C186.079,-1221.31 217.962,-1363.64 233,-1483 240.752,-1544.53 231.478,-1990.62 269,-2040 278.07,-2051.94 293,-2058.42 307.123,-2061.93"/>
<polygon fill="#000000" stroke="#000000" points="306.668,-2065.41 317.168,-2064 308.078,-2058.55 306.668,-2065.41"/>
</g>
<!-- proc~state_init&#45;&gt;timer -->
<g id="proc~~siesta_forces~~CallsGraph_edge84" class="edge"><title>proc~state_init&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M176.422,-1179.26C186.311,-1221.28 218.694,-1363.55 233,-1483 242.103,-1559.01 221.215,-2111.2 269,-2171 278.18,-2182.49 293.126,-2187.99 307.231,-2190.53"/>
<polygon fill="#000000" stroke="#000000" points="306.877,-2194.01 317.258,-2191.89 307.822,-2187.08 306.877,-2194.01"/>
</g>
<!-- re_alloc -->
<g id="proc~~siesta_forces~~CallsGraph_node28" class="node"><title>re_alloc</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-822 317.5,-822 317.5,-798 371.5,-798 371.5,-822"/>
<text text-anchor="middle" x="344.5" y="-807.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">re_alloc</text>
</g>
<!-- proc~state_init&#45;&gt;re_alloc -->
<g id="proc~~siesta_forces~~CallsGraph_edge52" class="edge"><title>proc~state_init&#45;&gt;re_alloc</title>
<path fill="none" stroke="#000000" d="M200.013,-1164.02C211.9,-1161.27 225.014,-1156.02 233,-1146 320.796,-1035.78 177.693,-938.327 269,-831 278.459,-819.881 293.306,-814.417 307.264,-811.811"/>
<polygon fill="#000000" stroke="#000000" points="307.784,-815.273 317.181,-810.379 306.783,-808.344 307.784,-815.273"/>
</g>
<!-- crtsparsity_sc -->
<g id="proc~~siesta_forces~~CallsGraph_node31" class="node"><title>crtsparsity_sc</title>
<polygon fill="#777777" stroke="#777777" points="383.5,-780 305.5,-780 305.5,-756 383.5,-756 383.5,-780"/>
<text text-anchor="middle" x="344.5" y="-765.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">crtsparsity_sc</text>
</g>
<!-- proc~state_init&#45;&gt;crtsparsity_sc -->
<g id="proc~~siesta_forces~~CallsGraph_edge53" class="edge"><title>proc~state_init&#45;&gt;crtsparsity_sc</title>
<path fill="none" stroke="#000000" d="M200.072,-1164.06C211.973,-1161.33 225.081,-1156.08 233,-1146 331.529,-1020.61 166.477,-911.148 269,-789 275.809,-780.888 285.486,-775.78 295.621,-772.596"/>
<polygon fill="#000000" stroke="#000000" points="296.577,-775.964 305.399,-770.097 294.843,-769.182 296.577,-775.964"/>
</g>
<!-- nsc -->
<g id="proc~~siesta_forces~~CallsGraph_node33" class="node"><title>nsc</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-738 317.5,-738 317.5,-714 371.5,-714 371.5,-738"/>
<text text-anchor="middle" x="344.5" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nsc</text>
</g>
<!-- proc~state_init&#45;&gt;nsc -->
<g id="proc~~siesta_forces~~CallsGraph_edge54" class="edge"><title>proc~state_init&#45;&gt;nsc</title>
<path fill="none" stroke="#000000" d="M200.119,-1164.1C212.03,-1161.38 225.134,-1156.12 233,-1146 287.636,-1075.71 212.124,-815.49 269,-747 278.395,-735.686 293.372,-730.208 307.442,-727.643"/>
<polygon fill="#000000" stroke="#000000" points="308.014,-731.097 317.434,-726.249 307.046,-724.165 308.014,-731.097"/>
</g>
<!-- overlap -->
<g id="proc~~siesta_forces~~CallsGraph_node35" class="node"><title>overlap</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-696 317.5,-696 317.5,-672 371.5,-672 371.5,-696"/>
<text text-anchor="middle" x="344.5" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">overlap</text>
</g>
<!-- proc~state_init&#45;&gt;overlap -->
<g id="proc~~siesta_forces~~CallsGraph_edge55" class="edge"><title>proc~state_init&#45;&gt;overlap</title>
<path fill="none" stroke="#000000" d="M200.157,-1164.13C212.077,-1161.41 225.178,-1156.15 233,-1146 293.011,-1068.11 206.507,-780.912 269,-705 278.347,-693.646 293.317,-688.162 307.395,-685.604"/>
<polygon fill="#000000" stroke="#000000" points="307.97,-689.058 317.394,-684.216 307.008,-682.124 307.97,-689.058"/>
</g>
<!-- setup_dm_netcdf_file -->
<g id="proc~~siesta_forces~~CallsGraph_node36" class="node"><title>setup_dm_netcdf_file</title>
<polygon fill="#777777" stroke="#777777" points="402,-654 287,-654 287,-630 402,-630 402,-654"/>
<text text-anchor="middle" x="344.5" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_dm_netcdf_file</text>
</g>
<!-- proc~state_init&#45;&gt;setup_dm_netcdf_file -->
<g id="proc~~siesta_forces~~CallsGraph_edge56" class="edge"><title>proc~state_init&#45;&gt;setup_dm_netcdf_file</title>
<path fill="none" stroke="#000000" d="M200.189,-1164.15C212.116,-1161.44 225.213,-1156.18 233,-1146 298.389,-1060.51 200.886,-746.336 269,-663 271.604,-659.814 274.652,-657.089 277.999,-654.761"/>
<polygon fill="#000000" stroke="#000000" points="279.872,-657.723 286.855,-649.756 276.427,-651.629 279.872,-657.723"/>
</g>
<!-- init_val -->
<g id="proc~~siesta_forces~~CallsGraph_node37" class="node"><title>init_val</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-612 317.5,-612 317.5,-588 371.5,-588 371.5,-612"/>
<text text-anchor="middle" x="344.5" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">init_val</text>
</g>
<!-- proc~state_init&#45;&gt;init_val -->
<g id="proc~~siesta_forces~~CallsGraph_edge57" class="edge"><title>proc~state_init&#45;&gt;init_val</title>
<path fill="none" stroke="#000000" d="M200.216,-1164.17C212.149,-1161.47 225.244,-1156.2 233,-1146 303.769,-1052.9 195.264,-711.764 269,-621 278.273,-609.586 293.232,-604.093 307.322,-601.544"/>
<polygon fill="#000000" stroke="#000000" points="307.904,-604.997 317.334,-600.167 306.95,-598.063 307.904,-604.997"/>
</g>
<!-- proc~state_init&#45;&gt;write_debug -->
<g id="proc~~siesta_forces~~CallsGraph_edge58" class="edge"><title>proc~state_init&#45;&gt;write_debug</title>
<path fill="none" stroke="#000000" d="M176.448,-1179.25C186.418,-1221.27 219.034,-1363.51 233,-1483 242.969,-1568.29 215.586,-2187.76 269,-2255 276.37,-2264.28 287.501,-2269.66 298.928,-2272.72"/>
<polygon fill="#000000" stroke="#000000" points="298.449,-2276.2 308.959,-2274.86 299.907,-2269.35 298.449,-2276.2"/>
</g>
<!-- sp_to_spglobal -->
<g id="proc~~siesta_forces~~CallsGraph_node41" class="node"><title>sp_to_spglobal</title>
<polygon fill="#777777" stroke="#777777" points="387,-570 302,-570 302,-546 387,-546 387,-570"/>
<text text-anchor="middle" x="344.5" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sp_to_spglobal</text>
</g>
<!-- proc~state_init&#45;&gt;sp_to_spglobal -->
<g id="proc~~siesta_forces~~CallsGraph_edge59" class="edge"><title>proc~state_init&#45;&gt;sp_to_spglobal</title>
<path fill="none" stroke="#000000" d="M200.238,-1164.19C212.177,-1161.49 225.27,-1156.22 233,-1146 309.151,-1045.3 189.639,-677.193 269,-579 274.893,-571.709 283.107,-566.832 291.939,-563.595"/>
<polygon fill="#000000" stroke="#000000" points="293.102,-566.9 301.686,-560.689 291.102,-560.192 293.102,-566.9"/>
</g>
<!-- get_chess_parameter -->
<g id="proc~~siesta_forces~~CallsGraph_node42" class="node"><title>get_chess_parameter</title>
<polygon fill="#777777" stroke="#777777" points="403,-528 286,-528 286,-504 403,-504 403,-528"/>
<text text-anchor="middle" x="344.5" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">get_chess_parameter</text>
</g>
<!-- proc~state_init&#45;&gt;get_chess_parameter -->
<g id="proc~~siesta_forces~~CallsGraph_edge60" class="edge"><title>proc~state_init&#45;&gt;get_chess_parameter</title>
<path fill="none" stroke="#000000" d="M200.258,-1164.21C212.201,-1161.51 225.292,-1156.24 233,-1146 314.534,-1037.69 184.014,-642.624 269,-537 271.302,-534.139 273.962,-531.649 276.876,-529.484"/>
<polygon fill="#000000" stroke="#000000" points="278.904,-532.35 285.68,-524.205 275.304,-526.346 278.904,-532.35"/>
</g>
<!-- newsparsity -->
<g id="proc~~siesta_forces~~CallsGraph_node43" class="node"><title>newsparsity</title>
<polygon fill="#777777" stroke="#777777" points="379,-486 310,-486 310,-462 379,-462 379,-486"/>
<text text-anchor="middle" x="344.5" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newsparsity</text>
</g>
<!-- proc~state_init&#45;&gt;newsparsity -->
<g id="proc~~siesta_forces~~CallsGraph_edge62" class="edge"><title>proc~state_init&#45;&gt;newsparsity</title>
<path fill="none" stroke="#000000" d="M200.275,-1164.22C212.222,-1161.52 225.311,-1156.25 233,-1146 319.918,-1030.08 178.387,-608.056 269,-495 276.616,-485.497 288.176,-480.091 299.934,-477.071"/>
<polygon fill="#000000" stroke="#000000" points="300.678,-480.492 309.774,-475.059 299.275,-473.634 300.678,-480.492"/>
</g>
<!-- newddata2d -->
<g id="proc~~siesta_forces~~CallsGraph_node46" class="node"><title>newddata2d</title>
<polygon fill="#777777" stroke="#777777" points="380,-444 309,-444 309,-420 380,-420 380,-444"/>
<text text-anchor="middle" x="344.5" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newddata2d</text>
</g>
<!-- proc~state_init&#45;&gt;newddata2d -->
<g id="proc~~siesta_forces~~CallsGraph_edge63" class="edge"><title>proc~state_init&#45;&gt;newddata2d</title>
<path fill="none" stroke="#000000" d="M200.29,-1164.23C212.241,-1161.54 225.328,-1156.27 233,-1146 325.303,-1022.47 172.76,-573.49 269,-453 276.395,-443.742 287.533,-438.37 298.959,-435.306"/>
<polygon fill="#000000" stroke="#000000" points="299.938,-438.676 308.988,-433.167 298.478,-431.83 299.938,-438.676"/>
</g>
<!-- isc_off -->
<g id="proc~~siesta_forces~~CallsGraph_node47" class="node"><title>isc_off</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-402 317.5,-402 317.5,-378 371.5,-378 371.5,-402"/>
<text text-anchor="middle" x="344.5" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">isc_off</text>
</g>
<!-- proc~state_init&#45;&gt;isc_off -->
<g id="proc~~siesta_forces~~CallsGraph_edge64" class="edge"><title>proc~state_init&#45;&gt;isc_off</title>
<path fill="none" stroke="#000000" d="M200.304,-1164.24C212.258,-1161.55 225.344,-1156.28 233,-1146 330.688,-1014.86 167.131,-538.924 269,-411 278.161,-399.496 293.104,-393.99 307.212,-391.456"/>
<polygon fill="#000000" stroke="#000000" points="307.805,-394.908 317.242,-390.093 306.862,-387.971 307.805,-394.908"/>
</g>
<!-- iotdxv -->
<g id="proc~~siesta_forces~~CallsGraph_node49" class="node"><title>iotdxv</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-360 317.5,-360 317.5,-336 371.5,-336 371.5,-360"/>
<text text-anchor="middle" x="344.5" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">iotdxv</text>
</g>
<!-- proc~state_init&#45;&gt;iotdxv -->
<g id="proc~~siesta_forces~~CallsGraph_edge65" class="edge"><title>proc~state_init&#45;&gt;iotdxv</title>
<path fill="none" stroke="#000000" d="M200.01,-1164.32C212.048,-1161.65 225.292,-1156.38 233,-1146 284.537,-1076.62 215.251,-436.68 269,-369 278.146,-357.484 293.087,-351.976 307.197,-349.444"/>
<polygon fill="#000000" stroke="#000000" points="307.791,-352.896 317.23,-348.083 306.85,-345.959 307.791,-352.896"/>
</g>
<!-- listhptr -->
<g id="proc~~siesta_forces~~CallsGraph_node50" class="node"><title>listhptr</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-318 317.5,-318 317.5,-294 371.5,-294 371.5,-318"/>
<text text-anchor="middle" x="344.5" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">listhptr</text>
</g>
<!-- proc~state_init&#45;&gt;listhptr -->
<g id="proc~~siesta_forces~~CallsGraph_edge66" class="edge"><title>proc~state_init&#45;&gt;listhptr</title>
<path fill="none" stroke="#000000" d="M200.02,-1164.33C212.061,-1161.66 225.304,-1156.39 233,-1146 287.23,-1072.81 212.437,-398.397 269,-327 278.132,-315.473 293.071,-309.963 307.184,-307.433"/>
<polygon fill="#000000" stroke="#000000" points="307.779,-310.885 317.219,-306.074 306.839,-303.948 307.779,-310.885"/>
</g>
<!-- sporb_to_spatom -->
<g id="proc~~siesta_forces~~CallsGraph_node51" class="node"><title>sporb_to_spatom</title>
<polygon fill="#777777" stroke="#777777" points="392.5,-276 296.5,-276 296.5,-252 392.5,-252 392.5,-276"/>
<text text-anchor="middle" x="344.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sporb_to_spatom</text>
</g>
<!-- proc~state_init&#45;&gt;sporb_to_spatom -->
<g id="proc~~siesta_forces~~CallsGraph_edge67" class="edge"><title>proc~state_init&#45;&gt;sporb_to_spatom</title>
<path fill="none" stroke="#000000" d="M200.03,-1164.33C212.073,-1161.67 225.315,-1156.39 233,-1146 289.924,-1069.01 209.622,-360.115 269,-285 273.641,-279.129 279.788,-274.819 286.566,-271.668"/>
<polygon fill="#000000" stroke="#000000" points="288.005,-274.866 296.118,-268.052 285.527,-268.319 288.005,-274.866"/>
</g>
<!-- nscold -->
<g id="proc~~siesta_forces~~CallsGraph_node52" class="node"><title>nscold</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-234 317.5,-234 317.5,-210 371.5,-210 371.5,-234"/>
<text text-anchor="middle" x="344.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nscold</text>
</g>
<!-- proc~state_init&#45;&gt;nscold -->
<g id="proc~~siesta_forces~~CallsGraph_edge68" class="edge"><title>proc~state_init&#45;&gt;nscold</title>
<path fill="none" stroke="#000000" d="M200.039,-1164.34C212.084,-1161.68 225.325,-1156.4 233,-1146 292.617,-1065.2 206.807,-321.834 269,-243 278.109,-231.454 293.044,-225.942 307.16,-223.415"/>
<polygon fill="#000000" stroke="#000000" points="307.758,-226.866 317.199,-222.059 306.821,-219.929 307.758,-226.866"/>
</g>
<!-- siesta_write_positions -->
<g id="proc~~siesta_forces~~CallsGraph_node53" class="node"><title>siesta_write_positions</title>
<polygon fill="#777777" stroke="#777777" points="403,-192 286,-192 286,-168 403,-168 403,-192"/>
<text text-anchor="middle" x="344.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_write_positions</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_write_positions -->
<g id="proc~~siesta_forces~~CallsGraph_edge69" class="edge"><title>proc~state_init&#45;&gt;siesta_write_positions</title>
<path fill="none" stroke="#000000" d="M200.047,-1164.35C212.094,-1161.68 225.335,-1156.41 233,-1146 295.311,-1061.39 203.991,-283.552 269,-201 271.385,-197.971 274.171,-195.358 277.238,-193.104"/>
<polygon fill="#000000" stroke="#000000" points="279.12,-196.057 285.932,-187.942 275.546,-190.038 279.12,-196.057"/>
</g>
<!-- setup_ts_kpoint_grid -->
<g id="proc~~siesta_forces~~CallsGraph_node55" class="node"><title>setup_ts_kpoint_grid</title>
<polygon fill="#777777" stroke="#777777" points="400.5,-150 288.5,-150 288.5,-126 400.5,-126 400.5,-150"/>
<text text-anchor="middle" x="344.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_ts_kpoint_grid</text>
</g>
<!-- proc~state_init&#45;&gt;setup_ts_kpoint_grid -->
<g id="proc~~siesta_forces~~CallsGraph_edge70" class="edge"><title>proc~state_init&#45;&gt;setup_ts_kpoint_grid</title>
<path fill="none" stroke="#000000" d="M200.054,-1164.35C212.103,-1161.69 225.343,-1156.41 233,-1146 298.005,-1057.59 201.176,-245.271 269,-159 271.929,-155.274 275.465,-152.177 279.384,-149.605"/>
<polygon fill="#000000" stroke="#000000" points="281.298,-152.552 288.493,-144.774 278.018,-146.368 281.298,-152.552"/>
</g>
<!-- madelung -->
<g id="proc~~siesta_forces~~CallsGraph_node56" class="node"><title>madelung</title>
<polygon fill="#777777" stroke="#777777" points="374.5,-108 314.5,-108 314.5,-84 374.5,-84 374.5,-108"/>
<text text-anchor="middle" x="344.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">madelung</text>
</g>
<!-- proc~state_init&#45;&gt;madelung -->
<g id="proc~~siesta_forces~~CallsGraph_edge71" class="edge"><title>proc~state_init&#45;&gt;madelung</title>
<path fill="none" stroke="#000000" d="M200.061,-1164.36C212.112,-1161.7 225.351,-1156.42 233,-1146 300.699,-1053.78 198.361,-206.99 269,-117 277.463,-106.218 291.01,-100.694 304.245,-97.9501"/>
<polygon fill="#000000" stroke="#000000" points="304.895,-101.391 314.216,-96.3524 303.788,-94.4788 304.895,-101.391"/>
</g>
<!-- setup_kpoint_grid -->
<g id="proc~~siesta_forces~~CallsGraph_node59" class="node"><title>setup_kpoint_grid</title>
<polygon fill="#777777" stroke="#777777" points="393,-66 296,-66 296,-42 393,-42 393,-66"/>
<text text-anchor="middle" x="344.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_kpoint_grid</text>
</g>
<!-- proc~state_init&#45;&gt;setup_kpoint_grid -->
<g id="proc~~siesta_forces~~CallsGraph_edge72" class="edge"><title>proc~state_init&#45;&gt;setup_kpoint_grid</title>
<path fill="none" stroke="#000000" d="M200.067,-1164.36C212.119,-1161.7 225.358,-1156.43 233,-1146 303.393,-1049.97 195.545,-168.709 269,-75 273.56,-69.1831 279.599,-64.8964 286.271,-61.7508"/>
<polygon fill="#000000" stroke="#000000" points="287.605,-64.9877 295.683,-58.1321 285.093,-58.454 287.605,-64.9877"/>
</g>
<!-- fname_tshs -->
<g id="proc~~siesta_forces~~CallsGraph_node61" class="node"><title>fname_tshs</title>
<polygon fill="#777777" stroke="#777777" points="378.5,-24 310.5,-24 310.5,-0 378.5,-0 378.5,-24"/>
<text text-anchor="middle" x="344.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">fname_tshs</text>
</g>
<!-- proc~state_init&#45;&gt;fname_tshs -->
<g id="proc~~siesta_forces~~CallsGraph_edge73" class="edge"><title>proc~state_init&#45;&gt;fname_tshs</title>
<path fill="none" stroke="#000000" d="M200.073,-1164.36C212.127,-1161.71 225.365,-1156.43 233,-1146 306.087,-1046.16 192.729,-130.428 269,-33 276.636,-23.2453 288.434,-17.7929 300.405,-14.8091"/>
<polygon fill="#000000" stroke="#000000" points="301.277,-18.2049 310.415,-12.8431 299.928,-11.3361 301.277,-18.2049"/>
</g>
<!-- delete -->
<g id="proc~~siesta_forces~~CallsGraph_node62" class="node"><title>delete</title>
<polygon fill="#777777" stroke="#777777" points="513.5,-2048 459.5,-2048 459.5,-2024 513.5,-2024 513.5,-2048"/>
<text text-anchor="middle" x="486.5" y="-2033.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">delete</text>
</g>
<!-- proc~state_init&#45;&gt;delete -->
<g id="proc~~siesta_forces~~CallsGraph_edge74" class="edge"><title>proc~state_init&#45;&gt;delete</title>
<path fill="none" stroke="#000000" d="M176.349,-1179.26C186.002,-1221.32 217.72,-1363.67 233,-1483 240.412,-1540.89 229.087,-1964.42 269,-2007 292.817,-2032.41 393.895,-2036.28 449.116,-2036.45"/>
<polygon fill="#000000" stroke="#000000" points="449.191,-2039.95 459.188,-2036.44 449.184,-2032.95 449.191,-2039.95"/>
</g>
<!-- ts_sparse_init -->
<g id="proc~~siesta_forces~~CallsGraph_node63" class="node"><title>ts_sparse_init</title>
<polygon fill="#777777" stroke="#777777" points="384,-1998 305,-1998 305,-1974 384,-1974 384,-1998"/>
<text text-anchor="middle" x="344.5" y="-1983.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ts_sparse_init</text>
</g>
<!-- proc~state_init&#45;&gt;ts_sparse_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge75" class="edge"><title>proc~state_init&#45;&gt;ts_sparse_init</title>
<path fill="none" stroke="#000000" d="M176.322,-1179.27C185.89,-1221.33 217.365,-1363.72 233,-1483 239.98,-1536.25 235.01,-1923.42 269,-1965 275.639,-1973.12 285.155,-1978.24 295.177,-1981.44"/>
<polygon fill="#000000" stroke="#000000" points="294.305,-1984.83 304.863,-1983.95 296.06,-1978.05 294.305,-1984.83"/>
</g>
<!-- numh -->
<g id="proc~~siesta_forces~~CallsGraph_node64" class="node"><title>numh</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1956 317.5,-1956 317.5,-1932 371.5,-1932 371.5,-1956"/>
<text text-anchor="middle" x="344.5" y="-1941.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">numh</text>
</g>
<!-- proc~state_init&#45;&gt;numh -->
<g id="proc~~siesta_forces~~CallsGraph_edge76" class="edge"><title>proc~state_init&#45;&gt;numh</title>
<path fill="none" stroke="#000000" d="M176.291,-1179.27C185.756,-1221.35 216.943,-1363.77 233,-1483 239.547,-1531.61 237.82,-1885.13 269,-1923 278.348,-1934.35 293.318,-1939.84 307.396,-1942.4"/>
<polygon fill="#000000" stroke="#000000" points="307.009,-1945.88 317.395,-1943.78 307.971,-1938.94 307.009,-1945.88"/>
</g>
<!-- domaindecom -->
<g id="proc~~siesta_forces~~CallsGraph_node65" class="node"><title>domaindecom</title>
<polygon fill="#777777" stroke="#777777" points="384.5,-1914 304.5,-1914 304.5,-1890 384.5,-1890 384.5,-1914"/>
<text text-anchor="middle" x="344.5" y="-1899.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">domaindecom</text>
</g>
<!-- proc~state_init&#45;&gt;domaindecom -->
<g id="proc~~siesta_forces~~CallsGraph_edge77" class="edge"><title>proc~state_init&#45;&gt;domaindecom</title>
<path fill="none" stroke="#000000" d="M176.252,-1179.28C185.595,-1221.37 216.432,-1363.84 233,-1483 245.23,-1570.96 212.258,-1812.69 269,-1881 275.504,-1888.83 284.682,-1893.87 294.382,-1897.07"/>
<polygon fill="#000000" stroke="#000000" points="293.61,-1900.49 304.176,-1899.71 295.429,-1893.73 293.61,-1900.49"/>
</g>
<!-- setup_ordern_indexes -->
<g id="proc~~siesta_forces~~CallsGraph_node67" class="node"><title>setup_ordern_indexes</title>
<polygon fill="#777777" stroke="#777777" points="404,-1872 285,-1872 285,-1848 404,-1848 404,-1872"/>
<text text-anchor="middle" x="344.5" y="-1857.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_ordern_indexes</text>
</g>
<!-- proc~state_init&#45;&gt;setup_ordern_indexes -->
<g id="proc~~siesta_forces~~CallsGraph_edge78" class="edge"><title>proc~state_init&#45;&gt;setup_ordern_indexes</title>
<path fill="none" stroke="#000000" d="M176.205,-1179.28C185.395,-1221.4 215.802,-1363.93 233,-1483 244.367,-1561.7 217.872,-1778.1 269,-1839 271.16,-1841.57 273.609,-1843.84 276.269,-1845.85"/>
<polygon fill="#000000" stroke="#000000" points="274.455,-1848.84 284.808,-1851.09 278.116,-1842.87 274.455,-1848.84"/>
</g>
<!-- chess_init -->
<g id="proc~~siesta_forces~~CallsGraph_node68" class="node"><title>chess_init</title>
<polygon fill="#777777" stroke="#777777" points="374.5,-1830 314.5,-1830 314.5,-1806 374.5,-1806 374.5,-1830"/>
<text text-anchor="middle" x="344.5" y="-1815.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">chess_init</text>
</g>
<!-- proc~state_init&#45;&gt;chess_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge79" class="edge"><title>proc~state_init&#45;&gt;chess_init</title>
<path fill="none" stroke="#000000" d="M176.083,-1179C185.005,-1220.78 214.965,-1363.77 233,-1483 243.505,-1552.44 223.48,-1743.51 269,-1797 277.728,-1807.26 291.038,-1812.7 304.006,-1815.53"/>
<polygon fill="#000000" stroke="#000000" points="303.792,-1819.04 314.239,-1817.28 304.972,-1812.14 303.792,-1819.04"/>
</g>
<!-- xij_offset -->
<g id="proc~~siesta_forces~~CallsGraph_node69" class="node"><title>xij_offset</title>
<polygon fill="#777777" stroke="#777777" points="372,-1788 317,-1788 317,-1764 372,-1764 372,-1788"/>
<text text-anchor="middle" x="344.5" y="-1773.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">xij_offset</text>
</g>
<!-- proc~state_init&#45;&gt;xij_offset -->
<g id="proc~~siesta_forces~~CallsGraph_edge80" class="edge"><title>proc~state_init&#45;&gt;xij_offset</title>
<path fill="none" stroke="#000000" d="M176.007,-1179.01C184.68,-1220.83 213.926,-1363.94 233,-1483 242.645,-1543.2 229.08,-1708.91 269,-1755 278.395,-1765.85 292.914,-1771.3 306.648,-1773.97"/>
<polygon fill="#000000" stroke="#000000" points="306.49,-1777.48 316.9,-1775.51 307.532,-1770.56 306.49,-1777.48"/>
</g>
<!-- attach -->
<g id="proc~~siesta_forces~~CallsGraph_node70" class="node"><title>attach</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1746 317.5,-1746 317.5,-1722 371.5,-1722 371.5,-1746"/>
<text text-anchor="middle" x="344.5" y="-1731.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">attach</text>
</g>
<!-- proc~state_init&#45;&gt;attach -->
<g id="proc~~siesta_forces~~CallsGraph_edge81" class="edge"><title>proc~state_init&#45;&gt;attach</title>
<path fill="none" stroke="#000000" d="M175.904,-1179.03C184.24,-1220.9 212.518,-1364.17 233,-1483 241.787,-1533.98 234.668,-1674.3 269,-1713 278.594,-1723.81 293.28,-1729.25 307.085,-1731.91"/>
<polygon fill="#000000" stroke="#000000" points="306.963,-1735.43 317.371,-1733.46 308.001,-1728.51 306.963,-1735.43"/>
</g>
<!-- val -->
<g id="proc~~siesta_forces~~CallsGraph_node71" class="node"><title>val</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1704 317.5,-1704 317.5,-1680 371.5,-1680 371.5,-1704"/>
<text text-anchor="middle" x="344.5" y="-1689.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">val</text>
</g>
<!-- proc~state_init&#45;&gt;val -->
<g id="proc~~siesta_forces~~CallsGraph_edge82" class="edge"><title>proc~state_init&#45;&gt;val</title>
<path fill="none" stroke="#000000" d="M175.846,-1179.44C190.465,-1256.96 268.455,-1670.4 269,-1671 278.693,-1681.58 293.262,-1686.99 306.952,-1689.7"/>
<polygon fill="#000000" stroke="#000000" points="306.736,-1693.21 317.155,-1691.28 307.812,-1686.29 306.736,-1693.21"/>
</g>
<!-- dict_repopulate_md -->
<g id="proc~~siesta_forces~~CallsGraph_node72" class="node"><title>dict_repopulate_md</title>
<polygon fill="#777777" stroke="#777777" points="398,-1662 291,-1662 291,-1638 398,-1638 398,-1662"/>
<text text-anchor="middle" x="344.5" y="-1647.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dict_repopulate_md</text>
</g>
<!-- proc~state_init&#45;&gt;dict_repopulate_md -->
<g id="proc~~siesta_forces~~CallsGraph_edge83" class="edge"><title>proc~state_init&#45;&gt;dict_repopulate_md</title>
<path fill="none" stroke="#000000" d="M175.824,-1179.11C189.667,-1251.14 260.94,-1620.35 269,-1629 272.628,-1632.89 276.917,-1636.09 281.575,-1638.7"/>
<polygon fill="#000000" stroke="#000000" points="280.369,-1642 290.912,-1643.05 283.323,-1635.65 280.369,-1642"/>
</g>
<!-- escf -->
<g id="proc~~siesta_forces~~CallsGraph_node73" class="node"><title>escf</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1620 317.5,-1620 317.5,-1596 371.5,-1596 371.5,-1620"/>
<text text-anchor="middle" x="344.5" y="-1605.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">escf</text>
</g>
<!-- proc~state_init&#45;&gt;escf -->
<g id="proc~~siesta_forces~~CallsGraph_edge86" class="edge"><title>proc~state_init&#45;&gt;escf</title>
<path fill="none" stroke="#000000" d="M175.551,-1179.43C186.594,-1245.73 239.577,-1556.03 269,-1587 278.884,-1597.4 293.484,-1602.78 307.146,-1605.52"/>
<polygon fill="#000000" stroke="#000000" points="306.892,-1609.02 317.318,-1607.13 307.991,-1602.11 306.892,-1609.02"/>
</g>
<!-- new_dm -->
<g id="proc~~siesta_forces~~CallsGraph_node74" class="node"><title>new_dm</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1578 317.5,-1578 317.5,-1554 371.5,-1554 371.5,-1578"/>
<text text-anchor="middle" x="344.5" y="-1563.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">new_dm</text>
</g>
<!-- proc~state_init&#45;&gt;new_dm -->
<g id="proc~~siesta_forces~~CallsGraph_edge85" class="edge"><title>proc~state_init&#45;&gt;new_dm</title>
<path fill="none" stroke="#000000" d="M174.93,-1179.1C182.069,-1237.56 215.659,-1490.18 269,-1545 279.007,-1555.28 293.628,-1560.64 307.272,-1563.4"/>
<polygon fill="#000000" stroke="#000000" points="306.994,-1566.9 317.423,-1565.03 308.107,-1559.98 306.994,-1566.9"/>
</g>
<!-- ts_write_tshs -->
<g id="proc~~siesta_forces~~CallsGraph_node75" class="node"><title>ts_write_tshs</title>
<polygon fill="#777777" stroke="#777777" points="382,-1536 307,-1536 307,-1512 382,-1512 382,-1536"/>
<text text-anchor="middle" x="344.5" y="-1521.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ts_write_tshs</text>
</g>
<!-- proc~state_init&#45;&gt;ts_write_tshs -->
<g id="proc~~siesta_forces~~CallsGraph_edge87" class="edge"><title>proc~state_init&#45;&gt;ts_write_tshs</title>
<path fill="none" stroke="#000000" d="M173.039,-1179.14C171.897,-1227.53 174.343,-1408.55 269,-1503 276.569,-1510.55 286.63,-1515.44 296.903,-1518.59"/>
<polygon fill="#000000" stroke="#000000" points="296.188,-1522.02 306.743,-1521.1 297.922,-1515.23 296.188,-1522.02"/>
</g>
<!-- outcoor -->
<g id="proc~~siesta_forces~~CallsGraph_node78" class="node"><title>outcoor</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1494 317.5,-1494 317.5,-1470 371.5,-1470 371.5,-1494"/>
<text text-anchor="middle" x="344.5" y="-1479.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">outcoor</text>
</g>
<!-- proc~state_init&#45;&gt;outcoor -->
<g id="proc~~siesta_forces~~CallsGraph_edge88" class="edge"><title>proc~state_init&#45;&gt;outcoor</title>
<path fill="none" stroke="#000000" d="M173.613,-1179.15C174.71,-1223.73 184.662,-1379.92 269,-1461 279.267,-1470.87 293.802,-1476.17 307.311,-1478.99"/>
<polygon fill="#000000" stroke="#000000" points="306.909,-1482.47 317.354,-1480.69 308.082,-1475.57 306.909,-1482.47"/>
</g>
<!-- proc~state_init&#45;&gt;volcel -->
<g id="proc~~siesta_forces~~CallsGraph_edge89" class="edge"><title>proc~state_init&#45;&gt;volcel</title>
<path fill="none" stroke="#000000" d="M176.436,-1179.25C186.367,-1221.27 218.874,-1363.53 233,-1483 242.536,-1563.65 218.401,-2149.48 269,-2213 278.163,-2224.5 293.107,-2230.01 307.214,-2232.54"/>
<polygon fill="#000000" stroke="#000000" points="306.863,-2236.03 317.244,-2233.91 307.806,-2229.09 306.863,-2236.03"/>
</g>
<!-- ioxv -->
<g id="proc~~siesta_forces~~CallsGraph_node81" class="node"><title>ioxv</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1452 317.5,-1452 317.5,-1428 371.5,-1428 371.5,-1452"/>
<text text-anchor="middle" x="344.5" y="-1437.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ioxv</text>
</g>
<!-- proc~state_init&#45;&gt;ioxv -->
<g id="proc~~siesta_forces~~CallsGraph_edge90" class="edge"><title>proc~state_init&#45;&gt;ioxv</title>
<path fill="none" stroke="#000000" d="M174.357,-1179.09C177.882,-1219.49 194.829,-1351.05 269,-1419 279.423,-1428.55 293.858,-1433.8 307.249,-1436.66"/>
<polygon fill="#000000" stroke="#000000" points="306.745,-1440.13 317.202,-1438.43 307.965,-1433.24 306.745,-1440.13"/>
</g>
<!-- file_exist -->
<g id="proc~~siesta_forces~~CallsGraph_node82" class="node"><title>file_exist</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1410 317.5,-1410 317.5,-1386 371.5,-1386 371.5,-1410"/>
<text text-anchor="middle" x="344.5" y="-1395.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">file_exist</text>
</g>
<!-- proc~state_init&#45;&gt;file_exist -->
<g id="proc~~siesta_forces~~CallsGraph_edge91" class="edge"><title>proc~state_init&#45;&gt;file_exist</title>
<path fill="none" stroke="#000000" d="M175.371,-1179.08C181.58,-1214.99 204.878,-1321.96 269,-1377 279.725,-1386.21 294.215,-1391.39 307.564,-1394.31"/>
<polygon fill="#000000" stroke="#000000" points="307.002,-1397.76 317.469,-1396.12 308.264,-1390.88 307.002,-1397.76"/>
</g>
<!-- proximity_check -->
<g id="proc~~siesta_forces~~CallsGraph_node83" class="node"><title>proximity_check</title>
<polygon fill="#777777" stroke="#777777" points="389,-1368 300,-1368 300,-1344 389,-1344 389,-1368"/>
<text text-anchor="middle" x="344.5" y="-1353.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">proximity_check</text>
</g>
<!-- proc~state_init&#45;&gt;proximity_check -->
<g id="proc~~siesta_forces~~CallsGraph_edge92" class="edge"><title>proc~state_init&#45;&gt;proximity_check</title>
<path fill="none" stroke="#000000" d="M176.913,-1179.3C186.185,-1210.38 214.85,-1292.6 269,-1335 275.249,-1339.89 282.58,-1343.65 290.161,-1346.53"/>
<polygon fill="#000000" stroke="#000000" points="289.242,-1349.91 299.835,-1349.72 291.44,-1343.26 289.242,-1349.91"/>
</g>
<!-- ucell -->
<g id="proc~~siesta_forces~~CallsGraph_node86" class="node"><title>ucell</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1326 317.5,-1326 317.5,-1302 371.5,-1302 371.5,-1326"/>
<text text-anchor="middle" x="344.5" y="-1311.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ucell</text>
</g>
<!-- proc~state_init&#45;&gt;ucell -->
<g id="proc~~siesta_forces~~CallsGraph_edge101" class="edge"><title>proc~state_init&#45;&gt;ucell</title>
<path fill="none" stroke="#000000" d="M179.261,-1179.14C191.855,-1204.34 224.326,-1262.54 269,-1293 280.301,-1300.71 294.393,-1305.6 307.271,-1308.71"/>
<polygon fill="#000000" stroke="#000000" points="306.751,-1312.18 317.261,-1310.83 308.208,-1305.33 306.751,-1312.18"/>
</g>
<!-- hsparse -->
<g id="proc~~siesta_forces~~CallsGraph_node87" class="node"><title>hsparse</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1284 317.5,-1284 317.5,-1260 371.5,-1260 371.5,-1284"/>
<text text-anchor="middle" x="344.5" y="-1269.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">hsparse</text>
</g>
<!-- proc~state_init&#45;&gt;hsparse -->
<g id="proc~~siesta_forces~~CallsGraph_edge93" class="edge"><title>proc~state_init&#45;&gt;hsparse</title>
<path fill="none" stroke="#000000" d="M183.976,-1179.19C200.321,-1197.44 233.696,-1231.8 269,-1251 280.83,-1257.43 294.814,-1262.05 307.453,-1265.28"/>
<polygon fill="#000000" stroke="#000000" points="306.698,-1268.7 317.234,-1267.59 308.304,-1261.89 306.698,-1268.7"/>
</g>
<!-- newdspdata1d -->
<g id="proc~~siesta_forces~~CallsGraph_node88" class="node"><title>newdspdata1d</title>
<polygon fill="#777777" stroke="#777777" points="385.5,-1242 303.5,-1242 303.5,-1218 385.5,-1218 385.5,-1242"/>
<text text-anchor="middle" x="344.5" y="-1227.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newdspdata1d</text>
</g>
<!-- proc~state_init&#45;&gt;newdspdata1d -->
<g id="proc~~siesta_forces~~CallsGraph_edge94" class="edge"><title>proc~state_init&#45;&gt;newdspdata1d</title>
<path fill="none" stroke="#000000" d="M198.247,-1179.02C217.303,-1188 244.451,-1200.19 269,-1209 276.909,-1211.84 285.399,-1214.54 293.715,-1217.01"/>
<polygon fill="#000000" stroke="#000000" points="292.773,-1220.38 303.352,-1219.79 294.714,-1213.66 292.773,-1220.38"/>
</g>
<!-- write_zmatrix -->
<g id="proc~~siesta_forces~~CallsGraph_node89" class="node"><title>write_zmatrix</title>
<polygon fill="#777777" stroke="#777777" points="382.5,-1200 306.5,-1200 306.5,-1176 382.5,-1176 382.5,-1200"/>
<text text-anchor="middle" x="344.5" y="-1185.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_zmatrix</text>
</g>
<!-- proc~state_init&#45;&gt;write_zmatrix -->
<g id="proc~~siesta_forces~~CallsGraph_edge95" class="edge"><title>proc~state_init&#45;&gt;write_zmatrix</title>
<path fill="none" stroke="#000000" d="M200.062,-1170.28C225.736,-1173.45 265.194,-1178.33 296.232,-1182.16"/>
<polygon fill="#000000" stroke="#000000" points="296.049,-1185.66 306.403,-1183.42 296.907,-1178.72 296.049,-1185.66"/>
</g>
<!-- superc -->
<g id="proc~~siesta_forces~~CallsGraph_node90" class="node"><title>superc</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-1158 317.5,-1158 317.5,-1134 371.5,-1134 371.5,-1158"/>
<text text-anchor="middle" x="344.5" y="-1143.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">superc</text>
</g>
<!-- proc~state_init&#45;&gt;superc -->
<g id="proc~~siesta_forces~~CallsGraph_edge96" class="edge"><title>proc~state_init&#45;&gt;superc</title>
<path fill="none" stroke="#000000" d="M200.062,-1163.72C228.84,-1160.16 274.938,-1154.47 307.082,-1150.5"/>
<polygon fill="#000000" stroke="#000000" points="307.907,-1153.92 317.403,-1149.22 307.049,-1146.98 307.907,-1153.92"/>
</g>
<!-- globalize_or -->
<g id="proc~~siesta_forces~~CallsGraph_node91" class="node"><title>globalize_or</title>
<polygon fill="#777777" stroke="#777777" points="379.5,-1116 309.5,-1116 309.5,-1092 379.5,-1092 379.5,-1116"/>
<text text-anchor="middle" x="344.5" y="-1101.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">globalize_or</text>
</g>
<!-- proc~state_init&#45;&gt;globalize_or -->
<g id="proc~~siesta_forces~~CallsGraph_edge97" class="edge"><title>proc~state_init&#45;&gt;globalize_or</title>
<path fill="none" stroke="#000000" d="M200.288,-1158.75C210.678,-1155.23 222.563,-1150.83 233,-1146 249.808,-1138.22 251.949,-1132.24 269,-1125 278.556,-1120.94 289.128,-1117.42 299.234,-1114.48"/>
<polygon fill="#000000" stroke="#000000" points="300.427,-1117.79 309.129,-1111.74 298.557,-1111.04 300.427,-1117.79"/>
</g>
<!-- setup_dmhs_netcdf_file -->
<g id="proc~~siesta_forces~~CallsGraph_node92" class="node"><title>setup_dmhs_netcdf_file</title>
<polygon fill="#777777" stroke="#777777" points="407.5,-1074 281.5,-1074 281.5,-1050 407.5,-1050 407.5,-1074"/>
<text text-anchor="middle" x="344.5" y="-1059.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_dmhs_netcdf_file</text>
</g>
<!-- proc~state_init&#45;&gt;setup_dmhs_netcdf_file -->
<g id="proc~~siesta_forces~~CallsGraph_edge98" class="edge"><title>proc~state_init&#45;&gt;setup_dmhs_netcdf_file</title>
<path fill="none" stroke="#000000" d="M200.157,-1161.92C211.239,-1158.77 223.665,-1153.79 233,-1146 257.759,-1125.34 243.587,-1102.85 269,-1083 270.85,-1081.55 272.794,-1080.21 274.811,-1078.96"/>
<polygon fill="#000000" stroke="#000000" points="276.875,-1081.82 284.056,-1074.03 273.585,-1075.64 276.875,-1081.82"/>
</g>
<!-- ts_tri_analyze -->
<g id="proc~~siesta_forces~~CallsGraph_node93" class="node"><title>ts_tri_analyze</title>
<polygon fill="#777777" stroke="#777777" points="384,-1032 305,-1032 305,-1008 384,-1008 384,-1032"/>
<text text-anchor="middle" x="344.5" y="-1017.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ts_tri_analyze</text>
</g>
<!-- proc~state_init&#45;&gt;ts_tri_analyze -->
<g id="proc~~siesta_forces~~CallsGraph_edge99" class="edge"><title>proc~state_init&#45;&gt;ts_tri_analyze</title>
<path fill="none" stroke="#000000" d="M200.299,-1162.89C211.673,-1159.91 224.287,-1154.79 233,-1146 267.727,-1110.96 233.161,-1074.9 269,-1041 276.173,-1034.21 285.366,-1029.59 294.828,-1026.46"/>
<polygon fill="#000000" stroke="#000000" points="296.024,-1029.76 304.713,-1023.69 294.139,-1023.01 296.024,-1029.76"/>
</g>
<!-- normalize_dm -->
<g id="proc~~siesta_forces~~CallsGraph_node94" class="node"><title>normalize_dm</title>
<polygon fill="#777777" stroke="#777777" points="384.5,-990 304.5,-990 304.5,-966 384.5,-966 384.5,-990"/>
<text text-anchor="middle" x="344.5" y="-975.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">normalize_dm</text>
</g>
<!-- proc~state_init&#45;&gt;normalize_dm -->
<g id="proc~~siesta_forces~~CallsGraph_edge100" class="edge"><title>proc~state_init&#45;&gt;normalize_dm</title>
<path fill="none" stroke="#000000" d="M200.071,-1163.4C211.679,-1160.52 224.544,-1155.34 233,-1146 278.148,-1096.14 222.267,-1047.38 269,-999 275.86,-991.898 284.919,-987.144 294.351,-983.973"/>
<polygon fill="#000000" stroke="#000000" points="295.547,-987.273 304.237,-981.211 293.664,-980.531 295.547,-987.273"/>
</g>
<!-- proc~state_init&#45;&gt;proc~mixers_history_init -->
<g id="proc~~siesta_forces~~CallsGraph_edge102" class="edge"><title>proc~state_init&#45;&gt;proc~mixers_history_init</title>
<path fill="none" stroke="#000000" d="M176.39,-1179.26C186.174,-1221.3 218.261,-1363.6 233,-1483 241.237,-1549.72 226.842,-2034.63 269,-2087 273.147,-2092.15 278.454,-2096.1 284.321,-2099.11"/>
<polygon fill="#000000" stroke="#000000" points="283.338,-2102.5 293.914,-2103.12 286.038,-2096.04 283.338,-2102.5"/>
</g>
<!-- newdspdata2d -->
<g id="proc~~siesta_forces~~CallsGraph_node97" class="node"><title>newdspdata2d</title>
<polygon fill="#777777" stroke="#777777" points="385.5,-948 303.5,-948 303.5,-924 385.5,-924 385.5,-948"/>
<text text-anchor="middle" x="344.5" y="-933.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newdspdata2d</text>
</g>
<!-- proc~state_init&#45;&gt;newdspdata2d -->
<g id="proc~~siesta_forces~~CallsGraph_edge103" class="edge"><title>proc~state_init&#45;&gt;newdspdata2d</title>
<path fill="none" stroke="#000000" d="M200.295,-1163.6C211.949,-1160.76 224.79,-1155.55 233,-1146 288.73,-1081.14 211.207,-1020.02 269,-957 275.539,-949.87 284.291,-945.089 293.496,-941.9"/>
<polygon fill="#000000" stroke="#000000" points="294.531,-945.245 303.178,-939.122 292.6,-938.516 294.531,-945.245"/>
</g>
<!-- mscell -->
<g id="proc~~siesta_forces~~CallsGraph_node98" class="node"><title>mscell</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-906 317.5,-906 317.5,-882 371.5,-882 371.5,-906"/>
<text text-anchor="middle" x="344.5" y="-891.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mscell</text>
</g>
<!-- proc~state_init&#45;&gt;mscell -->
<g id="proc~~siesta_forces~~CallsGraph_edge104" class="edge"><title>proc~state_init&#45;&gt;mscell</title>
<path fill="none" stroke="#000000" d="M200.137,-1163.8C211.904,-1161 224.882,-1155.78 233,-1146 299.384,-1066.07 200.071,-992.751 269,-915 278.59,-904.182 293.276,-898.748 307.082,-896.083"/>
<polygon fill="#000000" stroke="#000000" points="307.998,-899.485 317.368,-894.541 306.96,-892.562 307.998,-899.485"/>
</g>
<!-- time_io -->
<g id="proc~~siesta_forces~~CallsGraph_node99" class="node"><title>time_io</title>
<polygon fill="#777777" stroke="#777777" points="371.5,-864 317.5,-864 317.5,-840 371.5,-840 371.5,-864"/>
<text text-anchor="middle" x="344.5" y="-849.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">time_io</text>
</g>
<!-- proc~state_init&#45;&gt;time_io -->
<g id="proc~~siesta_forces~~CallsGraph_edge105" class="edge"><title>proc~state_init&#45;&gt;time_io</title>
<path fill="none" stroke="#000000" d="M200.241,-1163.88C212.03,-1161.11 224.997,-1155.87 233,-1146 310.078,-1050.94 188.895,-965.525 269,-873 278.555,-861.963 293.416,-856.512 307.359,-853.893"/>
<polygon fill="#000000" stroke="#000000" points="307.872,-857.356 317.261,-852.447 306.86,-850.429 307.872,-857.356"/>
</g>
<!-- proc~mixers_history_init&#45;&gt;delete -->
<g id="proc~~siesta_forces~~CallsGraph_edge107" class="edge"><title>proc~mixers_history_init&#45;&gt;delete</title>
<path fill="none" stroke="#000000" d="M395.013,-2096.96C403.566,-2094.24 412.205,-2090.94 420,-2087 436.511,-2078.65 452.933,-2065.85 465.205,-2055.16"/>
<polygon fill="#000000" stroke="#000000" points="467.88,-2057.46 472.987,-2048.18 463.206,-2052.25 467.88,-2057.46"/>
</g>
<!-- proc~current_itt -->
<g id="proc~~siesta_forces~~CallsGraph_node100" class="node"><title>proc~current_itt</title>
<g id="a_proc~~siesta_forces~~CallsGraph_node100"><a xlink:href=".././proc/current_itt.html" xlink:title="current_itt">
<polygon fill="#d94e8f" stroke="#d94e8f" points="517,-2110 456,-2110 456,-2086 517,-2086 517,-2110"/>
<text text-anchor="middle" x="486.5" y="-2095.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">current_itt</text>
</a>
</g>
</g>
<!-- proc~mixers_history_init&#45;&gt;proc~current_itt -->
<g id="proc~~siesta_forces~~CallsGraph_edge106" class="edge"><title>proc~mixers_history_init&#45;&gt;proc~current_itt</title>
<path fill="none" stroke="#000000" d="M395.253,-2104.45C411.728,-2103.27 429.841,-2101.98 445.488,-2100.86"/>
<polygon fill="#000000" stroke="#000000" points="446.151,-2104.32 455.876,-2100.12 445.652,-2097.34 446.151,-2104.32"/>
</g>
<!-- new -->
<g id="proc~~siesta_forces~~CallsGraph_node101" class="node"><title>new</title>
<polygon fill="#777777" stroke="#777777" points="513.5,-2152 459.5,-2152 459.5,-2128 513.5,-2128 513.5,-2152"/>
<text text-anchor="middle" x="486.5" y="-2137.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">new</text>
</g>
<!-- proc~mixers_history_init&#45;&gt;new -->
<g id="proc~~siesta_forces~~CallsGraph_edge108" class="edge"><title>proc~mixers_history_init&#45;&gt;new</title>
<path fill="none" stroke="#000000" d="M395.253,-2119.37C413.217,-2123.48 433.127,-2128.03 449.665,-2131.81"/>
<polygon fill="#000000" stroke="#000000" points="448.951,-2135.24 459.48,-2134.05 450.511,-2128.41 448.951,-2135.24"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,-0 64,-0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,-0 136,-0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node"><title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,-0 209.5,-0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node"><title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,-0 364,-0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,-0 436,-0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="551.5,-24 454.5,-24 454.5,-0 551.5,-0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      




















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/siesta_forces.html#src">siesta_forces</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>  <span class="k">subroutine </span><span class="n">siesta_forces</span><span class="p">(</span><span class="n">istep</span><span class="p">)</span>
  <span class="c">!! This subroutine represents central SIESTA operation logic.</span>

<span class="cp">#ifdef MPI</span>
    <span class="k">use </span><span class="n">mpi_siesta</span>
<span class="cp">#endif</span>
    <span class="k">use </span><span class="n">units</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">eV</span><span class="p">,</span> <span class="n">Ang</span>
    <span class="k">use </span><span class="nb">precision</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">dp</span>
    <span class="k">use </span><span class="n">sys</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">bye</span>

    <span class="k">use </span><span class="n">files</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">slabel</span>
    <span class="k">use </span><span class="n">siesta_cml</span>
<span class="cp">#ifdef SIESTA__FLOOK</span>
    <span class="k">use </span><span class="n">flook_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">slua_call</span>
    <span class="k">use </span><span class="n">flook_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">LUA_INIT_MD</span><span class="p">,</span> <span class="n">LUA_SCF_LOOP</span>
    <span class="k">use </span><span class="n">siesta_dicts</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">dict_variable_add</span>
    <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ts_scf_mixs</span>
    <span class="k">use </span><span class="n">variable</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cunpack</span>
<span class="cp">#ifndef NCDF_4</span>
    <span class="k">use </span><span class="n">dictionary</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="k">assign</span>
<span class="cp">#endif</span>
    <span class="k">use </span><span class="n">m_mixing</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">mixers_history_init</span>
<span class="cp">#endif</span>
    <span class="k">use </span><span class="n">m_state_init</span>
    <span class="k">use </span><span class="n">m_setup_hamiltonian</span>
    <span class="k">use </span><span class="n">m_setup_H0</span>
    <span class="k">use </span><span class="n">m_compute_dm</span>
    <span class="k">use </span><span class="n">m_compute_max_diff</span>
    <span class="k">use </span><span class="n">m_scfconvergence_test</span>
    <span class="k">use </span><span class="n">m_post_scf_work</span>
    <span class="k">use </span><span class="n">m_mixer</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">mixer</span>
    <span class="k">use </span><span class="n">m_mixing_scf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">mixing_scf_converged</span>
    <span class="k">use </span><span class="n">m_mixing_scf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">mixers_scf_history_init</span>
    <span class="k">use </span><span class="n">m_mixing_scf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">scf_mixs</span><span class="p">,</span> <span class="n">scf_mix</span>

    <span class="k">use </span><span class="n">m_rhog</span><span class="p">,</span>                <span class="n">only</span><span class="p">:</span> <span class="n">mix_rhog</span><span class="p">,</span> <span class="n">compute_charge_diff</span>
    <span class="k">use </span><span class="n">siesta_options</span>
    <span class="k">use </span><span class="n">parallel</span><span class="p">,</span>     <span class="n">only</span> <span class="p">:</span> <span class="n">IOnode</span><span class="p">,</span> <span class="n">SIESTA_worker</span>
    <span class="k">use </span><span class="n">m_state_analysis</span>
    <span class="k">use </span><span class="n">m_steps</span>
    <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>                <span class="n">only</span><span class="p">:</span> <span class="n">spin</span>
    <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">DM_2D</span><span class="p">,</span> <span class="n">S_1D</span>
    <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">H</span><span class="p">,</span> <span class="n">Hold</span><span class="p">,</span> <span class="n">Dold</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">Eold</span><span class="p">,</span> <span class="n">Escf</span><span class="p">,</span> <span class="n">maxnh</span>
    <span class="k">use </span><span class="n">m_convergence</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">converger_t</span>
    <span class="k">use </span><span class="n">m_convergence</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">reset</span><span class="p">,</span> <span class="n">set_tolerance</span>
    <span class="k">use </span><span class="n">siesta_geom</span><span class="p">,</span>   <span class="n">only</span><span class="p">:</span> <span class="n">na_u</span>           <span class="c">! Number of atoms in unit cell</span>
    <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span>    <span class="n">only</span><span class="p">:</span> <span class="n">Etot</span>           <span class="c">! Total energy</span>
    <span class="k">use </span><span class="n">m_forces</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">fa</span><span class="p">,</span> <span class="n">cfa</span>        <span class="c">! Forces and constrained forces</span>
    <span class="k">use </span><span class="n">m_stress</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">cstress</span>        <span class="c">! Constrained stress tensor</span>
    <span class="k">use </span><span class="n">siesta_master</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">forcesToMaster</span> <span class="c">! Send forces to master prog</span>
    <span class="k">use </span><span class="n">siesta_master</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">siesta_server</span>  <span class="c">! Is siesta a server?</span>
    <span class="k">use </span><span class="n">m_save_density_matrix</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">save_density_matrix</span>
    <span class="k">use </span><span class="n">m_iodm_old</span><span class="p">,</span>    <span class="n">only</span><span class="p">:</span> <span class="n">write_spmatrix</span>

    <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">Qtot</span>
    <span class="k">use </span><span class="n">m_dm_charge</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">dm_charge</span>

    <span class="k">use </span><span class="n">m_pexsi_solver</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">prevDmax</span>
    <span class="k">use </span><span class="n">write_subs</span><span class="p">,</span>            <span class="n">only</span><span class="p">:</span> <span class="n">siesta_write_forces</span>
    <span class="k">use </span><span class="n">write_subs</span><span class="p">,</span>            <span class="n">only</span><span class="p">:</span> <span class="n">siesta_write_stress_pressure</span>

<span class="cp">#ifdef NCDF_4</span>
    <span class="k">use </span><span class="n">dictionary</span>
    <span class="k">use </span><span class="n">m_ncdf_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cdf_init_file</span><span class="p">,</span> <span class="n">cdf_save_settings</span>
    <span class="k">use </span><span class="n">m_ncdf_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">cdf_save_state</span><span class="p">,</span> <span class="n">cdf_save_basis</span>
<span class="cp">#endif</span>
    <span class="k">use </span><span class="n">m_compute_energies</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">compute_energies</span>

    <span class="k">use </span><span class="n">m_mpi_utils</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">broadcast</span>
    <span class="k">use </span><span class="n">fdf</span>
<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="k">use </span><span class="n">m_pexsi</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">pexsi_finalize_scfloop</span>
<span class="cp">#endif</span>
    <span class="k">use </span><span class="n">m_check_walltime</span>

    <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">DE_NEGF</span>
    <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">N_Elec</span>
    <span class="k">use </span><span class="n">m_ts_method</span>
    <span class="k">use </span><span class="n">m_ts_global_vars</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">TSmode</span><span class="p">,</span> <span class="n">TSinit</span><span class="p">,</span> <span class="n">TSrun</span>
    <span class="k">use </span><span class="n">siesta_geom</span><span class="p">,</span>           <span class="n">only</span><span class="p">:</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">isc_off</span>
    <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">sparse_pattern</span><span class="p">,</span> <span class="n">block_dist</span>
    <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">S</span>
    <span class="k">use </span><span class="n">m_ts_charge</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ts_get_charges</span>
    <span class="k">use </span><span class="n">m_ts_charge</span><span class="p">,</span>           <span class="n">only</span><span class="p">:</span> <span class="n">TS_RHOCORR_METHOD</span>
    <span class="k">use </span><span class="n">m_ts_charge</span><span class="p">,</span>           <span class="n">only</span><span class="p">:</span> <span class="n">TS_RHOCORR_FERMI</span>
    <span class="k">use </span><span class="n">m_ts_charge</span><span class="p">,</span>           <span class="n">only</span><span class="p">:</span> <span class="n">TS_RHOCORR_FERMI_TOLERANCE</span>
    <span class="k">use </span><span class="n">m_transiesta</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">transiesta</span>
    <span class="k">use </span><span class="n">kpoint_grid</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">gamma_scf</span>
    <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">Ef</span>

    <span class="k">use </span><span class="n">m_initwf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">initwf</span>

    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">istep</span>

    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">iscf</span>
    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">first_scf</span><span class="p">,</span> <span class="n">SCFconverged</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dDmax</span> <span class="c">! Max. change in DM elements</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dHmax</span> <span class="c">! Max. change in H elements</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dEmax</span> <span class="c">! Max. change in EDM elements</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">drhog</span> <span class="c">! Max. change in rho(G) (experimental)</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">G2max</span> <span class="c">! actually used meshcutoff</span>
    <span class="k">type</span><span class="p">(</span><span class="n">converger_t</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">conv_harris</span><span class="p">,</span> <span class="n">conv_freeE</span>

    <span class="c">! For initwf</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">istpp</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
    <span class="c">! len=24 from m_mixing.F90</span>
    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="k">target</span> <span class="kd">::</span> <span class="n">next_mixer</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nnext_mixer</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">imix</span>
<span class="cp">#endif</span>

    <span class="kt">logical</span>               <span class="kd">::</span> <span class="n">time_is_up</span>
    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">tmp_str</span>

    <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Qcur</span>
<span class="cp">#ifdef NCDF_4</span>
    <span class="k">type</span><span class="p">(</span><span class="n">dict</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d_sav</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef MPI</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">MPIerror</span>
<span class="cp">#endif</span>

    <span class="k">external</span> <span class="kd">::</span> <span class="n">die</span><span class="p">,</span> <span class="n">message</span>

<span class="cp">#ifdef DEBUG</span>
    <span class="k">call </span><span class="n">write_debug</span><span class="p">(</span> <span class="s1">&#39;    PRE siesta_forces&#39;</span> <span class="p">)</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="c">! Broadcast relevant things for program logic</span>
    <span class="c">! These were set in read_options, called only by &quot;SIESTA_workers&quot;.</span>
    <span class="k">call </span><span class="n">broadcast</span><span class="p">(</span><span class="n">nscf</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="n">true_MPI_Comm_World</span><span class="p">)</span>
<span class="cp">#endif</span>

    <span class="c">!! Initialization tasks for a given geometry:</span>
    <span class="c">!!@code</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">SIESTA_worker</span> <span class="p">)</span>  <span class="k">then</span>
<span class="k">       call </span><span class="n">state_init</span><span class="p">(</span> <span class="n">istep</span> <span class="p">)</span>
    <span class="k">end if</span>
    <span class="c">!!@endcode</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">call </span><span class="n">memory_snapshot</span><span class="p">(</span><span class="s2">&quot;after state_init&quot;</span><span class="p">)</span>
<span class="cp">#endif</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;Sonly&quot;</span><span class="p">,.</span><span class="n">false</span><span class="p">.)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       if</span> <span class="p">(</span> <span class="n">SIESTA_worker</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
          <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
       <span class="k">end if</span>
<span class="k">       call </span><span class="n">bye</span><span class="p">(</span><span class="s2">&quot;S only&quot;</span><span class="p">)</span>
    <span class="k">end if</span>

<span class="k">    </span><span class="n">Qcur</span> <span class="o">=</span> <span class="n">Qtot</span>
    
<span class="cp">#ifdef SIESTA__FLOOK</span>
    <span class="c">! Add the iscf constant to the list of variables</span>
    <span class="c">! that are available only in this part of the routine.</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.iteration&#39;</span><span class="p">,</span><span class="n">iscf</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.converged&#39;</span><span class="p">,</span><span class="n">SCFconverged</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.charge&#39;</span><span class="p">,</span><span class="n">Qcur</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.dD&#39;</span><span class="p">,</span><span class="n">dDmax</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.dH&#39;</span><span class="p">,</span><span class="n">dHmax</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.dE&#39;</span><span class="p">,</span><span class="n">dEmax</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.drhoG&#39;</span><span class="p">,</span><span class="n">drhog</span><span class="p">)</span>
    <span class="c">! We have to set the meshcutoff here</span>
    <span class="c">! because the asked and required ones are not</span>
    <span class="c">! necessarily the same</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;Mesh.Cutoff.Minimum&#39;</span><span class="p">,</span><span class="n">G2cut</span><span class="p">)</span>
    <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;Mesh.Cutoff.Used&#39;</span><span class="p">,</span><span class="n">G2max</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">      call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Weight&#39;</span><span class="p">,</span> <span class="n">wmix</span><span class="p">)</span>
    <span class="k">else</span>
<span class="k">      call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Weight&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">w</span><span class="p">)</span>
      <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Restart&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">restart</span><span class="p">)</span>
      <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Iterations&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">n_itt</span><span class="p">)</span>
      
      <span class="c">! Just to populate the table in the dictionary</span>
      <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Switch&#39;</span><span class="p">,</span><span class="n">next_mixer</span><span class="p">)</span>
    <span class="k">end if</span>

    <span class="c">! Initialize to no switch</span>
    <span class="n">next_mixer</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
<span class="cp">#endif</span>

    <span class="c">!* This call computes the **non-scf** part of \( H \) and initializes the</span>
    <span class="c">!  real-space grid structures:</span>
    <span class="c">!!@code</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">SIESTA_worker</span> <span class="p">)</span> <span class="k">call </span><span class="n">setup_H0</span><span class="p">(</span><span class="n">G2max</span><span class="p">)</span>
    <span class="c">!!@endcode</span>
    <span class="c">!!@todo</span>
    <span class="c">!* It might be better to split the two,</span>
    <span class="c">!  putting the grid initialization into **state_init (link!)** and moving the</span>
    <span class="c">!  calculation of \( H_0 \) to the body of the loop, done `if first_scf=.true.`</span>
    <span class="c">!  This would suit _analysis_ runs in which **nscf = 0**</span>
    <span class="c">!!@endtodo</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">call </span><span class="n">memory_snapshot</span><span class="p">(</span><span class="s2">&quot;after setup_H0&quot;</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
    <span class="c">! Communicate with lua, just before entering the SCF loop</span>
    <span class="c">! This is mainly to be able to communicate</span>
    <span class="c">! mesh-related quantities (g2max)</span>
    <span class="k">call </span><span class="n">slua_call</span><span class="p">(</span><span class="n">LUA</span><span class="p">,</span> <span class="n">LUA_INIT_MD</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef NCDF_4</span>
    <span class="c">! Initialize the NC file</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">write_cdf</span> <span class="p">)</span> <span class="k">then</span>

       <span class="c">! Initialize the file...</span>
       <span class="k">call </span><span class="n">cdf_init_file</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span><span class="n">is_MD</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.)</span>
<span class="cp">#ifdef MPI</span>
       <span class="k">call </span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_Comm_World</span><span class="p">,</span><span class="n">MPIerror</span><span class="p">)</span>
<span class="cp">#endif</span>

       <span class="c">! Save the settings</span>
       <span class="k">call </span><span class="n">cdf_save_settings</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.nc&#39;</span><span class="p">)</span>
<span class="cp">#ifdef MPI</span>
       <span class="k">call </span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_Comm_World</span><span class="p">,</span><span class="n">MPIerror</span><span class="p">)</span>
<span class="cp">#endif</span>
       
       <span class="n">d_sav</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;sp&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
       <span class="n">d_sav</span> <span class="o">=</span> <span class="n">d_sav</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;nsc&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;xij&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
       <span class="n">d_sav</span> <span class="o">=</span> <span class="n">d_sav</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;xa&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;cell&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
       <span class="n">d_sav</span> <span class="o">=</span> <span class="n">d_sav</span><span class="o">//</span><span class="p">(</span><span class="s1">&#39;isc_off&#39;</span><span class="p">.</span><span class="n">kv</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span>
       <span class="k">call </span><span class="n">cdf_save_state</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span><span class="n">d_sav</span><span class="p">)</span>
       <span class="k">call </span><span class="n">delete</span><span class="p">(</span><span class="n">d_sav</span><span class="p">)</span>

       <span class="c">! Save the basis set</span>
       <span class="k">call </span><span class="n">cdf_save_basis</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.nc&#39;</span><span class="p">)</span>

    <span class="k">end if</span>
<span class="cp">#endif</span>

    <span class="c">!* The dHmax variable only has meaning for Hamiltonian</span>
    <span class="c">!  mixing, or when requiring the Hamiltonian to be converged.</span>
    <span class="n">dDmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1._dp</span>
    <span class="n">dHmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1._dp</span>
    <span class="n">dEmax</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1._dp</span>
    <span class="n">drhog</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1._dp</span>

    <span class="c">! Setup convergence criteria:</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">SIESTA_worker</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       if</span> <span class="p">(</span> <span class="n">converge_Eharr</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">reset</span><span class="p">(</span><span class="n">conv_harris</span><span class="p">)</span>
          <span class="k">call </span><span class="n">set_tolerance</span><span class="p">(</span><span class="n">conv_harris</span><span class="p">,</span><span class="n">tolerance_Eharr</span><span class="p">)</span>
       <span class="k">end if</span>
<span class="k">       if</span> <span class="p">(</span> <span class="n">converge_FreeE</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">reset</span><span class="p">(</span><span class="n">conv_FreeE</span><span class="p">)</span>
          <span class="k">call </span><span class="n">set_tolerance</span><span class="p">(</span><span class="n">conv_FreeE</span><span class="p">,</span><span class="n">tolerance_FreeE</span><span class="p">)</span>
       <span class="k">end if</span>
<span class="k">    end if</span>

    <span class="c">!!# SCF loop</span>
    <span class="c">!* The current structure of the loop tries to reproduce the</span>
    <span class="c">!  historical Siesta usage. It should be made more clear.</span>

    <span class="c">!* Two changes:</span>
    <span class="c">!</span>
    <span class="c">!  1. The number of scf iterations performed is exactly</span>
    <span class="c">!     equal to the number specified (i.e., the &quot;forces&quot;</span>
    <span class="c">!     phase is not counted as a final scf step)</span>
    <span class="c">!  2. At the change to a TranSiesta GF run the variable &quot;first_scf&quot;</span>
    <span class="c">!     is implicitly reset to &quot;true&quot;.</span>
    <span class="c">!</span>

    <span class="c">!!## Start of SCF cycle</span>
    <span class="c">!</span>
    <span class="c">!* Conditions of exit:</span>
    <span class="c">!</span>
    <span class="c">!  * At the top, to catch a non-positive nscf and # of iterations</span>
    <span class="c">!  * At the bottom, based on convergence</span>
    <span class="c">!</span>
    <span class="c">!!@code</span>
    <span class="n">iscf</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">do while</span> <span class="p">(</span> <span class="n">iscf</span> <span class="o">&lt;</span> <span class="n">nscf</span> <span class="p">)</span>
    <span class="c">!!@endcode</span>

       <span class="n">iscf</span> <span class="o">=</span> <span class="n">iscf</span> <span class="o">+</span> <span class="mi">1</span>

       <span class="c">!* Note implications for TranSiesta when mixing \(H\).</span>
       <span class="c">!  Now \(H\) will be recomputed instead of simply being</span>
       <span class="c">!  inherited, however, this is required as if</span>
       <span class="c">!  we have bias calculations as the electric</span>
       <span class="c">!  field across the junction needs to be present.</span>

       <span class="n">first_scf</span> <span class="o">=</span> <span class="p">(</span><span class="n">iscf</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

       <span class="k">if</span> <span class="p">(</span> <span class="n">SIESTA_worker</span> <span class="p">)</span> <span class="k">then</span>

          <span class="c">! Check whether we are short of time to continue</span>
          <span class="k">call </span><span class="n">check_walltime</span><span class="p">(</span><span class="n">time_is_up</span><span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">time_is_up</span> <span class="p">)</span> <span class="k">then</span>
             <span class="c">! Save DM/H if we were not saving it...</span>
             <span class="c">! Do any other bookeeping not done by &quot;die&quot;</span>
             <span class="k">call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;WARNING&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                  <span class="s1">&#39;SCF_NOT_CONV: SCF did not converge&#39;</span><span class="o">//</span> <span class="p">&amp;</span>
                  <span class="s1">&#39; before wall time exhaustion&#39;</span><span class="p">)</span>
             <span class="k">write</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">,</span><span class="s2">&quot;(2(i5,tr1),f12.6)&quot;</span><span class="p">)</span> <span class="n">istep</span><span class="p">,</span> <span class="n">iscf</span><span class="p">,</span> <span class="n">prevDmax</span>
             <span class="k">call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39; (info)&#39;</span><span class="p">,</span><span class="s2">&quot;Geom step, scf iteration, dmax:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">))</span>

             <span class="k">call </span><span class="n">die</span><span class="p">(</span><span class="s2">&quot;OUT_OF_TIME: Time is up.&quot;</span><span class="p">)</span>

          <span class="k">end if</span>

<span class="k">          call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;IterSCF&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="p">&amp;</span>
               <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span> <span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">iscf</span> <span class="p">)</span>

          <span class="k">if</span> <span class="p">(</span> <span class="n">mixH</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">             if</span> <span class="p">(</span> <span class="n">first_scf</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                if</span> <span class="p">(</span><span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;Read-H-from-file&quot;</span><span class="p">,.</span><span class="n">false</span><span class="p">.))</span> <span class="k">then</span>
<span class="k">                   call </span><span class="n">get_H_from_file</span><span class="p">()</span>
                <span class="k">else</span>
<span class="k">                   call </span><span class="n">setup_hamiltonian</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
                <span class="k">end if</span>
<span class="k">             end if</span>

<span class="k">             call </span><span class="n">compute_DM</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>

             <span class="c">! Maybe set Dold to zero if reading charge or H...</span>
             <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Dold</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">dDmax</span><span class="p">)</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">converge_EDM</span> <span class="p">)</span> <span class="p">&amp;</span>
                  <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Eold</span><span class="p">,</span> <span class="n">Escf</span><span class="p">,</span> <span class="n">dEmax</span><span class="p">)</span>
             <span class="k">call </span><span class="n">setup_hamiltonian</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
             <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Hold</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dHmax</span><span class="p">)</span>

          <span class="k">else</span>

<span class="k">             call </span><span class="n">setup_hamiltonian</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
             <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Hold</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dHmax</span><span class="p">)</span>

             <span class="k">call </span><span class="n">compute_DM</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>

             <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Dold</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">dDmax</span><span class="p">)</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">converge_EDM</span> <span class="p">)</span> <span class="p">&amp;</span>
                  <span class="k">call </span><span class="n">compute_max_diff</span><span class="p">(</span><span class="n">Eold</span><span class="p">,</span> <span class="n">Escf</span><span class="p">,</span> <span class="n">dEmax</span><span class="p">)</span>

          <span class="k">end if</span>

          <span class="c">! This iteration has completed calculating the new DM</span>

          <span class="k">call </span><span class="n">compute_energies</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             call </span><span class="n">compute_charge_diff</span><span class="p">(</span> <span class="n">drhog</span> <span class="p">)</span>
          <span class="k">end if</span>

          <span class="c">! Note: For DM and H convergence checks. At this point:</span>
          <span class="c">! If mixing the DM:</span>
          <span class="c">!        Dscf=DM_out, Dold=DM_in(mixed), H=H_in, Hold=H_in(prev step)</span>
          <span class="c">!        dDmax=maxdiff(DM_out,DM_in)</span>
          <span class="c">!        dHmax=maxdiff(H_in - H_in(prev step))</span>
          <span class="c">! If mixing the Hamiltonian:</span>
          <span class="c">!        Dscf=DM_out, Dold=DM_in, H=H_(DM_out), Hold=H_in(mixed)</span>
          <span class="c">!        dDmax=maxdiff(DM_out,DM_in)</span>
          <span class="c">!        dHmax=maxdiff(H(DM_out),H_in)</span>
          <span class="k">call </span><span class="n">scfconvergence_test</span><span class="p">(</span> <span class="n">first_scf</span><span class="p">,</span> <span class="n">iscf</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">dDmax</span><span class="p">,</span> <span class="n">dHmax</span><span class="p">,</span> <span class="n">dEmax</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">conv_harris</span><span class="p">,</span> <span class="n">conv_freeE</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="n">SCFconverged</span> <span class="p">)</span>

          <span class="c">! ** Check this heuristic</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">mixH</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             </span><span class="n">prevDmax</span> <span class="o">=</span> <span class="n">dHmax</span>
          <span class="k">else</span>
<span class="k">             </span><span class="n">prevDmax</span> <span class="o">=</span> <span class="n">dDmax</span>
          <span class="k">end if</span>

          <span class="c">! Calculate current charge based on the density matrix</span>
          <span class="k">call </span><span class="n">dm_charge</span><span class="p">(</span><span class="n">spin</span><span class="p">,</span> <span class="n">DM_2D</span><span class="p">,</span> <span class="n">S_1D</span><span class="p">,</span> <span class="n">Qcur</span><span class="p">)</span>


          <span class="c">! Check whether we should step to the next mixer</span>
          <span class="k">call </span><span class="n">mixing_scf_converged</span><span class="p">(</span> <span class="n">SCFconverged</span> <span class="p">)</span>

          <span class="k">if</span> <span class="p">(</span> <span class="n">SCFconverged</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">iscf</span> <span class="o">&lt;</span> <span class="n">min_nscf</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             </span><span class="n">SCFconverged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="p">&amp;</span>
                     <span class="s2">&quot;SCF cycle continued for minimum number of iterations: &quot;</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">min_nscf</span>
             <span class="k">end if</span>
<span class="k">          end if</span>

          <span class="c">! In case the user has requested a Fermi-level correction</span>
          <span class="c">! Then we start by correcting the fermi-level</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">TSrun</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">SCFconverged</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
               <span class="n">TS_RHOCORR_METHOD</span> <span class="o">==</span> <span class="n">TS_RHOCORR_FERMI</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">             if</span> <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Qcur</span> <span class="o">-</span> <span class="n">Qtot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TS_RHOCORR_FERMI_TOLERANCE</span> <span class="p">)</span> <span class="k">then</span>

                <span class="c">! Call transiesta with fermi-correct</span>
                <span class="k">call </span><span class="n">transiesta</span><span class="p">(</span><span class="n">iscf</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">block_dist</span><span class="p">,</span> <span class="n">sparse_pattern</span><span class="p">,</span> <span class="n">Gamma_Scf</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">isc_off</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">Dscf</span><span class="p">,</span> <span class="n">Escf</span><span class="p">,</span> <span class="n">Ef</span><span class="p">,</span> <span class="n">Qtot</span><span class="p">,</span> <span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">DE_NEGF</span><span class="p">)</span>

                <span class="c">! We will not have not converged as we have just</span>
                <span class="c">! changed the Fermi-level</span>
                <span class="n">SCFconverged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>

             <span class="k">end if</span>

<span class="k">          end if</span>

<span class="k">          if</span> <span class="p">(</span> <span class="n">monitor_forces_in_scf</span> <span class="p">)</span> <span class="k">call </span><span class="n">compute_forces</span><span class="p">()</span>

          <span class="c">! Mix_after_convergence preserves the old behavior of</span>
          <span class="c">! the program.</span>
          <span class="k">if</span> <span class="p">(</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SCFconverged</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">mix_after_convergence</span><span class="p">)</span> <span class="k">then</span>

             <span class="c">! Mix for next step</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                call </span><span class="n">mix_rhog</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
             <span class="k">else</span>
<span class="k">                call </span><span class="n">mixer</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>
             <span class="k">end if</span>

             <span class="c">! Save for possible restarts</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">mixH</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                call </span><span class="n">write_spmatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;H_MIXED&quot;</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="n">writeH</span><span class="p">)</span>
                <span class="k">call </span><span class="n">save_density_matrix</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;DM_OUT&quot;</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="n">writeDM</span><span class="p">)</span>
             <span class="k">else</span>
<span class="k">                call </span><span class="n">save_density_matrix</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;DM_MIXED&quot;</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="n">writeDM</span><span class="p">)</span>
                <span class="k">call </span><span class="n">write_spmatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;H_DMGEN&quot;</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="n">writeH</span><span class="p">)</span>
             <span class="k">end if</span>
<span class="k">          end if</span>

<span class="k">          call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;IterSCF&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
          <span class="k">call </span><span class="n">print_timings</span><span class="p">(</span> <span class="n">first_scf</span><span class="p">,</span> <span class="n">istep</span> <span class="o">==</span> <span class="n">inicoor</span> <span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlEndStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">)</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
          <span class="c">! Communicate with lua</span>
          <span class="k">call </span><span class="n">slua_call</span><span class="p">(</span><span class="n">LUA</span><span class="p">,</span> <span class="n">LUA_SCF_LOOP</span><span class="p">)</span>

          <span class="c">! Retrieve an easy character string</span>
          <span class="n">nnext_mixer</span> <span class="o">=</span> <span class="n">cunpack</span><span class="p">(</span><span class="n">next_mixer</span><span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">nnext_mixer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             if</span> <span class="p">(</span> <span class="n">TSrun</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                do </span><span class="n">imix</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">ts_scf_mixs</span><span class="p">)</span>
                   <span class="k">if</span> <span class="p">(</span> <span class="n">ts_scf_mixs</span><span class="p">(</span><span class="n">imix</span><span class="p">)%</span><span class="n">name</span> <span class="o">==</span> <span class="n">nnext_mixer</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                      call </span><span class="n">mixers_history_init</span><span class="p">(</span><span class="n">ts_scf_mixs</span><span class="p">)</span>
                      <span class="n">scf_mix</span> <span class="o">=&gt;</span> <span class="n">ts_scf_mixs</span><span class="p">(</span><span class="n">imix</span><span class="p">)</span>
                      <span class="k">exit</span>
<span class="k">                   end if</span>
<span class="k">                end do</span>
<span class="k">             else</span>
<span class="k">                do </span><span class="n">imix</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">scf_mixs</span><span class="p">)</span>
                   <span class="k">if</span> <span class="p">(</span> <span class="n">scf_mixs</span><span class="p">(</span><span class="n">imix</span><span class="p">)%</span><span class="n">name</span> <span class="o">==</span> <span class="n">nnext_mixer</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                      call </span><span class="n">mixers_history_init</span><span class="p">(</span><span class="n">scf_mixs</span><span class="p">)</span>
                      <span class="n">scf_mix</span> <span class="o">=&gt;</span> <span class="n">scf_mixs</span><span class="p">(</span><span class="n">imix</span><span class="p">)</span>
                      <span class="k">exit</span>
<span class="k">                   end if</span>
<span class="k">                end do</span>
<span class="k">             end if</span>

             <span class="c">! Check that we indeed have changed the mixer</span>
             <span class="k">if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">scf_mix</span><span class="p">%</span><span class="n">name</span> <span class="o">/=</span> <span class="n">nnext_mixer</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(2a)&#39;</span><span class="p">)</span> <span class="s1">&#39;siesta-lua: WARNING: trying to change &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="s1">&#39;to a non-existing mixer! Not changing anything!&#39;</span>

             <span class="k">else if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">                write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(2a)&#39;</span><span class="p">)</span> <span class="s1">&#39;siesta-lua: Switching mixer method to: &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="nb">trim</span><span class="p">(</span><span class="n">nnext_mixer</span><span class="p">)</span>

             <span class="k">end if</span>
             <span class="c">! Reset for next loop</span>
             <span class="n">next_mixer</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

             <span class="c">! Update the references</span>
             <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Weight&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">w</span><span class="p">)</span>
             <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Restart&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">restart</span><span class="p">)</span>
             <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Iterations&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">n_itt</span><span class="p">)</span>

          <span class="k">end if</span>
<span class="cp">#endif</span>

          <span class="c">! ... except that we might continue for TranSiesta</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">SCFconverged</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             call </span><span class="n">transiesta_switch</span><span class="p">()</span>
             <span class="c">! might reset SCFconverged and iscf</span>
          <span class="k">end if</span>

<span class="k">       else</span>

          <span class="c">! non-siesta worker</span>
          <span class="k">call </span><span class="n">compute_DM</span><span class="p">(</span> <span class="n">iscf</span> <span class="p">)</span>

       <span class="k">end if</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
       <span class="k">call </span><span class="n">broadcast</span><span class="p">(</span><span class="n">iscf</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="n">true_MPI_Comm_World</span><span class="p">)</span>
       <span class="k">call </span><span class="n">broadcast</span><span class="p">(</span><span class="n">SCFconverged</span><span class="p">,</span> <span class="n">comm</span><span class="o">=</span><span class="n">true_MPI_Comm_World</span><span class="p">)</span>
<span class="cp">#endif</span>

       <span class="c">!! Exit if converged:</span>
       <span class="c">!!@code</span>
       <span class="k">if</span> <span class="p">(</span> <span class="n">SCFconverged</span> <span class="p">)</span> <span class="k">exit</span>
       <span class="c">!!@endcode</span>

    <span class="k">end do</span>
    <span class="c">!! **end of SCF cycle**</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">isolve</span> <span class="o">==</span> <span class="n">SOLVE_PEXSI</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       call </span><span class="n">pexsi_finalize_scfloop</span><span class="p">()</span>
    <span class="k">end if</span>
<span class="cp">#endif</span>

    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SIESTA_worker</span> <span class="p">)</span> <span class="k">return</span>

<span class="k">    call </span><span class="n">end_of_cycle_save_operations</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SCFconverged</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       if</span> <span class="p">(</span> <span class="n">SCFMustConverge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;FATAL&#39;</span><span class="p">,</span><span class="s1">&#39;SCF_NOT_CONV: SCF did not converge&#39;</span> <span class="o">//</span> <span class="p">&amp;</span>
               <span class="s1">&#39; in maximum number of steps (required).&#39;</span><span class="p">)</span>
          <span class="k">write</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">,</span><span class="s2">&quot;(2(i5,tr1),f12.6)&quot;</span><span class="p">)</span> <span class="n">istep</span><span class="p">,</span> <span class="n">iscf</span><span class="p">,</span> <span class="n">prevDmax</span>
          <span class="k">call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39; (info)&#39;</span><span class="p">,</span><span class="s2">&quot;Geom step, scf iteration, dmax:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">))</span>
          <span class="k">call </span><span class="n">die</span><span class="p">(</span><span class="s1">&#39;ABNORMAL_TERMINATION&#39;</span><span class="p">)</span>
       <span class="k">else if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">harrisfun</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39;WARNING&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
               <span class="s1">&#39;SCF_NOT_CONV: SCF did not converge  in maximum number of steps.&#39;</span><span class="p">)</span>
          <span class="k">write</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">,</span><span class="s2">&quot;(2(i5,tr1),f12.6)&quot;</span><span class="p">)</span> <span class="n">istep</span><span class="p">,</span> <span class="n">iscf</span><span class="p">,</span> <span class="n">prevDmax</span>
          <span class="k">call </span><span class="n">message</span><span class="p">(</span><span class="s1">&#39; (info)&#39;</span><span class="p">,</span><span class="s2">&quot;Geom step, scf iteration, dmax:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tmp_str</span><span class="p">))</span>
       <span class="k">end if</span>
<span class="k">    end if</span>

    <span class="c">! To write the initial wavefunctions to be used in a</span>
    <span class="c">! consequent TDDFT run.</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">writetdwf</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       </span><span class="n">istpp</span> <span class="o">=</span> <span class="mi">0</span>
       <span class="k">call </span><span class="n">initwf</span><span class="p">(</span><span class="n">istpp</span><span class="p">,</span><span class="n">totime</span><span class="p">)</span>
    <span class="k">end if</span>
<span class="k">    </span>
<span class="k">    if</span> <span class="p">(</span> <span class="n">TSmode</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">TSinit</span><span class="p">.</span><span class="nb">and</span><span class="p">.(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">SCFConverged</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
       <span class="c">! Signal that the DM hasn&#39;t converged, so we cannot</span>
       <span class="c">! continue to the transiesta routines</span>
       <span class="k">call </span><span class="n">die</span><span class="p">(</span><span class="s1">&#39;ABNORMAL_TERMINATION&#39;</span><span class="p">)</span>
    <span class="k">end if</span>
    
    <span class="c">! Clean-up here to limit memory usage</span>
    <span class="k">call </span><span class="n">mixers_scf_history_init</span><span class="p">(</span> <span class="p">)</span>
    
    <span class="c">! End of standard SCF loop.</span>
    <span class="c">! Do one more pass to compute forces and stresses</span>
    
    <span class="c">! Note that this call will no longer overwrite H while computing the</span>
    <span class="c">! final energies, forces and stresses...</span>
    
    <span class="k">if</span> <span class="p">(</span> <span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;compute-forces&quot;</span><span class="p">,.</span><span class="n">true</span><span class="p">.)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">       call </span><span class="n">post_scf_work</span><span class="p">(</span> <span class="n">istep</span><span class="p">,</span> <span class="n">iscf</span> <span class="p">,</span> <span class="n">SCFconverged</span> <span class="p">)</span>
<span class="cp">#ifdef SIESTA__PEXSI</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">call </span><span class="n">memory_snapshot</span><span class="p">(</span><span class="s2">&quot;after post_scf_work&quot;</span><span class="p">)</span>
<span class="cp">#endif</span>
    <span class="k">end if</span>
    
    <span class="c">! ... so H at this point is the latest generator of the DM, except</span>
    <span class="c">! if mixing H beyond self-consistency or terminating the scf loop</span>
    <span class="c">! without convergence while mixing H</span>
    
    <span class="k">call </span><span class="n">state_analysis</span><span class="p">(</span> <span class="n">istep</span> <span class="p">)</span>
<span class="cp">#ifdef SIESTA__PEXSI</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">call </span><span class="n">memory_snapshot</span><span class="p">(</span><span class="s2">&quot;after state_analysis&quot;</span><span class="p">)</span>
<span class="cp">#endif</span>

    <span class="c">! If siesta is running as a subroutine, send forces to master program</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">siesta_server</span><span class="p">)</span> <span class="p">&amp;</span>
         <span class="k">call </span><span class="n">forcesToMaster</span><span class="p">(</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">Etot</span><span class="p">,</span> <span class="n">cfa</span><span class="p">,</span> <span class="n">cstress</span> <span class="p">)</span>

<span class="cp">#ifdef DEBUG</span>
    <span class="k">call </span><span class="n">write_debug</span><span class="p">(</span> <span class="s1">&#39;    POS siesta_forces&#39;</span> <span class="p">)</span>
<span class="cp">#endif</span>
    
  <span class="k">contains</span>

    <span class="c">! Read the Hamiltonian from a file</span>
    <span class="k">subroutine </span><span class="n">get_H_from_file</span><span class="p">()</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">listhptr</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">no_l</span>
      <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">nspin</span>
      <span class="k">use </span><span class="n">m_iodm_old</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">read_spmatrix</span>

      <span class="kt">logical</span> <span class="kd">::</span> <span class="n">found</span>

      <span class="k">call </span><span class="n">read_spmatrix</span><span class="p">(</span><span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">nspin</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="p">&amp;</span>
           <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">userfile</span><span class="o">=</span><span class="s2">&quot;H_IN&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">found</span><span class="p">)</span> <span class="k">call </span><span class="n">die</span><span class="p">(</span><span class="s2">&quot;Could not find H_IN&quot;</span><span class="p">)</span>

    <span class="k">end subroutine </span><span class="n">get_H_from_file</span>

    <span class="c">! Computes forces and stresses with the current DM_out</span>
    <span class="k">subroutine </span><span class="n">compute_forces</span><span class="p">()</span>

      <span class="k">use </span><span class="n">siesta_options</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">recompute_H_after_scf</span>
      <span class="k">use </span><span class="n">m_final_H_f_stress</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">final_H_f_stress</span>
      <span class="k">use </span><span class="n">write_subs</span>

      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">fa_old</span><span class="p">(:,:),</span> <span class="n">Hsave</span><span class="p">(:,:)</span>

      <span class="k">allocate</span><span class="p">(</span><span class="n">fa_old</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span><span class="nb">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span><span class="nb">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
      <span class="n">fa_old</span><span class="p">(:,:)</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(:,:)</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">recompute_H_after_scf</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         allocate</span><span class="p">(</span><span class="n">Hsave</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="nb">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="nb">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
         <span class="n">Hsave</span><span class="p">(:,:)</span> <span class="o">=</span> <span class="n">H</span><span class="p">(:,:)</span>
      <span class="k">end if</span>
<span class="k">      call </span><span class="n">final_H_f_stress</span><span class="p">(</span> <span class="n">istep</span> <span class="p">,</span> <span class="n">iscf</span> <span class="p">,</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">recompute_H_after_scf</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         </span><span class="n">H</span><span class="p">(:,:)</span> <span class="o">=</span> <span class="n">Hsave</span><span class="p">(:,:)</span>
         <span class="k">deallocate</span><span class="p">(</span><span class="n">Hsave</span><span class="p">)</span>
      <span class="k">end if</span>
<span class="k">      if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         print</span> <span class="o">*</span><span class="p">,</span> <span class="s2">&quot;Max diff in force (eV/Ang): &quot;</span><span class="p">,</span> <span class="p">&amp;</span>
              <span class="nb">maxval</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">fa</span><span class="o">-</span><span class="n">fa_old</span><span class="p">))</span><span class="o">*</span><span class="n">Ang</span><span class="o">/</span><span class="n">eV</span>
         <span class="k">call </span><span class="n">siesta_write_forces</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
         <span class="k">call </span><span class="n">siesta_write_stress_pressure</span><span class="p">()</span>
      <span class="n">endif</span>
      <span class="k">deallocate</span><span class="p">(</span><span class="n">fa_old</span><span class="p">)</span>

    <span class="k">end subroutine </span><span class="n">compute_forces</span>

    <span class="c">! Print out timings of the first SCF loop only</span>
    <span class="k">subroutine </span><span class="n">print_timings</span><span class="p">(</span><span class="n">first_scf</span><span class="p">,</span> <span class="n">first_md</span><span class="p">)</span>
      <span class="k">use </span><span class="n">timer_options</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">use_tree_timer</span>
      <span class="k">use </span><span class="n">m_ts_global_vars</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">TSrun</span>
      <span class="kt">logical</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">first_scf</span><span class="p">,</span> <span class="n">first_md</span>
      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="kd">::</span> <span class="n">routine</span>

      <span class="c">! If this is not the first iteration,</span>
      <span class="c">! we immediately return.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">first_scf</span> <span class="p">)</span> <span class="k">return</span>
<span class="k">      if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">first_md</span> <span class="p">)</span> <span class="k">return</span>

<span class="k">      </span><span class="n">routine</span> <span class="o">=</span> <span class="s1">&#39;IterSCF&#39;</span>

      <span class="k">if</span> <span class="p">(</span> <span class="n">TSrun</span> <span class="p">)</span> <span class="k">then</span>
         <span class="c">! with Green function generation</span>
         <span class="c">! The tree-timer requires direct</span>
         <span class="c">! children of the routine to be</span>
         <span class="c">! queried.</span>
         <span class="c">! This is not obeyed in the TS case... :(</span>
         <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">use_tree_timer</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            </span><span class="n">routine</span> <span class="o">=</span> <span class="s1">&#39;TS&#39;</span>
         <span class="k">end if</span>
<span class="k">      </span><span class="n">endif</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="n">routine</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>

    <span class="k">end subroutine </span><span class="n">print_timings</span>

    <span class="c">! Depending on various conditions, save the DMin</span>
    <span class="c">! or the DMout, and possibly keep a copy of H</span>

    <span class="c">! NOTE: Only if the scf cycle converged before exit it</span>
    <span class="c">! is guaranteed that the DM is &quot;pure out&quot; and that</span>
    <span class="c">! we can recover the right H if mixing H.</span>
    <span class="c">!</span>
    <span class="k">subroutine </span><span class="n">end_of_cycle_save_operations</span><span class="p">()</span>

      <span class="kt">logical</span> <span class="kd">::</span> <span class="n">DM_write</span><span class="p">,</span> <span class="n">H_write</span>

      <span class="c">! Depending on the option we should overwrite the</span>
      <span class="c">! Hamiltonian</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">mixH</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">mix_after_convergence</span> <span class="p">)</span> <span class="k">then</span>
         <span class="c">! Make sure that we keep the H actually used</span>
         <span class="c">! to generate the last DM, if needed.</span>
         <span class="n">H</span> <span class="o">=</span> <span class="n">Hold</span>
      <span class="k">end if</span>

<span class="k">      </span><span class="n">DM_write</span> <span class="o">=</span> <span class="n">write_DM_at_end_of_cycle</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
           <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">writeDM</span>
      <span class="n">H_write</span> <span class="o">=</span> <span class="n">write_H_at_end_of_cycle</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
           <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">writeH</span>

      <span class="k">if</span> <span class="p">(</span> <span class="n">mix_after_convergence</span> <span class="p">)</span> <span class="k">then</span>
         <span class="c">! If we have been saving them, there is no point in doing</span>
         <span class="c">! it one more time</span>
         <span class="k">if</span> <span class="p">(</span> <span class="n">mixH</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            call </span><span class="n">save_density_matrix</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;DM_OUT&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">DM_write</span><span class="p">)</span>
            <span class="k">call </span><span class="n">write_spmatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;H_MIXED&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">H_write</span><span class="p">)</span>
         <span class="k">else</span>
<span class="k">            call </span><span class="n">save_density_matrix</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;DM_MIXED&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">DM_write</span><span class="p">)</span>
            <span class="k">call </span><span class="n">write_spmatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;H_DMGEN&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">H_write</span><span class="p">)</span>
         <span class="k">end if</span>
<span class="k">      else</span>
<span class="k">         call </span><span class="n">save_density_matrix</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;DM_OUT&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">DM_write</span><span class="p">)</span>
         <span class="k">call </span><span class="n">write_spmatrix</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;H_DMGEN&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">=</span><span class="n">H_write</span><span class="p">)</span>
      <span class="k">end if</span>

<span class="k">    end subroutine </span><span class="n">end_of_cycle_save_operations</span>

    <span class="k">subroutine </span><span class="n">transiesta_switch</span><span class="p">()</span>

      <span class="k">use </span><span class="nb">precision</span><span class="p">,</span>             <span class="n">only</span><span class="p">:</span> <span class="n">dp</span>
      <span class="k">use </span><span class="n">parallel</span><span class="p">,</span>              <span class="n">only</span><span class="p">:</span> <span class="n">IONode</span>
      <span class="k">use </span><span class="n">class_dSpData2D</span>
      <span class="k">use </span><span class="n">class_Fstack_dData1D</span>
      <span class="k">use </span><span class="n">densematrix</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">resetDenseMatrix</span>

      <span class="k">use </span><span class="n">siesta_options</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">fire_mix</span><span class="p">,</span> <span class="n">broyden_maxit</span>
      <span class="k">use </span><span class="n">siesta_options</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">dDtol</span><span class="p">,</span> <span class="n">dHtol</span>

      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">DM_2D</span><span class="p">,</span> <span class="n">EDM_2D</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">lasto</span>
      <span class="k">use </span><span class="n">siesta_geom</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">isc_off</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">ucell</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">Ef</span>
      <span class="k">use </span><span class="n">m_mixing</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">mixers_history_init</span>
      <span class="k">use </span><span class="n">m_mixing_scf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">scf_mix</span><span class="p">,</span> <span class="n">scf_mixs</span>
      <span class="k">use </span><span class="n">m_rhog</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">resetRhoG</span>

      <span class="k">use </span><span class="n">m_ts_global_vars</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">TSinit</span><span class="p">,</span> <span class="n">TSrun</span>
      <span class="k">use </span><span class="n">m_ts_global_vars</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">ts_print_transiesta</span>
      <span class="k">use </span><span class="n">m_ts_method</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">N_Elec</span><span class="p">,</span> <span class="n">Elecs</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">DM_bulk</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">val_swap</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">ts_Dtol</span><span class="p">,</span> <span class="n">ts_Htol</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">ts_hist_keep</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">ts_siesta_stop</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">ts_scf_mixs</span>
      <span class="k">use </span><span class="n">m_ts_electype</span>

      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span> <span class="n">na_a</span>
      <span class="kt">integer</span><span class="p">,</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">allowed_a</span><span class="p">(:)</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">DM</span><span class="p">(:,:),</span> <span class="n">EDM</span><span class="p">(:,:)</span>

      <span class="c">! We are done with the initial diagon run</span>
      <span class="c">! Now we start the TRANSIESTA (Green functions) run</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">TSmode</span> <span class="p">)</span> <span class="k">return</span>
<span class="k">      if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">TSinit</span> <span class="p">)</span> <span class="k">return</span>

      <span class="c">! whether we are in siesta initialization step</span>
      <span class="n">TSinit</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
      <span class="c">! whether transiesta is running</span>
      <span class="n">TSrun</span>  <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>

      <span class="c">! If transiesta should stop immediately</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">ts_siesta_stop</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">         if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span> <span class="s1">&#39;ts: Stopping transiesta (user option)!&#39;</span>
         <span class="k">end if</span>

<span class="k">         return</span>

<span class="k">      end if</span>

      <span class="c">! Reduce memory requirements</span>
      <span class="k">call </span><span class="n">resetDenseMatrix</span><span class="p">()</span>

      <span class="c">! Signal to continue...</span>
      <span class="c">! These two variables are from the top-level</span>
      <span class="c">! routine (siesta_forces)</span>
      <span class="n">SCFconverged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
      <span class="n">iscf</span> <span class="o">=</span> <span class="mi">0</span>

      <span class="c">! DANGER (when/if going back to the DIAGON run, we should</span>
      <span class="c">! re-instantiate the original mixing value)</span>
      <span class="k">call </span><span class="n">val_swap</span><span class="p">(</span><span class="n">dDtol</span><span class="p">,</span> <span class="n">ts_Dtol</span><span class="p">)</span>
      <span class="k">call </span><span class="n">val_swap</span><span class="p">(</span><span class="n">dHtol</span><span class="p">,</span> <span class="n">ts_Htol</span><span class="p">)</span>

      <span class="c">! Clean up mixing history</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">resetRhoG</span><span class="p">(.</span><span class="n">true</span><span class="p">.)</span>
      <span class="k">else</span>
<span class="k">        if</span> <span class="p">(</span> <span class="nb">associated</span><span class="p">(</span><span class="n">ts_scf_mixs</span><span class="p">,</span> <span class="k">target</span><span class="o">=</span><span class="n">scf_mixs</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          do </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">stack</span><span class="p">)</span>
            <span class="k">call </span><span class="n">reset</span><span class="p">(</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">stack</span><span class="p">(</span><span class="n">iel</span><span class="p">),</span> <span class="o">-</span><span class="n">ts_hist_keep</span><span class="p">)</span>
            <span class="c">! Reset iteration count as certain</span>
            <span class="c">! mixing schemes require this for consistency</span>
            <span class="n">scf_mix</span><span class="p">%</span><span class="n">cur_itt</span> <span class="o">=</span> <span class="n">n_items</span><span class="p">(</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">stack</span><span class="p">(</span><span class="n">iel</span><span class="p">))</span>
          <span class="k">end do</span>
<span class="k">        else</span>
<span class="k">          call </span><span class="n">mixers_history_init</span><span class="p">(</span><span class="n">scf_mixs</span><span class="p">)</span>
        <span class="k">end if</span>
<span class="k">      end if</span>
      
      <span class="c">! Transfer scf_mixing to the transiesta mixing routine</span>
      <span class="n">scf_mix</span> <span class="o">=&gt;</span> <span class="n">ts_scf_mixs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">mix_charge</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Weight&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">w</span><span class="p">)</span>
         <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Restart&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">restart</span><span class="p">)</span>
         <span class="k">call </span><span class="n">dict_variable_add</span><span class="p">(</span><span class="s1">&#39;SCF.Mixer.Iterations&#39;</span><span class="p">,</span><span class="n">scf_mix</span><span class="p">%</span><span class="n">n_itt</span><span class="p">)</span>
      <span class="k">end if</span>
<span class="cp">#endif</span>

      <span class="k">call </span><span class="n">ts_print_transiesta</span><span class="p">()</span>

      <span class="c">! In case of transiesta and DM_bulk.</span>
      <span class="c">! In case we ask for initialization of the DM in bulk</span>
      <span class="c">! we read in the DM files from the electrodes and</span>
      <span class="c">! initialize the bulk to those values</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">DM_bulk</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">         if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(/,2a)&#39;</span><span class="p">)</span> <span class="s1">&#39;transiesta: &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                 <span class="s1">&#39;Initializing bulk DM in electrodes.&#39;</span>
         <span class="k">end if</span>

<span class="k">         </span><span class="n">na_a</span> <span class="o">=</span> <span class="mi">0</span>
         <span class="k">do </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">na_u</span>
            <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">a_isDev</span><span class="p">(</span><span class="n">iEl</span><span class="p">)</span> <span class="p">)</span> <span class="n">na_a</span> <span class="o">=</span> <span class="n">na_a</span> <span class="o">+</span> <span class="mi">1</span>
         <span class="k">end do</span>
<span class="k">         allocate</span><span class="p">(</span><span class="n">allowed_a</span><span class="p">(</span><span class="n">na_a</span><span class="p">))</span>
         <span class="n">na_a</span> <span class="o">=</span> <span class="mi">0</span>
         <span class="k">do </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">na_u</span>
            <span class="c">! We allow the buffer atoms as well (this will even out the</span>
            <span class="c">! potential around the back of the electrode)</span>
            <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">a_isDev</span><span class="p">(</span><span class="n">iEl</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">               </span><span class="n">na_a</span> <span class="o">=</span> <span class="n">na_a</span> <span class="o">+</span> <span class="mi">1</span>
               <span class="n">allowed_a</span><span class="p">(</span><span class="n">na_a</span><span class="p">)</span> <span class="o">=</span> <span class="n">iEl</span>
            <span class="k">end if</span>
<span class="k">         end do</span>

<span class="k">         do </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">N_Elec</span>

            <span class="k">if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">               write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(/,2a)&#39;</span><span class="p">)</span> <span class="s1">&#39;transiesta: &#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                    <span class="s1">&#39;Reading in electrode TSDE for &#39;</span><span class="o">//</span> <span class="p">&amp;</span>
                    <span class="nb">trim</span><span class="p">(</span><span class="n">Elecs</span><span class="p">(</span><span class="n">iEl</span><span class="p">)%</span><span class="n">Name</span><span class="p">)</span>
            <span class="k">end if</span>

            <span class="c">! Copy over the DM in the lead</span>
            <span class="c">! Notice that the EDM matrix that is copied over</span>
            <span class="c">! will be equivalent at Ef == 0</span>
            <span class="k">call </span><span class="n">copy_DM</span><span class="p">(</span><span class="n">Elecs</span><span class="p">(</span><span class="n">iEl</span><span class="p">),</span><span class="n">na_u</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">lasto</span><span class="p">,</span><span class="n">nsc</span><span class="p">,</span><span class="n">isc_off</span><span class="p">,</span> <span class="p">&amp;</span>
                 <span class="n">ucell</span><span class="p">,</span> <span class="n">DM_2D</span><span class="p">,</span> <span class="n">EDM_2D</span><span class="p">,</span> <span class="n">na_a</span><span class="p">,</span> <span class="n">allowed_a</span><span class="p">)</span>

         <span class="k">end do</span>

         <span class="c">! Clean-up</span>
         <span class="k">deallocate</span><span class="p">(</span><span class="n">allowed_a</span><span class="p">)</span>

         <span class="k">if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="c">! new-line</span>
         <span class="k">end if</span>

         <span class="c">! The electrode EDM is aligned at Ef == 0</span>
         <span class="c">! We need to align the energy matrix</span>
         <span class="n">DM</span>  <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">DM_2D</span><span class="p">)</span>
         <span class="n">EDM</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">EDM_2D</span><span class="p">)</span>
         <span class="n">iEl</span> <span class="o">=</span>  <span class="n">size</span><span class="p">(</span><span class="n">DM</span><span class="p">)</span>
         <span class="k">call </span><span class="n">daxpy</span><span class="p">(</span><span class="n">iEl</span><span class="p">,</span><span class="n">Ef</span><span class="p">,</span><span class="n">DM</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">EDM</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

      <span class="k">end if</span>

<span class="k">    end subroutine </span><span class="n">transiesta_switch</span>

  <span class="k">end subroutine </span><span class="n">siesta_forces</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprocs-1">All Procedures</a></h3></div>
  <div id="allprocs-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../proc/current_itt.html">current_itt</a>
      
      <a class="list-group-item" href="../proc/getstackval.html">getstackval</a>
      
      <a class="list-group-item" href="../proc/inverse.html">inverse</a>
      
      <a class="list-group-item" href="../proc/is_next.html">is_next</a>
      
      <a class="list-group-item" href="../proc/mix_method.html">mix_method</a>
      
      <a class="list-group-item" href="../proc/mix_method_variant.html">mix_method_variant</a>
      
      <a class="list-group-item" href="../proc/mixer_init.html">mixer_init</a>
      
      <a class="list-group-item" href="../proc/mixers_history_init.html">mixers_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_init.html">mixers_init</a>
      
      <a class="list-group-item" href="../proc/mixers_print.html">mixers_print</a>
      
      <a class="list-group-item" href="../proc/mixers_print_block.html">mixers_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_reset.html">mixers_reset</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_history_init.html">mixers_scf_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_init.html">mixers_scf_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print.html">mixers_scf_print</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print_block.html">mixers_scf_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_reset.html">mixers_scf_reset</a>
      
      <a class="list-group-item" href="../interface/mixing.html">mixing</a>
      
      <a class="list-group-item" href="../proc/mixing_1d.html">mixing_1d</a>
      
      <a class="list-group-item" href="../proc/mixing_2d.html">mixing_2d</a>
      
      <a class="list-group-item" href="../proc/mixing_calc_next.html">mixing_calc_next</a>
      
      <a class="list-group-item" href="../proc/mixing_coeff.html">mixing_coeff</a>
      
      <a class="list-group-item" href="../proc/mixing_finalize.html">mixing_finalize</a>
      
      <a class="list-group-item" href="../proc/mixing_init.html">mixing_init</a>
      
      <a class="list-group-item" href="../proc/mixing_ncoeff.html">mixing_ncoeff</a>
      
      <a class="list-group-item" href="../proc/mixing_scf_converged.html">mixing_scf_converged</a>
      
      <a class="list-group-item" href="../proc/mixing_step.html">mixing_step</a>
      
      <a class="list-group-item" href="../proc/norm.html">norm</a>
      
      <a class="list-group-item" href="../proc/push_diff.html">push_diff</a>
      
      <a class="list-group-item" href="../proc/push_f.html">push_F</a>
      
      <a class="list-group-item" href="../proc/push_stack_data.html">push_stack_data</a>
      
      <a class="list-group-item" href="../proc/setup_h0.html">setup_H0</a>
      
      <a class="list-group-item" href="../proc/siesta_analysis.html">siesta_analysis</a>
      
      <a class="list-group-item" href="../proc/siesta_forces.html">siesta_forces</a>
      
      <a class="list-group-item" href="../proc/stack_check.html">stack_check</a>
      
      <a class="list-group-item" href="../proc/state_analysis.html">state_analysis</a>
      
      <a class="list-group-item" href="../proc/state_init.html">state_init</a>
      
      <a class="list-group-item" href="../proc/svd.html">svd</a>
      
      <a class="list-group-item" href="../proc/update_f.html">update_F</a>
      
    </div>
  </div>
</div>


  </section>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SIESTA was developed by SIESTA Group</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    
  </body>
</html>