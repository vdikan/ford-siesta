<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A first-principles materials simulation code using Density Functional Theory.">
    
    <meta name="author" content="SIESTA Group" >
    <link rel="icon" href="../favicon.png">

    <title>siesta_analysis &ndash; SIESTA</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SIESTA <small>trunk-674--vdikan-ford-681</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Program Overview</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>siesta_analysis
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 4.3% of total for procedures.">224 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/siesta_analysis.F"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/siesta_analysis.f.html'>siesta_analysis.F</a></li>
    
     <li><a href='../module/m_siesta_analysis.html'>m_siesta_analysis</a></li>
    
  
     <li class="active">siesta_analysis</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/siesta_analysis.html#src">siesta_analysis</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine siesta_analysis(relaxd)
    
    
   
</h2>
    
  
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Uses</h3>
      </div>
      <ul class="list-group">
      
      <li class="list-group-item">
  <ul class="list-inline">
    
    <li>band</li>
    
    <li>writewave</li>
    
    <li>writewave</li>
    
    <li>m_ksvinit</li>
    
    <li>m_ksv</li>
    
    <li>m_projected_DOS</li>
    
    <li>m_local_DOS</li>
    
    <li>m_pexsi_local_DOS</li>
    
    <li>m_pexsi_dos</li>
    
    <li>siesta_options</li>
    
    <li>units</li>
    
    <li>sparse_matrices</li>
    
    <li>sparse_matrices</li>
    
    <li>siesta_geom</li>
    
    <li>m_dhscf</li>
    
    <li>atomlist</li>
    
    <li>atomlist</li>
    
    <li>fdf</li>
    
    <li>writewave</li>
    
    <li>siesta_cml</li>
    
    <li>files</li>
    
    <li>files</li>
    
    <li>zmatrix</li>
    
    <li>Kpoint_grid</li>
    
    <li>parallel</li>
    
    <li>parallel</li>
    
    <li>files</li>
    
    <li>m_energies</li>
    
    <li>m_steps</li>
    
    <li>m_ntm</li>
    
    <li>m_spin</li>
    
    <li>m_spin</li>
    
    <li>m_dipol</li>
    
    <li>m_eo</li>
    
    <li>m_forces</li>
    
    <li>m_gamma</li>
    
    <li>alloc</li>
    
    <li>basis_enthalpy</li>
    
    <li>m_partial_charges</li>
    
    <li>m_iodm_old</li>
    
    <li>m_siesta2wannier90</li>
    
    <li>m_mpi_utils</li>
    
    <li>flook_siesta</li>
    
  </ul>
      </li>
      
      
      
      <li class="list-group-item">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: proc~~siesta_analysis~~UsesGraph Pages: 1 -->
<svg id="procsiesta_analysisUsesGraph" width="240pt" height="1460pt"
 viewBox="0.00 0.00 240.00 1460.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~siesta_analysis~~UsesGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 1456)">
<title>proc~~siesta_analysis~~UsesGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1456 236,-1456 236,4 -4,4"/>
<!-- proc~siesta_analysis -->
<g id="proc~~siesta_analysis~~UsesGraph_node1" class="node">
<title>proc~siesta_analysis</title>
<polygon fill="none" stroke="#000000" points="232,-738 147,-738 147,-714 232,-714 232,-738"/>
<text text-anchor="middle" x="189.5" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">siesta_analysis</text>
</g>
<!-- atomlist -->
<g id="proc~~siesta_analysis~~UsesGraph_node2" class="node">
<title>atomlist</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-1452 28.5,-1452 28.5,-1428 82.5,-1428 82.5,-1452"/>
<text text-anchor="middle" x="55.5" y="-1437.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">atomlist</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;atomlist -->
<g id="proc~~siesta_analysis~~UsesGraph_edge1" class="edge">
<title>proc~siesta_analysis&#45;&gt;atomlist</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.8835,-738.0911C184.3134,-825.8189 154.6668,-1362.844 111,-1419 106.261,-1425.0944 99.5407,-1429.4203 92.4053,-1432.4909"/>
<polygon fill="#000000" stroke="#000000" points="90.8394,-1429.3312 82.5648,-1435.948 93.1596,-1435.9355 90.8394,-1429.3312"/>
</g>
<!-- parallel -->
<g id="proc~~siesta_analysis~~UsesGraph_node3" class="node">
<title>parallel</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-1410 28.5,-1410 28.5,-1386 82.5,-1386 82.5,-1410"/>
<text text-anchor="middle" x="55.5" y="-1395.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;parallel -->
<g id="proc~~siesta_analysis~~UsesGraph_edge2" class="edge">
<title>proc~siesta_analysis&#45;&gt;parallel</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.7867,-738.1625C183.7138,-823.0024 152.1133,-1324.5193 111,-1377 106.239,-1383.0773 99.5097,-1387.3961 92.3724,-1390.4652"/>
<polygon fill="#000000" stroke="#000000" points="90.8069,-1387.3054 82.5332,-1393.9234 93.128,-1393.9094 90.8069,-1387.3054"/>
</g>
<!-- m_ksvinit -->
<g id="proc~~siesta_analysis~~UsesGraph_node4" class="node">
<title>m_ksvinit</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-1368 27,-1368 27,-1344 84,-1344 84,-1368"/>
<text text-anchor="middle" x="55.5" y="-1353.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ksvinit</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_ksvinit -->
<g id="proc~~siesta_analysis~~UsesGraph_edge3" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_ksvinit</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.6814,-738.1546C183.0887,-819.763 149.5771,-1286.1699 111,-1335 106.5804,-1340.5942 100.4946,-1344.6985 93.9663,-1347.7096"/>
<polygon fill="#000000" stroke="#000000" points="92.3476,-1344.5795 84.2277,-1351.3852 94.8194,-1351.1286 92.3476,-1344.5795"/>
</g>
<!-- Kpoint_grid -->
<g id="proc~~siesta_analysis~~UsesGraph_node5" class="node">
<title>Kpoint_grid</title>
<polygon fill="#337ab7" stroke="#337ab7" points="89,-1326 22,-1326 22,-1302 89,-1302 89,-1326"/>
<text text-anchor="middle" x="55.5" y="-1311.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Kpoint_grid</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;Kpoint_grid -->
<g id="proc~~siesta_analysis~~UsesGraph_edge4" class="edge">
<title>proc~siesta_analysis&#45;&gt;Kpoint_grid</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.5674,-738.0623C182.4384,-816.1024 147.0586,-1247.7952 111,-1293 107.547,-1297.3289 103.0973,-1300.7657 98.2217,-1303.4943"/>
<polygon fill="#000000" stroke="#000000" points="96.735,-1300.3255 89.109,-1307.6804 99.6571,-1306.6865 96.735,-1300.3255"/>
</g>
<!-- m_ntm -->
<g id="proc~~siesta_analysis~~UsesGraph_node6" class="node">
<title>m_ntm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-1284 28.5,-1284 28.5,-1260 82.5,-1260 82.5,-1284"/>
<text text-anchor="middle" x="55.5" y="-1269.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ntm</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_ntm -->
<g id="proc~~siesta_analysis~~UsesGraph_edge5" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_ntm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.3034,-738.1286C187.9246,-808.9109 177.6826,-1168.3277 111,-1251 106.1976,-1256.9539 99.5122,-1261.2207 92.44,-1264.2781"/>
<polygon fill="#000000" stroke="#000000" points="90.9464,-1261.0945 82.697,-1267.7426 93.2917,-1267.6899 90.9464,-1261.0945"/>
</g>
<!-- m_pexsi_dos -->
<g id="proc~~siesta_analysis~~UsesGraph_node7" class="node">
<title>m_pexsi_dos</title>
<polygon fill="#337ab7" stroke="#337ab7" points="93.5,-1242 17.5,-1242 17.5,-1218 93.5,-1218 93.5,-1242"/>
<text text-anchor="middle" x="55.5" y="-1227.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_pexsi_dos</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_pexsi_dos -->
<g id="proc~~siesta_analysis~~UsesGraph_edge6" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_pexsi_dos</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.1335,-738.0285C186.8596,-805.192 172.6832,-1133.5113 111,-1209 108.5759,-1211.9666 105.6849,-1214.5145 102.5139,-1216.7027"/>
<polygon fill="#000000" stroke="#000000" points="100.6106,-1213.757 93.5941,-1221.6954 104.0297,-1219.8652 100.6106,-1213.757"/>
</g>
<!-- m_eo -->
<g id="proc~~siesta_analysis~~UsesGraph_node8" class="node">
<title>m_eo</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-1200 28.5,-1200 28.5,-1176 82.5,-1176 82.5,-1200"/>
<text text-anchor="middle" x="55.5" y="-1185.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_eo</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_eo -->
<g id="proc~~siesta_analysis~~UsesGraph_edge7" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_eo</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.9198,-738.2243C185.6506,-802.2687 167.6096,-1098.7742 111,-1167 106.1155,-1172.8868 99.3956,-1177.1253 92.3159,-1180.1765"/>
<polygon fill="#000000" stroke="#000000" points="90.8235,-1176.9926 82.5772,-1183.6446 93.1719,-1183.587 90.8235,-1176.9926"/>
</g>
<!-- m_dhscf -->
<g id="proc~~siesta_analysis~~UsesGraph_node9" class="node">
<title>m_dhscf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-1158 28.5,-1158 28.5,-1134 82.5,-1134 82.5,-1158"/>
<text text-anchor="middle" x="55.5" y="-1143.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_dhscf</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_dhscf -->
<g id="proc~~siesta_analysis~~UsesGraph_edge8" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_dhscf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.669,-738.2412C184.3448,-798.585 162.6089,-1063.9343 111,-1125 106.1082,-1130.7882 99.445,-1134.9839 92.4323,-1138.0244"/>
<polygon fill="#000000" stroke="#000000" points="91.0108,-1134.8161 82.7866,-1141.4955 93.381,-1141.4027 91.0108,-1134.8161"/>
</g>
<!-- m_projected_DOS -->
<g id="proc~~siesta_analysis~~UsesGraph_node10" class="node">
<title>m_projected_DOS</title>
<polygon fill="#337ab7" stroke="#337ab7" points="105.5,-1116 5.5,-1116 5.5,-1092 105.5,-1092 105.5,-1116"/>
<text text-anchor="middle" x="55.5" y="-1101.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_projected_DOS</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_projected_DOS -->
<g id="proc~~siesta_analysis~~UsesGraph_edge9" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_projected_DOS</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.3792,-738.0609C182.9459,-794.1448 157.6849,-1028.9872 111,-1083 110.1474,-1083.9865 109.2434,-1084.9267 108.2953,-1085.8229"/>
<polygon fill="#000000" stroke="#000000" points="106.1573,-1083.0514 100.2799,-1091.8666 110.3717,-1088.6407 106.1573,-1083.0514"/>
</g>
<!-- units -->
<g id="proc~~siesta_analysis~~UsesGraph_node11" class="node">
<title>units</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-1074 28.5,-1074 28.5,-1050 82.5,-1050 82.5,-1074"/>
<text text-anchor="middle" x="55.5" y="-1059.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">units</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;units -->
<g id="proc~~siesta_analysis~~UsesGraph_edge10" class="edge">
<title>proc~siesta_analysis&#45;&gt;units</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.0043,-738.0121C181.3298,-789.8677 152.7499,-994.032 111,-1041 105.9651,-1046.6642 99.241,-1050.8072 92.2143,-1053.8354"/>
<polygon fill="#000000" stroke="#000000" points="90.7944,-1050.6268 82.5751,-1057.3122 93.1694,-1057.2116 90.7944,-1050.6268"/>
</g>
<!-- sparse_matrices -->
<g id="proc~~siesta_analysis~~UsesGraph_node12" class="node">
<title>sparse_matrices</title>
<polygon fill="#337ab7" stroke="#337ab7" points="101,-1032 10,-1032 10,-1008 101,-1008 101,-1032"/>
<text text-anchor="middle" x="55.5" y="-1017.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">sparse_matrices</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;sparse_matrices -->
<g id="proc~~siesta_analysis~~UsesGraph_edge11" class="edge">
<title>proc~siesta_analysis&#45;&gt;sparse_matrices</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.4603,-738.3109C179.3129,-786.1623 147.7598,-959.1057 111,-999 109.9747,-1000.1128 108.8843,-1001.167 107.7397,-1002.1657"/>
<polygon fill="#000000" stroke="#000000" points="105.6572,-999.3516 99.5141,-1007.9837 109.6994,-1005.0666 105.6572,-999.3516"/>
</g>
<!-- files -->
<g id="proc~~siesta_analysis~~UsesGraph_node13" class="node">
<title>files</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-990 28.5,-990 28.5,-966 82.5,-966 82.5,-990"/>
<text text-anchor="middle" x="55.5" y="-975.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">files</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;files -->
<g id="proc~~siesta_analysis~~UsesGraph_edge12" class="edge">
<title>proc~siesta_analysis&#45;&gt;files</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.8886,-738.1363C186.3458,-775.8387 173.5492,-892.2776 111,-957 105.7827,-962.3986 99.0383,-966.4253 92.059,-969.4237"/>
<polygon fill="#000000" stroke="#000000" points="90.7107,-966.19 82.5176,-972.9074 93.1115,-972.7654 90.7107,-966.19"/>
</g>
<!-- siesta_options -->
<g id="proc~~siesta_analysis~~UsesGraph_node14" class="node">
<title>siesta_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="96,-948 15,-948 15,-924 96,-924 96,-948"/>
<text text-anchor="middle" x="55.5" y="-933.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_options</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;siesta_options -->
<g id="proc~~siesta_analysis~~UsesGraph_edge13" class="edge">
<title>proc~siesta_analysis&#45;&gt;siesta_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.8544,-738.0191C182.7291,-770.9494 164.0849,-863.5838 111,-915 109.1222,-916.8187 107.0714,-918.4833 104.9003,-920.0062"/>
<polygon fill="#000000" stroke="#000000" points="102.8942,-917.1253 96.0418,-925.2058 106.4377,-923.1622 102.8942,-917.1253"/>
</g>
<!-- alloc -->
<g id="proc~~siesta_analysis~~UsesGraph_node15" class="node">
<title>alloc</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-906 28.5,-906 28.5,-882 82.5,-882 82.5,-906"/>
<text text-anchor="middle" x="55.5" y="-891.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">alloc</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;alloc -->
<g id="proc~~siesta_analysis~~UsesGraph_edge14" class="edge">
<title>proc~siesta_analysis&#45;&gt;alloc</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M186.2354,-738.1241C178.1619,-765.8833 154.6806,-834.6103 111,-873 105.6449,-877.7065 99.1293,-881.403 92.472,-884.2916"/>
<polygon fill="#000000" stroke="#000000" points="90.8537,-881.1615 82.7356,-887.9693 93.3273,-887.7099 90.8537,-881.1615"/>
</g>
<!-- siesta_cml -->
<g id="proc~~siesta_analysis~~UsesGraph_node16" class="node">
<title>siesta_cml</title>
<polygon fill="#337ab7" stroke="#337ab7" points="87,-864 24,-864 24,-840 87,-840 87,-864"/>
<text text-anchor="middle" x="55.5" y="-849.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_cml</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;siesta_cml -->
<g id="proc~~siesta_analysis~~UsesGraph_edge15" class="edge">
<title>proc~siesta_analysis&#45;&gt;siesta_cml</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M183.4266,-738.1525C172.0559,-759.7511 145.5498,-804.9918 111,-831 106.576,-834.3303 101.5631,-837.1879 96.4036,-839.6244"/>
<polygon fill="#000000" stroke="#000000" points="94.9083,-836.4564 87.0537,-843.5667 97.628,-842.9065 94.9083,-836.4564"/>
</g>
<!-- fdf -->
<g id="proc~~siesta_analysis~~UsesGraph_node17" class="node">
<title>fdf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-822 28.5,-822 28.5,-798 82.5,-798 82.5,-822"/>
<text text-anchor="middle" x="55.5" y="-807.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fdf</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;fdf -->
<g id="proc~~siesta_analysis~~UsesGraph_edge16" class="edge">
<title>proc~siesta_analysis&#45;&gt;fdf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M177.086,-738.0529C162.3324,-751.8568 136.4914,-774.4381 111,-789 105.0499,-792.399 98.445,-795.4494 91.9272,-798.1029"/>
<polygon fill="#000000" stroke="#000000" points="90.6149,-794.8575 82.5267,-801.7009 93.1172,-801.395 90.6149,-794.8575"/>
</g>
<!-- m_ksv -->
<g id="proc~~siesta_analysis~~UsesGraph_node18" class="node">
<title>m_ksv</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-780 28.5,-780 28.5,-756 82.5,-756 82.5,-780"/>
<text text-anchor="middle" x="55.5" y="-765.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ksv</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_ksv -->
<g id="proc~~siesta_analysis~~UsesGraph_edge17" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_ksv</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M151.101,-738.0355C132.6995,-743.8031 110.7546,-750.6814 92.5337,-756.3924"/>
<polygon fill="#000000" stroke="#000000" points="91.3358,-753.0999 82.8403,-759.4306 93.4294,-759.7795 91.3358,-753.0999"/>
</g>
<!-- m_forces -->
<g id="proc~~siesta_analysis~~UsesGraph_node19" class="node">
<title>m_forces</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-738 27,-738 27,-714 84,-714 84,-738"/>
<text text-anchor="middle" x="55.5" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_forces</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_forces -->
<g id="proc~~siesta_analysis~~UsesGraph_edge18" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_forces</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M146.7331,-726C130.0201,-726 110.9821,-726 94.6363,-726"/>
<polygon fill="#000000" stroke="#000000" points="94.3351,-722.5001 84.3351,-726 94.3351,-729.5001 94.3351,-722.5001"/>
</g>
<!-- m_partial_charges -->
<g id="proc~~siesta_analysis~~UsesGraph_node20" class="node">
<title>m_partial_charges</title>
<polygon fill="#337ab7" stroke="#337ab7" points="106,-696 5,-696 5,-672 106,-672 106,-696"/>
<text text-anchor="middle" x="55.5" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_partial_charges</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_partial_charges -->
<g id="proc~~siesta_analysis~~UsesGraph_edge19" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_partial_charges</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M151.101,-713.9645C136.3827,-709.3513 119.3975,-704.0276 103.8642,-699.1589"/>
<polygon fill="#000000" stroke="#000000" points="104.4937,-695.6884 93.9046,-696.0373 102.4001,-702.368 104.4937,-695.6884"/>
</g>
<!-- basis_enthalpy -->
<g id="proc~~siesta_analysis~~UsesGraph_node21" class="node">
<title>basis_enthalpy</title>
<polygon fill="#337ab7" stroke="#337ab7" points="97.5,-654 13.5,-654 13.5,-630 97.5,-630 97.5,-654"/>
<text text-anchor="middle" x="55.5" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">basis_enthalpy</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;basis_enthalpy -->
<g id="proc~~siesta_analysis~~UsesGraph_edge20" class="edge">
<title>proc~siesta_analysis&#45;&gt;basis_enthalpy</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M177.086,-713.9471C162.3324,-700.1432 136.4914,-677.5619 111,-663 108.0019,-661.2873 104.8375,-659.6632 101.6018,-658.1337"/>
<polygon fill="#000000" stroke="#000000" points="102.9361,-654.897 92.3729,-654.0791 100.1205,-661.3058 102.9361,-654.897"/>
</g>
<!-- m_energies -->
<g id="proc~~siesta_analysis~~UsesGraph_node22" class="node">
<title>m_energies</title>
<polygon fill="#337ab7" stroke="#337ab7" points="90,-612 21,-612 21,-588 90,-588 90,-612"/>
<text text-anchor="middle" x="55.5" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_energies</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_energies -->
<g id="proc~~siesta_analysis~~UsesGraph_edge21" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_energies</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M183.4266,-713.8475C172.0559,-692.2489 145.5498,-647.0082 111,-621 107.4312,-618.3135 103.4792,-615.9346 99.3762,-613.8362"/>
<polygon fill="#000000" stroke="#000000" points="100.7944,-610.6363 90.2428,-609.6799 97.895,-617.0076 100.7944,-610.6363"/>
</g>
<!-- m_dipol -->
<g id="proc~~siesta_analysis~~UsesGraph_node23" class="node">
<title>m_dipol</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-570 28.5,-570 28.5,-546 82.5,-546 82.5,-570"/>
<text text-anchor="middle" x="55.5" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_dipol</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_dipol -->
<g id="proc~~siesta_analysis~~UsesGraph_edge22" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_dipol</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M186.2354,-713.8759C178.1619,-686.1167 154.6806,-617.3897 111,-579 105.6449,-574.2935 99.1293,-570.597 92.472,-567.7084"/>
<polygon fill="#000000" stroke="#000000" points="93.3273,-564.2901 82.7356,-564.0307 90.8537,-570.8385 93.3273,-564.2901"/>
</g>
<!-- m_gamma -->
<g id="proc~~siesta_analysis~~UsesGraph_node24" class="node">
<title>m_gamma</title>
<polygon fill="#337ab7" stroke="#337ab7" points="87.5,-528 23.5,-528 23.5,-504 87.5,-504 87.5,-528"/>
<text text-anchor="middle" x="55.5" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_gamma</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_gamma -->
<g id="proc~~siesta_analysis~~UsesGraph_edge23" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_gamma</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.8544,-713.9809C182.7291,-681.0506 164.0849,-588.4162 111,-537 106.9762,-533.1027 102.1579,-529.9136 97.0641,-527.3076"/>
<polygon fill="#000000" stroke="#000000" points="98.2746,-524.0171 87.7098,-523.2197 95.4715,-530.4313 98.2746,-524.0171"/>
</g>
<!-- m_steps -->
<g id="proc~~siesta_analysis~~UsesGraph_node25" class="node">
<title>m_steps</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-486 28.5,-486 28.5,-462 82.5,-462 82.5,-486"/>
<text text-anchor="middle" x="55.5" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_steps</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_steps -->
<g id="proc~~siesta_analysis~~UsesGraph_edge24" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_steps</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.8886,-713.8637C186.3458,-676.1613 173.5492,-559.7224 111,-495 105.7827,-489.6014 99.0383,-485.5747 92.059,-482.5763"/>
<polygon fill="#000000" stroke="#000000" points="93.1115,-479.2346 82.5176,-479.0926 90.7107,-485.81 93.1115,-479.2346"/>
</g>
<!-- writewave -->
<g id="proc~~siesta_analysis~~UsesGraph_node26" class="node">
<title>writewave</title>
<polygon fill="#337ab7" stroke="#337ab7" points="85.5,-444 25.5,-444 25.5,-420 85.5,-420 85.5,-444"/>
<text text-anchor="middle" x="55.5" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">writewave</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;writewave -->
<g id="proc~~siesta_analysis~~UsesGraph_edge25" class="edge">
<title>proc~siesta_analysis&#45;&gt;writewave</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.4603,-713.6891C179.3129,-665.8377 147.7598,-492.8943 111,-453 106.602,-448.227 101.0074,-444.5314 95.0716,-441.6719"/>
<polygon fill="#000000" stroke="#000000" points="96.1685,-438.3401 85.5859,-437.8322 93.542,-444.8287 96.1685,-438.3401"/>
</g>
<!-- band -->
<g id="proc~~siesta_analysis~~UsesGraph_node27" class="node">
<title>band</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-402 28.5,-402 28.5,-378 82.5,-378 82.5,-402"/>
<text text-anchor="middle" x="55.5" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">band</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;band -->
<g id="proc~~siesta_analysis~~UsesGraph_edge26" class="edge">
<title>proc~siesta_analysis&#45;&gt;band</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.0043,-713.9879C181.3298,-662.1323 152.7499,-457.968 111,-411 105.9651,-405.3358 99.241,-401.1928 92.2143,-398.1646"/>
<polygon fill="#000000" stroke="#000000" points="93.1694,-394.7884 82.5751,-394.6878 90.7944,-401.3732 93.1694,-394.7884"/>
</g>
<!-- m_siesta2wannier90 -->
<g id="proc~~siesta_analysis~~UsesGraph_node28" class="node">
<title>m_siesta2wannier90</title>
<polygon fill="#337ab7" stroke="#337ab7" points="111,-360 0,-360 0,-336 111,-336 111,-360"/>
<text text-anchor="middle" x="55.5" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_siesta2wannier90</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_siesta2wannier90 -->
<g id="proc~~siesta_analysis~~UsesGraph_edge27" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_siesta2wannier90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.3792,-713.9391C182.9459,-657.8552 157.6849,-423.0128 111,-369 110.1474,-368.0135 109.2434,-367.0733 108.2953,-366.1771"/>
<polygon fill="#000000" stroke="#000000" points="110.3717,-363.3593 100.2799,-360.1334 106.1573,-368.9486 110.3717,-363.3593"/>
</g>
<!-- m_iodm_old -->
<g id="proc~~siesta_analysis~~UsesGraph_node29" class="node">
<title>m_iodm_old</title>
<polygon fill="#337ab7" stroke="#337ab7" points="91,-318 20,-318 20,-294 91,-294 91,-318"/>
<text text-anchor="middle" x="55.5" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_iodm_old</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_iodm_old -->
<g id="proc~~siesta_analysis~~UsesGraph_edge28" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_iodm_old</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.669,-713.7588C184.3448,-653.415 162.6089,-388.0657 111,-327 108.0013,-323.4518 104.337,-320.5021 100.3346,-318.05"/>
<polygon fill="#000000" stroke="#000000" points="101.6664,-314.8022 91.1598,-313.4379 98.5224,-321.0564 101.6664,-314.8022"/>
</g>
<!-- siesta_geom -->
<g id="proc~~siesta_analysis~~UsesGraph_node30" class="node">
<title>siesta_geom</title>
<polygon fill="#337ab7" stroke="#337ab7" points="92,-276 19,-276 19,-252 92,-252 92,-276"/>
<text text-anchor="middle" x="55.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_geom</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;siesta_geom -->
<g id="proc~~siesta_analysis~~UsesGraph_edge29" class="edge">
<title>proc~siesta_analysis&#45;&gt;siesta_geom</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.9198,-713.7757C185.6506,-649.7313 167.6096,-353.2258 111,-285 108.2247,-281.6553 104.8569,-278.8426 101.1673,-276.4775"/>
<polygon fill="#000000" stroke="#000000" points="102.584,-273.2686 92.1012,-271.7314 99.3374,-279.4702 102.584,-273.2686"/>
</g>
<!-- m_mpi_utils -->
<g id="proc~~siesta_analysis~~UsesGraph_node31" class="node">
<title>m_mpi_utils</title>
<polygon fill="#337ab7" stroke="#337ab7" points="90.5,-234 20.5,-234 20.5,-210 90.5,-210 90.5,-234"/>
<text text-anchor="middle" x="55.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_mpi_utils</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_mpi_utils -->
<g id="proc~~siesta_analysis~~UsesGraph_edge30" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_mpi_utils</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.1335,-713.9715C186.8596,-646.808 172.6832,-318.4887 111,-243 107.9037,-239.2107 104.0456,-236.1045 99.8151,-233.5586"/>
<polygon fill="#000000" stroke="#000000" points="101.2499,-230.3637 90.7332,-229.0799 98.1539,-236.6418 101.2499,-230.3637"/>
</g>
<!-- m_local_DOS -->
<g id="proc~~siesta_analysis~~UsesGraph_node32" class="node">
<title>m_local_DOS</title>
<polygon fill="#337ab7" stroke="#337ab7" points="94.5,-192 16.5,-192 16.5,-168 94.5,-168 94.5,-192"/>
<text text-anchor="middle" x="55.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_local_DOS</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_local_DOS -->
<g id="proc~~siesta_analysis~~UsesGraph_edge31" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_local_DOS</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.3034,-713.8714C187.9246,-643.0891 177.6826,-283.6723 111,-201 108.8656,-198.3538 106.3593,-196.0409 103.6123,-194.0193"/>
<polygon fill="#000000" stroke="#000000" points="105.1684,-190.8731 94.781,-188.7865 101.6,-196.8953 105.1684,-190.8731"/>
</g>
<!-- m_spin -->
<g id="proc~~siesta_analysis~~UsesGraph_node33" class="node">
<title>m_spin</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-150 28.5,-150 28.5,-126 82.5,-126 82.5,-150"/>
<text text-anchor="middle" x="55.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_spin</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_spin -->
<g id="proc~~siesta_analysis~~UsesGraph_edge32" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_spin</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.5674,-713.9377C182.4384,-635.8976 147.0586,-204.2048 111,-159 106.23,-153.0201 99.5582,-148.7424 92.489,-145.6826"/>
<polygon fill="#000000" stroke="#000000" points="93.3389,-142.2703 82.7442,-142.2195 90.9948,-148.8661 93.3389,-142.2703"/>
</g>
<!-- flook_siesta -->
<g id="proc~~siesta_analysis~~UsesGraph_node34" class="node">
<title>flook_siesta</title>
<polygon fill="#337ab7" stroke="#337ab7" points="90,-108 21,-108 21,-84 90,-84 90,-108"/>
<text text-anchor="middle" x="55.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">flook_siesta</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;flook_siesta -->
<g id="proc~~siesta_analysis~~UsesGraph_edge33" class="edge">
<title>proc~siesta_analysis&#45;&gt;flook_siesta</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.6814,-713.8454C183.0887,-632.237 149.5771,-165.8301 111,-117 107.7699,-112.9114 103.6497,-109.6186 99.1173,-106.9669"/>
<polygon fill="#000000" stroke="#000000" points="100.5503,-103.7726 90.0187,-102.6167 97.5308,-110.0879 100.5503,-103.7726"/>
</g>
<!-- zmatrix -->
<g id="proc~~siesta_analysis~~UsesGraph_node35" class="node">
<title>zmatrix</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82.5,-66 28.5,-66 28.5,-42 82.5,-42 82.5,-66"/>
<text text-anchor="middle" x="55.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">zmatrix</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;zmatrix -->
<g id="proc~~siesta_analysis~~UsesGraph_edge34" class="edge">
<title>proc~siesta_analysis&#45;&gt;zmatrix</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.7867,-713.8375C183.7138,-628.9976 152.1133,-127.4807 111,-75 106.239,-68.9227 99.5097,-64.6039 92.3724,-61.5348"/>
<polygon fill="#000000" stroke="#000000" points="93.128,-58.0906 82.5332,-58.0766 90.8069,-64.6946 93.128,-58.0906"/>
</g>
<!-- m_pexsi_local_DOS -->
<g id="proc~~siesta_analysis~~UsesGraph_node36" class="node">
<title>m_pexsi_local_DOS</title>
<polygon fill="#337ab7" stroke="#337ab7" points="110,-24 1,-24 1,0 110,0 110,-24"/>
<text text-anchor="middle" x="55.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_pexsi_local_DOS</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;m_pexsi_local_DOS -->
<g id="proc~~siesta_analysis~~UsesGraph_edge35" class="edge">
<title>proc~siesta_analysis&#45;&gt;m_pexsi_local_DOS</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.8835,-713.9089C184.3134,-626.1811 154.6668,-89.156 111,-33 110.4052,-32.235 109.7791,-31.4979 109.1249,-30.7876"/>
<polygon fill="#000000" stroke="#000000" points="111.1014,-27.8784 101.1809,-24.1588 106.6165,-33.253 111.1014,-27.8784"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="490pt" height="32pt"
 viewBox="0.00 0.00 489.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 485.5,-28 485.5,4 -4,4"/>
<!-- Module -->
<g id="node1" class="node">
<title>Module</title>
<polygon fill="#337ab7" stroke="#337ab7" points="54,-24 0,-24 0,0 54,0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Module</text>
</g>
<!-- Submodule -->
<g id="node2" class="node">
<title>Submodule</title>
<polygon fill="#5bc0de" stroke="#5bc0de" points="139.5,-24 72.5,-24 72.5,0 139.5,0 139.5,-24"/>
<text text-anchor="middle" x="106" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Submodule</text>
</g>
<!-- Subroutine -->
<g id="node3" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="222,-24 158,-24 158,0 222,0 222,-24"/>
<text text-anchor="middle" x="190" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Subroutine</text>
</g>
<!-- Function -->
<g id="node4" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="294,-24 240,-24 240,0 294,0 294,-24"/>
<text text-anchor="middle" x="267" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Function</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="366,-24 312,-24 312,0 366,0 366,-24"/>
<text text-anchor="middle" x="339" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="481.5,-24 384.5,-24 384.5,0 481.5,0 481.5,-24"/>
<text text-anchor="middle" x="433" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a submodule to the (sub)module which it is
    descended from. Dashed arrows point from a module or program unit to 
    modules which it uses.
    </p>
    </div></div></div></div>
      </li>
      
      </ul>
    </div>
    


    
    <p>Check that we are converged in geometry,
 if strictly required,
 before carrying out any analysis.</p>
<p>@code
@endcode</p>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-relaxd"></span>logical</td>
  <td></td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>relaxd</strong></td><td></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: proc~~siesta_analysis~~CallsGraph Pages: 1 -->
<svg id="procsiesta_analysisCallsGraph" width="280pt" height="1502pt"
 viewBox="0.00 0.00 280.00 1502.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~siesta_analysis~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 1498)">
<title>proc~~siesta_analysis~~CallsGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1498 276,-1498 276,4 -4,4"/>
<!-- proc~siesta_analysis -->
<g id="proc~~siesta_analysis~~CallsGraph_node1" class="node">
<title>proc~siesta_analysis</title>
<polygon fill="none" stroke="#000000" points="85,-759 0,-759 0,-735 85,-735 85,-759"/>
<text text-anchor="middle" x="42.5" y="-744.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">siesta_analysis</text>
</g>
<!-- cmlstartmodule -->
<g id="proc~~siesta_analysis~~CallsGraph_node2" class="node">
<title>cmlstartmodule</title>
<polygon fill="#777777" stroke="#777777" points="239,-1494 154,-1494 154,-1470 239,-1470 239,-1494"/>
<text text-anchor="middle" x="196.5" y="-1479.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">cmlstartmodule</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;cmlstartmodule -->
<g id="proc~~siesta_analysis~~CallsGraph_edge1" class="edge">
<title>proc~siesta_analysis&#45;&gt;cmlstartmodule</title>
<path fill="none" stroke="#000000" d="M43.0274,-759.2108C47.0095,-848.9962 73.4993,-1405.1182 121,-1461 127.018,-1468.0798 135.1986,-1472.8767 143.9596,-1476.1049"/>
<polygon fill="#000000" stroke="#000000" points="143.0341,-1479.4815 153.6192,-1479.0259 145.0604,-1472.7812 143.0341,-1479.4815"/>
</g>
<!-- local_dos -->
<g id="proc~~siesta_analysis~~CallsGraph_node3" class="node">
<title>local_dos</title>
<polygon fill="#777777" stroke="#777777" points="225.5,-1452 167.5,-1452 167.5,-1428 225.5,-1428 225.5,-1452"/>
<text text-anchor="middle" x="196.5" y="-1437.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">local_dos</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;local_dos -->
<g id="proc~~siesta_analysis~~CallsGraph_edge2" class="edge">
<title>proc~siesta_analysis&#45;&gt;local_dos</title>
<path fill="none" stroke="#000000" d="M43.1063,-759.0396C47.5499,-845.2377 76.1763,-1366.6285 121,-1419 130.0236,-1429.543 143.8423,-1435.0184 157.2025,-1437.7906"/>
<polygon fill="#000000" stroke="#000000" points="156.8107,-1441.2728 167.2428,-1439.4229 157.934,-1434.3635 156.8107,-1441.2728"/>
</g>
<!-- scell -->
<g id="proc~~siesta_analysis~~CallsGraph_node4" class="node">
<title>scell</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-1410 169.5,-1410 169.5,-1386 223.5,-1386 223.5,-1410"/>
<text text-anchor="middle" x="196.5" y="-1395.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">scell</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;scell -->
<g id="proc~~siesta_analysis~~CallsGraph_edge3" class="edge">
<title>proc~siesta_analysis&#45;&gt;scell</title>
<path fill="none" stroke="#000000" d="M43.2065,-759.0767C48.174,-842.2367 78.8855,-1328.1745 121,-1377 130.5104,-1388.0259 145.2644,-1393.503 159.2156,-1396.1438"/>
<polygon fill="#000000" stroke="#000000" points="158.743,-1399.6119 169.1458,-1397.6043 159.7616,-1392.6864 158.743,-1399.6119"/>
</g>
<!-- siesta_write_forces -->
<g id="proc~~siesta_analysis~~CallsGraph_node5" class="node">
<title>siesta_write_forces</title>
<polygon fill="#777777" stroke="#777777" points="248.5,-1368 144.5,-1368 144.5,-1344 248.5,-1344 248.5,-1368"/>
<text text-anchor="middle" x="196.5" y="-1353.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_write_forces</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;siesta_write_forces -->
<g id="proc~~siesta_analysis~~CallsGraph_edge4" class="edge">
<title>proc~siesta_analysis&#45;&gt;siesta_write_forces</title>
<path fill="none" stroke="#000000" d="M43.3156,-759.0323C48.8252,-838.8121 81.5761,-1289.6964 121,-1335 124.9479,-1339.5367 129.7834,-1343.1328 135.0823,-1345.9779"/>
<polygon fill="#000000" stroke="#000000" points="133.8021,-1349.2388 144.3626,-1350.0904 136.6381,-1342.839 133.8021,-1349.2388"/>
</g>
<!-- xa_last -->
<g id="proc~~siesta_analysis~~CallsGraph_node6" class="node">
<title>xa_last</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-1326 169.5,-1326 169.5,-1302 223.5,-1302 223.5,-1326"/>
<text text-anchor="middle" x="196.5" y="-1311.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">xa_last</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;xa_last -->
<g id="proc~~siesta_analysis~~CallsGraph_edge5" class="edge">
<title>proc~siesta_analysis&#45;&gt;xa_last</title>
<path fill="none" stroke="#000000" d="M43.4735,-759.3968C49.6526,-836.7543 84.3268,-1251.2835 121,-1293 130.6138,-1303.9358 145.3847,-1309.3982 159.3206,-1312.0524"/>
<polygon fill="#000000" stroke="#000000" points="158.8287,-1315.5176 169.2348,-1313.5268 159.8585,-1308.5938 158.8287,-1315.5176"/>
</g>
<!-- cmladdproperty -->
<g id="proc~~siesta_analysis~~CallsGraph_node7" class="node">
<title>cmladdproperty</title>
<polygon fill="#777777" stroke="#777777" points="240,-1284 153,-1284 153,-1260 240,-1260 240,-1284"/>
<text text-anchor="middle" x="196.5" y="-1269.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">cmladdproperty</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;cmladdproperty -->
<g id="proc~~siesta_analysis~~CallsGraph_edge6" class="edge">
<title>proc~siesta_analysis&#45;&gt;cmladdproperty</title>
<path fill="none" stroke="#000000" d="M42.6702,-759.1856C43.8869,-828.7205 53.3144,-1174.9101 121,-1251 126.913,-1257.6472 134.7313,-1262.2687 143.0957,-1265.4657"/>
<polygon fill="#000000" stroke="#000000" points="142.1092,-1268.8245 152.6991,-1268.502 144.2194,-1262.1502 142.1092,-1268.8245"/>
</g>
<!-- slua_call -->
<g id="proc~~siesta_analysis~~CallsGraph_node8" class="node">
<title>slua_call</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-1242 169.5,-1242 169.5,-1218 223.5,-1218 223.5,-1242"/>
<text text-anchor="middle" x="196.5" y="-1227.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">slua_call</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;slua_call -->
<g id="proc~~siesta_analysis~~CallsGraph_edge7" class="edge">
<title>proc~siesta_analysis&#45;&gt;slua_call</title>
<path fill="none" stroke="#000000" d="M42.8533,-759.025C45.0244,-824.7227 58.6071,-1139.8266 121,-1209 130.7525,-1219.8123 145.5462,-1225.2545 159.4615,-1227.9269"/>
<polygon fill="#000000" stroke="#000000" points="158.9437,-1231.3883 169.3542,-1229.4205 159.9888,-1224.4667 158.9437,-1231.3883"/>
</g>
<!-- ucell -->
<g id="proc~~siesta_analysis~~CallsGraph_node9" class="node">
<title>ucell</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-1200 169.5,-1200 169.5,-1176 223.5,-1176 223.5,-1200"/>
<text text-anchor="middle" x="196.5" y="-1185.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ucell</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;ucell -->
<g id="proc~~siesta_analysis~~CallsGraph_edge8" class="edge">
<title>proc~siesta_analysis&#45;&gt;ucell</title>
<path fill="none" stroke="#000000" d="M43.0817,-759.145C46.3077,-821.4633 63.971,-1104.8107 121,-1167 130.7456,-1177.6275 145.3623,-1183.0547 159.1465,-1185.766"/>
<polygon fill="#000000" stroke="#000000" points="159.0141,-1189.2868 169.4305,-1187.3511 160.0804,-1182.3685 159.0141,-1189.2868"/>
</g>
<!-- setup_wfs_list -->
<g id="proc~~siesta_analysis~~CallsGraph_node10" class="node">
<title>setup_wfs_list</title>
<polygon fill="#777777" stroke="#777777" points="236,-1158 157,-1158 157,-1134 236,-1134 236,-1158"/>
<text text-anchor="middle" x="196.5" y="-1143.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">setup_wfs_list</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;setup_wfs_list -->
<g id="proc~~siesta_analysis~~CallsGraph_edge9" class="edge">
<title>proc~siesta_analysis&#45;&gt;setup_wfs_list</title>
<path fill="none" stroke="#000000" d="M43.3496,-759.0779C47.6928,-817.4402 69.2555,-1069.6933 121,-1125 127.9713,-1132.4512 137.3381,-1137.339 147.0984,-1140.5257"/>
<polygon fill="#000000" stroke="#000000" points="146.349,-1143.9486 156.9157,-1143.1773 148.1743,-1137.1908 146.349,-1143.9486"/>
</g>
<!-- wwave -->
<g id="proc~~siesta_analysis~~CallsGraph_node11" class="node">
<title>wwave</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-1116 169.5,-1116 169.5,-1092 223.5,-1092 223.5,-1116"/>
<text text-anchor="middle" x="196.5" y="-1101.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">wwave</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;wwave -->
<g id="proc~~siesta_analysis~~CallsGraph_edge10" class="edge">
<title>proc~siesta_analysis&#45;&gt;wwave</title>
<path fill="none" stroke="#000000" d="M43.6961,-759.1677C49.2883,-813.6444 74.5595,-1034.5778 121,-1083 130.9058,-1093.3285 145.4179,-1098.7147 159.0785,-1101.4763"/>
<polygon fill="#000000" stroke="#000000" points="158.8396,-1104.9828 169.2685,-1103.1149 159.9511,-1098.0716 158.8396,-1104.9828"/>
</g>
<!-- fdf_get -->
<g id="proc~~siesta_analysis~~CallsGraph_node12" class="node">
<title>fdf_get</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-1074 169.5,-1074 169.5,-1050 223.5,-1050 223.5,-1074"/>
<text text-anchor="middle" x="196.5" y="-1059.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fdf_get</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;fdf_get -->
<g id="proc~~siesta_analysis~~CallsGraph_edge11" class="edge">
<title>proc~siesta_analysis&#45;&gt;fdf_get</title>
<path fill="none" stroke="#000000" d="M44.1504,-759.3137C51.1394,-809.6939 79.8429,-999.414 121,-1041 131.0668,-1051.1717 145.6076,-1056.53 159.2461,-1059.3131"/>
<polygon fill="#000000" stroke="#000000" points="158.9767,-1062.8155 169.4107,-1060.9764 160.1072,-1055.9073 158.9767,-1062.8155"/>
</g>
<!-- pexsi_dos -->
<g id="proc~~siesta_analysis~~CallsGraph_node13" class="node">
<title>pexsi_dos</title>
<polygon fill="#777777" stroke="#777777" points="227,-1032 166,-1032 166,-1008 227,-1008 227,-1032"/>
<text text-anchor="middle" x="196.5" y="-1017.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pexsi_dos</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;pexsi_dos -->
<g id="proc~~siesta_analysis~~CallsGraph_edge12" class="edge">
<title>proc~siesta_analysis&#45;&gt;pexsi_dos</title>
<path fill="none" stroke="#000000" d="M44.6881,-759.0815C53.1394,-804.4822 84.9794,-964.0683 121,-999 130.4021,-1008.1179 143.4092,-1013.3479 155.9804,-1016.3248"/>
<polygon fill="#000000" stroke="#000000" points="155.4063,-1019.7787 165.8918,-1018.2603 156.748,-1012.9085 155.4063,-1019.7787"/>
</g>
<!-- ksv_pol -->
<g id="proc~~siesta_analysis~~CallsGraph_node14" class="node">
<title>ksv_pol</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-990 169.5,-990 169.5,-966 223.5,-966 223.5,-990"/>
<text text-anchor="middle" x="196.5" y="-975.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ksv_pol</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;ksv_pol -->
<g id="proc~~siesta_analysis~~CallsGraph_edge14" class="edge">
<title>proc~siesta_analysis&#45;&gt;ksv_pol</title>
<path fill="none" stroke="#000000" d="M43.3133,-759.0397C46.3932,-794.8246 60.4733,-901.4914 121,-957 131.4673,-966.5995 145.9522,-971.862 159.4376,-974.7283"/>
<polygon fill="#000000" stroke="#000000" points="159.0182,-978.2081 169.4721,-976.4853 160.2256,-971.313 159.0182,-978.2081"/>
</g>
<!-- dipol -->
<g id="proc~~siesta_analysis~~CallsGraph_node15" class="node">
<title>dipol</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-948 169.5,-948 169.5,-924 223.5,-924 223.5,-948"/>
<text text-anchor="middle" x="196.5" y="-933.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dipol</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;dipol -->
<g id="proc~~siesta_analysis~~CallsGraph_edge13" class="edge">
<title>proc~siesta_analysis&#45;&gt;dipol</title>
<path fill="none" stroke="#000000" d="M44.6078,-759.2691C50.5919,-790.2799 70.6285,-872.3583 121,-915 131.7572,-924.1065 146.1716,-929.2816 159.5219,-932.216"/>
<polygon fill="#000000" stroke="#000000" points="158.9755,-935.6742 169.4452,-934.0511 160.2484,-928.7909 158.9755,-935.6742"/>
</g>
<!-- optical -->
<g id="proc~~siesta_analysis~~CallsGraph_node16" class="node">
<title>optical</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-906 169.5,-906 169.5,-882 223.5,-882 223.5,-906"/>
<text text-anchor="middle" x="196.5" y="-891.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">optical</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;optical -->
<g id="proc~~siesta_analysis~~CallsGraph_edge17" class="edge">
<title>proc~siesta_analysis&#45;&gt;optical</title>
<path fill="none" stroke="#000000" d="M46.6094,-759.1454C55.7768,-784.3632 80.3499,-842.5787 121,-873 132.0016,-881.2333 146.0742,-886.2387 159.0822,-889.2818"/>
<polygon fill="#000000" stroke="#000000" points="158.7121,-892.7776 169.207,-891.3257 160.0973,-885.916 158.7121,-892.7776"/>
</g>
<!-- pexsi_local_dos -->
<g id="proc~~siesta_analysis~~CallsGraph_node17" class="node">
<title>pexsi_local_dos</title>
<polygon fill="#777777" stroke="#777777" points="240.5,-864 152.5,-864 152.5,-840 240.5,-840 240.5,-864"/>
<text text-anchor="middle" x="196.5" y="-849.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">pexsi_local_dos</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;pexsi_local_dos -->
<g id="proc~~siesta_analysis~~CallsGraph_edge18" class="edge">
<title>proc~siesta_analysis&#45;&gt;pexsi_local_dos</title>
<path fill="none" stroke="#000000" d="M50.5999,-759.2758C63.3671,-777.6513 89.9402,-812.1591 121,-831 127.7068,-835.0684 135.2222,-838.3694 142.8419,-841.0423"/>
<polygon fill="#000000" stroke="#000000" points="141.906,-844.4172 152.4962,-844.1026 144.0212,-837.7444 141.906,-844.4172"/>
</g>
<!-- message -->
<g id="proc~~siesta_analysis~~CallsGraph_node18" class="node">
<title>message</title>
<polygon fill="#777777" stroke="#777777" points="224.5,-822 168.5,-822 168.5,-798 224.5,-798 224.5,-822"/>
<text text-anchor="middle" x="196.5" y="-807.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">message</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;message -->
<g id="proc~~siesta_analysis~~CallsGraph_edge15" class="edge">
<title>proc~siesta_analysis&#45;&gt;message</title>
<path fill="none" stroke="#000000" d="M62.2438,-759.1373C77.7763,-768.2936 100.1975,-780.6602 121,-789 132.9376,-793.7858 146.3538,-797.9006 158.5288,-801.1874"/>
<polygon fill="#000000" stroke="#000000" points="157.8457,-804.626 168.4042,-803.7502 159.604,-797.8504 157.8457,-804.626"/>
</g>
<!-- eo -->
<g id="proc~~siesta_analysis~~CallsGraph_node19" class="node">
<title>eo</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-780 169.5,-780 169.5,-756 223.5,-756 223.5,-780"/>
<text text-anchor="middle" x="196.5" y="-765.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">eo</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;eo -->
<g id="proc~~siesta_analysis~~CallsGraph_edge16" class="edge">
<title>proc~siesta_analysis&#45;&gt;eo</title>
<path fill="none" stroke="#000000" d="M85.3976,-752.8497C108.6005,-756.0137 136.9808,-759.8837 159.2496,-762.9204"/>
<polygon fill="#000000" stroke="#000000" points="158.9439,-766.411 169.3251,-764.2943 159.8898,-759.4752 158.9439,-766.411"/>
</g>
<!-- print_spin -->
<g id="proc~~siesta_analysis~~CallsGraph_node20" class="node">
<title>print_spin</title>
<polygon fill="#777777" stroke="#777777" points="226,-738 167,-738 167,-714 226,-714 226,-738"/>
<text text-anchor="middle" x="196.5" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">print_spin</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;print_spin -->
<g id="proc~~siesta_analysis~~CallsGraph_edge19" class="edge">
<title>proc~siesta_analysis&#45;&gt;print_spin</title>
<path fill="none" stroke="#000000" d="M85.3976,-741.1503C107.8322,-738.0911 135.107,-734.3718 157.0178,-731.3839"/>
<polygon fill="#000000" stroke="#000000" points="157.5484,-734.8441 166.9838,-730.0249 156.6025,-727.9083 157.5484,-734.8441"/>
</g>
<!-- re_alloc -->
<g id="proc~~siesta_analysis~~CallsGraph_node21" class="node">
<title>re_alloc</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-696 169.5,-696 169.5,-672 223.5,-672 223.5,-696"/>
<text text-anchor="middle" x="196.5" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">re_alloc</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;re_alloc -->
<g id="proc~~siesta_analysis~~CallsGraph_edge20" class="edge">
<title>proc~siesta_analysis&#45;&gt;re_alloc</title>
<path fill="none" stroke="#000000" d="M62.2438,-734.8627C77.7763,-725.7064 100.1975,-713.3398 121,-705 133.2336,-700.0955 147.02,-695.8957 159.4321,-692.5696"/>
<polygon fill="#000000" stroke="#000000" points="160.6593,-695.8679 169.4708,-689.9849 158.9139,-689.089 160.6593,-695.8679"/>
</g>
<!-- write_basis_enthalpy -->
<g id="proc~~siesta_analysis~~CallsGraph_node22" class="node">
<title>write_basis_enthalpy</title>
<polygon fill="#777777" stroke="#777777" points="252.5,-654 140.5,-654 140.5,-630 252.5,-630 252.5,-654"/>
<text text-anchor="middle" x="196.5" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_basis_enthalpy</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;write_basis_enthalpy -->
<g id="proc~~siesta_analysis~~CallsGraph_edge21" class="edge">
<title>proc~siesta_analysis&#45;&gt;write_basis_enthalpy</title>
<path fill="none" stroke="#000000" d="M50.5999,-734.7242C63.3671,-716.3487 89.9402,-681.8409 121,-663 124.1516,-661.0882 127.4819,-659.3459 130.9175,-657.7585"/>
<polygon fill="#000000" stroke="#000000" points="132.3097,-660.9703 140.2081,-653.9088 129.63,-654.5035 132.3097,-660.9703"/>
</g>
<!-- bk -->
<g id="proc~~siesta_analysis~~CallsGraph_node23" class="node">
<title>bk</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-612 169.5,-612 169.5,-588 223.5,-588 223.5,-612"/>
<text text-anchor="middle" x="196.5" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">bk</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;bk -->
<g id="proc~~siesta_analysis~~CallsGraph_edge22" class="edge">
<title>proc~siesta_analysis&#45;&gt;bk</title>
<path fill="none" stroke="#000000" d="M46.6094,-734.8546C55.7768,-709.6368 80.3499,-651.4213 121,-621 132.0016,-612.7667 146.0742,-607.7613 159.0822,-604.7182"/>
<polygon fill="#000000" stroke="#000000" points="160.0973,-608.084 169.207,-602.6743 158.7121,-601.2224 160.0973,-608.084"/>
</g>
<!-- siesta_write_energies -->
<g id="proc~~siesta_analysis~~CallsGraph_node24" class="node">
<title>siesta_write_energies</title>
<polygon fill="#777777" stroke="#777777" points="254.5,-570 138.5,-570 138.5,-546 254.5,-546 254.5,-570"/>
<text text-anchor="middle" x="196.5" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_write_energies</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;siesta_write_energies -->
<g id="proc~~siesta_analysis~~CallsGraph_edge23" class="edge">
<title>proc~siesta_analysis&#45;&gt;siesta_write_energies</title>
<path fill="none" stroke="#000000" d="M44.6078,-734.7309C50.5919,-703.7201 70.6285,-621.6417 121,-579 123.5441,-576.8463 126.2927,-574.9125 129.1835,-573.1762"/>
<polygon fill="#000000" stroke="#000000" points="130.9217,-576.2182 138.2196,-568.5376 127.7249,-569.9908 130.9217,-576.2182"/>
</g>
<!-- de_alloc -->
<g id="proc~~siesta_analysis~~CallsGraph_node25" class="node">
<title>de_alloc</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-528 169.5,-528 169.5,-504 223.5,-504 223.5,-528"/>
<text text-anchor="middle" x="196.5" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">de_alloc</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;de_alloc -->
<g id="proc~~siesta_analysis~~CallsGraph_edge24" class="edge">
<title>proc~siesta_analysis&#45;&gt;de_alloc</title>
<path fill="none" stroke="#000000" d="M43.3133,-734.9603C46.3932,-699.1754 60.4733,-592.5086 121,-537 131.4673,-527.4005 145.9522,-522.138 159.4376,-519.2717"/>
<polygon fill="#000000" stroke="#000000" points="160.2256,-522.687 169.4721,-517.5147 159.0182,-515.7919 160.2256,-522.687"/>
</g>
<!-- read_spmatrix -->
<g id="proc~~siesta_analysis~~CallsGraph_node26" class="node">
<title>read_spmatrix</title>
<polygon fill="#777777" stroke="#777777" points="237,-486 156,-486 156,-462 237,-462 237,-486"/>
<text text-anchor="middle" x="196.5" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">read_spmatrix</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;read_spmatrix -->
<g id="proc~~siesta_analysis~~CallsGraph_edge25" class="edge">
<title>proc~siesta_analysis&#45;&gt;read_spmatrix</title>
<path fill="none" stroke="#000000" d="M44.6881,-734.9185C53.1394,-689.5178 84.9794,-529.9317 121,-495 127.9589,-488.2515 136.8926,-483.6328 146.1627,-480.4811"/>
<polygon fill="#000000" stroke="#000000" points="147.2261,-483.8173 155.8764,-477.6999 145.2992,-477.0877 147.2261,-483.8173"/>
</g>
<!-- scell_last -->
<g id="proc~~siesta_analysis~~CallsGraph_node27" class="node">
<title>scell_last</title>
<polygon fill="#777777" stroke="#777777" points="224.5,-444 168.5,-444 168.5,-420 224.5,-420 224.5,-444"/>
<text text-anchor="middle" x="196.5" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">scell_last</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;scell_last -->
<g id="proc~~siesta_analysis~~CallsGraph_edge26" class="edge">
<title>proc~siesta_analysis&#45;&gt;scell_last</title>
<path fill="none" stroke="#000000" d="M44.1504,-734.6863C51.1394,-684.3061 79.8429,-494.586 121,-453 130.838,-443.0594 144.9489,-437.7161 158.3149,-434.8807"/>
<polygon fill="#000000" stroke="#000000" points="159.0432,-438.307 168.3076,-433.1668 157.8598,-431.4077 159.0432,-438.307"/>
</g>
<!-- fdf_boolean -->
<g id="proc~~siesta_analysis~~CallsGraph_node28" class="node">
<title>fdf_boolean</title>
<polygon fill="#777777" stroke="#777777" points="231,-402 162,-402 162,-378 231,-378 231,-402"/>
<text text-anchor="middle" x="196.5" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fdf_boolean</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;fdf_boolean -->
<g id="proc~~siesta_analysis~~CallsGraph_edge27" class="edge">
<title>proc~siesta_analysis&#45;&gt;fdf_boolean</title>
<path fill="none" stroke="#000000" d="M43.6961,-734.8323C49.2883,-680.3556 74.5595,-459.4222 121,-411 129.1578,-402.4941 140.4395,-397.3402 151.7969,-394.2436"/>
<polygon fill="#000000" stroke="#000000" points="152.7281,-397.6218 161.7205,-392.0195 151.1971,-390.7913 152.7281,-397.6218"/>
</g>
<!-- outcoor -->
<g id="proc~~siesta_analysis~~CallsGraph_node29" class="node">
<title>outcoor</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-360 169.5,-360 169.5,-336 223.5,-336 223.5,-360"/>
<text text-anchor="middle" x="196.5" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">outcoor</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;outcoor -->
<g id="proc~~siesta_analysis~~CallsGraph_edge28" class="edge">
<title>proc~siesta_analysis&#45;&gt;outcoor</title>
<path fill="none" stroke="#000000" d="M43.3496,-734.9221C47.6928,-676.5598 69.2555,-424.3067 121,-369 130.7773,-358.5496 145.2664,-353.1417 158.9447,-350.3968"/>
<polygon fill="#000000" stroke="#000000" points="159.8267,-353.8008 169.1549,-348.7775 158.7301,-346.8872 159.8267,-353.8008"/>
</g>
<!-- siesta_write_positions -->
<g id="proc~~siesta_analysis~~CallsGraph_node30" class="node">
<title>siesta_write_positions</title>
<polygon fill="#777777" stroke="#777777" points="255,-318 138,-318 138,-294 255,-294 255,-318"/>
<text text-anchor="middle" x="196.5" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_write_positions</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;siesta_write_positions -->
<g id="proc~~siesta_analysis~~CallsGraph_edge29" class="edge">
<title>proc~siesta_analysis&#45;&gt;siesta_write_positions</title>
<path fill="none" stroke="#000000" d="M43.0817,-734.855C46.3077,-672.5367 63.971,-389.1893 121,-327 123.4181,-324.3631 126.136,-322.0464 129.0668,-320.0118"/>
<polygon fill="#000000" stroke="#000000" points="130.8835,-323.0047 137.8171,-314.9937 127.4011,-316.9324 130.8835,-323.0047"/>
</g>
<!-- ucell_last -->
<g id="proc~~siesta_analysis~~CallsGraph_node31" class="node">
<title>ucell_last</title>
<polygon fill="#777777" stroke="#777777" points="225,-276 168,-276 168,-252 225,-252 225,-276"/>
<text text-anchor="middle" x="196.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">ucell_last</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;ucell_last -->
<g id="proc~~siesta_analysis~~CallsGraph_edge30" class="edge">
<title>proc~siesta_analysis&#45;&gt;ucell_last</title>
<path fill="none" stroke="#000000" d="M42.8533,-734.975C45.0244,-669.2773 58.6071,-354.1734 121,-285 130.3673,-274.6147 144.3856,-269.1837 157.8091,-266.4028"/>
<polygon fill="#000000" stroke="#000000" points="158.5687,-269.8252 167.8715,-264.7547 157.4372,-262.9172 158.5687,-269.8252"/>
</g>
<!-- projected_dos -->
<g id="proc~~siesta_analysis~~CallsGraph_node32" class="node">
<title>projected_dos</title>
<polygon fill="#777777" stroke="#777777" points="236.5,-234 156.5,-234 156.5,-210 236.5,-210 236.5,-234"/>
<text text-anchor="middle" x="196.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">projected_dos</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;projected_dos -->
<g id="proc~~siesta_analysis~~CallsGraph_edge31" class="edge">
<title>proc~siesta_analysis&#45;&gt;projected_dos</title>
<path fill="none" stroke="#000000" d="M42.6702,-734.8144C43.8869,-665.2795 53.3144,-319.0899 121,-243 127.7141,-235.4522 136.8848,-230.5162 146.5222,-227.3118"/>
<polygon fill="#000000" stroke="#000000" points="147.52,-230.6675 156.2415,-224.652 145.6723,-223.9157 147.52,-230.6675"/>
</g>
<!-- xa -->
<g id="proc~~siesta_analysis~~CallsGraph_node33" class="node">
<title>xa</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-192 169.5,-192 169.5,-168 223.5,-168 223.5,-192"/>
<text text-anchor="middle" x="196.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">xa</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;xa -->
<g id="proc~~siesta_analysis~~CallsGraph_edge32" class="edge">
<title>proc~siesta_analysis&#45;&gt;xa</title>
<path fill="none" stroke="#000000" d="M43.4735,-734.6032C49.6526,-657.2457 84.3268,-242.7165 121,-201 130.6138,-190.0642 145.3847,-184.6018 159.3206,-181.9476"/>
<polygon fill="#000000" stroke="#000000" points="159.8585,-185.4062 169.2348,-180.4732 158.8287,-178.4824 159.8585,-185.4062"/>
</g>
<!-- dhscf -->
<g id="proc~~siesta_analysis~~CallsGraph_node34" class="node">
<title>dhscf</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-150 169.5,-150 169.5,-126 223.5,-126 223.5,-150"/>
<text text-anchor="middle" x="196.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">dhscf</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;dhscf -->
<g id="proc~~siesta_analysis~~CallsGraph_edge33" class="edge">
<title>proc~siesta_analysis&#45;&gt;dhscf</title>
<path fill="none" stroke="#000000" d="M43.3156,-734.9677C48.8252,-655.1879 81.5761,-204.3036 121,-159 130.5585,-148.0159 145.3205,-142.5456 159.2645,-139.8986"/>
<polygon fill="#000000" stroke="#000000" points="159.8067,-143.3565 169.1873,-138.4316 158.7829,-136.4318 159.8067,-143.3565"/>
</g>
<!-- siesta_write_stress_pressure -->
<g id="proc~~siesta_analysis~~CallsGraph_node35" class="node">
<title>siesta_write_stress_pressure</title>
<polygon fill="#777777" stroke="#777777" points="272,-108 121,-108 121,-84 272,-84 272,-108"/>
<text text-anchor="middle" x="196.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_write_stress_pressure</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;siesta_write_stress_pressure -->
<g id="proc~~siesta_analysis~~CallsGraph_edge34" class="edge">
<title>proc~siesta_analysis&#45;&gt;siesta_write_stress_pressure</title>
<path fill="none" stroke="#000000" d="M43.2065,-734.9233C48.174,-651.7633 78.8855,-165.8255 121,-117 121.7553,-116.1243 122.5437,-115.2836 123.3622,-114.4766"/>
<polygon fill="#000000" stroke="#000000" points="125.7781,-117.0286 131.4578,-108.0847 121.4403,-111.5346 125.7781,-117.0286"/>
</g>
<!-- die -->
<g id="proc~~siesta_analysis~~CallsGraph_node36" class="node">
<title>die</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-66 169.5,-66 169.5,-42 223.5,-42 223.5,-66"/>
<text text-anchor="middle" x="196.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">die</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;die -->
<g id="proc~~siesta_analysis~~CallsGraph_edge35" class="edge">
<title>proc~siesta_analysis&#45;&gt;die</title>
<path fill="none" stroke="#000000" d="M43.1063,-734.9604C47.5499,-648.7623 76.1763,-127.3715 121,-75 130.5392,-63.8546 145.4371,-58.3725 159.4872,-55.7602"/>
<polygon fill="#000000" stroke="#000000" points="160.0783,-59.2113 169.4792,-54.3253 159.0833,-52.2824 160.0783,-59.2113"/>
</g>
<!-- bands -->
<g id="proc~~siesta_analysis~~CallsGraph_node37" class="node">
<title>bands</title>
<polygon fill="#777777" stroke="#777777" points="223.5,-24 169.5,-24 169.5,0 223.5,0 223.5,-24"/>
<text text-anchor="middle" x="196.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">bands</text>
</g>
<!-- proc~siesta_analysis&#45;&gt;bands -->
<g id="proc~~siesta_analysis~~CallsGraph_edge36" class="edge">
<title>proc~siesta_analysis&#45;&gt;bands</title>
<path fill="none" stroke="#000000" d="M43.0274,-734.7892C47.0095,-645.0038 73.4993,-88.8818 121,-33 130.5013,-21.8223 145.3933,-16.3351 159.4491,-13.7277"/>
<polygon fill="#000000" stroke="#000000" points="160.0434,-17.1785 169.4472,-12.298 159.0524,-10.2489 160.0434,-17.1785"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,0 64,0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,0 136,0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,0 209.5,0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,0 364,0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,0 436,0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="551.5,-24 454.5,-24 454.5,0 551.5,0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/siesta_analysis.html#src">siesta_analysis</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>      <span class="k">subroutine </span><span class="n">siesta_analysis</span><span class="p">(</span> <span class="n">relaxd</span> <span class="p">)</span>
      <span class="k">USE </span><span class="n">band</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">nbk</span><span class="p">,</span> <span class="n">bk</span><span class="p">,</span> <span class="n">maxbk</span><span class="p">,</span> <span class="n">bands</span>
      <span class="k">USE </span><span class="n">writewave</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">nwk</span><span class="p">,</span> <span class="n">wfk</span><span class="p">,</span> <span class="n">wwave</span>
      <span class="k">USE </span><span class="n">writewave</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">setup_wfs_list</span><span class="p">,</span> <span class="n">wfs_filename</span>
      <span class="k">USE </span><span class="n">m_ksvinit</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">nkpol</span><span class="p">,</span> <span class="n">kpol</span><span class="p">,</span> <span class="n">wgthpol</span>
      <span class="k">use </span><span class="n">m_ksv</span>
      <span class="k">USE </span><span class="n">m_projected_DOS</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">projected_DOS</span>
      <span class="k">USE </span><span class="n">m_local_DOS</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">local_DOS</span>
<span class="cp">#ifdef SIESTA__PEXSI</span>
      <span class="k">USE </span><span class="n">m_pexsi_local_DOS</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">pexsi_local_DOS</span>
      <span class="k">USE </span><span class="n">m_pexsi_dos</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">pexsi_dos</span>
<span class="cp">#endif      </span>
      <span class="k">USE </span><span class="n">siesta_options</span>
      <span class="k">use </span><span class="n">units</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Debye</span><span class="p">,</span> <span class="n">eV</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">numh</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">xijo</span>
      <span class="k">use </span><span class="n">siesta_geom</span>
      <span class="k">use </span><span class="n">m_dhscf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">dhscf</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">indxuo</span><span class="p">,</span> <span class="n">iaorb</span><span class="p">,</span> <span class="n">lastkb</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">datm</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span>
     <span class="p">&amp;</span>                    <span class="n">iphkb</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">iza</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">rmaxo</span><span class="p">,</span> <span class="n">indxua</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">qtot</span>
      <span class="k">use </span><span class="n">fdf</span>
      <span class="k">use </span><span class="n">writewave</span><span class="p">,</span>    <span class="n">only</span><span class="p">:</span> <span class="n">wwave</span>
      <span class="k">use </span><span class="n">siesta_cml</span>
      <span class="k">use </span><span class="n">files</span><span class="p">,</span>        <span class="n">only</span> <span class="p">:</span> <span class="n">slabel</span>
      <span class="k">use </span><span class="n">files</span><span class="p">,</span>        <span class="n">only</span> <span class="p">:</span> <span class="n">filesOut_t</span>   <span class="c">! derived type for output file names</span>
      <span class="k">use </span><span class="n">zmatrix</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">lUseZmatrix</span><span class="p">,</span> <span class="n">write_zmatrix</span>
      <span class="k">use </span><span class="n">Kpoint_grid</span>
      <span class="k">use </span><span class="n">parallel</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">IOnode</span>
      <span class="k">use </span><span class="n">parallel</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">SIESTA_worker</span>
      <span class="k">use </span><span class="n">files</span><span class="p">,</span>       <span class="n">only</span> <span class="p">:</span> <span class="n">label_length</span>
      <span class="k">use </span><span class="n">m_energies</span>
      <span class="k">use </span><span class="n">m_steps</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="k">final</span>
<span class="k">      use </span><span class="n">m_ntm</span>
      <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>         <span class="n">only</span><span class="p">:</span> <span class="n">nspin</span><span class="p">,</span> <span class="n">spinor_dim</span><span class="p">,</span> <span class="n">h_spin_dim</span>
      <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>         <span class="n">only</span><span class="p">:</span> <span class="n">SpOrb</span><span class="p">,</span> <span class="n">NonCol</span><span class="p">,</span> <span class="n">SPpol</span><span class="p">,</span> <span class="n">NoMagn</span>
      <span class="k">use </span><span class="n">m_dipol</span>
      <span class="k">use </span><span class="n">m_eo</span>
      <span class="k">use </span><span class="n">m_forces</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">fa</span>
      <span class="k">use </span><span class="n">m_gamma</span> 
      <span class="k">use </span><span class="n">alloc</span><span class="p">,</span>             <span class="n">only</span><span class="p">:</span> <span class="n">re_alloc</span><span class="p">,</span> <span class="n">de_alloc</span>
      <span class="k">use </span><span class="n">basis_enthalpy</span><span class="p">,</span>    <span class="n">only</span><span class="p">:</span> <span class="n">write_basis_enthalpy</span>
      <span class="k">use </span><span class="n">m_partial_charges</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">want_partial_charges</span>
      <span class="k">use </span><span class="n">m_iodm_old</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">read_spmatrix</span>
      <span class="k">use </span><span class="n">m_siesta2wannier90</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">siesta2wannier90</span>

<span class="cp">#ifdef MPI</span>
      <span class="k">use </span><span class="n">m_mpi_utils</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">globalize_sum</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="k">use </span><span class="n">flook_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">slua_call</span><span class="p">,</span> <span class="n">LUA_ANALYSIS</span>
<span class="cp">#endif</span>

      <span class="k">implicit none</span>

<span class="k">      </span><span class="kt">logical</span> <span class="kd">::</span> <span class="n">relaxd</span><span class="p">,</span> <span class="n">getPSI</span><span class="p">,</span> <span class="n">quenched_MD</span><span class="p">,</span> <span class="n">found</span>

      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dummy_str</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dummy_strl</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">qspin</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>         <span class="c">! Local</span>

      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">polxyz</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nspin</span><span class="p">)</span>  <span class="c">! Autom., small</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">polR</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nspin</span><span class="p">)</span>    <span class="c">! Autom., small</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">qaux</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">ebk</span><span class="p">(:,:,:)</span>       <span class="c">! Band energies</span>

      <span class="kt">integer</span>           <span class="kd">::</span> <span class="n">j</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ik</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">ispin</span>
      <span class="kt">integer</span>           <span class="kd">::</span> <span class="n">wfs_band_min</span><span class="p">,</span> <span class="n">wfs_band_max</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">g2max</span><span class="p">,</span> <span class="n">current_ef</span>
<span class="cp">#ifdef MPI</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">qtmp</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="cp">#endif</span>
      <span class="k">type</span><span class="p">(</span><span class="n">filesOut_t</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">filesOut</span>  <span class="c">! blank output file names</span>

<span class="c">!-----------------------------------------------------------------------BEGIN</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">SIESTA_worker</span><span class="p">)</span> <span class="k">call </span><span class="n">timer</span><span class="p">(</span><span class="s2">&quot;Analysis&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

      <span class="c">!! Check that we are converged in geometry,</span>
      <span class="c">!! if strictly required,</span>
      <span class="c">!! before carrying out any analysis.</span>

      <span class="c">!!@code</span>
      <span class="n">quenched_MD</span> <span class="o">=</span>  <span class="p">(</span> <span class="p">(</span><span class="n">iquench</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span>
     <span class="err">$</span>     <span class="p">((</span><span class="n">idyn</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">1</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">idyn</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">3</span><span class="p">))</span> <span class="p">)</span>

      <span class="k">if</span> <span class="p">((</span><span class="n">nmove</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">quenched_MD</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         if</span> <span class="p">(</span><span class="n">GeometryMustConverge</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">relaxd</span><span class="p">))</span> <span class="k">then</span>
<span class="k">            call </span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;FATAL&quot;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="s2">&quot;GEOM_NOT_CONV: Geometry relaxation not converged&quot;</span><span class="p">)</span>
            <span class="k">call </span><span class="n">die</span><span class="p">(</span><span class="s2">&quot;ABNORMAL_TERMINATION&quot;</span><span class="p">)</span>
         <span class="n">endif</span>
      <span class="n">endif</span>
      <span class="c">!!@endcode</span>

<span class="c">!     All the comments below assume that this compatibility option</span>
<span class="c">!     is not used.</span>
<span class="c">!     Note also that full compatibility cannot be guaranteed</span>

      <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">compat_pre_v4_dynamics</span><span class="p">)</span> <span class="k">then</span>

<span class="c">!     This is a sanity safeguard: we reset the geometry (which might</span>
<span class="c">!     have been moved by the relaxation or MD routines) to the one used</span>
<span class="c">!     in the last computation of the electronic structure.</span>
<span class="c">!     See the comments below for explanation</span>

<span class="c">!$OMP parallel workshare default(shared)</span>
         <span class="n">xa</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">na_s</span><span class="p">)</span> <span class="o">=</span> <span class="n">xa_last</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">na_s</span><span class="p">)</span>
         <span class="n">ucell</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ucell_last</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
         <span class="n">scell</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">scell_last</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<span class="c">!$OMP end parallel workshare</span>

      <span class="n">endif</span>

      <span class="c">! zmatrix info reset??</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;Read-H-from-file&quot;</span><span class="p">,.</span><span class="n">false</span><span class="p">.))</span> <span class="k">then</span>
<span class="k">         if</span> <span class="p">(</span><span class="n">SIESTA_worker</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            call </span><span class="n">read_spmatrix</span><span class="p">(</span><span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">h_spin_dim</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span>
     <span class="p">.</span>           <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">userfile</span><span class="o">=</span><span class="s2">&quot;H_IN&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">found</span><span class="p">)</span> <span class="k">call </span><span class="n">die</span><span class="p">(</span><span class="s2">&quot;Could not find H_IN&quot;</span><span class="p">)</span>
            <span class="n">current_ef</span> <span class="o">=</span> <span class="n">ef</span>
            <span class="n">ef</span> <span class="o">=</span> <span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;Manual-Fermi-Level&quot;</span><span class="p">,</span><span class="n">current_ef</span><span class="p">,</span><span class="s2">&quot;Ry&quot;</span><span class="p">)</span> 
         <span class="n">endif</span>
      <span class="n">endif</span>

<span class="cp">#ifdef SIESTA__PEXSI</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;PEXSI.DOS&quot;</span><span class="p">,.</span><span class="n">false</span><span class="p">.))</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">pexsi_dos</span><span class="p">(</span><span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">spinor_dim</span><span class="p">,</span>
     <span class="err">$</span>        <span class="n">maxnh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">qtot</span><span class="p">,</span> <span class="n">ef</span><span class="p">)</span>
         
      <span class="n">endif</span>
<span class="cp">#endif</span>
      <span class="c">! section done by Siesta subset of nodes</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">SIESTA_worker</span><span class="p">)</span> <span class="k">then</span>

<span class="k">      final</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">cmlStartModule</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Finalization&#39;</span><span class="p">)</span>
      <span class="n">endif</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="c">! Call lua right before doing the analysis,</span>
      <span class="c">! possibly changing some of the variables</span>
      <span class="k">call </span><span class="n">slua_call</span><span class="p">(</span><span class="n">LUA</span><span class="p">,</span><span class="n">LUA_ANALYSIS</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="c">!</span>
<span class="c">!     NOTE that the geometry output by the following sections</span>
<span class="c">!     used to be that &quot;predicted&quot; for the next MD or relaxation step.</span>
<span class="c">!     This is now changed</span>

<span class="c">!</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
        <span class="c">! Print atomic coordinates</span>

        <span class="c">! This covers CG and MD-quench (verlet, pr), instances in which </span>
        <span class="c">! &quot;relaxd&quot; is meaningful</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">nmove</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">quenched_MD</span> <span class="p">)</span> <span class="k">then</span>

<span class="k">          if</span> <span class="p">(</span><span class="n">relaxd</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! xa = xa_last</span>
             <span class="c">! The &quot;relaxation&quot; routines do not update</span>
             <span class="c">! the coordinates if relaxed, so this behavior is unchanged</span>
             <span class="k">call </span><span class="n">outcoor</span><span class="p">(</span><span class="n">ucell</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="s1">&#39;Relaxed&#39;</span><span class="p">,</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span> <span class="p">)</span>
          <span class="k">else</span>  
             <span class="c">! Since xa = xa_last now, this will just repeat the</span>
             <span class="c">! last set of coordinates used, not the predicted ones.</span>
             <span class="k">call </span><span class="n">outcoor</span><span class="p">(</span><span class="n">ucell</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="s1">&#39;Final (unrelaxed)&#39;</span><span class="p">,</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span> <span class="p">)</span>
          <span class="n">endif</span>

        <span class="n">endif</span>

        <span class="c">! This call will write xa_last to the .STRUCT_OUT file</span>
        <span class="c">! (again, since it has already been written by state_init),</span>
        <span class="c">! CML records of the latest processed structure, and </span>
        <span class="c">! possibly zmatrix info.  *** unmoved?? how?</span>
        <span class="c">! Note that the .STRUCT_NEXT_ITER file is produced</span>
        <span class="c">! in siesta_move for checkpointing of relaxations and MD runs.</span>

        <span class="c">! If all we want are the CML records (to satisfy some expectation</span>
        <span class="c">! of appearance in the &quot;finalization&quot; section, we might put the</span>
        <span class="c">! cml call explicitly and forget about the rest.</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">compat_pre_v4_dynamics</span><span class="p">)</span> <span class="k">then</span>
<span class="k">           call </span><span class="n">siesta_write_positions</span><span class="p">(</span><span class="n">moved</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>  
        <span class="k">else</span>
<span class="k">           call </span><span class="n">siesta_write_positions</span><span class="p">(</span><span class="n">moved</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.)</span>  
        <span class="n">endif</span>


        
        <span class="c">! ??  Clarify Zmatrix behavior ****</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lUseZmatrix</span><span class="p">)</span> <span class="k">call </span><span class="n">write_Zmatrix</span>

        <span class="c">! Print unit cell (cell_last) for variable cell and server operation</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">varcel</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">idyn</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">8</span><span class="p">))</span> <span class="k">call </span><span class="n">outcell</span><span class="p">(</span><span class="n">ucell</span><span class="p">)</span>

<span class="c">!------------------------------------------------------------------</span>
        <span class="c">! It can be argued that these needed the xa_last coordinates</span>
        <span class="c">! all along</span>

<span class="c">!       Print coordinates in xmol format in a separate file</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fdf_boolean</span><span class="p">(</span><span class="s1">&#39;WriteCoorXmol&#39;</span><span class="p">,.</span><span class="n">false</span><span class="p">.))</span> 
     <span class="p">&amp;</span>     <span class="k">call </span><span class="n">coxmol</span><span class="p">(</span><span class="n">iza</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">na_u</span> <span class="p">)</span>

<span class="c">!       Print coordinates in cerius format in a separate file</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fdf_boolean</span><span class="p">(</span><span class="s1">&#39;WriteCoorCerius&#39;</span><span class="p">,.</span><span class="n">false</span><span class="p">.))</span>
     <span class="p">&amp;</span>     <span class="k">call </span><span class="n">coceri</span><span class="p">(</span><span class="n">iza</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">sname</span> <span class="p">)</span>

<span class="c">!       Find interatomic distances (output in file BONDS_FINAL)</span>
        <span class="k">call </span><span class="n">bonds</span><span class="p">(</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span>
     <span class="p">&amp;</span>       <span class="n">rmax_bonds</span><span class="p">,</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="o">//</span> <span class="s2">&quot;.BONDS_FINAL&quot;</span> <span class="p">)</span>

      <span class="n">endif</span> <span class="c">! IONode</span>
<span class="c">!--- end output of geometry information</span>
<span class="c">!</span>
<span class="c">!</span>
<span class="c">! NOTE: In the following sections, wavefunction generation, computation</span>
<span class="c">!       of band structure, etc, are carried out using the last Hamiltonian</span>
<span class="c">!       generated in the SCF run for the last geometry considered.</span>

<span class="c">!   But, if xa /= xa_last, the computation of, say, bands, will use</span>
<span class="c">!      H phases which are not the same as those producing the final </span>
<span class="c">!      ground-state electronic structure.</span>
<span class="c">!</span>
<span class="c">!    Also, since we have removed the replication (superx call) </span>
<span class="c">!      of &quot;moved&quot; coordinates</span>
<span class="c">!      into the auxiliary supercell from &#39;siesta_move&#39; (recall that it is</span>
<span class="c">!      done always in state_init for every new geometry), the &quot;moved unit</span>
<span class="c">!      cell coordinates&quot; could coexist here with &quot;unmoved non-unit cell SC coords&quot;,</span>
<span class="c">!      which is wrong.</span>

<span class="c">!      For all of the above, we should put here a sanity safeguard</span>
<span class="c">!        (if we have not done so already at the top of this routine)</span>

<span class="c">!        xa(1:3,1:na_s) = xa_last(1:3,1:na_s)</span>
<span class="c">!        ucell(1:3,1:3) = ucell_last(1:3,1:3)</span>
<span class="c">!        scell(1:3,1:3) = scell_last(1:3,1:3)</span>

<span class="c">!        DM and H issues</span>
<span class="c">!</span>
<span class="c">!        Some of the routines that follow use H and S, and some use the DM.</span>
<span class="c">!        Those which use the DM should work with the final &quot;out&quot; DM for</span>
<span class="c">!        consistency.</span>
<span class="c">!        Those which use H,S should work with the latest diagonalized H,S pair.</span>
<span class="c">!</span>
<span class="c">!      If mixing the DM during the scf loop we should avoid mixing it one more time</span>
<span class="c">!        after convergence (or restoring Dold)</span>
<span class="c">!        If mixing H, we should avoid mixing it one more time</span>
<span class="c">!        after convergence (and restoring Hold to have the exact H that generated the</span>
<span class="c">!        latest DM, although this is probably too much).</span>
<span class="c">!        See the logic in siesta_forces.</span>

<span class="c">!     Find and print wavefunctions at selected k-points</span>
<span class="c">!   This uses H,S, and xa</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nwk</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        </span><span class="n">wfs_filename</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;.selected.WFSX&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IONode</span><span class="p">)</span> <span class="k">print</span> <span class="s2">&quot;(a)&quot;</span><span class="p">,</span>
     <span class="err">$</span>              <span class="s2">&quot;Writing WFSX for selected k-points in &quot;</span>
     <span class="err">$</span>                           <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">wfs_filename</span><span class="p">)</span>
        <span class="k">call </span><span class="n">wwave</span><span class="p">(</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">h_spin_dim</span><span class="p">,</span> <span class="n">spinor_dim</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> 
     <span class="p">&amp;</span>              <span class="n">nwk</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Ef</span><span class="p">,</span> <span class="n">xijo</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">nwk</span><span class="p">,</span> <span class="n">wfk</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="nb">gamma</span><span class="p">,</span> <span class="n">occtol</span> <span class="p">)</span>
      <span class="n">endif</span>


<span class="c">!   This uses H,S, and xa</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">write_coop</span><span class="p">)</span> <span class="k">then</span>
        <span class="c">! Output the wavefunctions for the kpoints in the SCF set</span>
        <span class="c">! Note that we allow both a band number and an energy range</span>
        <span class="c">! The user is responsible for using appropriate values.</span>
        <span class="n">wfs_band_min</span> <span class="o">=</span> <span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;WFS.BandMin&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">wfs_band_max</span> <span class="o">=</span> <span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;WFS.BandMax&quot;</span><span class="p">,</span><span class="n">no_u</span><span class="p">)</span>
        <span class="k">call </span><span class="n">setup_wfs_list</span><span class="p">(</span><span class="n">nkpnt</span><span class="p">,</span><span class="n">no_u</span><span class="p">,</span><span class="n">wfs_band_min</span><span class="p">,</span><span class="n">wfs_band_max</span><span class="p">,</span>
     <span class="err">$</span>                      <span class="n">use_scf_weights</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span>
     <span class="err">$</span>                      <span class="n">use_energy_window</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
         <span class="n">wfs_filename</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;.fullBZ.WFSX&quot;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">IONode</span><span class="p">)</span> <span class="k">print</span> <span class="s2">&quot;(a)&quot;</span><span class="p">,</span> <span class="s2">&quot;Writing WFSX for COOP/COHP in &quot;</span> 
     <span class="err">$</span>                           <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">wfs_filename</span><span class="p">)</span>
         <span class="k">call </span><span class="n">wwave</span><span class="p">(</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">h_spin_dim</span><span class="p">,</span> <span class="n">spinor_dim</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> 
     <span class="p">.</span>        <span class="n">nkpnt</span><span class="p">,</span>
     <span class="p">.</span>        <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Ef</span><span class="p">,</span> <span class="n">xijo</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">.</span>        <span class="n">nkpnt</span><span class="p">,</span> <span class="n">kpoint</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="nb">gamma</span><span class="p">,</span> <span class="n">occtol</span><span class="p">)</span>
      <span class="n">endif</span>

<span class="c">!     Compute bands</span>
<span class="c">!   This uses H,S, and xa</span>
      <span class="k">nullify</span><span class="p">(</span> <span class="n">ebk</span> <span class="p">)</span>
      <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span> <span class="n">ebk</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">spinor_dim</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxbk</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="s1">&#39;ebk&#39;</span><span class="p">,</span> <span class="s1">&#39;siesta_analysis&#39;</span> <span class="p">)</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">nbk</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span><span class="n">IONode</span><span class="p">)</span> <span class="k">print</span> <span class="s2">&quot;(a)&quot;</span><span class="p">,</span> <span class="s2">&quot;Computing bands...&quot;</span>
        <span class="n">getPSI</span> <span class="o">=</span> <span class="n">fdf_get</span><span class="p">(</span><span class="s1">&#39;WFS.Write.For.Bands&#39;</span><span class="p">,</span> <span class="p">.</span><span class="n">false</span><span class="p">.)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">getPSI</span><span class="p">)</span> <span class="k">then</span>
<span class="k">           </span><span class="n">wfs_filename</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;.bands.WFSX&quot;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">IONode</span><span class="p">)</span> <span class="k">print</span> <span class="s2">&quot;(a)&quot;</span><span class="p">,</span> <span class="s2">&quot;Writing WFSX for bands in &quot;</span>
     <span class="err">$</span>                           <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">wfs_filename</span><span class="p">)</span>
           <span class="n">wfs_band_min</span> <span class="o">=</span> <span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;WFS.BandMin&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
           <span class="n">wfs_band_max</span> <span class="o">=</span> <span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;WFS.BandMax&quot;</span><span class="p">,</span><span class="n">no_u</span><span class="p">)</span>
           <span class="k">call </span><span class="n">setup_wfs_list</span><span class="p">(</span><span class="n">nbk</span><span class="p">,</span><span class="n">no_u</span><span class="p">,</span><span class="n">wfs_band_min</span><span class="p">,</span><span class="n">wfs_band_max</span><span class="p">,</span>
     <span class="err">$</span>          <span class="n">use_scf_weights</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span>
     <span class="err">$</span>          <span class="n">use_energy_window</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.)</span>
        <span class="n">endif</span>
        <span class="k">call </span><span class="n">bands</span><span class="p">(</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">h_spin_dim</span><span class="p">,</span> <span class="n">spinor_dim</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> 
     <span class="p">.</span>              <span class="n">maxbk</span><span class="p">,</span>
     <span class="p">.</span>              <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Ef</span><span class="p">,</span> <span class="n">xijo</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">.</span>              <span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">nbk</span><span class="p">,</span> <span class="n">bk</span><span class="p">,</span> <span class="n">ebk</span><span class="p">,</span> <span class="n">occtol</span><span class="p">,</span> <span class="n">getPSI</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          if</span> <span class="p">(</span> <span class="n">writbk</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(/,a,/,a4,a12)&#39;</span><span class="p">)</span>
     <span class="p">&amp;</span>       <span class="s1">&#39;siesta: Band k vectors (Bohr**-1):&#39;</span><span class="p">,</span> <span class="s1">&#39;ik&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span>
            <span class="k">do </span><span class="n">ik</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nbk</span>
              <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(i4,3f12.6)&#39;</span><span class="p">)</span> <span class="n">ik</span><span class="p">,</span> <span class="p">(</span><span class="n">bk</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">ik</span><span class="p">),</span><span class="n">ix</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">enddo</span>
          <span class="n">endif</span>
        
          <span class="k">if</span> <span class="p">(</span> <span class="n">writb</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(/,a,/,a4,a3,a7)&#39;</span><span class="p">)</span>
     <span class="p">&amp;</span>       <span class="s1">&#39;siesta: Band energies (eV):&#39;</span><span class="p">,</span> <span class="s1">&#39;ik&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;eps&#39;</span>
            <span class="k">do </span><span class="n">ispin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">spinor_dim</span>
              <span class="k">do </span><span class="n">ik</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nbk</span>
                <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(i4,i3,10f7.2)&#39;</span><span class="p">)</span>
     <span class="p">&amp;</span>            <span class="n">ik</span><span class="p">,</span> <span class="n">ispin</span><span class="p">,</span> <span class="p">(</span><span class="n">ebk</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="n">ispin</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span><span class="n">io</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">no_u</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">no_u</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">10</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(7x,10f7.2)&#39;</span><span class="p">)</span>
     <span class="p">&amp;</span>              <span class="p">(</span><span class="n">ebk</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="n">ispin</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span><span class="n">io</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">no_u</span><span class="p">)</span>
              <span class="n">enddo</span>
            <span class="n">enddo</span>
          <span class="n">endif</span>
        <span class="n">endif</span>
      <span class="n">endif</span>

<span class="c">!     Print eigenvalues</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">writeig</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">((</span><span class="n">isolve</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">SOLVE_DIAGON</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span>
     <span class="p">&amp;</span>       <span class="p">((</span><span class="n">isolve</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">SOLVE_MINIM</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">minim_calc_eigenvalues</span><span class="p">))</span>
     <span class="p">&amp;</span>      <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">no_l</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1000</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          if</span> <span class="p">(</span> <span class="n">h_spin_dim</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(/,a,/,a4,a3,a7)&#39;</span><span class="p">)</span>
     <span class="p">&amp;</span>       <span class="s1">&#39;siesta: Eigenvalues (eV):&#39;</span><span class="p">,</span> <span class="s1">&#39;ik&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;eps&#39;</span>
            <span class="k">do </span><span class="n">ik</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nkpnt</span>
              <span class="k">do </span><span class="n">ispin</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">spinor_dim</span>
                <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(i4,i3,10f7.2)&#39;</span><span class="p">)</span>
     <span class="p">&amp;</span>            <span class="n">ik</span><span class="p">,</span><span class="n">ispin</span><span class="p">,(</span><span class="n">eo</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="n">ispin</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span><span class="n">io</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">neigwanted</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">no_u</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">10</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(7x,10f7.2)&#39;</span><span class="p">)</span>
     <span class="p">&amp;</span>            <span class="p">(</span><span class="n">eo</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="n">ispin</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span><span class="n">io</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">neigwanted</span><span class="p">)</span>
              <span class="n">enddo</span>
            <span class="n">enddo</span>
          <span class="k">else</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(/,a)&#39;</span><span class="p">)</span> <span class="s1">&#39;siesta: Eigenvalues (eV):&#39;</span>
            <span class="k">do </span><span class="n">ik</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nkpnt</span>
              <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;ik =&#39;</span><span class="p">,</span> <span class="n">ik</span>
              <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(10f7.2)&#39;</span><span class="p">)</span>
     <span class="p">&amp;</span>          <span class="p">((</span><span class="n">eo</span><span class="p">(</span><span class="n">io</span><span class="p">,</span><span class="n">ispin</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span><span class="n">io</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">neigwanted</span><span class="p">),</span><span class="n">ispin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">enddo</span>
          <span class="n">endif</span>
          <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(a,f15.6,a)&#39;</span><span class="p">)</span> <span class="s1">&#39;siesta: Fermi energy =&#39;</span><span class="p">,</span> <span class="n">ef</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span> <span class="s1">&#39; eV&#39;</span>
        <span class="n">endif</span>
      <span class="n">endif</span>

      <span class="k">if</span> <span class="p">(((</span><span class="n">isolve</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">SOLVE_DIAGON</span><span class="p">).</span><span class="nb">or</span><span class="p">.</span>
     <span class="p">&amp;</span>     <span class="p">((</span><span class="n">isolve</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">SOLVE_MINIM</span><span class="p">).</span><span class="nb">and</span><span class="p">.</span><span class="n">minim_calc_eigenvalues</span><span class="p">))</span>
     <span class="p">&amp;</span>     <span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">IOnode</span><span class="p">)</span>
     <span class="p">&amp;</span>     <span class="k">call </span><span class="n">ioeig</span><span class="p">(</span><span class="n">eo</span><span class="p">,</span><span class="n">ef</span><span class="p">,</span><span class="n">neigwanted</span><span class="p">,</span><span class="n">nspin</span><span class="p">,</span><span class="n">nkpnt</span><span class="p">,</span><span class="n">no_u</span><span class="p">,</span><span class="n">spinor_dim</span><span class="p">,</span>
     <span class="p">&amp;</span>     <span class="n">nkpnt</span><span class="p">,</span><span class="n">kpoint</span><span class="p">,</span> <span class="n">kweight</span><span class="p">)</span>


<span class="c">!   This uses H,S, and xa, as it diagonalizes them again</span>
      <span class="k">call </span><span class="n">projected_DOS</span><span class="p">()</span>

<span class="c">!     Print program&#39;s energy decomposition and final forces</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">siesta_write_energies</span><span class="p">(</span> <span class="n">iscf</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dDmax</span><span class="o">=</span><span class="mf">0._dp</span><span class="p">,</span> <span class="n">dHmax</span><span class="o">=</span><span class="mf">0._dp</span><span class="p">)</span>
        <span class="c">! final == .true. which makes the step counter irrelevant</span>
        <span class="k">call </span><span class="n">siesta_write_forces</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">call </span><span class="n">siesta_write_stress_pressure</span><span class="p">()</span>
        <span class="k">call </span><span class="n">write_basis_enthalpy</span><span class="p">(</span><span class="n">FreeE</span><span class="p">,</span><span class="n">FreeEHarris</span><span class="p">)</span>
      <span class="n">endif</span>

<span class="c">! NOTE: Here, the spin polarization is computed using Dscf, which is</span>
<span class="c">!       a density matrix obtained after mixing the &quot;in&quot; and &quot;out&quot;</span>
<span class="c">!       DMs of the SCF run for the last geometry considered.</span>
<span class="c">!       This can be considered a feature or a bug.</span>

      <span class="k">call </span><span class="n">print_spin</span><span class="p">(</span><span class="n">qspin</span><span class="p">)</span>  <span class="c">! qspin returned for use below</span>

<span class="c">!     This uses the last computed dipole in dhscf during the scf cycle,</span>
<span class="c">!     which is in fact derived from the &quot;in&quot; DM.</span>
<span class="c">!     Perhaps this section should be moved after the call to dhscf below</span>
<span class="c">!     AND use the DM_out of the last step (but there might not be a call</span>
<span class="c">!     to dhscf if there are no files to output, and the computation of the</span>
<span class="c">!     charge density is expensive...</span>

<span class="c">!     Print electric dipole</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">shape</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="s1">&#39;bulk&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(/,a,3f12.6)&#39;</span><span class="p">)</span>
     <span class="p">&amp;</span>      <span class="s1">&#39;siesta: Electric dipole (a.u.)  =&#39;</span><span class="p">,</span> <span class="n">dipol</span>
          <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(a,3f12.6)&#39;</span><span class="p">)</span>
     <span class="p">&amp;</span>      <span class="s1">&#39;siesta: Electric dipole (Debye) =&#39;</span><span class="p">,</span> 
     <span class="p">&amp;</span>      <span class="p">(</span><span class="n">dipol</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span><span class="o">/</span><span class="n">Debye</span><span class="p">,</span><span class="n">ix</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">endif</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">dipol</span><span class="o">/</span><span class="n">Debye</span><span class="p">,</span>
     <span class="p">&amp;</span>         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Electric dipole&#39;</span><span class="p">,</span> <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:dipol&#39;</span><span class="p">,</span>
     <span class="p">.</span>         <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:Debye&#39;</span><span class="p">)</span>
        <span class="n">endif</span> <span class="c">!cml_p</span>
      <span class="n">endif</span>

<span class="c">! NOTE: The use of *_last geometries in the following sections</span>
<span class="c">!       guarantees that the analysis of the electronic structure</span>
<span class="c">!       is done for the geometry for which it was computed.</span>

<span class="c">!  BUT these routines need H,S, so H should not be mixed after</span>
<span class="c">!       convergence.</span>

<span class="c">!     Calculation of the bulk polarization using the Berry phase</span>
<span class="c">!     formulas by King-Smith and Vanderbilt</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nkpol</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="n">bornz</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span><span class="n">NonCol</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">SpOrb</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(/a)&#39;</span><span class="p">)</span>
     <span class="p">.</span>       <span class="s1">&#39;siesta_analysis: bulk polarization implemented only for&#39;</span>
            <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(/a)&#39;</span><span class="p">)</span>
     <span class="p">.</span>       <span class="s1">&#39;siesta_analysis: paramagnetic or collinear spin runs&#39;</span>
          <span class="n">endif</span>
        <span class="k">else</span>
<span class="k">         call </span><span class="n">KSV_pol</span><span class="p">(</span><span class="n">na_u</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">xa_last</span><span class="p">,</span> <span class="n">rmaxo</span><span class="p">,</span> <span class="n">scell_last</span><span class="p">,</span> 
     <span class="p">&amp;</span>               <span class="n">ucell_last</span><span class="p">,</span><span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">nspin</span><span class="p">,</span> <span class="n">qspin</span><span class="p">,</span> 
     <span class="p">&amp;</span>               <span class="n">maxnh</span><span class="p">,</span> <span class="n">nkpol</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> 
     <span class="p">&amp;</span>               <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">xijo</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> 
     <span class="p">&amp;</span>               <span class="n">iaorb</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="nb">shape</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">nkpol</span><span class="p">,</span><span class="n">kpol</span><span class="p">,</span><span class="n">wgthpol</span><span class="p">,</span> <span class="n">polR</span><span class="p">,</span> <span class="n">polxyz</span> <span class="p">)</span> 
       <span class="n">endif</span>
      <span class="n">endif</span>

<span class="c">!     Calculation of the optical conductivity</span>
      <span class="k">call </span><span class="n">optical</span><span class="p">(</span><span class="n">na_u</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">xa_last</span><span class="p">,</span> <span class="n">scell_last</span><span class="p">,</span> <span class="n">ucell_last</span><span class="p">,</span>
     <span class="p">&amp;</span>             <span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">nspin</span><span class="p">,</span> <span class="n">qspin</span><span class="p">,</span>
     <span class="p">&amp;</span>             <span class="n">maxnh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">xijo</span><span class="p">,</span>
     <span class="err">$</span>             <span class="n">indxuo</span><span class="p">,</span> <span class="n">ebk</span><span class="p">,</span> <span class="n">ef</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span>
     <span class="p">&amp;</span>             <span class="n">isa</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">iphKB</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">lastkb</span><span class="p">,</span> <span class="nb">shape</span> <span class="p">)</span>

      <span class="k">call </span><span class="n">de_alloc</span><span class="p">(</span> <span class="n">ebk</span><span class="p">,</span> <span class="s1">&#39;ebk&#39;</span><span class="p">,</span> <span class="s1">&#39;siesta_analysis&#39;</span> <span class="p">)</span>
<span class="c">!...................................</span>

<span class="c">!</span>
<span class="c">!  NOTE: Dscf here might be the mixed one (see above).</span>
<span class="c">!</span>
      <span class="n">want_partial_charges</span> <span class="o">=</span> <span class="p">(</span><span class="n">hirshpop</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">voropop</span><span class="p">)</span> <span class="p">.</span><span class="nb">AND</span><span class="p">.</span>
     <span class="err">$</span>                   <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">partial_charges_at_every_geometry</span><span class="p">)</span>

<span class="c">!     Save electron density and potential</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">saverho</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">savedrho</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">saverhoxc</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> 
     <span class="p">&amp;</span>    <span class="n">savevh</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">savevt</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">savevna</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span>
     <span class="p">&amp;</span>    <span class="n">savepsch</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">savetoch</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> 
     <span class="p">&amp;</span>    <span class="n">want_partial_charges</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span><span class="n">saverho</span><span class="p">)</span>   <span class="n">filesOut</span><span class="p">%</span><span class="n">rho</span>   <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;.RHO&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">savedrho</span><span class="p">)</span>  <span class="n">filesOut</span><span class="p">%</span><span class="n">drho</span>  <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;.DRHO&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">saverhoxc</span><span class="p">)</span> <span class="n">filesOut</span><span class="p">%</span><span class="n">rhoxc</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;.RHOXC&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">savevh</span><span class="p">)</span>    <span class="n">filesOut</span><span class="p">%</span><span class="n">vh</span>    <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;.VH&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">savevt</span><span class="p">)</span>    <span class="n">filesOut</span><span class="p">%</span><span class="n">vt</span>    <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;.VT&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">savevna</span><span class="p">)</span>   <span class="n">filesOut</span><span class="p">%</span><span class="n">vna</span>   <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;.VNA&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">savepsch</span><span class="p">)</span>  <span class="n">filesOut</span><span class="p">%</span><span class="n">psch</span>  <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;.IOCH&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">savetoch</span><span class="p">)</span>  <span class="n">filesOut</span><span class="p">%</span><span class="n">toch</span>  <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;.TOCH&#39;</span>
        <span class="n">g2max</span> <span class="o">=</span> <span class="n">g2cut</span>
        <span class="n">dummy_str</span>  <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">dummy_strl</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">call </span><span class="n">dhscf</span><span class="p">(</span> <span class="n">nspin</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">iaorb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span>
     <span class="p">.</span>              <span class="n">no_u</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">xa_last</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span> 
     <span class="p">&amp;</span>              <span class="n">ntm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filesOut</span><span class="p">,</span> 
     <span class="p">&amp;</span>              <span class="n">maxnh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">Datm</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">maxnh</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">Enaatm</span><span class="p">,</span> <span class="n">Enascf</span><span class="p">,</span> <span class="n">Uatm</span><span class="p">,</span> <span class="n">Uscf</span><span class="p">,</span> <span class="n">DUscf</span><span class="p">,</span> <span class="n">DUext</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">Exc</span><span class="p">,</span> <span class="n">Dxc</span><span class="p">,</span> <span class="n">dipol</span><span class="p">,</span> <span class="n">dummy_str</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span> <span class="n">dummy_strl</span> <span class="p">)</span>
                    <span class="c">! next to last argument is dummy here,</span>
                    <span class="c">! as no forces are calculated</span>
                    <span class="c">! todo: make all these optional</span>
      <span class="n">endif</span>
<span class="n">C</span>    
<span class="n">C</span>     <span class="k">Call </span><span class="n">the</span> <span class="n">wannier90</span> <span class="k">interface </span><span class="n">here</span><span class="p">,</span> <span class="n">as</span> <span class="n">local_DOS</span> <span class="n">destroys</span> <span class="n">the</span> <span class="n">DM</span><span class="p">...</span>
<span class="n">C</span>
      <span class="k">if</span><span class="p">(</span> <span class="n">w90_processing</span> <span class="p">)</span> <span class="k">call </span><span class="n">siesta2wannier90</span><span class="p">()</span>

<span class="n">C</span>     <span class="n">Find</span> <span class="n">local</span> <span class="n">density</span> <span class="n">of</span> <span class="n">states</span>
<span class="c">!  It needs H,S, and xa, as it diagonalizes them again</span>
<span class="c">!  NOTE: This call will obliterate Dscf</span>
<span class="c">!  It is better to put a explicit out argument for the partial DM computed.</span>
      <span class="k">call </span><span class="n">local_DOS</span><span class="p">()</span>

<span class="c">! In summary, it is better to:</span>
<span class="c">!</span>
<span class="c">!   -- Avoid (or warn the user about) doing any analysis if the calculation is not converged</span>
<span class="c">!   -- Avoid mixing DM or H after scf convergence</span>
<span class="c">!   -- Set xa to xa_last at the top of this file. Write any &quot;next iter&quot; coordinate file</span>
<span class="c">!      in &#39;siesta_move&#39;</span>

      <span class="n">endif</span> <span class="c">! SIESTA_worker</span>
<span class="cp">#ifdef SIESTA__PEXSI</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">fdf_get</span><span class="p">(</span><span class="s2">&quot;PEXSI.LDOS&quot;</span><span class="p">,.</span><span class="n">false</span><span class="p">.))</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">pexsi_local_DOS</span><span class="p">()</span>
      <span class="n">endif</span>
<span class="cp">#endif</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">SIESTA_worker</span><span class="p">)</span> <span class="k">call </span><span class="n">timer</span><span class="p">(</span><span class="s2">&quot;Analysis&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="c">!------------------------------------------------------------------------- END</span>
      <span class="k">END subroutine </span><span class="n">siesta_analysis</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SIESTA was developed by SIESTA Group</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>