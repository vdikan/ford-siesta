<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="A first-principles materials simulation code using Density Functional Theory.">
    
    <meta name="author" content="SIESTA Group" >
    <link rel="icon" href="../favicon.png">

    <title>state_init &ndash; SIESTA</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SIESTA <small>trunk-674</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li><a href='../page/index.html'>Program Overview</a></li>
	    
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>state_init
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title="13.2% of total for procedures.">349 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/state_init.F"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li><a href='../sourcefile/state_init.f.html'>state_init.F</a></li>
  
     <li><a href='../module/m_state_init.html'>m_state_init</a></li>
  
     <li class="active">state_init</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  




















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/state_init.html#src">state_init</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprocs-0">All Procedures</a></h3></div>
  <div id="allprocs-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../proc/current_itt.html">current_itt</a>
      
      <a class="list-group-item" href="../proc/getstackval.html">getstackval</a>
      
      <a class="list-group-item" href="../proc/inverse.html">inverse</a>
      
      <a class="list-group-item" href="../proc/is_next.html">is_next</a>
      
      <a class="list-group-item" href="../proc/mix_method.html">mix_method</a>
      
      <a class="list-group-item" href="../proc/mix_method_variant.html">mix_method_variant</a>
      
      <a class="list-group-item" href="../proc/mixer_init.html">mixer_init</a>
      
      <a class="list-group-item" href="../proc/mixers_history_init.html">mixers_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_init.html">mixers_init</a>
      
      <a class="list-group-item" href="../proc/mixers_print.html">mixers_print</a>
      
      <a class="list-group-item" href="../proc/mixers_print_block.html">mixers_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_reset.html">mixers_reset</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_history_init.html">mixers_scf_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_init.html">mixers_scf_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print.html">mixers_scf_print</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print_block.html">mixers_scf_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_reset.html">mixers_scf_reset</a>
      
      <a class="list-group-item" href="../interface/mixing.html">mixing</a>
      
      <a class="list-group-item" href="../proc/mixing_1d.html">mixing_1d</a>
      
      <a class="list-group-item" href="../proc/mixing_2d.html">mixing_2d</a>
      
      <a class="list-group-item" href="../proc/mixing_calc_next.html">mixing_calc_next</a>
      
      <a class="list-group-item" href="../proc/mixing_coeff.html">mixing_coeff</a>
      
      <a class="list-group-item" href="../proc/mixing_finalize.html">mixing_finalize</a>
      
      <a class="list-group-item" href="../proc/mixing_init.html">mixing_init</a>
      
      <a class="list-group-item" href="../proc/mixing_ncoeff.html">mixing_ncoeff</a>
      
      <a class="list-group-item" href="../proc/mixing_scf_converged.html">mixing_scf_converged</a>
      
      <a class="list-group-item" href="../proc/mixing_step.html">mixing_step</a>
      
      <a class="list-group-item" href="../proc/norm.html">norm</a>
      
      <a class="list-group-item" href="../proc/push_diff.html">push_diff</a>
      
      <a class="list-group-item" href="../proc/push_f.html">push_F</a>
      
      <a class="list-group-item" href="../proc/push_stack_data.html">push_stack_data</a>
      
      <a class="list-group-item" href="../proc/setup_h0.html">setup_H0</a>
      
      <a class="list-group-item" href="../proc/siesta_analysis.html">siesta_analysis</a>
      
      <a class="list-group-item" href="../proc/siesta_forces.html">siesta_forces</a>
      
      <a class="list-group-item" href="../proc/stack_check.html">stack_check</a>
      
      <a class="list-group-item" href="../proc/state_analysis.html">state_analysis</a>
      
      <a class="list-group-item" href="../proc/state_init.html">state_init</a>
      
      <a class="list-group-item" href="../proc/svd.html">svd</a>
      
      <a class="list-group-item" href="../proc/update_f.html">update_F</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine state_init(istep)
    
    
	 
</h2>
    
  
    <div class="panel panel-default">
      <div class="panel-heading">
	<h3 class="panel-title">Uses</h3>
      </div>
      <ul class="list-group">
      
      <li class="list-group-item">
	<ul class="list-inline">
	  
	  <li>Kpoint_grid</li>
	  
	  <li>m_os</li>
	  
	  <li>m_new_dm</li>
	  
	  <li>m_proximity_check</li>
	  
	  <li>siesta_options</li>
	  
	  <li>units</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>create_Sparsity_SC</li>
	  
	  <li>m_sparsity_handling</li>
	  
	  <li>m_sparsity_handling</li>
	  
	  <li>m_pivot_methods</li>
	  
	  <li>siesta_geom</li>
	  
	  <li>atomlist</li>
	  
	  <li>alloc</li>
	  
	  <li>m_hsparse</li>
	  
	  <li>m_overlap</li>
	  
	  <li>m_supercell</li>
	  
	  <li>siesta_cml</li>
	  
	  <li>zmatrix</li>
	  
	  <li>m_energies</li>
	  
	  <li>write_subs</li>
	  
	  <li>m_ioxv</li>
	  
	  <li>m_iotdxv</li>
	  
	  <li>m_steps</li>
	  
	  <li>parallel</li>
	  
	  <li>m_spin</li>
	  
	  <li>m_rmaxh</li>
	  
	  <li><a href='../module/m_mixing.html'>m_mixing</a></li>
	  
	  <li><a href='../module/m_mixing_scf.html'>m_mixing_scf</a></li>
	  
	  <li>m_normalize_dm</li>
	  
	  <li>m_eo</li>
	  
	  <li>m_gamma</li>
	  
	  <li>files</li>
	  
	  <li>m_mpi_utils</li>
	  
	  <li>m_mpi_utils</li>
	  
	  <li>domain_decom</li>
	  
	  <li>ldau_specs</li>
	  
	  <li>m_sparse</li>
	  
	  <li>m_ts_kpoints</li>
	  
	  <li>m_ts_charge</li>
	  
	  <li>m_ts_options</li>
	  
	  <li>m_ts_options</li>
	  
	  <li>m_ts_options</li>
	  
	  <li>m_ts_electype</li>
	  
	  <li>m_ts_global_vars</li>
	  
	  <li>sys</li>
	  
	  <li>m_ts_io</li>
	  
	  <li>m_ts_sparse</li>
	  
	  <li>m_ts_tri_init</li>
	  
	  <li>files</li>
	  
	  <li>m_chess</li>
	  
	  <li>iodm_netcdf</li>
	  
	  <li>iodmhs_netcdf</li>
	  
	  <li>class_Sparsity</li>
	  
	  <li>class_dSpData1D</li>
	  
	  <li>class_dSpData2D</li>
	  
	  <li>class_dData2D</li>
	  
	  <li>m_test_io</li>
	  
	  <li>siesta_dicts</li>
	  
	</ul>
      </li>
      
      
      
      <li class="list-group-item">
	<div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~state_init~~UsesGraph Pages: 1 -->
<svg id="procstate_initUsesGraph" width="462pt" height="2254pt"
 viewBox="0.00 0.00 462.00 2254.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_init~~UsesGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 2250)">
<title>proc~~state_init~~UsesGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-2250 458,-2250 458,4 -4,4"/>
<!-- proc~state_init -->
<g id="proc~~state_init~~UsesGraph_node1" class="node"><title>proc~state_init</title>
<polygon fill="none" stroke="black" points="454,-1133 399,-1133 399,-1109 454,-1109 454,-1133"/>
<text text-anchor="middle" x="426.5" y="-1118.6" font-family="Helvetica,sans-Serif" font-size="10.50">state_init</text>
</g>
<!-- m_ts_io -->
<g id="proc~~state_init~~UsesGraph_node2" class="node"><title>m_ts_io</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-2246 280.5,-2246 280.5,-2222 334.5,-2222 334.5,-2246"/>
<text text-anchor="middle" x="307.5" y="-2231.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_io</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_io -->
<g id="proc~~state_init~~UsesGraph_edge1" class="edge"><title>proc~state_init&#45;&gt;m_ts_io</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.592,-1133.23C426.346,-1247.21 429.923,-2121.23 363,-2213 358.441,-2219.25 351.757,-2223.64 344.62,-2226.73"/>
<polygon fill="#000000" stroke="#000000" points="343.048,-2223.57 334.764,-2230.17 345.359,-2230.18 343.048,-2223.57"/>
</g>
<!-- sparse_matrices -->
<g id="proc~~state_init~~UsesGraph_node3" class="node"><title>sparse_matrices</title>
<polygon fill="#337ab7" stroke="#337ab7" points="353,-2204 262,-2204 262,-2180 353,-2180 353,-2204"/>
<text text-anchor="middle" x="307.5" y="-2189.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sparse_matrices</text>
</g>
<!-- proc~state_init&#45;&gt;sparse_matrices -->
<g id="proc~~state_init~~UsesGraph_edge2" class="edge"><title>proc~state_init&#45;&gt;sparse_matrices</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.562,-1133.11C426.027,-1244.12 427.391,-2082.91 363,-2171 362.327,-2171.92 361.608,-2172.8 360.848,-2173.64"/>
<polygon fill="#000000" stroke="#000000" points="358.434,-2171.1 353.052,-2180.23 362.951,-2176.45 358.434,-2171.1"/>
</g>
<!-- class_dData2D -->
<g id="proc~~state_init~~UsesGraph_node4" class="node"><title>class_dData2D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="350,-2162 265,-2162 265,-2138 350,-2138 350,-2162"/>
<text text-anchor="middle" x="307.5" y="-2147.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dData2D</text>
</g>
<!-- proc~state_init&#45;&gt;class_dData2D -->
<g id="proc~~state_init~~UsesGraph_edge3" class="edge"><title>proc~state_init&#45;&gt;class_dData2D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.53,-1133.31C425.696,-1242.57 424.8,-2044.68 363,-2129 361.636,-2130.86 360.085,-2132.56 358.389,-2134.1"/>
<polygon fill="#000000" stroke="#000000" points="356.282,-2131.31 350.171,-2139.96 360.345,-2137.01 356.282,-2131.31"/>
</g>
<!-- m_ts_charge -->
<g id="proc~~state_init~~UsesGraph_node5" class="node"><title>m_ts_charge</title>
<polygon fill="#337ab7" stroke="#337ab7" points="345,-2120 270,-2120 270,-2096 345,-2096 345,-2120"/>
<text text-anchor="middle" x="307.5" y="-2105.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_charge</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_charge -->
<g id="proc~~state_init~~UsesGraph_edge4" class="edge"><title>proc~state_init&#45;&gt;m_ts_charge</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.495,-1133.12C425.354,-1239.13 422.281,-2006.34 363,-2087 360.57,-2090.31 357.546,-2093.09 354.177,-2095.44"/>
<polygon fill="#000000" stroke="#000000" points="352.269,-2092.5 345.233,-2100.42 355.673,-2098.61 352.269,-2092.5"/>
</g>
<!-- m_normalize_dm -->
<g id="proc~~state_init~~UsesGraph_node6" class="node"><title>m_normalize_dm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="355,-2078 260,-2078 260,-2054 355,-2054 355,-2078"/>
<text text-anchor="middle" x="307.5" y="-2063.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_normalize_dm</text>
</g>
<!-- proc~state_init&#45;&gt;m_normalize_dm -->
<g id="proc~~state_init~~UsesGraph_edge5" class="edge"><title>proc~state_init&#45;&gt;m_normalize_dm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.457,-1133.25C424.992,-1237.08 419.708,-1968.08 363,-2045 362.434,-2045.77 361.836,-2046.51 361.209,-2047.22"/>
<polygon fill="#000000" stroke="#000000" points="358.8,-2044.68 353.53,-2053.87 363.382,-2049.97 358.8,-2044.68"/>
</g>
<!-- m_supercell -->
<g id="proc~~state_init~~UsesGraph_node7" class="node"><title>m_supercell</title>
<polygon fill="#337ab7" stroke="#337ab7" points="342.5,-2036 272.5,-2036 272.5,-2012 342.5,-2012 342.5,-2036"/>
<text text-anchor="middle" x="307.5" y="-2021.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_supercell</text>
</g>
<!-- proc~state_init&#45;&gt;m_supercell -->
<g id="proc~~state_init~~UsesGraph_edge6" class="edge"><title>proc~state_init&#45;&gt;m_supercell</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.417,-1133C424.627,-1233.28 417.203,-1929.72 363,-2003 360.028,-2007.02 356.181,-2010.27 351.906,-2012.89"/>
<polygon fill="#000000" stroke="#000000" points="350.083,-2009.89 342.671,-2017.46 353.186,-2016.16 350.083,-2009.89"/>
</g>
<!-- m_ts_options -->
<g id="proc~~state_init~~UsesGraph_node8" class="node"><title>m_ts_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="345.5,-1994 269.5,-1994 269.5,-1970 345.5,-1970 345.5,-1994"/>
<text text-anchor="middle" x="307.5" y="-1979.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_options</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_options -->
<g id="proc~~state_init~~UsesGraph_edge7" class="edge"><title>proc~state_init&#45;&gt;m_ts_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.372,-1133.04C424.234,-1230.73 414.649,-1891.43 363,-1961 360.688,-1964.11 357.85,-1966.77 354.695,-1969.03"/>
<polygon fill="#000000" stroke="#000000" points="352.696,-1966.14 345.747,-1974.13 356.167,-1972.22 352.696,-1966.14"/>
</g>
<!-- siesta_dicts -->
<g id="proc~~state_init~~UsesGraph_node9" class="node"><title>siesta_dicts</title>
<polygon fill="#337ab7" stroke="#337ab7" points="341.5,-1952 273.5,-1952 273.5,-1928 341.5,-1928 341.5,-1952"/>
<text text-anchor="middle" x="307.5" y="-1937.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_dicts</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_dicts -->
<g id="proc~~state_init~~UsesGraph_edge8" class="edge"><title>proc~state_init&#45;&gt;siesta_dicts</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.322,-1133.04C423.822,-1227.9 412.106,-1853.13 363,-1919 359.787,-1923.31 355.568,-1926.74 350.896,-1929.46"/>
<polygon fill="#000000" stroke="#000000" points="349.062,-1926.45 341.502,-1933.87 352.041,-1932.79 349.062,-1926.45"/>
</g>
<!-- siesta_cml -->
<g id="proc~~state_init~~UsesGraph_node10" class="node"><title>siesta_cml</title>
<polygon fill="#337ab7" stroke="#337ab7" points="339,-1910 276,-1910 276,-1886 339,-1886 339,-1910"/>
<text text-anchor="middle" x="307.5" y="-1895.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_cml</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_cml -->
<g id="proc~~state_init~~UsesGraph_edge10" class="edge"><title>proc~state_init&#45;&gt;siesta_cml</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.262,-1133.28C423.364,-1226.04 409.525,-1814.87 363,-1877 359.301,-1881.94 354.281,-1885.72 348.776,-1888.61"/>
<polygon fill="#000000" stroke="#000000" points="347.036,-1885.54 339.203,-1892.68 349.776,-1891.99 347.036,-1885.54"/>
</g>
<!-- write_subs -->
<g id="proc~~state_init~~UsesGraph_node11" class="node"><title>write_subs</title>
<polygon fill="#337ab7" stroke="#337ab7" points="339.5,-1868 275.5,-1868 275.5,-1844 339.5,-1844 339.5,-1868"/>
<text text-anchor="middle" x="307.5" y="-1853.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_subs</text>
</g>
<!-- proc~state_init&#45;&gt;write_subs -->
<g id="proc~~state_init~~UsesGraph_edge9" class="edge"><title>proc~state_init&#45;&gt;write_subs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.202,-1133.16C422.913,-1222.58 407.006,-1776.53 363,-1835 359.367,-1839.83 354.474,-1843.54 349.103,-1846.41"/>
<polygon fill="#000000" stroke="#000000" points="347.532,-1843.27 339.751,-1850.46 350.318,-1849.7 347.532,-1843.27"/>
</g>
<!-- iodmhs_netcdf -->
<g id="proc~~state_init~~UsesGraph_node12" class="node"><title>iodmhs_netcdf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348.5,-1826 266.5,-1826 266.5,-1802 348.5,-1802 348.5,-1826"/>
<text text-anchor="middle" x="307.5" y="-1811.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">iodmhs_netcdf</text>
</g>
<!-- proc~state_init&#45;&gt;iodmhs_netcdf -->
<g id="proc~~state_init~~UsesGraph_edge11" class="edge"><title>proc~state_init&#45;&gt;iodmhs_netcdf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.129,-1133.26C422.406,-1219.94 404.454,-1738.23 363,-1793 361.367,-1795.16 359.482,-1797.09 357.416,-1798.83"/>
<polygon fill="#000000" stroke="#000000" points="355.108,-1796.16 348.694,-1804.59 358.967,-1802 355.108,-1796.16"/>
</g>
<!-- m_pivot_methods -->
<g id="proc~~state_init~~UsesGraph_node13" class="node"><title>m_pivot_methods</title>
<polygon fill="#337ab7" stroke="#337ab7" points="356,-1784 259,-1784 259,-1760 356,-1760 356,-1784"/>
<text text-anchor="middle" x="307.5" y="-1769.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_pivot_methods</text>
</g>
<!-- proc~state_init&#45;&gt;m_pivot_methods -->
<g id="proc~~state_init~~UsesGraph_edge12" class="edge"><title>proc~state_init&#45;&gt;m_pivot_methods</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.058,-1133.03C421.916,-1215.84 401.961,-1699.85 363,-1751 362.324,-1751.89 361.606,-1752.74 360.85,-1753.55"/>
<polygon fill="#000000" stroke="#000000" points="358.609,-1750.86 353.162,-1759.95 363.087,-1756.24 358.609,-1750.86"/>
</g>
<!-- parallel -->
<g id="proc~~state_init~~UsesGraph_node14" class="node"><title>parallel</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1742 280.5,-1742 280.5,-1718 334.5,-1718 334.5,-1742"/>
<text text-anchor="middle" x="307.5" y="-1727.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">parallel</text>
</g>
<!-- proc~state_init&#45;&gt;parallel -->
<g id="proc~~state_init~~UsesGraph_edge13" class="edge"><title>proc~state_init&#45;&gt;parallel</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.959,-1133.24C421.315,-1213.39 399.401,-1661.56 363,-1709 358.29,-1715.14 351.545,-1719.48 344.397,-1722.56"/>
<polygon fill="#000000" stroke="#000000" points="342.829,-1719.4 334.553,-1726.01 345.148,-1726.01 342.829,-1719.4"/>
</g>
<!-- m_mpi_utils -->
<g id="proc~~state_init~~UsesGraph_node15" class="node"><title>m_mpi_utils</title>
<polygon fill="#337ab7" stroke="#337ab7" points="342.5,-1700 272.5,-1700 272.5,-1676 342.5,-1676 342.5,-1700"/>
<text text-anchor="middle" x="307.5" y="-1685.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mpi_utils</text>
</g>
<!-- proc~state_init&#45;&gt;m_mpi_utils -->
<g id="proc~~state_init~~UsesGraph_edge14" class="edge"><title>proc~state_init&#45;&gt;m_mpi_utils</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.758,-1133.11C427.06,-1205.41 430.434,-1579.84 363,-1667 359.979,-1670.9 356.136,-1674.08 351.892,-1676.67"/>
<polygon fill="#000000" stroke="#000000" points="350.163,-1673.62 342.756,-1681.2 353.27,-1679.9 350.163,-1673.62"/>
</g>
<!-- siesta_geom -->
<g id="proc~~state_init~~UsesGraph_node16" class="node"><title>siesta_geom</title>
<polygon fill="#337ab7" stroke="#337ab7" points="344,-1658 271,-1658 271,-1634 344,-1634 344,-1658"/>
<text text-anchor="middle" x="307.5" y="-1643.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_geom</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_geom -->
<g id="proc~~state_init~~UsesGraph_edge15" class="edge"><title>proc~state_init&#45;&gt;siesta_geom</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.629,-1133.07C426.129,-1201.95 425.423,-1545.1 363,-1625 360.296,-1628.46 356.947,-1631.35 353.249,-1633.77"/>
<polygon fill="#000000" stroke="#000000" points="351.335,-1630.82 344.124,-1638.58 354.602,-1637.01 351.335,-1630.82"/>
</g>
<!-- zmatrix -->
<g id="proc~~state_init~~UsesGraph_node17" class="node"><title>zmatrix</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1616 280.5,-1616 280.5,-1592 334.5,-1592 334.5,-1616"/>
<text text-anchor="middle" x="307.5" y="-1601.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">zmatrix</text>
</g>
<!-- proc~state_init&#45;&gt;zmatrix -->
<g id="proc~~state_init~~UsesGraph_edge16" class="edge"><title>proc~state_init&#45;&gt;zmatrix</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.476,-1133.34C425.111,-1199.34 420.333,-1510.45 363,-1583 358.246,-1589.02 351.544,-1593.31 344.461,-1596.38"/>
<polygon fill="#000000" stroke="#000000" points="342.964,-1593.19 334.712,-1599.84 345.307,-1599.79 342.964,-1593.19"/>
</g>
<!-- class_Sparsity -->
<g id="proc~~state_init~~UsesGraph_node18" class="node"><title>class_Sparsity</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-1574 267,-1574 267,-1550 348,-1550 348,-1574"/>
<text text-anchor="middle" x="307.5" y="-1559.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_Sparsity</text>
</g>
<!-- proc~state_init&#45;&gt;class_Sparsity -->
<g id="proc~~state_init~~UsesGraph_edge17" class="edge"><title>proc~state_init&#45;&gt;class_Sparsity</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.298,-1133.02C424.031,-1194.74 415.425,-1475.55 363,-1541 361.158,-1543.3 359.031,-1545.35 356.709,-1547.17"/>
<polygon fill="#000000" stroke="#000000" points="354.775,-1544.25 348.187,-1552.55 358.511,-1550.17 354.775,-1544.25"/>
</g>
<!-- m_hsparse -->
<g id="proc~~state_init~~UsesGraph_node19" class="node"><title>m_hsparse</title>
<polygon fill="#337ab7" stroke="#337ab7" points="340.5,-1532 274.5,-1532 274.5,-1508 340.5,-1508 340.5,-1532"/>
<text text-anchor="middle" x="307.5" y="-1517.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_hsparse</text>
</g>
<!-- proc~state_init&#45;&gt;m_hsparse -->
<g id="proc~~state_init~~UsesGraph_edge18" class="edge"><title>proc~state_init&#45;&gt;m_hsparse</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.067,-1133.34C422.779,-1191.85 410.357,-1440.85 363,-1499 359.438,-1503.37 354.851,-1506.84 349.853,-1509.58"/>
<polygon fill="#000000" stroke="#000000" points="348.218,-1506.48 340.544,-1513.78 351.098,-1512.86 348.218,-1506.48"/>
</g>
<!-- m_test_io -->
<g id="proc~~state_init~~UsesGraph_node20" class="node"><title>m_test_io</title>
<polygon fill="#337ab7" stroke="#337ab7" points="337,-1490 278,-1490 278,-1466 337,-1466 337,-1490"/>
<text text-anchor="middle" x="307.5" y="-1475.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_test_io</text>
</g>
<!-- proc~state_init&#45;&gt;m_test_io -->
<g id="proc~~state_init~~UsesGraph_edge19" class="edge"><title>proc~state_init&#45;&gt;m_test_io</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.806,-1133.04C421.471,-1186.97 405.477,-1405.89 363,-1457 358.602,-1462.29 352.706,-1466.25 346.415,-1469.22"/>
<polygon fill="#000000" stroke="#000000" points="345.08,-1465.98 337.045,-1472.89 347.632,-1472.5 345.08,-1465.98"/>
</g>
<!-- module~m_mixing_scf -->
<g id="proc~~state_init~~UsesGraph_node21" class="node"><title>module~m_mixing_scf</title>
<g id="a_proc~~state_init~~UsesGraph_node21"><a xlink:href=".././module/m_mixing_scf.html" xlink:title="m_mixing_scf">
<polygon fill="#337ab7" stroke="#337ab7" points="346.5,-1448 268.5,-1448 268.5,-1424 346.5,-1424 346.5,-1448"/>
<text text-anchor="middle" x="307.5" y="-1433.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mixing_scf</text>
</a>
</g>
</g>
<!-- proc~state_init&#45;&gt;module~m_mixing_scf -->
<g id="proc~~state_init~~UsesGraph_edge20" class="edge"><title>proc~state_init&#45;&gt;module~m_mixing_scf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.444,-1133.18C419.898,-1183.05 400.506,-1371.03 363,-1415 360.796,-1417.58 358.235,-1419.85 355.449,-1421.84"/>
<polygon fill="#000000" stroke="#000000" points="353.434,-1418.96 346.545,-1427.01 356.95,-1425.02 353.434,-1418.96"/>
</g>
<!-- files -->
<g id="proc~~state_init~~UsesGraph_node22" class="node"><title>files</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1406 280.5,-1406 280.5,-1382 334.5,-1382 334.5,-1406"/>
<text text-anchor="middle" x="307.5" y="-1391.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">files</text>
</g>
<!-- proc~state_init&#45;&gt;files -->
<g id="proc~~state_init~~UsesGraph_edge21" class="edge"><title>proc~state_init&#45;&gt;files</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M426.149,-1133C427.621,-1172.58 426.976,-1300.51 363,-1373 357.972,-1378.7 351.218,-1382.86 344.179,-1385.89"/>
<polygon fill="#000000" stroke="#000000" points="342.755,-1382.69 334.539,-1389.38 345.133,-1389.27 342.755,-1382.69"/>
</g>
<!-- m_ts_electype -->
<g id="proc~~state_init~~UsesGraph_node23" class="node"><title>m_ts_electype</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348.5,-1364 266.5,-1364 266.5,-1340 348.5,-1340 348.5,-1364"/>
<text text-anchor="middle" x="307.5" y="-1349.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_electype</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_electype -->
<g id="proc~~state_init~~UsesGraph_edge22" class="edge"><title>proc~state_init&#45;&gt;m_ts_electype</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.424,-1133.22C424.544,-1168.61 417.224,-1272.34 363,-1331 361.253,-1332.89 359.318,-1334.61 357.247,-1336.18"/>
<polygon fill="#000000" stroke="#000000" points="355.348,-1333.24 348.711,-1341.5 359.049,-1339.18 355.348,-1333.24"/>
</g>
<!-- m_ts_global_vars -->
<g id="proc~~state_init~~UsesGraph_node24" class="node"><title>m_ts_global_vars</title>
<polygon fill="#337ab7" stroke="#337ab7" points="356,-1322 259,-1322 259,-1298 356,-1298 356,-1322"/>
<text text-anchor="middle" x="307.5" y="-1307.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_global_vars</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_global_vars -->
<g id="proc~~state_init~~UsesGraph_edge23" class="edge"><title>proc~state_init&#45;&gt;m_ts_global_vars</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.335,-1133.39C420.818,-1163.98 407.628,-1243.85 363,-1289 361.908,-1290.1 360.753,-1291.15 359.544,-1292.14"/>
<polygon fill="#000000" stroke="#000000" points="357.266,-1289.46 350.923,-1297.94 361.174,-1295.27 357.266,-1289.46"/>
</g>
<!-- m_ts_sparse -->
<g id="proc~~state_init~~UsesGraph_node25" class="node"><title>m_ts_sparse</title>
<polygon fill="#337ab7" stroke="#337ab7" points="344.5,-1280 270.5,-1280 270.5,-1256 344.5,-1256 344.5,-1280"/>
<text text-anchor="middle" x="307.5" y="-1265.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_sparse</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_sparse -->
<g id="proc~~state_init~~UsesGraph_edge24" class="edge"><title>proc~state_init&#45;&gt;m_ts_sparse</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M422.639,-1133.21C416.218,-1158.03 398.373,-1214.76 363,-1247 360.213,-1249.54 357.086,-1251.79 353.776,-1253.77"/>
<polygon fill="#000000" stroke="#000000" points="351.997,-1250.75 344.696,-1258.42 355.191,-1256.98 351.997,-1250.75"/>
</g>
<!-- m_gamma -->
<g id="proc~~state_init~~UsesGraph_node26" class="node"><title>m_gamma</title>
<polygon fill="#337ab7" stroke="#337ab7" points="339.5,-1238 275.5,-1238 275.5,-1214 339.5,-1214 339.5,-1238"/>
<text text-anchor="middle" x="307.5" y="-1223.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_gamma</text>
</g>
<!-- proc~state_init&#45;&gt;m_gamma -->
<g id="proc~~state_init~~UsesGraph_edge25" class="edge"><title>proc~state_init&#45;&gt;m_gamma</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M419.297,-1133.28C409.596,-1151.35 389.203,-1185.1 363,-1205 358.817,-1208.18 354.096,-1210.93 349.225,-1213.29"/>
<polygon fill="#000000" stroke="#000000" points="347.563,-1210.2 339.777,-1217.38 350.344,-1216.62 347.563,-1210.2"/>
</g>
<!-- sys -->
<g id="proc~~state_init~~UsesGraph_node27" class="node"><title>sys</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1196 280.5,-1196 280.5,-1172 334.5,-1172 334.5,-1196"/>
<text text-anchor="middle" x="307.5" y="-1181.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sys</text>
</g>
<!-- proc~state_init&#45;&gt;sys -->
<g id="proc~~state_init~~UsesGraph_edge26" class="edge"><title>proc~state_init&#45;&gt;sys</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M409.668,-1133.09C397.388,-1142.11 379.7,-1154.31 363,-1163 357.097,-1166.07 350.639,-1168.95 344.298,-1171.53"/>
<polygon fill="#000000" stroke="#000000" points="342.582,-1168.44 334.528,-1175.32 345.117,-1174.96 342.582,-1168.44"/>
</g>
<!-- ldau_specs -->
<g id="proc~~state_init~~UsesGraph_node28" class="node"><title>ldau_specs</title>
<polygon fill="#337ab7" stroke="#337ab7" points="341,-1154 274,-1154 274,-1130 341,-1130 341,-1154"/>
<text text-anchor="middle" x="307.5" y="-1139.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ldau_specs</text>
</g>
<!-- proc~state_init&#45;&gt;ldau_specs -->
<g id="proc~~state_init~~UsesGraph_edge27" class="edge"><title>proc~state_init&#45;&gt;ldau_specs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398.951,-1125.77C384.903,-1128.29 367.309,-1131.44 351.382,-1134.3"/>
<polygon fill="#000000" stroke="#000000" points="350.434,-1130.92 341.21,-1136.13 351.671,-1137.81 350.434,-1130.92"/>
</g>
<!-- m_spin -->
<g id="proc~~state_init~~UsesGraph_node29" class="node"><title>m_spin</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1112 280.5,-1112 280.5,-1088 334.5,-1088 334.5,-1112"/>
<text text-anchor="middle" x="307.5" y="-1097.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_spin</text>
</g>
<!-- proc~state_init&#45;&gt;m_spin -->
<g id="proc~~state_init~~UsesGraph_edge28" class="edge"><title>proc~state_init&#45;&gt;m_spin</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398.951,-1116.23C382.832,-1113.34 362.044,-1109.61 344.463,-1106.45"/>
<polygon fill="#000000" stroke="#000000" points="345.002,-1103 334.541,-1104.67 343.765,-1109.89 345.002,-1103"/>
</g>
<!-- m_ts_kpoints -->
<g id="proc~~state_init~~UsesGraph_node30" class="node"><title>m_ts_kpoints</title>
<polygon fill="#337ab7" stroke="#337ab7" points="345.5,-1070 269.5,-1070 269.5,-1046 345.5,-1046 345.5,-1070"/>
<text text-anchor="middle" x="307.5" y="-1055.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_kpoints</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_kpoints -->
<g id="proc~~state_init~~UsesGraph_edge29" class="edge"><title>proc~state_init&#45;&gt;m_ts_kpoints</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M409.668,-1108.91C397.388,-1099.89 379.7,-1087.69 363,-1079 359.703,-1077.28 356.232,-1075.63 352.706,-1074.05"/>
<polygon fill="#000000" stroke="#000000" points="353.894,-1070.76 343.321,-1070.08 351.163,-1077.2 353.894,-1070.76"/>
</g>
<!-- siesta_options -->
<g id="proc~~state_init~~UsesGraph_node31" class="node"><title>siesta_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-1028 267,-1028 267,-1004 348,-1004 348,-1028"/>
<text text-anchor="middle" x="307.5" y="-1013.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_options</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_options -->
<g id="proc~~state_init~~UsesGraph_edge30" class="edge"><title>proc~state_init&#45;&gt;siesta_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M419.297,-1108.72C409.596,-1090.65 389.203,-1056.9 363,-1037 360.986,-1035.47 358.847,-1034.04 356.627,-1032.7"/>
<polygon fill="#000000" stroke="#000000" points="358.228,-1029.59 347.753,-1028 354.952,-1035.78 358.228,-1029.59"/>
</g>
<!-- m_ioxv -->
<g id="proc~~state_init~~UsesGraph_node32" class="node"><title>m_ioxv</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-986 280.5,-986 280.5,-962 334.5,-962 334.5,-986"/>
<text text-anchor="middle" x="307.5" y="-971.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ioxv</text>
</g>
<!-- proc~state_init&#45;&gt;m_ioxv -->
<g id="proc~~state_init~~UsesGraph_edge31" class="edge"><title>proc~state_init&#45;&gt;m_ioxv</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M422.639,-1108.79C416.218,-1083.97 398.373,-1027.24 363,-995 357.663,-990.136 351.077,-986.353 344.351,-983.425"/>
<polygon fill="#000000" stroke="#000000" points="345.116,-979.974 334.524,-979.723 342.648,-986.524 345.116,-979.974"/>
</g>
<!-- domain_decom -->
<g id="proc~~state_init~~UsesGraph_node33" class="node"><title>domain_decom</title>
<polygon fill="#337ab7" stroke="#337ab7" points="350.5,-944 264.5,-944 264.5,-920 350.5,-920 350.5,-944"/>
<text text-anchor="middle" x="307.5" y="-929.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">domain_decom</text>
</g>
<!-- proc~state_init&#45;&gt;domain_decom -->
<g id="proc~~state_init~~UsesGraph_edge32" class="edge"><title>proc~state_init&#45;&gt;domain_decom</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.335,-1108.61C420.818,-1078.02 407.628,-998.15 363,-953 361.775,-951.761 360.469,-950.593 359.097,-949.493"/>
<polygon fill="#000000" stroke="#000000" points="360.923,-946.504 350.652,-943.905 357.06,-952.342 360.923,-946.504"/>
</g>
<!-- m_sparse -->
<g id="proc~~state_init~~UsesGraph_node34" class="node"><title>m_sparse</title>
<polygon fill="#337ab7" stroke="#337ab7" points="337.5,-902 277.5,-902 277.5,-878 337.5,-878 337.5,-902"/>
<text text-anchor="middle" x="307.5" y="-887.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_sparse</text>
</g>
<!-- proc~state_init&#45;&gt;m_sparse -->
<g id="proc~~state_init~~UsesGraph_edge33" class="edge"><title>proc~state_init&#45;&gt;m_sparse</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.424,-1108.78C424.544,-1073.39 417.224,-969.658 363,-911 358.618,-906.26 353.046,-902.579 347.146,-899.723"/>
<polygon fill="#000000" stroke="#000000" points="348.31,-896.418 337.729,-895.881 345.666,-902.9 348.31,-896.418"/>
</g>
<!-- m_proximity_check -->
<g id="proc~~state_init~~UsesGraph_node35" class="node"><title>m_proximity_check</title>
<polygon fill="#337ab7" stroke="#337ab7" points="359.5,-860 255.5,-860 255.5,-836 359.5,-836 359.5,-860"/>
<text text-anchor="middle" x="307.5" y="-845.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_proximity_check</text>
</g>
<!-- proc~state_init&#45;&gt;m_proximity_check -->
<g id="proc~~state_init~~UsesGraph_edge34" class="edge"><title>proc~state_init&#45;&gt;m_proximity_check</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M426.149,-1109C427.621,-1069.42 426.976,-941.494 363,-869 362.132,-868.016 361.212,-867.079 360.249,-866.184"/>
<polygon fill="#000000" stroke="#000000" points="362.238,-863.302 352.123,-860.149 358.064,-868.922 362.238,-863.302"/>
</g>
<!-- m_sparsity_handling -->
<g id="proc~~state_init~~UsesGraph_node36" class="node"><title>m_sparsity_handling</title>
<polygon fill="#337ab7" stroke="#337ab7" points="363,-818 252,-818 252,-794 363,-794 363,-818"/>
<text text-anchor="middle" x="307.5" y="-803.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_sparsity_handling</text>
</g>
<!-- proc~state_init&#45;&gt;m_sparsity_handling -->
<g id="proc~~state_init~~UsesGraph_edge35" class="edge"><title>proc~state_init&#45;&gt;m_sparsity_handling</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.444,-1108.82C419.898,-1058.95 400.506,-870.969 363,-827 362.149,-826.002 361.244,-825.051 360.294,-824.145"/>
<polygon fill="#000000" stroke="#000000" points="362.327,-821.294 352.243,-818.046 358.1,-826.874 362.327,-821.294"/>
</g>
<!-- Kpoint_grid -->
<g id="proc~~state_init~~UsesGraph_node37" class="node"><title>Kpoint_grid</title>
<polygon fill="#337ab7" stroke="#337ab7" points="341,-776 274,-776 274,-752 341,-752 341,-776"/>
<text text-anchor="middle" x="307.5" y="-761.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Kpoint_grid</text>
</g>
<!-- proc~state_init&#45;&gt;Kpoint_grid -->
<g id="proc~~state_init~~UsesGraph_edge36" class="edge"><title>proc~state_init&#45;&gt;Kpoint_grid</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.806,-1108.96C421.471,-1055.03 405.477,-836.106 363,-785 359.564,-780.866 355.214,-777.543 350.475,-774.874"/>
<polygon fill="#000000" stroke="#000000" points="351.568,-771.523 341.023,-770.503 348.63,-777.877 351.568,-771.523"/>
</g>
<!-- m_chess -->
<g id="proc~~state_init~~UsesGraph_node38" class="node"><title>m_chess</title>
<polygon fill="#337ab7" stroke="#337ab7" points="335,-734 280,-734 280,-710 335,-710 335,-734"/>
<text text-anchor="middle" x="307.5" y="-719.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_chess</text>
</g>
<!-- proc~state_init&#45;&gt;m_chess -->
<g id="proc~~state_init~~UsesGraph_edge37" class="edge"><title>proc~state_init&#45;&gt;m_chess</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.067,-1108.66C422.779,-1050.15 410.357,-801.153 363,-743 358.246,-737.162 351.665,-732.944 344.716,-729.897"/>
<polygon fill="#000000" stroke="#000000" points="345.745,-726.547 335.151,-726.427 343.358,-733.128 345.745,-726.547"/>
</g>
<!-- iodm_netcdf -->
<g id="proc~~state_init~~UsesGraph_node39" class="node"><title>iodm_netcdf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="343,-692 272,-692 272,-668 343,-668 343,-692"/>
<text text-anchor="middle" x="307.5" y="-677.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">iodm_netcdf</text>
</g>
<!-- proc~state_init&#45;&gt;iodm_netcdf -->
<g id="proc~~state_init~~UsesGraph_edge38" class="edge"><title>proc~state_init&#45;&gt;iodm_netcdf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.298,-1108.98C424.031,-1047.26 415.425,-766.448 363,-701 360.068,-697.34 356.417,-694.317 352.401,-691.82"/>
<polygon fill="#000000" stroke="#000000" points="353.672,-688.54 343.168,-687.152 350.514,-694.787 353.672,-688.54"/>
</g>
<!-- alloc -->
<g id="proc~~state_init~~UsesGraph_node40" class="node"><title>alloc</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-650 280.5,-650 280.5,-626 334.5,-626 334.5,-650"/>
<text text-anchor="middle" x="307.5" y="-635.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">alloc</text>
</g>
<!-- proc~state_init&#45;&gt;alloc -->
<g id="proc~~state_init~~UsesGraph_edge39" class="edge"><title>proc~state_init&#45;&gt;alloc</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.476,-1108.66C425.111,-1042.66 420.333,-731.555 363,-659 358.246,-652.983 351.544,-648.689 344.461,-645.624"/>
<polygon fill="#000000" stroke="#000000" points="345.307,-642.21 334.712,-642.161 342.964,-648.807 345.307,-642.21"/>
</g>
<!-- module~m_mixing -->
<g id="proc~~state_init~~UsesGraph_node41" class="node"><title>module~m_mixing</title>
<g id="a_proc~~state_init~~UsesGraph_node41"><a xlink:href=".././module/m_mixing.html" xlink:title="m_mixing">
<polygon fill="#337ab7" stroke="#337ab7" points="216,-1406 158,-1406 158,-1382 216,-1382 216,-1406"/>
<text text-anchor="middle" x="187" y="-1391.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mixing</text>
</a>
</g>
</g>
<!-- proc~state_init&#45;&gt;module~m_mixing -->
<g id="proc~~state_init~~UsesGraph_edge40" class="edge"><title>proc~state_init&#45;&gt;module~m_mixing</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.943,-1108.96C421.429,-1035.61 401.238,-650.789 363,-617 326.032,-584.333 288.288,-583.579 252,-617 194.978,-669.519 188.76,-1250.31 188.083,-1371.8"/>
<polygon fill="#000000" stroke="#000000" points="184.583,-1371.79 188.034,-1381.81 191.583,-1371.82 184.583,-1371.79"/>
</g>
<!-- units -->
<g id="proc~~state_init~~UsesGraph_node42" class="node"><title>units</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-570 280.5,-570 280.5,-546 334.5,-546 334.5,-570"/>
<text text-anchor="middle" x="307.5" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">units</text>
</g>
<!-- proc~state_init&#45;&gt;units -->
<g id="proc~~state_init~~UsesGraph_edge41" class="edge"><title>proc~state_init&#45;&gt;units</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.636,-1108.7C426.204,-1036.88 425.919,-671.991 363,-584 358.241,-577.345 351.318,-572.331 343.993,-568.576"/>
<polygon fill="#000000" stroke="#000000" points="345.196,-565.281 334.632,-564.465 342.381,-571.69 345.196,-565.281"/>
</g>
<!-- m_os -->
<g id="proc~~state_init~~UsesGraph_node43" class="node"><title>m_os</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-528 280.5,-528 280.5,-504 334.5,-504 334.5,-528"/>
<text text-anchor="middle" x="307.5" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_os</text>
</g>
<!-- proc~state_init&#45;&gt;m_os -->
<g id="proc~~state_init~~UsesGraph_edge42" class="edge"><title>proc~state_init&#45;&gt;m_os</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.953,-1108.85C421.274,-1029.24 399.173,-584.111 363,-537 358.287,-530.862 351.542,-526.518 344.393,-523.443"/>
<polygon fill="#000000" stroke="#000000" points="345.144,-519.997 334.55,-519.987 342.826,-526.602 345.144,-519.997"/>
</g>
<!-- create_Sparsity_SC -->
<g id="proc~~state_init~~UsesGraph_node44" class="node"><title>create_Sparsity_SC</title>
<polygon fill="#337ab7" stroke="#337ab7" points="361,-486 254,-486 254,-462 361,-462 361,-486"/>
<text text-anchor="middle" x="307.5" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">create_Sparsity_SC</text>
</g>
<!-- proc~state_init&#45;&gt;create_Sparsity_SC -->
<g id="proc~~state_init~~UsesGraph_edge43" class="edge"><title>proc~state_init&#45;&gt;create_Sparsity_SC</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.042,-1108.79C421.833,-1025.74 401.691,-545.762 363,-495 362.324,-494.113 361.605,-493.263 360.849,-492.45"/>
<polygon fill="#000000" stroke="#000000" points="363.085,-489.757 353.159,-486.052 358.608,-495.138 363.085,-489.757"/>
</g>
<!-- class_dSpData2D -->
<g id="proc~~state_init~~UsesGraph_node45" class="node"><title>class_dSpData2D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="356,-444 259,-444 259,-420 356,-420 356,-444"/>
<text text-anchor="middle" x="307.5" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dSpData2D</text>
</g>
<!-- proc~state_init&#45;&gt;class_dSpData2D -->
<g id="proc~~state_init~~UsesGraph_edge44" class="edge"><title>proc~state_init&#45;&gt;class_dSpData2D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.124,-1108.81C422.367,-1022.65 404.225,-507.437 363,-453 362.411,-452.222 361.789,-451.473 361.137,-450.751"/>
<polygon fill="#000000" stroke="#000000" points="363.081,-447.811 353.182,-444.035 358.565,-453.16 363.081,-447.811"/>
</g>
<!-- m_ts_tri_init -->
<g id="proc~~state_init~~UsesGraph_node46" class="node"><title>m_ts_tri_init</title>
<polygon fill="#337ab7" stroke="#337ab7" points="342.5,-402 272.5,-402 272.5,-378 342.5,-378 342.5,-402"/>
<text text-anchor="middle" x="307.5" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_tri_init</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_tri_init -->
<g id="proc~~state_init~~UsesGraph_edge45" class="edge"><title>proc~state_init&#45;&gt;m_ts_tri_init</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.198,-1108.91C422.875,-1019.99 406.776,-469.137 363,-411 359.994,-407.008 356.126,-403.775 351.839,-401.156"/>
<polygon fill="#000000" stroke="#000000" points="353.109,-397.88 342.592,-396.598 350.014,-404.159 353.109,-397.88"/>
</g>
<!-- atomlist -->
<g id="proc~~state_init~~UsesGraph_node47" class="node"><title>atomlist</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-360 280.5,-360 280.5,-336 334.5,-336 334.5,-360"/>
<text text-anchor="middle" x="307.5" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">atomlist</text>
</g>
<!-- proc~state_init&#45;&gt;atomlist -->
<g id="proc~~state_init~~UsesGraph_edge46" class="edge"><title>proc~state_init&#45;&gt;atomlist</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.258,-1108.79C423.327,-1016.51 409.294,-430.794 363,-369 358.361,-362.807 351.644,-358.44 344.501,-355.361"/>
<polygon fill="#000000" stroke="#000000" points="345.247,-351.914 334.652,-351.91 342.932,-358.52 345.247,-351.914"/>
</g>
<!-- m_rmaxh -->
<g id="proc~~state_init~~UsesGraph_node48" class="node"><title>m_rmaxh</title>
<polygon fill="#337ab7" stroke="#337ab7" points="336.5,-318 278.5,-318 278.5,-294 336.5,-294 336.5,-318"/>
<text text-anchor="middle" x="307.5" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_rmaxh</text>
</g>
<!-- proc~state_init&#45;&gt;m_rmaxh -->
<g id="proc~~state_init~~UsesGraph_edge47" class="edge"><title>proc~state_init&#45;&gt;m_rmaxh</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.313,-1108.72C423.762,-1013.32 411.823,-392.467 363,-327 358.764,-321.32 352.781,-317.177 346.319,-314.153"/>
<polygon fill="#000000" stroke="#000000" points="347.248,-310.762 336.657,-310.478 344.759,-317.305 347.248,-310.762"/>
</g>
<!-- m_overlap -->
<g id="proc~~state_init~~UsesGraph_node49" class="node"><title>m_overlap</title>
<polygon fill="#337ab7" stroke="#337ab7" points="339,-276 276,-276 276,-252 339,-252 339,-276"/>
<text text-anchor="middle" x="307.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_overlap</text>
</g>
<!-- proc~state_init&#45;&gt;m_overlap -->
<g id="proc~~state_init~~UsesGraph_edge48" class="edge"><title>proc~state_init&#45;&gt;m_overlap</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.364,-1108.7C424.178,-1010.4 414.363,-354.157 363,-285 359.321,-280.046 354.31,-276.26 348.81,-273.368"/>
<polygon fill="#000000" stroke="#000000" points="349.811,-269.99 339.239,-269.294 347.07,-276.431 349.811,-269.99"/>
</g>
<!-- m_iotdxv -->
<g id="proc~~state_init~~UsesGraph_node50" class="node"><title>m_iotdxv</title>
<polygon fill="#337ab7" stroke="#337ab7" points="335,-234 280,-234 280,-210 335,-210 335,-234"/>
<text text-anchor="middle" x="307.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_iotdxv</text>
</g>
<!-- proc~state_init&#45;&gt;m_iotdxv -->
<g id="proc~~state_init~~UsesGraph_edge49" class="edge"><title>proc~state_init&#45;&gt;m_iotdxv</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.411,-1108.73C424.577,-1007.77 416.914,-315.861 363,-243 358.48,-236.892 351.937,-232.56 344.941,-229.488"/>
<polygon fill="#000000" stroke="#000000" points="345.864,-226.102 335.27,-226.032 343.509,-232.693 345.864,-226.102"/>
</g>
<!-- m_steps -->
<g id="proc~~state_init~~UsesGraph_node51" class="node"><title>m_steps</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-192 280.5,-192 280.5,-168 334.5,-168 334.5,-192"/>
<text text-anchor="middle" x="307.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_steps</text>
</g>
<!-- proc~state_init&#45;&gt;m_steps -->
<g id="proc~~state_init~~UsesGraph_edge50" class="edge"><title>proc~state_init&#45;&gt;m_steps</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.453,-1108.81C424.959,-1005.42 419.475,-277.582 363,-201 358.407,-194.772 351.71,-190.391 344.571,-187.31"/>
<polygon fill="#000000" stroke="#000000" points="345.312,-183.861 334.717,-183.861 343,-190.468 345.312,-183.861"/>
</g>
<!-- m_new_dm -->
<g id="proc~~state_init~~UsesGraph_node52" class="node"><title>m_new_dm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="341.5,-150 273.5,-150 273.5,-126 341.5,-126 341.5,-150"/>
<text text-anchor="middle" x="307.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_new_dm</text>
</g>
<!-- proc~state_init&#45;&gt;m_new_dm -->
<g id="proc~~state_init~~UsesGraph_edge51" class="edge"><title>proc~state_init&#45;&gt;m_new_dm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.492,-1108.93C425.322,-1003.36 422.047,-239.318 363,-159 359.816,-154.669 355.613,-151.231 350.95,-148.502"/>
<polygon fill="#000000" stroke="#000000" points="352.101,-145.175 341.563,-144.08 349.118,-151.508 352.101,-145.175"/>
</g>
<!-- m_energies -->
<g id="proc~~state_init~~UsesGraph_node53" class="node"><title>m_energies</title>
<polygon fill="#337ab7" stroke="#337ab7" points="342,-108 273,-108 273,-84 342,-84 342,-108"/>
<text text-anchor="middle" x="307.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_energies</text>
</g>
<!-- proc~state_init&#45;&gt;m_energies -->
<g id="proc~~state_init~~UsesGraph_edge52" class="edge"><title>proc~state_init&#45;&gt;m_energies</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.527,-1108.74C425.664,-999.908 424.566,-200.981 363,-117 359.895,-112.764 355.815,-109.383 351.282,-106.683"/>
<polygon fill="#000000" stroke="#000000" points="352.673,-103.468 342.144,-102.288 349.638,-109.777 352.673,-103.468"/>
</g>
<!-- class_dSpData1D -->
<g id="proc~~state_init~~UsesGraph_node54" class="node"><title>class_dSpData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="356,-66 259,-66 259,-42 356,-42 356,-66"/>
<text text-anchor="middle" x="307.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dSpData1D</text>
</g>
<!-- proc~state_init&#45;&gt;class_dSpData1D -->
<g id="proc~~state_init~~UsesGraph_edge53" class="edge"><title>proc~state_init&#45;&gt;class_dSpData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.559,-1108.94C425.996,-998.344 427.157,-162.745 363,-75 362.437,-74.2301 361.842,-73.4884 361.218,-72.7739"/>
<polygon fill="#000000" stroke="#000000" points="363.401,-70.0342 353.559,-66.1118 358.807,-75.3157 363.401,-70.0342"/>
</g>
<!-- m_eo -->
<g id="proc~~state_init~~UsesGraph_node55" class="node"><title>m_eo</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-24 280.5,-24 280.5,-0 334.5,-0 334.5,-24"/>
<text text-anchor="middle" x="307.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_eo</text>
</g>
<!-- proc~state_init&#45;&gt;m_eo -->
<g id="proc~~state_init~~UsesGraph_edge54" class="edge"><title>proc~state_init&#45;&gt;m_eo</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.589,-1108.81C426.316,-995.247 429.689,-124.428 363,-33 358.44,-26.7484 351.756,-22.3578 344.619,-19.2743"/>
<polygon fill="#000000" stroke="#000000" points="345.358,-15.825 334.763,-15.8277 343.047,-22.4326 345.358,-15.825"/>
</g>
<!-- module~m_mixing_scf&#45;&gt;module~m_mixing -->
<g id="proc~~state_init~~UsesGraph_edge56" class="edge"><title>module~m_mixing_scf&#45;&gt;module~m_mixing</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M272.543,-1423.96C257.956,-1418.79 240.852,-1412.73 225.858,-1407.42"/>
<polygon fill="#000000" stroke="#000000" points="226.953,-1404.09 216.358,-1404.05 224.614,-1410.69 226.953,-1404.09"/>
</g>
<!-- class_Fstack_dData1D -->
<g id="proc~~state_init~~UsesGraph_node57" class="node"><title>class_Fstack_dData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="122,-1448 -7.10543e-15,-1448 -7.10543e-15,-1424 122,-1424 122,-1448"/>
<text text-anchor="middle" x="61" y="-1433.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_Fstack_dData1D</text>
</g>
<!-- module~m_mixing_scf&#45;&gt;class_Fstack_dData1D -->
<g id="proc~~state_init~~UsesGraph_edge55" class="edge"><title>module~m_mixing_scf&#45;&gt;class_Fstack_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M268.297,-1436C232.038,-1436 176.66,-1436 132.406,-1436"/>
<polygon fill="#000000" stroke="#000000" points="132.281,-1432.5 122.281,-1436 132.281,-1439.5 132.281,-1432.5"/>
</g>
<!-- precision -->
<g id="proc~~state_init~~UsesGraph_node56" class="node"><title>precision</title>
<polygon fill="#337ab7" stroke="#337ab7" points="88.5,-1406 33.5,-1406 33.5,-1382 88.5,-1382 88.5,-1406"/>
<text text-anchor="middle" x="61" y="-1391.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">precision</text>
</g>
<!-- module~m_mixing&#45;&gt;precision -->
<g id="proc~~state_init~~UsesGraph_edge57" class="edge"><title>module~m_mixing&#45;&gt;precision</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M157.862,-1394C140.378,-1394 117.711,-1394 98.8085,-1394"/>
<polygon fill="#000000" stroke="#000000" points="98.7511,-1390.5 88.7511,-1394 98.7511,-1397.5 98.7511,-1390.5"/>
</g>
<!-- module~m_mixing&#45;&gt;class_Fstack_dData1D -->
<g id="proc~~state_init~~UsesGraph_edge58" class="edge"><title>module~m_mixing&#45;&gt;class_Fstack_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M157.862,-1403.53C142.929,-1408.59 124.216,-1414.93 107.296,-1420.66"/>
<polygon fill="#000000" stroke="#000000" points="105.931,-1417.42 97.5827,-1423.95 108.177,-1424.05 105.931,-1417.42"/>
</g>
<!-- class_dData1D -->
<g id="proc~~state_init~~UsesGraph_node58" class="node"><title>class_dData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="103.5,-1364 18.5,-1364 18.5,-1340 103.5,-1340 103.5,-1364"/>
<text text-anchor="middle" x="61" y="-1349.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dData1D</text>
</g>
<!-- module~m_mixing&#45;&gt;class_dData1D -->
<g id="proc~~state_init~~UsesGraph_edge59" class="edge"><title>module~m_mixing&#45;&gt;class_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M157.862,-1384.47C142.929,-1379.41 124.216,-1373.07 107.296,-1367.34"/>
<polygon fill="#000000" stroke="#000000" points="108.177,-1363.95 97.5827,-1364.05 105.931,-1370.58 108.177,-1363.95"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="490pt" height="32pt"
 viewBox="0.00 0.00 489.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 485.5,-28 485.5,4 -4,4"/>
<!-- Module -->
<g id="node1" class="node"><title>Module</title>
<polygon fill="#337ab7" stroke="#337ab7" points="54,-24 0,-24 0,-0 54,-0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Module</text>
</g>
<!-- Submodule -->
<g id="node2" class="node"><title>Submodule</title>
<polygon fill="#5bc0de" stroke="#5bc0de" points="139.5,-24 72.5,-24 72.5,-0 139.5,-0 139.5,-24"/>
<text text-anchor="middle" x="106" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Submodule</text>
</g>
<!-- Subroutine -->
<g id="node3" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="222,-24 158,-24 158,-0 222,-0 222,-24"/>
<text text-anchor="middle" x="190" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node4" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="294,-24 240,-24 240,-0 294,-0 294,-24"/>
<text text-anchor="middle" x="267" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="366,-24 312,-24 312,-0 366,-0 366,-24"/>
<text text-anchor="middle" x="339" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="481.5,-24 384.5,-24 384.5,-0 481.5,-0 481.5,-24"/>
<text text-anchor="middle" x="433" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a submodule to the (sub)module which it is
    descended from. Dashed arrows point from a module or program unit to 
    modules which it uses.
    </p>
    </div></div></div></div>
      </li>
      
      </ul>
    </div>
    


    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-istep%7E2"></span>integer</td>
  <td></td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>istep</strong></td><td></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
	<h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
	<div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~state_init~~CallsGraph Pages: 1 -->
<svg id="procstate_initCallsGraph" width="322pt" height="2254pt"
 viewBox="0.00 0.00 322.00 2254.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_init~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 2250)">
<title>proc~~state_init~~CallsGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-2250 318,-2250 318,4 -4,4"/>
<!-- proc~state_init -->
<g id="proc~~state_init~~CallsGraph_node1" class="node"><title>proc~state_init</title>
<polygon fill="none" stroke="black" points="55,-1137 0,-1137 0,-1113 55,-1113 55,-1137"/>
<text text-anchor="middle" x="27.5" y="-1122.6" font-family="Helvetica,sans-Serif" font-size="10.50">state_init</text>
</g>
<!-- re_alloc -->
<g id="proc~~state_init~~CallsGraph_node2" class="node"><title>re_alloc</title>
<polygon fill="#777777" stroke="#777777" points="181,-2246 127,-2246 127,-2222 181,-2222 181,-2246"/>
<text text-anchor="middle" x="154" y="-2231.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">re_alloc</text>
</g>
<!-- proc~state_init&#45;&gt;re_alloc -->
<g id="proc~~state_init~~CallsGraph_edge1" class="edge"><title>proc~state_init&#45;&gt;re_alloc</title>
<path fill="none" stroke="#000000" d="M28.3872,-1137.21C27.4397,-1250.94 22.4419,-2122.97 91,-2213 97.2997,-2221.27 107.017,-2226.32 116.903,-2229.38"/>
<polygon fill="#000000" stroke="#000000" points="116.176,-2232.8 126.726,-2231.83 117.871,-2226.01 116.176,-2232.8"/>
</g>
<!-- crtsparsity_sc -->
<g id="proc~~state_init~~CallsGraph_node3" class="node"><title>crtsparsity_sc</title>
<polygon fill="#777777" stroke="#777777" points="193,-2204 115,-2204 115,-2180 193,-2180 193,-2204"/>
<text text-anchor="middle" x="154" y="-2189.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">crtsparsity_sc</text>
</g>
<!-- proc~state_init&#45;&gt;crtsparsity_sc -->
<g id="proc~~state_init~~CallsGraph_edge2" class="edge"><title>proc~state_init&#45;&gt;crtsparsity_sc</title>
<path fill="none" stroke="#000000" d="M28.4177,-1137.08C27.7661,-1247.83 25.0491,-2084.6 91,-2171 94.7547,-2175.92 99.7173,-2179.7 105.204,-2182.59"/>
<polygon fill="#000000" stroke="#000000" points="104.24,-2185.99 114.812,-2186.69 106.984,-2179.55 104.24,-2185.99"/>
</g>
<!-- overlap -->
<g id="proc~~state_init~~CallsGraph_node4" class="node"><title>overlap</title>
<polygon fill="#777777" stroke="#777777" points="181,-2162 127,-2162 127,-2138 181,-2138 181,-2162"/>
<text text-anchor="middle" x="154" y="-2147.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">overlap</text>
</g>
<!-- proc~state_init&#45;&gt;overlap -->
<g id="proc~~state_init~~CallsGraph_edge4" class="edge"><title>proc~state_init&#45;&gt;overlap</title>
<path fill="none" stroke="#000000" d="M28.4491,-1137.27C28.1009,-1246.27 27.7171,-2046.3 91,-2129 97.3195,-2137.26 107.042,-2142.3 116.928,-2145.36"/>
<polygon fill="#000000" stroke="#000000" points="116.198,-2148.78 126.748,-2147.81 117.894,-2141.99 116.198,-2148.78"/>
</g>
<!-- setup_dm_netcdf_file -->
<g id="proc~~state_init~~CallsGraph_node5" class="node"><title>setup_dm_netcdf_file</title>
<polygon fill="#777777" stroke="#777777" points="211.5,-2120 96.5,-2120 96.5,-2096 211.5,-2096 211.5,-2120"/>
<text text-anchor="middle" x="154" y="-2105.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_dm_netcdf_file</text>
</g>
<!-- proc~state_init&#45;&gt;setup_dm_netcdf_file -->
<g id="proc~~state_init~~CallsGraph_edge5" class="edge"><title>proc~state_init&#45;&gt;setup_dm_netcdf_file</title>
<path fill="none" stroke="#000000" d="M28.4844,-1137.09C28.4506,-1242.81 30.3104,-2007.92 91,-2087 91.5903,-2087.77 92.21,-2088.51 92.8567,-2089.22"/>
<polygon fill="#000000" stroke="#000000" points="90.8102,-2092.08 100.695,-2095.89 95.3461,-2086.75 90.8102,-2092.08"/>
</g>
<!-- nsc -->
<g id="proc~~state_init~~CallsGraph_node6" class="node"><title>nsc</title>
<polygon fill="#777777" stroke="#777777" points="181,-2078 127,-2078 127,-2054 181,-2054 181,-2078"/>
<text text-anchor="middle" x="154" y="-2063.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nsc</text>
</g>
<!-- proc~state_init&#45;&gt;nsc -->
<g id="proc~~state_init~~CallsGraph_edge3" class="edge"><title>proc~state_init&#45;&gt;nsc</title>
<path fill="none" stroke="#000000" d="M28.5227,-1137.21C28.8181,-1240.75 32.9591,-1969.6 91,-2045 97.3428,-2053.24 107.072,-2058.27 116.957,-2061.34"/>
<polygon fill="#000000" stroke="#000000" points="116.223,-2064.76 126.773,-2063.79 117.921,-2057.97 116.223,-2064.76"/>
</g>
<!-- init_val -->
<g id="proc~~state_init~~CallsGraph_node7" class="node"><title>init_val</title>
<polygon fill="#777777" stroke="#777777" points="181,-2036 127,-2036 127,-2012 181,-2012 181,-2036"/>
<text text-anchor="middle" x="154" y="-2021.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">init_val</text>
</g>
<!-- proc~state_init&#45;&gt;init_val -->
<g id="proc~~state_init~~CallsGraph_edge6" class="edge"><title>proc~state_init&#45;&gt;init_val</title>
<path fill="none" stroke="#000000" d="M28.5651,-1137.29C29.2043,-1238.4 35.5968,-1931.26 91,-2003 97.3561,-2011.23 107.089,-2016.26 116.973,-2019.32"/>
<polygon fill="#000000" stroke="#000000" points="116.237,-2022.75 126.788,-2021.78 117.937,-2015.96 116.237,-2022.75"/>
</g>
<!-- write_debug -->
<g id="proc~~state_init~~CallsGraph_node8" class="node"><title>write_debug</title>
<polygon fill="#777777" stroke="#777777" points="189.5,-1994 118.5,-1994 118.5,-1970 189.5,-1970 189.5,-1994"/>
<text text-anchor="middle" x="154" y="-1979.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_debug</text>
</g>
<!-- proc~state_init&#45;&gt;write_debug -->
<g id="proc~~state_init~~CallsGraph_edge7" class="edge"><title>proc~state_init&#45;&gt;write_debug</title>
<path fill="none" stroke="#000000" d="M28.6087,-1137.01C29.5908,-1234.37 38.1676,-1892.84 91,-1961 95.5953,-1966.93 101.942,-1971.2 108.832,-1974.26"/>
<polygon fill="#000000" stroke="#000000" points="107.856,-1977.63 118.45,-1977.75 110.241,-1971.05 107.856,-1977.63"/>
</g>
<!-- sp_to_spglobal -->
<g id="proc~~state_init~~CallsGraph_node9" class="node"><title>sp_to_spglobal</title>
<polygon fill="#777777" stroke="#777777" points="196.5,-1952 111.5,-1952 111.5,-1928 196.5,-1928 196.5,-1952"/>
<text text-anchor="middle" x="154" y="-1937.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sp_to_spglobal</text>
</g>
<!-- proc~state_init&#45;&gt;sp_to_spglobal -->
<g id="proc~~state_init~~CallsGraph_edge8" class="edge"><title>proc~state_init&#45;&gt;sp_to_spglobal</title>
<path fill="none" stroke="#000000" d="M28.6629,-1137.3C30.0318,-1232.84 40.8388,-1854.55 91,-1919 94.0669,-1922.94 97.9075,-1926.15 102.166,-1928.76"/>
<polygon fill="#000000" stroke="#000000" points="100.864,-1932.02 111.379,-1933.31 103.967,-1925.74 100.864,-1932.02"/>
</g>
<!-- get_chess_parameter -->
<g id="proc~~state_init~~CallsGraph_node10" class="node"><title>get_chess_parameter</title>
<polygon fill="#777777" stroke="#777777" points="212.5,-1910 95.5,-1910 95.5,-1886 212.5,-1886 212.5,-1910"/>
<text text-anchor="middle" x="154" y="-1895.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">get_chess_parameter</text>
</g>
<!-- proc~state_init&#45;&gt;get_chess_parameter -->
<g id="proc~~state_init~~CallsGraph_edge9" class="edge"><title>proc~state_init&#45;&gt;get_chess_parameter</title>
<path fill="none" stroke="#000000" d="M28.7186,-1137.23C30.473,-1229.64 43.443,-1816.17 91,-1877 91.5972,-1877.76 92.2234,-1878.5 92.8761,-1879.21"/>
<polygon fill="#000000" stroke="#000000" points="90.8562,-1882.08 100.763,-1885.84 95.3608,-1876.73 90.8562,-1882.08"/>
</g>
<!-- bye -->
<g id="proc~~state_init~~CallsGraph_node11" class="node"><title>bye</title>
<polygon fill="#777777" stroke="#777777" points="181,-1868 127,-1868 127,-1844 181,-1844 181,-1868"/>
<text text-anchor="middle" x="154" y="-1853.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">bye</text>
</g>
<!-- proc~state_init&#45;&gt;bye -->
<g id="proc~~state_init~~CallsGraph_edge10" class="edge"><title>proc~state_init&#45;&gt;bye</title>
<path fill="none" stroke="#000000" d="M28.7791,-1137.11C30.9321,-1226.16 46.0359,-1777.78 91,-1835 97.4248,-1843.18 107.177,-1848.19 117.058,-1851.26"/>
<polygon fill="#000000" stroke="#000000" points="116.312,-1854.68 126.863,-1853.72 118.018,-1847.89 116.312,-1854.68"/>
</g>
<!-- newsparsity -->
<g id="proc~~state_init~~CallsGraph_node12" class="node"><title>newsparsity</title>
<polygon fill="#777777" stroke="#777777" points="188.5,-1826 119.5,-1826 119.5,-1802 188.5,-1802 188.5,-1826"/>
<text text-anchor="middle" x="154" y="-1811.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newsparsity</text>
</g>
<!-- proc~state_init&#45;&gt;newsparsity -->
<g id="proc~~state_init~~CallsGraph_edge11" class="edge"><title>proc~state_init&#45;&gt;newsparsity</title>
<path fill="none" stroke="#000000" d="M28.8526,-1137.21C31.4458,-1223.49 48.6623,-1739.42 91,-1793 95.7473,-1799.01 102.29,-1803.31 109.355,-1806.38"/>
<polygon fill="#000000" stroke="#000000" points="108.597,-1809.83 119.192,-1809.86 110.932,-1803.23 108.597,-1809.83"/>
</g>
<!-- newddata2d -->
<g id="proc~~state_init~~CallsGraph_node13" class="node"><title>newddata2d</title>
<polygon fill="#777777" stroke="#777777" points="189.5,-1784 118.5,-1784 118.5,-1760 189.5,-1760 189.5,-1784"/>
<text text-anchor="middle" x="154" y="-1769.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newddata2d</text>
</g>
<!-- proc~state_init&#45;&gt;newddata2d -->
<g id="proc~~state_init~~CallsGraph_edge12" class="edge"><title>proc~state_init&#45;&gt;newddata2d</title>
<path fill="none" stroke="#000000" d="M28.934,-1137.23C31.9863,-1220.4 51.2719,-1701.05 91,-1751 95.6201,-1756.81 101.918,-1761.02 108.738,-1764.07"/>
<polygon fill="#000000" stroke="#000000" points="107.657,-1767.4 118.251,-1767.56 110.064,-1760.83 107.657,-1767.4"/>
</g>
<!-- isc_off -->
<g id="proc~~state_init~~CallsGraph_node14" class="node"><title>isc_off</title>
<polygon fill="#777777" stroke="#777777" points="181,-1742 127,-1742 127,-1718 181,-1718 181,-1742"/>
<text text-anchor="middle" x="154" y="-1727.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">isc_off</text>
</g>
<!-- proc~state_init&#45;&gt;isc_off -->
<g id="proc~~state_init~~CallsGraph_edge13" class="edge"><title>proc~state_init&#45;&gt;isc_off</title>
<path fill="none" stroke="#000000" d="M29.0236,-1137.17C32.5531,-1216.89 53.8642,-1662.64 91,-1709 97.5014,-1717.12 107.276,-1722.11 117.153,-1725.18"/>
<polygon fill="#000000" stroke="#000000" points="116.395,-1728.6 126.947,-1727.66 118.108,-1721.81 116.395,-1728.6"/>
</g>
<!-- proc~mixers_history_init -->
<g id="proc~~state_init~~CallsGraph_node15" class="node"><title>proc~mixers_history_init</title>
<g id="a_proc~~state_init~~CallsGraph_node15"><a xlink:href=".././proc/mixers_history_init.html" xlink:title="mixers_history_init">
<polygon fill="#d9534f" stroke="#d9534f" points="204.5,-1700 103.5,-1700 103.5,-1676 204.5,-1676 204.5,-1700"/>
<text text-anchor="middle" x="154" y="-1685.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mixers_history_init</text>
</a>
</g>
</g>
<!-- proc~state_init&#45;&gt;proc~mixers_history_init -->
<g id="proc~~state_init~~CallsGraph_edge51" class="edge"><title>proc~state_init&#45;&gt;proc~mixers_history_init</title>
<path fill="none" stroke="#000000" d="M28.2048,-1137.06C26.6833,-1209.07 22.2501,-1581.9 91,-1667 92.1538,-1668.43 93.4089,-1669.76 94.748,-1671"/>
<polygon fill="#000000" stroke="#000000" points="93.0709,-1674.11 103.214,-1677.17 97.194,-1668.45 93.0709,-1674.11"/>
</g>
<!-- iotdxv -->
<g id="proc~~state_init~~CallsGraph_node16" class="node"><title>iotdxv</title>
<polygon fill="#777777" stroke="#777777" points="181,-1658 127,-1658 127,-1634 181,-1634 181,-1658"/>
<text text-anchor="middle" x="154" y="-1643.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">iotdxv</text>
</g>
<!-- proc~state_init&#45;&gt;iotdxv -->
<g id="proc~~state_init~~CallsGraph_edge14" class="edge"><title>proc~state_init&#45;&gt;iotdxv</title>
<path fill="none" stroke="#000000" d="M28.3352,-1137.01C27.6333,-1205.57 27.4068,-1547.05 91,-1625 97.5193,-1632.99 107.208,-1637.96 116.999,-1641.04"/>
<polygon fill="#000000" stroke="#000000" points="116.155,-1644.43 126.711,-1643.53 117.896,-1637.65 116.155,-1644.43"/>
</g>
<!-- listhptr -->
<g id="proc~~state_init~~CallsGraph_node17" class="node"><title>listhptr</title>
<polygon fill="#777777" stroke="#777777" points="181,-1616 127,-1616 127,-1592 181,-1592 181,-1616"/>
<text text-anchor="middle" x="154" y="-1601.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">listhptr</text>
</g>
<!-- proc~state_init&#45;&gt;listhptr -->
<g id="proc~~state_init~~CallsGraph_edge15" class="edge"><title>proc~state_init&#45;&gt;listhptr</title>
<path fill="none" stroke="#000000" d="M28.4885,-1137.27C28.669,-1202.92 32.6437,-1512.28 91,-1583 97.5642,-1590.95 107.266,-1595.91 117.055,-1598.99"/>
<polygon fill="#000000" stroke="#000000" points="116.205,-1602.38 126.761,-1601.49 117.95,-1595.61 116.205,-1602.38"/>
</g>
<!-- sporb_to_spatom -->
<g id="proc~~state_init~~CallsGraph_node18" class="node"><title>sporb_to_spatom</title>
<polygon fill="#777777" stroke="#777777" points="202,-1574 106,-1574 106,-1550 202,-1550 202,-1574"/>
<text text-anchor="middle" x="154" y="-1559.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sporb_to_spatom</text>
</g>
<!-- proc~state_init&#45;&gt;sporb_to_spatom -->
<g id="proc~~state_init~~CallsGraph_edge16" class="edge"><title>proc~state_init&#45;&gt;sporb_to_spatom</title>
<path fill="none" stroke="#000000" d="M28.6767,-1137.36C29.8074,-1199.51 37.8108,-1477.42 91,-1541 92.7547,-1543.1 94.7273,-1544.99 96.8613,-1546.69"/>
<polygon fill="#000000" stroke="#000000" points="95.4575,-1549.94 105.773,-1552.36 99.2155,-1544.04 95.4575,-1549.94"/>
</g>
<!-- nscold -->
<g id="proc~~state_init~~CallsGraph_node19" class="node"><title>nscold</title>
<polygon fill="#777777" stroke="#777777" points="181,-1532 127,-1532 127,-1508 181,-1508 181,-1532"/>
<text text-anchor="middle" x="154" y="-1517.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nscold</text>
</g>
<!-- proc~state_init&#45;&gt;nscold -->
<g id="proc~~state_init~~CallsGraph_edge17" class="edge"><title>proc~state_init&#45;&gt;nscold</title>
<path fill="none" stroke="#000000" d="M28.9021,-1137.25C31.0455,-1195.34 42.9058,-1442.46 91,-1499 97.6826,-1506.86 107.419,-1511.78 117.203,-1514.87"/>
<polygon fill="#000000" stroke="#000000" points="116.335,-1518.26 126.893,-1517.38 118.091,-1511.48 116.335,-1518.26"/>
</g>
<!-- siesta_write_positions -->
<g id="proc~~state_init~~CallsGraph_node20" class="node"><title>siesta_write_positions</title>
<polygon fill="#777777" stroke="#777777" points="212.5,-1490 95.5,-1490 95.5,-1466 212.5,-1466 212.5,-1490"/>
<text text-anchor="middle" x="154" y="-1475.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_write_positions</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_write_positions -->
<g id="proc~~state_init~~CallsGraph_edge18" class="edge"><title>proc~state_init&#45;&gt;siesta_write_positions</title>
<path fill="none" stroke="#000000" d="M29.1881,-1137.3C32.4494,-1191.38 48.0218,-1407.52 91,-1457 91.8593,-1457.99 92.767,-1458.93 93.717,-1459.83"/>
<polygon fill="#000000" stroke="#000000" points="91.6393,-1462.65 101.727,-1465.89 95.8612,-1457.06 91.6393,-1462.65"/>
</g>
<!-- setup_ts_kpoint_grid -->
<g id="proc~~state_init~~CallsGraph_node21" class="node"><title>setup_ts_kpoint_grid</title>
<polygon fill="#777777" stroke="#777777" points="210,-1448 98,-1448 98,-1424 210,-1424 210,-1448"/>
<text text-anchor="middle" x="154" y="-1433.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_ts_kpoint_grid</text>
</g>
<!-- proc~state_init&#45;&gt;setup_ts_kpoint_grid -->
<g id="proc~~state_init~~CallsGraph_edge19" class="edge"><title>proc~state_init&#45;&gt;setup_ts_kpoint_grid</title>
<path fill="none" stroke="#000000" d="M29.5309,-1137.06C33.9783,-1186.42 53.0366,-1372.43 91,-1415 91.8935,-1416 92.8365,-1416.96 93.8226,-1417.86"/>
<polygon fill="#000000" stroke="#000000" points="91.992,-1420.86 102.119,-1423.98 96.1448,-1415.23 91.992,-1420.86"/>
</g>
<!-- madelung -->
<g id="proc~~state_init~~CallsGraph_node22" class="node"><title>madelung</title>
<polygon fill="#777777" stroke="#777777" points="184,-1406 124,-1406 124,-1382 184,-1382 184,-1406"/>
<text text-anchor="middle" x="154" y="-1391.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">madelung</text>
</g>
<!-- proc~state_init&#45;&gt;madelung -->
<g id="proc~~state_init~~CallsGraph_edge20" class="edge"><title>proc~state_init&#45;&gt;madelung</title>
<path fill="none" stroke="#000000" d="M30.0121,-1137.11C35.8287,-1181.89 58.0929,-1337.36 91,-1373 97.1615,-1379.67 105.519,-1384.23 114.1,-1387.33"/>
<polygon fill="#000000" stroke="#000000" points="113.194,-1390.72 123.779,-1390.26 115.221,-1384.02 113.194,-1390.72"/>
</g>
<!-- fname_tshs -->
<g id="proc~~state_init~~CallsGraph_node23" class="node"><title>fname_tshs</title>
<polygon fill="#777777" stroke="#777777" points="188,-1364 120,-1364 120,-1340 188,-1340 188,-1364"/>
<text text-anchor="middle" x="154" y="-1349.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">fname_tshs</text>
</g>
<!-- proc~state_init&#45;&gt;fname_tshs -->
<g id="proc~~state_init~~CallsGraph_edge22" class="edge"><title>proc~state_init&#45;&gt;fname_tshs</title>
<path fill="none" stroke="#000000" d="M28.8525,-1137.12C30.4823,-1171.27 39.636,-1269.47 91,-1326 96.3536,-1331.89 103.255,-1336.49 110.5,-1340.06"/>
<polygon fill="#000000" stroke="#000000" points="109.202,-1343.32 119.77,-1344.07 111.976,-1336.89 109.202,-1343.32"/>
</g>
<!-- delete -->
<g id="proc~~state_init~~CallsGraph_node24" class="node"><title>delete</title>
<polygon fill="#777777" stroke="#777777" points="310.5,-1491 256.5,-1491 256.5,-1467 310.5,-1467 310.5,-1491"/>
<text text-anchor="middle" x="283.5" y="-1476.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">delete</text>
</g>
<!-- proc~state_init&#45;&gt;delete -->
<g id="proc~~state_init~~CallsGraph_edge23" class="edge"><title>proc~state_init&#45;&gt;delete</title>
<path fill="none" stroke="#000000" d="M29.4151,-1137.15C32.389,-1167.87 44.4862,-1249.34 91,-1293 133.647,-1333.03 173.162,-1292.28 217,-1331 255.03,-1364.59 271.999,-1424.44 278.697,-1456.78"/>
<polygon fill="#000000" stroke="#000000" points="275.264,-1457.46 280.59,-1466.62 282.137,-1456.14 275.264,-1457.46"/>
</g>
<!-- ts_sparse_init -->
<g id="proc~~state_init~~CallsGraph_node25" class="node"><title>ts_sparse_init</title>
<polygon fill="#777777" stroke="#777777" points="193.5,-1284 114.5,-1284 114.5,-1260 193.5,-1260 193.5,-1284"/>
<text text-anchor="middle" x="154" y="-1269.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ts_sparse_init</text>
</g>
<!-- proc~state_init&#45;&gt;ts_sparse_init -->
<g id="proc~~state_init~~CallsGraph_edge24" class="edge"><title>proc~state_init&#45;&gt;ts_sparse_init</title>
<path fill="none" stroke="#000000" d="M31.2528,-1137.33C37.4746,-1162.37 54.97,-1219.5 91,-1251 95.1708,-1254.65 100.001,-1257.67 105.089,-1260.16"/>
<polygon fill="#000000" stroke="#000000" points="103.865,-1263.45 114.439,-1264.12 106.595,-1257 103.865,-1263.45"/>
</g>
<!-- numh -->
<g id="proc~~state_init~~CallsGraph_node26" class="node"><title>numh</title>
<polygon fill="#777777" stroke="#777777" points="181,-1242 127,-1242 127,-1218 181,-1218 181,-1242"/>
<text text-anchor="middle" x="154" y="-1227.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">numh</text>
</g>
<!-- proc~state_init&#45;&gt;numh -->
<g id="proc~~state_init~~CallsGraph_edge25" class="edge"><title>proc~state_init&#45;&gt;numh</title>
<path fill="none" stroke="#000000" d="M34.4413,-1137.12C43.9433,-1155.29 64.246,-1189.54 91,-1209 98.7617,-1214.65 108.15,-1218.85 117.247,-1221.95"/>
<polygon fill="#000000" stroke="#000000" points="116.326,-1225.33 126.912,-1224.9 118.369,-1218.64 116.326,-1225.33"/>
</g>
<!-- domaindecom -->
<g id="proc~~state_init~~CallsGraph_node27" class="node"><title>domaindecom</title>
<polygon fill="#777777" stroke="#777777" points="194,-1200 114,-1200 114,-1176 194,-1176 194,-1200"/>
<text text-anchor="middle" x="154" y="-1185.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">domaindecom</text>
</g>
<!-- proc~state_init&#45;&gt;domaindecom -->
<g id="proc~~state_init~~CallsGraph_edge26" class="edge"><title>proc~state_init&#45;&gt;domaindecom</title>
<path fill="none" stroke="#000000" d="M44.2308,-1137.29C56.4584,-1146.41 74.1243,-1158.66 91,-1167 95.2947,-1169.12 99.8563,-1171.12 104.48,-1172.97"/>
<polygon fill="#000000" stroke="#000000" points="103.402,-1176.3 113.994,-1176.55 105.872,-1169.75 103.402,-1176.3"/>
</g>
<!-- setup_ordern_indexes -->
<g id="proc~~state_init~~CallsGraph_node28" class="node"><title>setup_ordern_indexes</title>
<polygon fill="#777777" stroke="#777777" points="213.5,-1158 94.5,-1158 94.5,-1134 213.5,-1134 213.5,-1158"/>
<text text-anchor="middle" x="154" y="-1143.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_ordern_indexes</text>
</g>
<!-- proc~state_init&#45;&gt;setup_ordern_indexes -->
<g id="proc~~state_init~~CallsGraph_edge27" class="edge"><title>proc~state_init&#45;&gt;setup_ordern_indexes</title>
<path fill="none" stroke="#000000" d="M55.2084,-1129.51C63.9258,-1130.98 74.0417,-1132.68 84.3945,-1134.43"/>
<polygon fill="#000000" stroke="#000000" points="83.9122,-1137.9 94.3551,-1136.11 85.0765,-1130.99 83.9122,-1137.9"/>
</g>
<!-- chess_init -->
<g id="proc~~state_init~~CallsGraph_node29" class="node"><title>chess_init</title>
<polygon fill="#777777" stroke="#777777" points="184,-1116 124,-1116 124,-1092 184,-1092 184,-1116"/>
<text text-anchor="middle" x="154" y="-1101.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">chess_init</text>
</g>
<!-- proc~state_init&#45;&gt;chess_init -->
<g id="proc~~state_init~~CallsGraph_edge28" class="edge"><title>proc~state_init&#45;&gt;chess_init</title>
<path fill="none" stroke="#000000" d="M55.2084,-1120.49C72.2876,-1117.61 94.7349,-1113.83 113.815,-1110.61"/>
<polygon fill="#000000" stroke="#000000" points="114.447,-1114.05 123.725,-1108.94 113.283,-1107.15 114.447,-1114.05"/>
</g>
<!-- xij_offset -->
<g id="proc~~state_init~~CallsGraph_node30" class="node"><title>xij_offset</title>
<polygon fill="#777777" stroke="#777777" points="181.5,-1074 126.5,-1074 126.5,-1050 181.5,-1050 181.5,-1074"/>
<text text-anchor="middle" x="154" y="-1059.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">xij_offset</text>
</g>
<!-- proc~state_init&#45;&gt;xij_offset -->
<g id="proc~~state_init~~CallsGraph_edge29" class="edge"><title>proc~state_init&#45;&gt;xij_offset</title>
<path fill="none" stroke="#000000" d="M44.2308,-1112.71C56.4584,-1103.59 74.1243,-1091.34 91,-1083 99.1421,-1078.97 108.243,-1075.42 116.911,-1072.42"/>
<polygon fill="#000000" stroke="#000000" points="118.031,-1075.74 126.439,-1069.29 115.846,-1069.09 118.031,-1075.74"/>
</g>
<!-- attach -->
<g id="proc~~state_init~~CallsGraph_node31" class="node"><title>attach</title>
<polygon fill="#777777" stroke="#777777" points="181,-1032 127,-1032 127,-1008 181,-1008 181,-1032"/>
<text text-anchor="middle" x="154" y="-1017.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">attach</text>
</g>
<!-- proc~state_init&#45;&gt;attach -->
<g id="proc~~state_init~~CallsGraph_edge30" class="edge"><title>proc~state_init&#45;&gt;attach</title>
<path fill="none" stroke="#000000" d="M34.4413,-1112.88C43.9433,-1094.71 64.246,-1060.46 91,-1041 98.7617,-1035.35 108.15,-1031.15 117.247,-1028.05"/>
<polygon fill="#000000" stroke="#000000" points="118.369,-1031.36 126.912,-1025.1 116.326,-1024.67 118.369,-1031.36"/>
</g>
<!-- val -->
<g id="proc~~state_init~~CallsGraph_node32" class="node"><title>val</title>
<polygon fill="#777777" stroke="#777777" points="181,-990 127,-990 127,-966 181,-966 181,-990"/>
<text text-anchor="middle" x="154" y="-975.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">val</text>
</g>
<!-- proc~state_init&#45;&gt;val -->
<g id="proc~~state_init~~CallsGraph_edge31" class="edge"><title>proc~state_init&#45;&gt;val</title>
<path fill="none" stroke="#000000" d="M31.2528,-1112.67C37.4746,-1087.63 54.97,-1030.5 91,-999 98.3511,-992.573 107.752,-988.094 116.998,-984.98"/>
<polygon fill="#000000" stroke="#000000" points="118.243,-988.264 126.867,-982.109 116.287,-981.542 118.243,-988.264"/>
</g>
<!-- dict_repopulate_md -->
<g id="proc~~state_init~~CallsGraph_node33" class="node"><title>dict_repopulate_md</title>
<polygon fill="#777777" stroke="#777777" points="207.5,-948 100.5,-948 100.5,-924 207.5,-924 207.5,-948"/>
<text text-anchor="middle" x="154" y="-933.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dict_repopulate_md</text>
</g>
<!-- proc~state_init&#45;&gt;dict_repopulate_md -->
<g id="proc~~state_init~~CallsGraph_edge32" class="edge"><title>proc~state_init&#45;&gt;dict_repopulate_md</title>
<path fill="none" stroke="#000000" d="M29.5034,-1112.94C32.6845,-1082.44 45.2278,-1001.44 91,-957 92.2613,-955.775 93.5966,-954.622 94.9922,-953.536"/>
<polygon fill="#000000" stroke="#000000" points="97.041,-956.38 103.552,-948.021 93.2497,-950.495 97.041,-956.38"/>
</g>
<!-- timer -->
<g id="proc~~state_init~~CallsGraph_node34" class="node"><title>timer</title>
<polygon fill="#777777" stroke="#777777" points="181,-906 127,-906 127,-882 181,-882 181,-906"/>
<text text-anchor="middle" x="154" y="-891.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">timer</text>
</g>
<!-- proc~state_init&#45;&gt;timer -->
<g id="proc~~state_init~~CallsGraph_edge33" class="edge"><title>proc~state_init&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M28.4565,-1112.92C28.995,-1077.48 35.4469,-972.666 91,-915 97.9638,-907.771 107.502,-903.031 117.01,-899.922"/>
<polygon fill="#000000" stroke="#000000" points="118.079,-903.258 126.797,-897.238 116.228,-896.508 118.079,-903.258"/>
</g>
<!-- new_dm -->
<g id="proc~~state_init~~CallsGraph_node35" class="node"><title>new_dm</title>
<polygon fill="#777777" stroke="#777777" points="181,-864 127,-864 127,-840 181,-840 181,-864"/>
<text text-anchor="middle" x="154" y="-849.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">new_dm</text>
</g>
<!-- proc~state_init&#45;&gt;new_dm -->
<g id="proc~~state_init~~CallsGraph_edge34" class="edge"><title>proc~state_init&#45;&gt;new_dm</title>
<path fill="none" stroke="#000000" d="M29.9843,-1112.7C35.7024,-1067.2 57.6617,-909.244 91,-873 97.8522,-865.551 107.441,-860.743 117.032,-857.64"/>
<polygon fill="#000000" stroke="#000000" points="118.165,-860.96 126.914,-854.985 116.349,-854.2 118.165,-860.96"/>
</g>
<!-- escf -->
<g id="proc~~state_init~~CallsGraph_node36" class="node"><title>escf</title>
<polygon fill="#777777" stroke="#777777" points="181,-822 127,-822 127,-798 181,-798 181,-822"/>
<text text-anchor="middle" x="154" y="-807.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">escf</text>
</g>
<!-- proc~state_init&#45;&gt;escf -->
<g id="proc~~state_init~~CallsGraph_edge35" class="edge"><title>proc~state_init&#45;&gt;escf</title>
<path fill="none" stroke="#000000" d="M29.507,-1112.77C33.8597,-1062.74 52.5966,-874.187 91,-831 97.7259,-823.436 107.276,-818.594 116.871,-815.494"/>
<polygon fill="#000000" stroke="#000000" points="118.01,-818.813 126.77,-812.855 116.206,-812.05 118.01,-818.813"/>
</g>
<!-- ts_write_tshs -->
<g id="proc~~state_init~~CallsGraph_node37" class="node"><title>ts_write_tshs</title>
<polygon fill="#777777" stroke="#777777" points="191.5,-780 116.5,-780 116.5,-756 191.5,-756 191.5,-780"/>
<text text-anchor="middle" x="154" y="-765.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ts_write_tshs</text>
</g>
<!-- proc~state_init&#45;&gt;ts_write_tshs -->
<g id="proc~~state_init~~CallsGraph_edge36" class="edge"><title>proc~state_init&#45;&gt;ts_write_tshs</title>
<path fill="none" stroke="#000000" d="M29.1455,-1112.92C32.2681,-1058.8 47.4787,-839.22 91,-789 95.2982,-784.04 100.812,-780.25 106.775,-777.353"/>
<polygon fill="#000000" stroke="#000000" points="108.422,-780.464 116.404,-773.497 105.819,-773.965 108.422,-780.464"/>
</g>
<!-- outcoor -->
<g id="proc~~state_init~~CallsGraph_node38" class="node"><title>outcoor</title>
<polygon fill="#777777" stroke="#777777" points="181,-738 127,-738 127,-714 181,-714 181,-738"/>
<text text-anchor="middle" x="154" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">outcoor</text>
</g>
<!-- proc~state_init&#45;&gt;outcoor -->
<g id="proc~~state_init~~CallsGraph_edge37" class="edge"><title>proc~state_init&#45;&gt;outcoor</title>
<path fill="none" stroke="#000000" d="M28.8828,-1112.62C30.9379,-1053.92 42.4545,-804.165 91,-747 97.6758,-739.139 107.41,-734.212 117.195,-731.127"/>
<polygon fill="#000000" stroke="#000000" points="118.083,-734.513 126.886,-728.616 116.327,-727.737 118.083,-734.513"/>
</g>
<!-- volcel -->
<g id="proc~~state_init~~CallsGraph_node39" class="node"><title>volcel</title>
<polygon fill="#777777" stroke="#777777" points="181,-696 127,-696 127,-672 181,-672 181,-696"/>
<text text-anchor="middle" x="154" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">volcel</text>
</g>
<!-- proc~state_init&#45;&gt;volcel -->
<g id="proc~~state_init~~CallsGraph_edge38" class="edge"><title>proc~state_init&#45;&gt;volcel</title>
<path fill="none" stroke="#000000" d="M28.6524,-1112.94C29.6708,-1051.02 37.2374,-769.354 91,-705 97.6122,-697.085 107.328,-692.143 117.115,-689.06"/>
<polygon fill="#000000" stroke="#000000" points="118.007,-692.445 126.815,-686.556 116.257,-685.667 118.007,-692.445"/>
</g>
<!-- ioxv -->
<g id="proc~~state_init~~CallsGraph_node40" class="node"><title>ioxv</title>
<polygon fill="#777777" stroke="#777777" points="181,-654 127,-654 127,-630 181,-630 181,-654"/>
<text text-anchor="middle" x="154" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ioxv</text>
</g>
<!-- proc~state_init&#45;&gt;ioxv -->
<g id="proc~~state_init~~CallsGraph_edge39" class="edge"><title>proc~state_init&#45;&gt;ioxv</title>
<path fill="none" stroke="#000000" d="M28.4726,-1112.62C28.5704,-1046.4 32.1847,-734.358 91,-663 97.5596,-655.042 107.26,-650.087 117.05,-647.006"/>
<polygon fill="#000000" stroke="#000000" points="117.944,-650.39 126.756,-644.508 116.199,-643.61 117.944,-650.39"/>
</g>
<!-- file_exist -->
<g id="proc~~state_init~~CallsGraph_node41" class="node"><title>file_exist</title>
<polygon fill="#777777" stroke="#777777" points="181,-612 127,-612 127,-588 181,-588 181,-612"/>
<text text-anchor="middle" x="154" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">file_exist</text>
</g>
<!-- proc~state_init&#45;&gt;file_exist -->
<g id="proc~~state_init~~CallsGraph_edge40" class="edge"><title>proc~state_init&#45;&gt;file_exist</title>
<path fill="none" stroke="#000000" d="M28.3209,-1112.89C27.5393,-1043.79 26.9442,-699.6 91,-621 97.5154,-613.005 107.203,-608.04 116.994,-604.96"/>
<polygon fill="#000000" stroke="#000000" points="117.891,-608.344 126.707,-602.467 116.151,-601.564 117.891,-608.344"/>
</g>
<!-- proximity_check -->
<g id="proc~~state_init~~CallsGraph_node42" class="node"><title>proximity_check</title>
<polygon fill="#777777" stroke="#777777" points="198.5,-570 109.5,-570 109.5,-546 198.5,-546 198.5,-570"/>
<text text-anchor="middle" x="154" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">proximity_check</text>
</g>
<!-- proc~state_init&#45;&gt;proximity_check -->
<g id="proc~~state_init~~CallsGraph_edge41" class="edge"><title>proc~state_init&#45;&gt;proximity_check</title>
<path fill="none" stroke="#000000" d="M29.1285,-1112.64C33.1524,-1035.5 56.2427,-622.061 91,-579 93.6901,-575.667 96.9319,-572.861 100.505,-570.497"/>
<polygon fill="#000000" stroke="#000000" points="102.187,-573.567 109.338,-565.749 98.8723,-567.401 102.187,-573.567"/>
</g>
<!-- hsparse -->
<g id="proc~~state_init~~CallsGraph_node43" class="node"><title>hsparse</title>
<polygon fill="#777777" stroke="#777777" points="181,-528 127,-528 127,-504 181,-504 181,-528"/>
<text text-anchor="middle" x="154" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">hsparse</text>
</g>
<!-- proc~state_init&#45;&gt;hsparse -->
<g id="proc~~state_init~~CallsGraph_edge42" class="edge"><title>proc~state_init&#45;&gt;hsparse</title>
<path fill="none" stroke="#000000" d="M29.0179,-1112.74C32.511,-1032.48 53.6295,-583.683 91,-537 97.4985,-528.882 107.272,-523.884 117.149,-520.814"/>
<polygon fill="#000000" stroke="#000000" points="118.105,-524.182 126.944,-518.341 116.391,-517.395 118.105,-524.182"/>
</g>
<!-- newdspdata1d -->
<g id="proc~~state_init~~CallsGraph_node44" class="node"><title>newdspdata1d</title>
<polygon fill="#777777" stroke="#777777" points="195,-486 113,-486 113,-462 195,-462 195,-486"/>
<text text-anchor="middle" x="154" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newdspdata1d</text>
</g>
<!-- proc~state_init&#45;&gt;newdspdata1d -->
<g id="proc~~state_init~~CallsGraph_edge43" class="edge"><title>proc~state_init&#45;&gt;newdspdata1d</title>
<path fill="none" stroke="#000000" d="M28.919,-1112.96C31.9045,-1030.02 50.9935,-545.337 91,-495 94.4471,-490.663 98.8297,-487.216 103.666,-484.478"/>
<polygon fill="#000000" stroke="#000000" points="105.151,-487.647 112.759,-480.274 102.213,-481.293 105.151,-487.647"/>
</g>
<!-- write_zmatrix -->
<g id="proc~~state_init~~CallsGraph_node45" class="node"><title>write_zmatrix</title>
<polygon fill="#777777" stroke="#777777" points="192,-444 116,-444 116,-420 192,-420 192,-444"/>
<text text-anchor="middle" x="154" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_zmatrix</text>
</g>
<!-- proc~state_init&#45;&gt;write_zmatrix -->
<g id="proc~~state_init~~CallsGraph_edge44" class="edge"><title>proc~state_init&#45;&gt;write_zmatrix</title>
<path fill="none" stroke="#000000" d="M28.8395,-1112.99C31.3698,-1027.03 48.3805,-506.964 91,-453 95.0677,-447.85 100.455,-443.954 106.36,-441.01"/>
<polygon fill="#000000" stroke="#000000" points="107.998,-444.123 115.95,-437.122 105.368,-437.635 107.998,-444.123"/>
</g>
<!-- superc -->
<g id="proc~~state_init~~CallsGraph_node46" class="node"><title>superc</title>
<polygon fill="#777777" stroke="#777777" points="181,-402 127,-402 127,-378 181,-378 181,-402"/>
<text text-anchor="middle" x="154" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">superc</text>
</g>
<!-- proc~state_init&#45;&gt;superc -->
<g id="proc~~state_init~~CallsGraph_edge45" class="edge"><title>proc~state_init&#45;&gt;superc</title>
<path fill="none" stroke="#000000" d="M28.7744,-1112.82C30.8936,-1023.27 45.7986,-468.553 91,-411 97.4228,-402.822 107.175,-397.807 117.056,-394.739"/>
<polygon fill="#000000" stroke="#000000" points="118.016,-398.107 126.861,-392.275 116.309,-391.318 118.016,-398.107"/>
</g>
<!-- globalize_or -->
<g id="proc~~state_init~~CallsGraph_node47" class="node"><title>globalize_or</title>
<polygon fill="#777777" stroke="#777777" points="189,-360 119,-360 119,-336 189,-336 189,-360"/>
<text text-anchor="middle" x="154" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">globalize_or</text>
</g>
<!-- proc~state_init&#45;&gt;globalize_or -->
<g id="proc~~state_init~~CallsGraph_edge46" class="edge"><title>proc~state_init&#45;&gt;globalize_or</title>
<path fill="none" stroke="#000000" d="M28.7087,-1113C30.4083,-1021.06 43.1544,-430.224 91,-369 95.6667,-363.028 102.109,-358.743 109.086,-355.67"/>
<polygon fill="#000000" stroke="#000000" points="110.579,-358.854 118.814,-352.188 108.219,-352.263 110.579,-358.854"/>
</g>
<!-- setup_dmhs_netcdf_file -->
<g id="proc~~state_init~~CallsGraph_node48" class="node"><title>setup_dmhs_netcdf_file</title>
<polygon fill="#777777" stroke="#777777" points="217,-318 91,-318 91,-294 217,-294 217,-318"/>
<text text-anchor="middle" x="154" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_dmhs_netcdf_file</text>
</g>
<!-- proc~state_init&#45;&gt;setup_dmhs_netcdf_file -->
<g id="proc~~state_init~~CallsGraph_edge47" class="edge"><title>proc~state_init&#45;&gt;setup_dmhs_netcdf_file</title>
<path fill="none" stroke="#000000" d="M28.6545,-1112.94C29.9727,-1017.94 40.547,-391.849 91,-327 91.5954,-326.235 92.2199,-325.497 92.871,-324.786"/>
<polygon fill="#000000" stroke="#000000" points="95.357,-327.268 100.745,-318.146 90.8441,-321.917 95.357,-327.268"/>
</g>
<!-- ts_tri_analyze -->
<g id="proc~~state_init~~CallsGraph_node49" class="node"><title>ts_tri_analyze</title>
<polygon fill="#777777" stroke="#777777" points="193.5,-276 114.5,-276 114.5,-252 193.5,-252 193.5,-276"/>
<text text-anchor="middle" x="154" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ts_tri_analyze</text>
</g>
<!-- proc~state_init&#45;&gt;ts_tri_analyze -->
<g id="proc~~state_init~~CallsGraph_edge48" class="edge"><title>proc~state_init&#45;&gt;ts_tri_analyze</title>
<path fill="none" stroke="#000000" d="M28.6047,-1112.94C29.5552,-1015.11 37.9284,-353.489 91,-285 94.7013,-280.223 99.5398,-276.525 104.883,-273.663"/>
<polygon fill="#000000" stroke="#000000" points="106.467,-276.791 114.241,-269.594 103.675,-270.372 106.467,-276.791"/>
</g>
<!-- normalize_dm -->
<g id="proc~~state_init~~CallsGraph_node50" class="node"><title>normalize_dm</title>
<polygon fill="#777777" stroke="#777777" points="194,-234 114,-234 114,-210 194,-210 194,-234"/>
<text text-anchor="middle" x="154" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">normalize_dm</text>
</g>
<!-- proc~state_init&#45;&gt;normalize_dm -->
<g id="proc~~state_init~~CallsGraph_edge49" class="edge"><title>proc~state_init&#45;&gt;normalize_dm</title>
<path fill="none" stroke="#000000" d="M28.5593,-1112.98C29.1562,-1012.56 35.2986,-315.145 91,-243 94.6484,-238.275 99.4101,-234.604 104.675,-231.755"/>
<polygon fill="#000000" stroke="#000000" points="106.159,-234.926 113.901,-227.694 103.339,-228.519 106.159,-234.926"/>
</g>
<!-- ucell -->
<g id="proc~~state_init~~CallsGraph_node51" class="node"><title>ucell</title>
<polygon fill="#777777" stroke="#777777" points="181,-192 127,-192 127,-168 181,-168 181,-192"/>
<text text-anchor="middle" x="154" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ucell</text>
</g>
<!-- proc~state_init&#45;&gt;ucell -->
<g id="proc~~state_init~~CallsGraph_edge50" class="edge"><title>proc~state_init&#45;&gt;ucell</title>
<path fill="none" stroke="#000000" d="M28.519,-1112.74C28.7839,-1008.75 32.719,-276.737 91,-201 97.3416,-192.759 107.07,-187.726 116.955,-184.661"/>
<polygon fill="#000000" stroke="#000000" points="117.92,-188.028 126.772,-182.206 116.222,-181.237 117.92,-188.028"/>
</g>
<!-- setup_kpoint_grid -->
<g id="proc~~state_init~~CallsGraph_node52" class="node"><title>setup_kpoint_grid</title>
<polygon fill="#777777" stroke="#777777" points="202.5,-150 105.5,-150 105.5,-126 202.5,-126 202.5,-150"/>
<text text-anchor="middle" x="154" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_kpoint_grid</text>
</g>
<!-- proc~state_init&#45;&gt;setup_kpoint_grid -->
<g id="proc~~state_init~~CallsGraph_edge21" class="edge"><title>proc~state_init&#45;&gt;setup_kpoint_grid</title>
<path fill="none" stroke="#000000" d="M28.481,-1112.86C28.4172,-1006.7 30.0697,-238.42 91,-159 92.6645,-156.83 94.5639,-154.883 96.6393,-153.135"/>
<polygon fill="#000000" stroke="#000000" points="98.9884,-155.778 105.392,-147.337 95.1224,-149.942 98.9884,-155.778"/>
</g>
<!-- newdspdata2d -->
<g id="proc~~state_init~~CallsGraph_node53" class="node"><title>newdspdata2d</title>
<polygon fill="#777777" stroke="#777777" points="195,-108 113,-108 113,-84 195,-84 195,-108"/>
<text text-anchor="middle" x="154" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newdspdata2d</text>
</g>
<!-- proc~state_init&#45;&gt;newdspdata2d -->
<g id="proc~~state_init~~CallsGraph_edge52" class="edge"><title>proc~state_init&#45;&gt;newdspdata2d</title>
<path fill="none" stroke="#000000" d="M28.4457,-1112.68C28.068,-1003.25 27.4761,-200.031 91,-117 94.4096,-112.543 98.8103,-109.025 103.693,-106.248"/>
<polygon fill="#000000" stroke="#000000" points="105.275,-109.373 112.892,-102.009 102.345,-103.015 105.275,-109.373"/>
</g>
<!-- mscell -->
<g id="proc~~state_init~~CallsGraph_node54" class="node"><title>mscell</title>
<polygon fill="#777777" stroke="#777777" points="181,-66 127,-66 127,-42 181,-42 181,-66"/>
<text text-anchor="middle" x="154" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mscell</text>
</g>
<!-- proc~state_init&#45;&gt;mscell -->
<g id="proc~~state_init~~CallsGraph_edge53" class="edge"><title>proc~state_init&#45;&gt;mscell</title>
<path fill="none" stroke="#000000" d="M28.4145,-1112.87C27.734,-1001.7 24.8076,-161.741 91,-75 97.3083,-66.7334 107.028,-61.6934 116.914,-58.6295"/>
<polygon fill="#000000" stroke="#000000" points="117.881,-61.9956 126.735,-56.178 116.185,-55.204 117.881,-61.9956"/>
</g>
<!-- time_io -->
<g id="proc~~state_init~~CallsGraph_node55" class="node"><title>time_io</title>
<polygon fill="#777777" stroke="#777777" points="181,-24 127,-24 127,-0 181,-0 181,-24"/>
<text text-anchor="middle" x="154" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">time_io</text>
</g>
<!-- proc~state_init&#45;&gt;time_io -->
<g id="proc~~state_init~~CallsGraph_edge54" class="edge"><title>proc~state_init&#45;&gt;time_io</title>
<path fill="none" stroke="#000000" d="M28.3841,-1112.75C27.408,-998.602 22.2002,-123.372 91,-33 97.2988,-24.7262 107.015,-19.6841 116.902,-16.6206"/>
<polygon fill="#000000" stroke="#000000" points="117.87,-19.9866 126.725,-14.1701 116.175,-13.1947 117.87,-19.9866"/>
</g>
<!-- proc~mixers_history_init&#45;&gt;delete -->
<g id="proc~~state_init~~CallsGraph_edge56" class="edge"><title>proc~mixers_history_init&#45;&gt;delete</title>
<path fill="none" stroke="#000000" d="M204.525,-1676.06C209.097,-1673.58 213.368,-1670.6 217,-1667 263.468,-1620.93 277.029,-1540.19 280.941,-1501.25"/>
<polygon fill="#000000" stroke="#000000" points="284.452,-1501.28 281.84,-1491.01 277.479,-1500.67 284.452,-1501.28"/>
</g>
<!-- proc~current_itt -->
<g id="proc~~state_init~~CallsGraph_node56" class="node"><title>proc~current_itt</title>
<g id="a_proc~~state_init~~CallsGraph_node56"><a xlink:href=".././proc/current_itt.html" xlink:title="current_itt">
<polygon fill="#d94e8f" stroke="#d94e8f" points="314,-1721 253,-1721 253,-1697 314,-1697 314,-1721"/>
<text text-anchor="middle" x="283.5" y="-1706.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">current_itt</text>
</a>
</g>
</g>
<!-- proc~mixers_history_init&#45;&gt;proc~current_itt -->
<g id="proc~~state_init~~CallsGraph_edge55" class="edge"><title>proc~mixers_history_init&#45;&gt;proc~current_itt</title>
<path fill="none" stroke="#000000" d="M204.66,-1696.18C217.206,-1698.25 230.52,-1700.44 242.521,-1702.42"/>
<polygon fill="#000000" stroke="#000000" points="242.241,-1705.92 252.677,-1704.09 243.379,-1699.01 242.241,-1705.92"/>
</g>
<!-- new -->
<g id="proc~~state_init~~CallsGraph_node57" class="node"><title>new</title>
<polygon fill="#777777" stroke="#777777" points="310.5,-1679 256.5,-1679 256.5,-1655 310.5,-1655 310.5,-1679"/>
<text text-anchor="middle" x="283.5" y="-1664.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">new</text>
</g>
<!-- proc~mixers_history_init&#45;&gt;new -->
<g id="proc~~state_init~~CallsGraph_edge57" class="edge"><title>proc~mixers_history_init&#45;&gt;new</title>
<path fill="none" stroke="#000000" d="M204.66,-1679.82C218.563,-1677.53 233.408,-1675.09 246.366,-1672.95"/>
<polygon fill="#000000" stroke="#000000" points="247.001,-1676.39 256.299,-1671.32 245.863,-1669.49 247.001,-1676.39"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,-0 64,-0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,-0 136,-0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node"><title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,-0 209.5,-0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node"><title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,-0 364,-0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,-0 436,-0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="551.5,-24 454.5,-24 454.5,-0 551.5,-0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <div class="panel panel-default">
      <div class="panel-heading">
	<h3 class="panel-title">Called by</h3>
      </div>
      <div class="panel-body">
	<div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~state_init~~CalledByGraph Pages: 1 -->
<svg id="procstate_initCalledByGraph" width="175pt" height="32pt"
 viewBox="0.00 0.00 175.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_init~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>proc~~state_init~~CalledByGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 171,-28 171,4 -4,4"/>
<!-- proc~state_init -->
<g id="proc~~state_init~~CalledByGraph_node1" class="node"><title>proc~state_init</title>
<polygon fill="none" stroke="black" points="167,-24 112,-24 112,-0 167,-0 167,-24"/>
<text text-anchor="middle" x="139.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">state_init</text>
</g>
<!-- proc~siesta_forces -->
<g id="proc~~state_init~~CalledByGraph_node2" class="node"><title>proc~siesta_forces</title>
<g id="a_proc~~state_init~~CalledByGraph_node2"><a xlink:href=".././proc/siesta_forces.html" xlink:title="siesta_forces">
<polygon fill="#d9534f" stroke="#d9534f" points="76,-24 0,-24 0,-0 76,-0 76,-24"/>
<text text-anchor="middle" x="38" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_forces</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~state_init -->
<g id="proc~~state_init~~CalledByGraph_edge1" class="edge"><title>proc~siesta_forces&#45;&gt;proc~state_init</title>
<path fill="none" stroke="#000000" d="M76.0501,-12C84.4416,-12 93.3497,-12 101.73,-12"/>
<polygon fill="#000000" stroke="#000000" points="101.983,-15.5001 111.983,-12 101.983,-8.5001 101.983,-15.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,-0 64,-0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,-0 136,-0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node"><title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,-0 209.5,-0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node"><title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,-0 364,-0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,-0 436,-0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="551.5,-24 454.5,-24 454.5,-0 551.5,-0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      




















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/state_init.html#src">state_init</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>      <span class="k">subroutine </span><span class="n">state_init</span><span class="p">(</span> <span class="n">istep</span> <span class="p">)</span>
      <span class="k">use </span><span class="n">Kpoint_grid</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">setup_Kpoint_grid</span><span class="p">,</span> <span class="n">nkpnt</span>
      <span class="k">use </span><span class="n">m_os</span><span class="p">,</span>              <span class="n">only</span><span class="p">:</span> <span class="n">file_exist</span>
      <span class="k">use </span><span class="n">m_new_dm</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">new_dm</span>
      <span class="k">use </span><span class="n">m_proximity_check</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">proximity_check</span>
      <span class="k">use </span><span class="n">siesta_options</span>
      <span class="k">use </span><span class="n">units</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Ang</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">listhptr</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Dold</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">DM_2D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Eold</span><span class="p">,</span> <span class="n">Escf</span><span class="p">,</span> <span class="n">EDM_2D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Hold</span><span class="p">,</span> <span class="n">H</span>   <span class="p">,</span> <span class="n">H_2D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">xijo</span><span class="p">,</span> <span class="n">xij_2D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">S</span>   <span class="p">,</span> <span class="n">S_1D</span>

      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">H_kin_1D</span><span class="p">,</span> <span class="n">H_vkb_1D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">H_ldau_2D</span><span class="p">,</span> <span class="n">H_so_2D</span>

      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">sparse_pattern</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">block_dist</span><span class="p">,</span> <span class="n">single_dist</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">DM_history</span>


      <span class="k">use </span><span class="n">create_Sparsity_SC</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">crtSparsity_SC</span>
      <span class="k">use </span><span class="n">m_sparsity_handling</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">SpOrb_to_SpAtom</span>
      <span class="k">use </span><span class="n">m_sparsity_handling</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Sp_to_Spglobal</span>
      <span class="k">use </span><span class="n">m_pivot_methods</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">sp2graphviz</span>

      <span class="k">use </span><span class="n">siesta_geom</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">iphkb</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span>
     <span class="p">&amp;</span>                             <span class="n">rmaxo</span><span class="p">,</span> <span class="n">rmaxkb</span><span class="p">,</span> <span class="n">rmaxv</span><span class="p">,</span> <span class="n">rmaxldau</span><span class="p">,</span>
     <span class="p">&amp;</span>                             <span class="n">lastkb</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">superc</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>                             <span class="n">no_u</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">iza</span><span class="p">,</span> <span class="n">qtots</span>
      <span class="k">use </span><span class="n">alloc</span><span class="p">,</span>             <span class="n">only</span><span class="p">:</span> <span class="n">re_alloc</span><span class="p">,</span> <span class="n">de_alloc</span><span class="p">,</span> <span class="n">alloc_report</span>
      <span class="k">use </span><span class="n">m_hsparse</span><span class="p">,</span>         <span class="n">only</span><span class="p">:</span> <span class="n">hsparse</span>
      <span class="k">use </span><span class="n">m_overlap</span><span class="p">,</span>         <span class="n">only</span><span class="p">:</span> <span class="n">overlap</span>
      <span class="k">use </span><span class="n">m_supercell</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">exact_sc_ag</span>
      <span class="k">use </span><span class="n">siesta_cml</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">cml_p</span><span class="p">,</span> <span class="n">cmlStartStep</span><span class="p">,</span> <span class="n">mainXML</span>
      <span class="k">use </span><span class="n">zmatrix</span><span class="p">,</span>           <span class="n">only</span><span class="p">:</span> <span class="n">lUseZmatrix</span><span class="p">,</span> <span class="n">write_zmatrix</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">Emad</span>
      <span class="k">use </span><span class="n">write_subs</span>
      <span class="k">use </span><span class="n">m_ioxv</span><span class="p">,</span>            <span class="n">only</span><span class="p">:</span> <span class="n">ioxv</span>
      <span class="k">use </span><span class="n">m_iotdxv</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">iotdxv</span>
      <span class="k">use </span><span class="n">m_steps</span>
      <span class="k">use </span><span class="n">parallel</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">IOnode</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">BlockSize</span>
      <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>            <span class="n">only</span><span class="p">:</span> <span class="n">spin</span>
      <span class="k">use </span><span class="n">m_rmaxh</span>
      <span class="k">use </span><span class="n">m_mixing</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">mixers_history_init</span>
      <span class="k">use </span><span class="n">m_mixing_scf</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">scf_mixs</span><span class="p">,</span> <span class="n">scf_mix</span>

      <span class="k">use </span><span class="n">m_normalize_dm</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">normalize_dm</span>

      <span class="k">use </span><span class="n">m_eo</span>
      <span class="k">use </span><span class="n">m_gamma</span>
      <span class="k">use </span><span class="n">files</span><span class="p">,</span>             <span class="n">only</span><span class="p">:</span> <span class="n">slabel</span>
      <span class="k">use </span><span class="n">m_mpi_utils</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">globalize_or</span>
      <span class="k">use </span><span class="n">m_mpi_utils</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">globalize_max</span>
      <span class="k">use </span><span class="n">domain_decom</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">domainDecom</span><span class="p">,</span> <span class="n">use_dd</span><span class="p">,</span> <span class="n">use_dd_perm</span>
      <span class="k">use </span><span class="n">ldau_specs</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">switch_ldau</span><span class="p">,</span> <span class="n">ldau_init</span>

      <span class="k">use </span><span class="n">m_sparse</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">xij_offset</span>

      <span class="k">use </span><span class="n">m_ts_kpoints</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">setup_ts_kpoint_grid</span>
      <span class="k">use </span><span class="n">m_ts_charge</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">TS_RHOCORR_METHOD</span><span class="p">,</span> <span class="n">TS_RHOCORR_FERMI</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">BTD_method</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">TS_Analyze</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">N_Elec</span><span class="p">,</span> <span class="n">Elecs</span><span class="p">,</span> <span class="n">IsVolt</span>
      <span class="k">use </span><span class="n">m_ts_electype</span>
      <span class="k">use </span><span class="n">m_ts_global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">TSrun</span><span class="p">,</span> <span class="n">TSmode</span><span class="p">,</span> <span class="n">onlyS</span>
      <span class="k">use </span><span class="n">sys</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">bye</span>
      <span class="k">use </span><span class="n">m_ts_io</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">fname_TSHS</span><span class="p">,</span> <span class="n">ts_write_tshs</span>
      <span class="k">use </span><span class="n">m_ts_sparse</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ts_sparse_init</span>
      <span class="k">use </span><span class="n">m_ts_tri_init</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ts_tri_init</span><span class="p">,</span> <span class="n">ts_tri_analyze</span>
      <span class="k">use </span><span class="n">files</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">slabel</span><span class="p">,</span> <span class="n">label_length</span>
<span class="cp">#ifdef SIESTA__CHESS</span>
      <span class="k">use </span><span class="n">m_chess</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">CheSS_init</span><span class="p">,</span> <span class="n">get_CheSS_parameter</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CDF</span>
      <span class="k">use </span><span class="n">iodm_netcdf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">setup_dm_netcdf_file</span>
      <span class="k">use </span><span class="n">iodmhs_netcdf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">setup_dmhs_netcdf_file</span>
<span class="cp">#endif</span>
      <span class="k">use </span><span class="n">class_Sparsity</span>
      <span class="k">use </span><span class="n">class_dSpData1D</span>
      <span class="k">use </span><span class="n">class_dSpData2D</span>
      <span class="k">use </span><span class="n">class_dData2D</span>
<span class="cp">#ifdef TEST_IO</span>
      <span class="k">use </span><span class="n">m_test_io</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="k">use </span><span class="n">siesta_dicts</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">dict_repopulate_MD</span>
<span class="cp">#endif</span>

      <span class="k">implicit none</span>

<span class="k">      </span><span class="kt">integer</span>            <span class="kd">::</span> <span class="n">istep</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">veclen</span>      <span class="c">! Length of a unit-cell vector</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">rmax</span>
      <span class="kt">logical</span>            <span class="kd">::</span> <span class="n">cell_can_change</span>
      <span class="kt">integer</span>            <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">iadispl</span><span class="p">,</span> <span class="n">ixdispl</span>
      <span class="kt">logical</span>            <span class="kd">::</span> <span class="n">auxchanged</span>   <span class="c">! Auxiliary supercell changed?</span>
      <span class="kt">logical</span>            <span class="kd">::</span> <span class="n">folding</span><span class="p">,</span> <span class="n">folding1</span>
      <span class="kt">logical</span>            <span class="kd">::</span> <span class="n">foundxv</span>  <span class="c">! dummy for call to ioxv</span>
      <span class="k">external</span>           <span class="kd">::</span>  <span class="n">madelung</span><span class="p">,</span> <span class="n">timer</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">external</span> <span class="kd">::</span> <span class="n">volcel</span>

      <span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">ts_kscell_file</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">ts_kdispl_file</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
      <span class="kt">logical</span>                       <span class="kd">::</span> <span class="n">ts_Gamma_file</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">label_length</span><span class="o">+</span><span class="mi">6</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">dummyef</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dummyqtot</span><span class="o">=</span><span class="mf">0.0</span>
<span class="cp">#ifdef SIESTA__CHESS</span>
      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">maxnh_kernel</span><span class="p">,</span> <span class="n">maxnh_mult</span><span class="p">,</span> <span class="n">no_l_kernel</span><span class="p">,</span> <span class="n">no_l_mult</span>
      <span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">listh_kernel</span><span class="p">,</span> <span class="n">listh_mult</span>
      <span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">numh_kernel</span><span class="p">,</span> <span class="n">numh_mult</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">chess_value</span>
<span class="cp">#endif</span>
      <span class="k">type</span><span class="p">(</span><span class="n">Sparsity</span><span class="p">)</span> <span class="kd">::</span> <span class="n">g_Sp</span>
      
      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">oname</span>

      <span class="k">type</span><span class="p">(</span><span class="n">dData2D</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tmp_2D</span>


<span class="c">!------------------------------------------------------------------- BEGIN</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;IterGeom&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="cp">#ifdef DEBUG</span>
      <span class="k">call </span><span class="n">write_debug</span><span class="p">(</span> <span class="s1">&#39;  PRE state_init&#39;</span> <span class="p">)</span>
<span class="cp">#endif</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;state_init&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>

      <span class="n">istp</span> <span class="o">=</span> <span class="n">istp</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">      write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(/,t22,a)&#39;</span><span class="p">)</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span>
      <span class="k">select case</span> <span class="p">(</span><span class="n">idyn</span><span class="p">)</span>
      <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">nmove</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a)&#39;</span><span class="p">)</span> <span class="s1">&#39;Single-point calculation&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;Single-Point&#39;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="nb">index</span><span class="o">=</span><span class="n">istp</span><span class="p">)</span>
         <span class="k">else</span>
<span class="k">            if</span> <span class="p">(</span><span class="n">broyden_optim</span><span class="p">)</span> <span class="k">then</span>
<span class="k">               write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin Broyden opt. move = &#39;</span><span class="p">,</span>
     <span class="err">$</span>              <span class="n">istep</span>
            <span class="k">else if</span> <span class="p">(</span><span class="n">fire_optim</span><span class="p">)</span> <span class="k">then</span>
<span class="k">               write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin FIRE opt. move = &#39;</span><span class="p">,</span>
     <span class="err">$</span>              <span class="n">istep</span>
            <span class="k">else</span>
<span class="k">               write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin CG opt. move = &#39;</span><span class="p">,</span>
     <span class="err">$</span>              <span class="n">istep</span>
            <span class="k">end if</span>
<span class="k">            if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;Geom. Optim&#39;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="nb">index</span><span class="o">=</span><span class="n">istp</span><span class="p">)</span>
         <span class="n">endif</span>
         
<span class="c">!        Print Z-matrix coordinates</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">lUseZmatrix</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            call </span><span class="n">write_Zmatrix</span><span class="p">()</span>
         <span class="n">endif</span>
      <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">iquench</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin MD quenched step = &#39;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="n">istep</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;MD-quenched&#39;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
         <span class="k">else</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin MD step = &#39;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="n">istep</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;MD&#39;</span><span class="p">,</span>
     <span class="err">$</span>             <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
         <span class="n">endif</span>
      <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
         <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin MD step = &#39;</span><span class="p">,</span> <span class="n">istep</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;MD&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
      <span class="k">case</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
          <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin FC step = &#39;</span><span class="p">,</span><span class="n">istep</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;FC&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
          
          <span class="k">if</span> <span class="p">(</span><span class="n">istep</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a)&#39;</span><span class="p">)</span> <span class="s1">&#39;Undisplaced coordinates&#39;</span>
         <span class="k">else</span>
<span class="k">            </span><span class="n">iadispl</span> <span class="o">=</span> <span class="p">(</span><span class="n">istep</span><span class="o">-</span><span class="nb">mod</span><span class="p">(</span><span class="n">istep</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span><span class="o">/</span><span class="mi">6</span><span class="o">+</span><span class="n">ia1</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">istep</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">ixdispl</span> <span class="o">=</span> <span class="p">(</span><span class="n">ix</span> <span class="o">-</span> <span class="nb">mod</span><span class="p">(</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t26,a,i0,/,t26,a,i1,a,f10.6,a)&#39;</span><span class="p">)</span> <span class="s1">&#39;displace atom &#39;</span><span class="p">,</span>
     <span class="p">&amp;</span>           <span class="n">iadispl</span><span class="p">,</span><span class="s1">&#39;in direction &#39;</span><span class="p">,</span><span class="n">ixdispl</span><span class="p">,</span><span class="s1">&#39; by&#39;</span><span class="p">,</span> <span class="n">dx</span><span class="o">/</span><span class="n">Ang</span><span class="p">,</span><span class="s1">&#39; Ang&#39;</span>
         <span class="n">endif</span>
         
      <span class="k">case</span> <span class="p">(</span><span class="mi">8</span><span class="p">)</span>
         <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin Server step = &#39;</span><span class="p">,</span><span class="n">istep</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;FS&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
         
      <span class="k">case</span> <span class="p">(</span><span class="mi">9</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">(</span> <span class="n">istep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i7)&#39;</span><span class="p">)</span><span class="s1">&#39;Explicit coord. initialization&#39;</span>
         <span class="k">else</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i7)&#39;</span><span class="p">)</span><span class="s1">&#39;Explicit coord. step =&#39;</span><span class="p">,</span><span class="n">istep</span>
         <span class="k">end if</span>
<span class="k">         if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;ECS&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
         
      <span class="k">case</span> <span class="p">(</span><span class="mi">10</span><span class="p">)</span>
         <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i7)&#39;</span><span class="p">)</span><span class="s1">&#39;LUA coord. step =&#39;</span><span class="p">,</span><span class="n">istep</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;LUA&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
         
      <span class="k">end select</span>
<span class="k">      </span>
<span class="k">      write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t22,a)&#39;</span><span class="p">)</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span>
      
<span class="c">!     Print atomic coordinates</span>
      <span class="k">call </span><span class="n">outcoor</span><span class="p">(</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">writec</span> <span class="p">)</span>

<span class="c">!     Save structural information in crystallographic format</span>
<span class="c">!     (in file SystemLabel.STRUCT_OUT),</span>
<span class="c">!     canonical Zmatrix (if applicable), and CML record</span>
      
      <span class="k">call </span><span class="n">siesta_write_positions</span><span class="p">(</span><span class="n">moved</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.)</span>
       
      <span class="n">endif</span> <span class="c">! IONode</span>

      <span class="c">! Write the XV file for single-point calculations, so that</span>
      <span class="c">! it is there at the end for those users who rely on it</span>
      <span class="k">call </span><span class="n">ioxv</span><span class="p">(</span> <span class="s1">&#39;write&#39;</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">vcell</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">iza</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> 
     <span class="p">&amp;</span>           <span class="n">foundxv</span><span class="p">)</span>
      <span class="c">! Write TDXV file for TDDFT restart.</span>
      <span class="k">if</span><span class="p">(</span><span class="n">writetdwf</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">td_elec_dyn</span><span class="p">)</span> <span class="k">then</span>
<span class="k">      call </span><span class="n">iotdxv</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">,</span><span class="n">ucell</span><span class="p">,</span><span class="n">vcell</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">isa</span><span class="p">,</span><span class="n">iza</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">va</span><span class="p">,</span><span class="n">foundxv</span><span class="p">)</span>
      <span class="k">end if</span>  

<span class="c">!     Actualize things if variable cell </span>
      <span class="n">auxchanged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
      <span class="n">cell_can_change</span> <span class="o">=</span> <span class="p">(</span> <span class="n">varcel</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span>
     <span class="p">&amp;</span>                    <span class="p">(</span><span class="n">idyn</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">8</span><span class="p">)</span>  <span class="c">! Force/stress evaluation</span>
     <span class="p">&amp;</span>                  <span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">change_kgrid_in_md</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         </span><span class="n">cell_can_change</span> <span class="o">=</span> <span class="n">cell_can_change</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span>
     <span class="p">&amp;</span>                     <span class="p">(</span><span class="n">idyn</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">3</span><span class="p">)</span>   <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="c">! Parrinello-Rahman</span>
     <span class="p">&amp;</span>                     <span class="p">(</span><span class="n">idyn</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">4</span><span class="p">)</span>   <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="c">! Nose-Parrinello-Rahman</span>
     <span class="p">&amp;</span>                     <span class="p">(</span><span class="n">idyn</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">5</span><span class="p">)</span>        <span class="c">! Anneal</span>
      <span class="n">endif</span>

      <span class="k">if</span> <span class="p">(</span> <span class="n">cell_can_change</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span>
     <span class="p">&amp;</span>     <span class="p">(</span><span class="n">istep</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">inicoor</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">gamma</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>

<span class="c">!       Will print k-points also</span>
        <span class="k">call </span><span class="n">setup_Kpoint_grid</span><span class="p">(</span> <span class="n">ucell</span> <span class="p">)</span>

        <span class="k">call </span><span class="n">setup_ts_kpoint_grid</span><span class="p">(</span> <span class="n">ucell</span> <span class="p">)</span>

        <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span> <span class="n">eo</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">spinor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nkpnt</span><span class="p">,</span> <span class="s1">&#39;eo&#39;</span><span class="p">,</span>
     <span class="p">&amp;</span>                 <span class="s1">&#39;state_init&#39;</span><span class="p">)</span>
        <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span> <span class="n">qo</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">spinor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nkpnt</span><span class="p">,</span> <span class="s1">&#39;qo&#39;</span><span class="p">,</span>
     <span class="p">&amp;</span>                 <span class="s1">&#39;state_init&#39;</span> <span class="p">)</span>

<span class="c">!       Find required supercell</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">gamma</span><span class="p">)</span> <span class="k">then</span>
<span class="k">           </span><span class="n">nsc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else if</span> <span class="p">(</span><span class="n">fixauxcell</span><span class="p">)</span> <span class="k">then</span>
<span class="k">           </span><span class="n">nsc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">nscold</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span>
<span class="k">           do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">3</span>
              <span class="n">veclen</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">ucell</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ucell</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ucell</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
              <span class="n">nsc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">ceiling</span><span class="p">(</span> <span class="n">rmaxh</span> <span class="o">/</span> <span class="n">veclen</span> <span class="p">)</span>
           <span class="k">end do</span>
<span class="k">           if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">naiveauxcell</span> <span class="p">)</span>
     <span class="p">&amp;</span>          <span class="k">call </span><span class="n">exact_sc_ag</span><span class="p">(</span><span class="n">negl</span><span class="p">,</span><span class="n">ucell</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">isa</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">nsc</span><span class="p">)</span>
        <span class="n">endif</span>

        <span class="n">mscell</span> <span class="o">=</span> <span class="mf">0.0_dp</span>
        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
           <span class="n">mscell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">nsc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
           <span class="k">if</span> <span class="p">(</span><span class="n">nsc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/=</span> <span class="n">nscold</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="n">auxchanged</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
           <span class="n">nscold</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">nsc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">enddo</span>

<span class="c">!       Madelung correction for charged systems </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">charnet</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mf">0.0_dp</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">madelung</span><span class="p">(</span><span class="n">ucell</span><span class="p">,</span> <span class="nb">shape</span><span class="p">,</span> <span class="n">charnet</span><span class="p">,</span> <span class="n">Emad</span><span class="p">)</span>
        <span class="n">endif</span>

      <span class="n">endif</span>
<span class="c">!     End variable cell actualization</span>

<span class="c">!     Auxiliary supercell</span>
<span class="c">!     Do not move from here, as the coordinates might have changed</span>
<span class="c">!     even if not the unit cell</span>
      <span class="k">call </span><span class="n">superc</span><span class="p">(</span><span class="n">ucell</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">)</span>
<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="k">call </span><span class="n">dict_repopulate_MD</span><span class="p">()</span>
<span class="cp">#endif</span>

<span class="c">!     Print unit cell and compute cell volume</span>
<span class="c">!     Possible BUG: </span>
<span class="c">!     Note that this volume is later used in write_subs and the md output</span>
<span class="c">!     routines, even if the cell later changes.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">call </span><span class="n">outcell</span><span class="p">(</span><span class="n">ucell</span><span class="p">)</span>
      <span class="n">volume_of_some_cell</span> <span class="o">=</span> <span class="n">volcel</span><span class="p">(</span><span class="n">ucell</span><span class="p">)</span>

<span class="c">!     Use largest possible range in program, except hsparse...</span>
<span class="c">!     2 * rmaxv: Vna overlap</span>
<span class="c">!     rmaxo + rmaxkb: Non-local KB action</span>
<span class="c">!     2 * (rmaxo + rmaxldau): Interaction through LDAU projector</span>
<span class="c">!     2.0_dp * (rmaxo+rmaxkb) : Orbital interaction through KB projectors</span>
      <span class="n">rmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="mf">2._dp</span><span class="o">*</span><span class="n">rmaxv</span><span class="p">,</span> <span class="mf">2._dp</span><span class="o">*</span><span class="p">(</span><span class="n">rmaxo</span><span class="o">+</span><span class="n">rmaxldau</span><span class="p">),</span> <span class="n">rmaxo</span><span class="o">+</span><span class="n">rmaxkb</span><span class="p">)</span>

      <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">negl</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">        </span><span class="n">rmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rmax</span><span class="p">,</span> <span class="mf">2.0_dp</span> <span class="o">*</span> <span class="p">(</span><span class="n">rmaxo</span><span class="o">+</span><span class="n">rmaxkb</span><span class="p">)</span> <span class="p">)</span>
      <span class="n">endif</span>

<span class="c">!     Check if any two atoms are unreasonably close</span>
      <span class="k">call </span><span class="n">proximity_check</span><span class="p">(</span><span class="n">rmax</span><span class="p">)</span>

      <span class="c">! Clear history of mixing parameters</span>
      <span class="k">call </span><span class="n">mixers_history_init</span><span class="p">(</span> <span class="n">scf_mixs</span> <span class="p">)</span>
      <span class="n">scf_mix</span> <span class="o">=&gt;</span> <span class="n">scf_mixs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

      <span class="c">! Ensure sparsity pattern is empty</span>
      <span class="k">call </span><span class="n">delete</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">)</span>
      <span class="c">! sadly deleting the sparse pattern does not necessarily</span>
      <span class="c">! mean that the arrays are de-associated.</span>
      <span class="c">! Remember that the reference counter could (in MD)</span>
      <span class="c">! be higher than 1, hence we need to create &quot;fake&quot;</span>
      <span class="c">! containers and let the new&lt;class&gt; delete the old</span>
      <span class="c">! sparsity pattern</span>
      <span class="k">nullify</span><span class="p">(</span><span class="n">numh</span><span class="p">,</span><span class="n">listhptr</span><span class="p">,</span><span class="n">listh</span><span class="p">)</span>
      <span class="k">allocate</span><span class="p">(</span><span class="n">numh</span><span class="p">(</span><span class="n">no_l</span><span class="p">),</span><span class="n">listhptr</span><span class="p">(</span><span class="n">no_l</span><span class="p">))</span>
      <span class="c">! We do not need to allocate listh</span>
      <span class="c">! that will be allocated in hsparse</span>

<span class="cp">#ifdef SIESTA__CHESS</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">isolve</span> <span class="o">==</span> <span class="n">SOLVE_CHESS</span><span class="p">)</span> <span class="k">then</span>
<span class="c">!         Calculate a sparsity pattern with some buffers... Only required</span>
<span class="c">!         for CheSS</span>
          <span class="n">chess_value</span> <span class="o">=</span> <span class="n">get_chess_parameter</span><span class="p">(</span><span class="s1">&#39;chess_buffer_kernel&#39;</span><span class="p">)</span>
          <span class="k">call </span><span class="n">hsparse</span><span class="p">(</span> <span class="n">negl</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">lastkb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">iphKB</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="nb">gamma</span><span class="p">,</span> 
     <span class="p">&amp;</span>              <span class="n">set_xijo</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">folding</span><span class="o">=</span><span class="n">folding1</span><span class="p">,</span>
     <span class="err">$</span>              <span class="n">buffer</span><span class="o">=</span><span class="n">chess_value</span><span class="p">)</span>
          <span class="n">maxnh_kernel</span> <span class="o">=</span> <span class="n">maxnh</span>
          <span class="n">no_l_kernel</span> <span class="o">=</span> <span class="n">no_l</span>
          <span class="k">allocate</span><span class="p">(</span><span class="n">listh_kernel</span><span class="p">(</span><span class="n">maxnh_kernel</span><span class="p">))</span>
          <span class="k">allocate</span><span class="p">(</span><span class="n">numh_kernel</span><span class="p">(</span><span class="n">no_l_kernel</span><span class="p">))</span>
          <span class="n">listh_kernel</span> <span class="o">=</span> <span class="n">listh</span>
          <span class="n">numh_kernel</span> <span class="o">=</span> <span class="n">numh</span>
    
          <span class="n">chess_value</span> <span class="o">=</span> <span class="n">get_chess_parameter</span><span class="p">(</span><span class="s1">&#39;chess_buffer_mult&#39;</span><span class="p">)</span>
          <span class="k">call </span><span class="n">hsparse</span><span class="p">(</span> <span class="n">negl</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span>
     <span class="p">&amp;</span>                  <span class="n">lastkb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">iphKB</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="nb">gamma</span><span class="p">,</span>
     <span class="p">&amp;</span>                  <span class="n">set_xijo</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">folding</span><span class="o">=</span><span class="n">folding1</span><span class="p">,</span>
     <span class="err">$</span>                  <span class="n">buffer</span><span class="o">=</span><span class="n">chess_value</span><span class="p">)</span>
          <span class="n">maxnh_mult</span> <span class="o">=</span> <span class="n">maxnh</span>
          <span class="n">no_l_mult</span> <span class="o">=</span> <span class="n">no_l</span>
          <span class="k">allocate</span><span class="p">(</span><span class="n">listh_mult</span><span class="p">(</span><span class="n">maxnh_mult</span><span class="p">))</span>
          <span class="k">allocate</span><span class="p">(</span><span class="n">numh_mult</span><span class="p">(</span><span class="n">no_l_mult</span><span class="p">))</span>
          <span class="n">listh_mult</span> <span class="o">=</span> <span class="n">listh</span>
          <span class="n">numh_mult</span> <span class="o">=</span> <span class="n">numh</span>
      <span class="k">end if</span>
<span class="cp">#endif /* CHESS */</span>

<span class="c">!     List of nonzero Hamiltonian matrix elements</span>
<span class="c">!     and, if applicable,  vectors between orbital centers</span>

<span class="c">!     Listh and xijo are allocated inside hsparse</span>
<span class="c">!     Note: We always generate xijo now, for COOP and other</span>
<span class="c">!           analyses.</span>
      <span class="k">call </span><span class="n">delete</span><span class="p">(</span><span class="n">xij_2D</span><span class="p">)</span> <span class="c">! as xijo will be reallocated</span>
      <span class="k">nullify</span><span class="p">(</span><span class="n">xijo</span><span class="p">)</span>
      <span class="k">call </span><span class="n">hsparse</span><span class="p">(</span> <span class="n">negl</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">lastkb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">iphKB</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="nb">gamma</span><span class="p">,</span>
     <span class="err">$</span>              <span class="n">set_xijo</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">folding</span><span class="o">=</span><span class="n">folding1</span><span class="p">)</span>
<span class="c">!</span>
<span class="cp">#ifdef SIESTA__CHESS</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">isolve</span> <span class="o">==</span> <span class="n">SOLVE_CHESS</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">CheSS_init</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">maxnh_kernel</span><span class="p">,</span> <span class="n">maxnh_mult</span><span class="p">,</span> 
     <span class="p">&amp;</span>         <span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">no_l_kernel</span><span class="p">,</span> <span class="n">no_l_mult</span><span class="p">,</span> <span class="n">BlockSize</span><span class="p">,</span> 
     <span class="p">&amp;</span>         <span class="n">spin</span><span class="p">%</span><span class="n">spinor</span><span class="p">,</span> <span class="n">qtots</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">listh_kernel</span><span class="p">,</span> <span class="n">listh_mult</span><span class="p">,</span> 
     <span class="p">&amp;</span>         <span class="n">numh</span><span class="p">,</span> <span class="n">numh_kernel</span><span class="p">,</span> <span class="n">numh_mult</span><span class="p">)</span>
          <span class="k">deallocate</span><span class="p">(</span><span class="n">listh_kernel</span><span class="p">)</span>
          <span class="k">deallocate</span><span class="p">(</span><span class="n">numh_kernel</span><span class="p">)</span>
          <span class="k">deallocate</span><span class="p">(</span><span class="n">listh_mult</span><span class="p">)</span>
          <span class="k">deallocate</span><span class="p">(</span><span class="n">numh_mult</span><span class="p">)</span>
      <span class="k">end if</span>
<span class="cp">#endif /* CHESS */</span>
      <span class="k">call </span><span class="n">globalize_or</span><span class="p">(</span><span class="n">folding1</span><span class="p">,</span><span class="n">folding</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">folding</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            print</span> <span class="o">*</span><span class="p">,</span> <span class="s2">&quot;Folding of H and S is implicitly performed&quot;</span>
         <span class="n">endif</span>
      <span class="n">endif</span>
      <span class="c">!</span>
      <span class="c">! If using domain decomposition, redistribute orbitals</span>
      <span class="c">! for this geometry, based on the hsparse info. </span>
      <span class="c">! The first time round, the initial distribution is a</span>
      <span class="c">! simple block one (given by preSetOrbitLimits).</span>
      <span class="c">!</span>
      <span class="c">! Any DM, etc, read from file will be redistributed according</span>
      <span class="c">! to the new pattern. </span>
      <span class="c">! Inherited DMs from a previous geometry cannot be used if the</span>
      <span class="c">! orbital distribution changes. For now, we avoid changing the</span>
      <span class="c">! distribution (the variable use_dd_perm is .true. if domain</span>
      <span class="c">! decomposition is in effect). Names should be changed...</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">use_dd</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">use_dd_perm</span><span class="p">))</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">domainDecom</span><span class="p">(</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">maxnh</span> <span class="p">)</span>  <span class="c">! maxnh intent(in) here</span>
         <span class="n">maxnh</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numh</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">no_l</span><span class="p">))</span>
         <span class="c">! We still need to re-create Julian Gale&#39;s</span>
         <span class="c">! indexing for O(N) in parallel.</span>
         <span class="k">print</span> <span class="s2">&quot;(a5,i3,a20,3i8)&quot;</span><span class="p">,</span>
     <span class="err">$</span>         <span class="s2">&quot;Node: &quot;</span><span class="p">,</span> <span class="n">Node</span><span class="p">,</span> <span class="s2">&quot;no_u, no_l, maxnh: &quot;</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">maxnh</span>
         <span class="k">call </span><span class="n">setup_ordern_indexes</span><span class="p">(</span><span class="n">no_l</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">Nodes</span><span class="p">)</span>
      <span class="n">endif</span>

      <span class="c">! I would like to skip this alloc/move/dealloc/attach</span>
      <span class="c">! by allowing sparsity to have pointer targets.</span>
      <span class="c">! However, this poses a problem with intel compilers,</span>
      <span class="c">! as it apparently errors out when de-allocating a target pointer</span>
      <span class="k">write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;sparsity for geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newSparsity</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">no_l</span><span class="p">,</span><span class="n">no_u</span><span class="p">,</span><span class="n">maxnh</span><span class="p">,</span>
     <span class="p">&amp;</span>     <span class="n">numh</span><span class="p">,</span><span class="n">listhptr</span><span class="p">,</span><span class="n">listh</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">oname</span><span class="p">)</span>
      <span class="k">deallocate</span><span class="p">(</span><span class="n">numh</span><span class="p">,</span><span class="n">listhptr</span><span class="p">,</span><span class="n">listh</span><span class="p">)</span>
      <span class="k">call </span><span class="n">attach</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span> 
     <span class="p">&amp;</span>     <span class="n">n_col</span> <span class="o">=</span> <span class="n">numh</span><span class="p">,</span> <span class="n">list_ptr</span> <span class="o">=</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">list_col</span> <span class="o">=</span> <span class="n">listh</span> <span class="p">)</span>

      <span class="c">! In case the user requests to create the connectivity graph</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">write_GRAPHVIZ</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">then</span>
         <span class="c">! first create the unit-cell sparsity pattern</span>
         <span class="k">call </span><span class="n">crtSparsity_SC</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span> <span class="n">g_Sp</span><span class="p">,</span> <span class="n">UC</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
         <span class="c">! next move to global sparsity pattern</span>
         <span class="k">call </span><span class="n">Sp_to_Spglobal</span><span class="p">(</span><span class="n">block_dist</span><span class="p">,</span> <span class="n">g_Sp</span><span class="p">,</span> <span class="n">g_Sp</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            if</span> <span class="p">(</span> <span class="n">write_GRAPHVIZ</span> <span class="o">/=</span> <span class="mi">2</span> <span class="p">)</span>
     <span class="p">&amp;</span>           <span class="k">call </span><span class="n">sp2graphviz</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.ORB.gv&#39;</span><span class="p">,</span> <span class="n">g_Sp</span><span class="p">)</span>
            <span class="c">! Convert to atomic </span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">write_GRAPHVIZ</span> <span class="o">/=</span> <span class="mi">1</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">               call </span><span class="n">SpOrb_to_SpAtom</span><span class="p">(</span><span class="n">single_dist</span><span class="p">,</span><span class="n">g_Sp</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">lasto</span><span class="p">,</span><span class="n">g_Sp</span><span class="p">)</span>
               <span class="k">call </span><span class="n">sp2graphviz</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.ATOM.gv&#39;</span><span class="p">,</span> <span class="n">g_Sp</span><span class="p">)</span>
            <span class="k">end if</span>
<span class="k">         end if</span>
<span class="k">         call </span><span class="n">delete</span><span class="p">(</span><span class="n">g_Sp</span><span class="p">)</span>
      <span class="k">end if</span>

             
      <span class="c">! Copy over xijo array (we can first do it here... :( )</span>
      <span class="k">call </span><span class="n">newdData2D</span><span class="p">(</span><span class="n">tmp_2D</span><span class="p">,</span><span class="n">xijo</span><span class="p">,</span><span class="s1">&#39;xijo&#39;</span><span class="p">)</span>
      <span class="k">deallocate</span><span class="p">(</span><span class="n">xijo</span><span class="p">)</span>
      <span class="k">write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;xijo at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData2D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">tmp_2D</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">xij_2D</span><span class="p">,</span> 
     <span class="p">&amp;</span>     <span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="k">call </span><span class="n">delete</span><span class="p">(</span><span class="n">tmp_2D</span><span class="p">)</span> <span class="c">! decrement container...</span>
      <span class="n">xijo</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">xij_2D</span><span class="p">)</span>

      <span class="c">! Calculate the super-cell offsets...</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nb">Gamma</span> <span class="p">)</span> <span class="k">then</span>
         <span class="c">! Here we create the super-cell offsets</span>
         <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span><span class="n">isc_off</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
         <span class="n">isc_off</span><span class="p">(:,:)</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">else</span>
<span class="k">         call </span><span class="n">xij_offset</span><span class="p">(</span><span class="n">ucell</span><span class="p">,</span><span class="n">nsc</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">lasto</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="n">xij_2D</span><span class="p">,</span> <span class="n">isc_off</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">Bcast</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
      <span class="k">end if</span>

      
      <span class="c">! When the user requests to only do an analyzation, we can call</span>
      <span class="c">! appropriate routines and quit</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">TS_Analyze</span> <span class="p">)</span> <span class="k">then</span>

         <span class="c">! Force the creation of the full sparsity pattern</span>
         <span class="k">call </span><span class="n">ts_sparse_init</span><span class="p">(</span><span class="n">slabel</span><span class="p">,</span><span class="n">IsVolt</span><span class="p">,</span> <span class="n">N_Elec</span><span class="p">,</span> <span class="n">Elecs</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="n">ucell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">block_dist</span><span class="p">,</span> <span class="n">sparse_pattern</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="nb">Gamma</span><span class="p">,</span> <span class="n">isc_off</span><span class="p">)</span>

         <span class="c">! create the tri-diagonal matrix</span>
         <span class="k">call </span><span class="n">ts_tri_analyze</span><span class="p">(</span> <span class="n">block_dist</span><span class="p">,</span> <span class="n">sparse_pattern</span> <span class="p">,</span> <span class="n">N_Elec</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">Elecs</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">isc_off</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">BTD_method</span> <span class="p">)</span>

         <span class="c">! Print-out timers</span>
         <span class="k">call </span><span class="n">timer</span><span class="p">(</span><span class="s1">&#39;TS-rgn2tri&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

         <span class="c">! Bye also waits for all processors</span>
         <span class="k">call </span><span class="n">bye</span><span class="p">(</span><span class="s1">&#39;transiesta analyzation performed&#39;</span><span class="p">)</span>
         
      <span class="k">end if</span>


<span class="k">      write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;EDM at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData2D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">EDM</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">EDM_2D</span><span class="p">,</span>
     <span class="p">&amp;</span>     <span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="c">!if (ionode) call print_type(EDM_2D)</span>
      <span class="n">Escf</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">EDM_2D</span><span class="p">)</span>

      <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span><span class="n">Dold</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxnh</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">DM</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Dold&#39;</span><span class="p">,</span>
     <span class="p">.</span>     <span class="n">routine</span><span class="o">=</span><span class="s1">&#39;sparseMat&#39;</span><span class="p">,</span><span class="n">copy</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">shrink</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
      <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span><span class="n">Hold</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxnh</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Hold&#39;</span><span class="p">,</span>
     <span class="p">.</span>     <span class="n">routine</span><span class="o">=</span><span class="s1">&#39;sparseMat&#39;</span><span class="p">,</span><span class="n">copy</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">shrink</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">converge_EDM</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">re_alloc</span><span class="p">(</span><span class="n">Eold</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxnh</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">EDM</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Eold&#39;</span><span class="p">,</span>
     <span class="p">.</span>     <span class="n">routine</span><span class="o">=</span><span class="s1">&#39;sparseMat&#39;</span><span class="p">,</span><span class="n">copy</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">shrink</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
      <span class="k">end if</span>

<span class="c">!     Allocate/reallocate storage associated with Hamiltonian/Overlap matrix</span>
      <span class="k">write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;H at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData2D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">H_2D</span><span class="p">,</span>
     <span class="p">&amp;</span>                  <span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="c">!if (ionode) call print_type(H_2D)</span>
      <span class="n">H</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">H_2D</span><span class="p">)</span>

      <span class="k">write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;H_vkb at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData1D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">H_vkb_1D</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="c">!if (ionode) call print_type(H_vkb_1D)</span>

      <span class="k">write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;H_kin at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData1D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">H_kin_1D</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="c">!if (ionode) call print_type(H_kin_1D)</span>

      <span class="k">if</span> <span class="p">(</span> <span class="n">switch_ldau</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;H_ldau at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
         <span class="k">call </span><span class="n">newdSpData2D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">spinor</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">block_dist</span><span class="p">,</span><span class="n">H_ldau_2D</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
         
         <span class="c">! Initialize to 0, LDA+U may re-calculate</span>
         <span class="c">!   this matrix sporadically doing the SCF.</span>
         <span class="c">! Hence initialization MUST be performed upon</span>
         <span class="c">! re-allocation.</span>
         <span class="k">call </span><span class="n">init_val</span><span class="p">(</span><span class="n">H_ldau_2D</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">(</span> <span class="n">inicoor</span> <span class="o">/=</span> <span class="n">istep</span> <span class="p">)</span> <span class="k">then</span>
            <span class="c">! Force initialization of the LDA+U</span>
            <span class="c">! when changing geometry</span>
            <span class="c">! For the first geometry this is controlled</span>
            <span class="c">! by the user via an fdf-key</span>
            <span class="n">ldau_init</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
         <span class="k">end if</span>
<span class="k">      end if</span>
<span class="k">      </span>
<span class="k">      if</span> <span class="p">(</span> <span class="n">spin</span><span class="p">%</span><span class="n">SO</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;H_so at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
         <span class="k">call </span><span class="n">newdSpData2D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">H</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">block_dist</span><span class="p">,</span><span class="n">H_so_2D</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="k">end if</span>

<span class="k">      write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;S at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData1D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">S_1D</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">call </span><span class="n">print_type</span><span class="p">(</span><span class="n">S_1D</span><span class="p">)</span>
      <span class="n">S</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">S_1D</span><span class="p">)</span>

<span class="c">!     Find overlap matrix </span>
      <span class="k">call </span><span class="n">overlap</span><span class="p">(</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span> <span class="n">rmaxo</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">lasto</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">S</span> <span class="p">)</span>


<span class="c">!</span>
<span class="c">!     Here we could also read a Hamiltonian, either to proceed to</span>
<span class="c">!     the analysis section (with nscf=0) or to start a mix-H scf cycle.</span>
<span class="c">!</span>
<span class="c">!     Initialize density matrix</span>
      <span class="c">! The resizing of Dscf is done inside new_dm</span>
      <span class="k">call </span><span class="n">new_DM</span><span class="p">(</span><span class="n">auxchanged</span><span class="p">,</span> <span class="n">DM_history</span><span class="p">,</span> <span class="n">DM_2D</span><span class="p">,</span> <span class="n">EDM_2D</span><span class="p">)</span>
      <span class="n">Dscf</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">DM_2D</span><span class="p">)</span>
      <span class="n">Escf</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">EDM_2D</span><span class="p">)</span>

      <span class="c">! Initialize energy-density matrix to zero for first call to overfsm</span>
      <span class="c">! Only part of Escf is updated in TS, so if it is put as zero here</span>
      <span class="c">! a continuation run gives bad forces.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">TSrun</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">normalize_DM</span><span class="p">(</span> <span class="n">first</span><span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span> <span class="p">)</span>
<span class="c">!$OMP parallel workshare default(shared)</span>
         <span class="n">Escf</span><span class="p">(:,:)</span> <span class="o">=</span> <span class="mf">0.0_dp</span>
<span class="c">!$OMP end parallel workshare</span>
      <span class="k">end if</span>

<span class="cp">#ifdef TEST_IO</span>
      <span class="c">! We test the io-performance here</span>
      <span class="k">call </span><span class="n">time_io</span><span class="p">(</span><span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span><span class="n">H_2D</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="c">!     If onlyS, Save overlap matrix and exit</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">onlyS</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         </span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname_TSHS</span><span class="p">(</span><span class="n">slabel</span><span class="p">,</span> <span class="n">onlyS</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span> <span class="p">)</span>
         <span class="c">! We include H as S, well-knowing that we only write one of</span>
         <span class="c">! them, there is no need to allocate space for no reason!</span>
         <span class="k">call </span><span class="n">ts_write_tshs</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="nb">Gamma</span><span class="p">,</span> <span class="n">ts_Gamma_file</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">ucell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">isc_off</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">ts_kscell_file</span><span class="p">,</span> <span class="n">ts_kdispl_file</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">xa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="n">H_2D</span><span class="p">,</span> <span class="n">S_1D</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="n">dummyEf</span><span class="p">,</span> <span class="n">dummyQtot</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
         <span class="k">call </span><span class="n">bye</span><span class="p">(</span> <span class="s1">&#39;Save overlap matrix and exit&#39;</span> <span class="p">)</span> <span class="c">! Exit siesta</span>
         
      <span class="n">endif</span> 

      <span class="c">! In case the user is requesting a Fermi-correction</span>
      <span class="c">! we need to delete the TS_FERMI file after each iteration</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">TSmode</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">TS_RHOCORR_METHOD</span> <span class="o">==</span> <span class="n">TS_RHOCORR_FERMI</span>
     <span class="p">&amp;</span>     <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
          <span class="c">! Delete the TS_FERMI file (enables</span>
          <span class="c">! reading it in and improve on the convergence)</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">file_exist</span><span class="p">(</span><span class="s1">&#39;TS_FERMI&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             </span><span class="n">i</span> <span class="o">=</span> <span class="mi">23455</span> <span class="c">! this should just not be used any were...</span>
             <span class="c">! Delete the file...</span>
             <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s1">&#39;TS_FERMI&#39;</span><span class="p">)</span>
             <span class="k">close</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span>
          <span class="k">end if</span>
<span class="k">       end if</span>
      
<span class="cp">#ifdef CDF</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">writedm_cdf</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">setup_dm_netcdf_file</span><span class="p">(</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">no_s</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">)</span>
      <span class="n">endif</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">writedm_cdf_history</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">setup_dm_netcdf_file</span><span class="p">(</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">no_s</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">istep</span><span class="p">)</span>
      <span class="n">endif</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">writedmhs_cdf</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">setup_dmhs_netcdf_file</span><span class="p">(</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">no_s</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">s</span><span class="p">)</span>
      <span class="n">endif</span>
      <span class="k">if</span><span class="p">(</span><span class="n">writedmhs_cdf_history</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">setup_dmhs_netcdf_file</span><span class="p">(</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">no_s</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">s</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">istep</span><span class="p">)</span>
      <span class="n">endif</span>
<span class="cp">#endif</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;state_init&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

      <span class="k">END subroutine </span><span class="n">state_init</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprocs-1">All Procedures</a></h3></div>
  <div id="allprocs-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../proc/current_itt.html">current_itt</a>
      
      <a class="list-group-item" href="../proc/getstackval.html">getstackval</a>
      
      <a class="list-group-item" href="../proc/inverse.html">inverse</a>
      
      <a class="list-group-item" href="../proc/is_next.html">is_next</a>
      
      <a class="list-group-item" href="../proc/mix_method.html">mix_method</a>
      
      <a class="list-group-item" href="../proc/mix_method_variant.html">mix_method_variant</a>
      
      <a class="list-group-item" href="../proc/mixer_init.html">mixer_init</a>
      
      <a class="list-group-item" href="../proc/mixers_history_init.html">mixers_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_init.html">mixers_init</a>
      
      <a class="list-group-item" href="../proc/mixers_print.html">mixers_print</a>
      
      <a class="list-group-item" href="../proc/mixers_print_block.html">mixers_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_reset.html">mixers_reset</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_history_init.html">mixers_scf_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_init.html">mixers_scf_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print.html">mixers_scf_print</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print_block.html">mixers_scf_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_reset.html">mixers_scf_reset</a>
      
      <a class="list-group-item" href="../interface/mixing.html">mixing</a>
      
      <a class="list-group-item" href="../proc/mixing_1d.html">mixing_1d</a>
      
      <a class="list-group-item" href="../proc/mixing_2d.html">mixing_2d</a>
      
      <a class="list-group-item" href="../proc/mixing_calc_next.html">mixing_calc_next</a>
      
      <a class="list-group-item" href="../proc/mixing_coeff.html">mixing_coeff</a>
      
      <a class="list-group-item" href="../proc/mixing_finalize.html">mixing_finalize</a>
      
      <a class="list-group-item" href="../proc/mixing_init.html">mixing_init</a>
      
      <a class="list-group-item" href="../proc/mixing_ncoeff.html">mixing_ncoeff</a>
      
      <a class="list-group-item" href="../proc/mixing_scf_converged.html">mixing_scf_converged</a>
      
      <a class="list-group-item" href="../proc/mixing_step.html">mixing_step</a>
      
      <a class="list-group-item" href="../proc/norm.html">norm</a>
      
      <a class="list-group-item" href="../proc/push_diff.html">push_diff</a>
      
      <a class="list-group-item" href="../proc/push_f.html">push_F</a>
      
      <a class="list-group-item" href="../proc/push_stack_data.html">push_stack_data</a>
      
      <a class="list-group-item" href="../proc/setup_h0.html">setup_H0</a>
      
      <a class="list-group-item" href="../proc/siesta_analysis.html">siesta_analysis</a>
      
      <a class="list-group-item" href="../proc/siesta_forces.html">siesta_forces</a>
      
      <a class="list-group-item" href="../proc/stack_check.html">stack_check</a>
      
      <a class="list-group-item" href="../proc/state_analysis.html">state_analysis</a>
      
      <a class="list-group-item" href="../proc/state_init.html">state_init</a>
      
      <a class="list-group-item" href="../proc/svd.html">svd</a>
      
      <a class="list-group-item" href="../proc/update_f.html">update_F</a>
      
    </div>
  </div>
</div>


  </section>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SIESTA was developed by SIESTA Group</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    
  </body>
</html>