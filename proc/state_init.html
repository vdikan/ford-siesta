<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="A first-principles materials simulation code using Density Functional Theory.">
    
    <meta name="author" content="SIESTA Group" >
    <link rel="icon" href="../favicon.png">

    <title>state_init &ndash; SIESTA</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SIESTA <small>trunk-674</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li><a href='../page/index.html'>Program Overview</a></li>
	    
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>state_init
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title="12.0% of total for procedures.">349 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/state_init.F"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li><a href='../sourcefile/state_init.f.html'>state_init.F</a></li>
  
     <li><a href='../module/m_state_init.html'>m_state_init</a></li>
  
     <li class="active">state_init</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  




















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/state_init.html#src">state_init</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprocs-0">All Procedures</a></h3></div>
  <div id="allprocs-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../proc/compute_dm.html">compute_dm</a>
      
      <a class="list-group-item" href="../proc/current_itt.html">current_itt</a>
      
      <a class="list-group-item" href="../proc/getstackval.html">getstackval</a>
      
      <a class="list-group-item" href="../proc/inverse.html">inverse</a>
      
      <a class="list-group-item" href="../proc/is_next.html">is_next</a>
      
      <a class="list-group-item" href="../proc/mix_method.html">mix_method</a>
      
      <a class="list-group-item" href="../proc/mix_method_variant.html">mix_method_variant</a>
      
      <a class="list-group-item" href="../proc/mixer_init.html">mixer_init</a>
      
      <a class="list-group-item" href="../proc/mixers_history_init.html">mixers_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_init.html">mixers_init</a>
      
      <a class="list-group-item" href="../proc/mixers_print.html">mixers_print</a>
      
      <a class="list-group-item" href="../proc/mixers_print_block.html">mixers_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_reset.html">mixers_reset</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_history_init.html">mixers_scf_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_init.html">mixers_scf_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print.html">mixers_scf_print</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print_block.html">mixers_scf_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_reset.html">mixers_scf_reset</a>
      
      <a class="list-group-item" href="../interface/mixing.html">mixing</a>
      
      <a class="list-group-item" href="../proc/mixing_1d.html">mixing_1d</a>
      
      <a class="list-group-item" href="../proc/mixing_2d.html">mixing_2d</a>
      
      <a class="list-group-item" href="../proc/mixing_calc_next.html">mixing_calc_next</a>
      
      <a class="list-group-item" href="../proc/mixing_coeff.html">mixing_coeff</a>
      
      <a class="list-group-item" href="../proc/mixing_finalize.html">mixing_finalize</a>
      
      <a class="list-group-item" href="../proc/mixing_init.html">mixing_init</a>
      
      <a class="list-group-item" href="../proc/mixing_ncoeff.html">mixing_ncoeff</a>
      
      <a class="list-group-item" href="../proc/mixing_scf_converged.html">mixing_scf_converged</a>
      
      <a class="list-group-item" href="../proc/mixing_step.html">mixing_step</a>
      
      <a class="list-group-item" href="../proc/norm.html">norm</a>
      
      <a class="list-group-item" href="../proc/push_diff.html">push_diff</a>
      
      <a class="list-group-item" href="../proc/push_f.html">push_F</a>
      
      <a class="list-group-item" href="../proc/push_stack_data.html">push_stack_data</a>
      
      <a class="list-group-item" href="../proc/setup_h0.html">setup_H0</a>
      
      <a class="list-group-item" href="../proc/setup_hamiltonian.html">setup_hamiltonian</a>
      
      <a class="list-group-item" href="../proc/siesta_analysis.html">siesta_analysis</a>
      
      <a class="list-group-item" href="../proc/siesta_forces.html">siesta_forces</a>
      
      <a class="list-group-item" href="../proc/stack_check.html">stack_check</a>
      
      <a class="list-group-item" href="../proc/state_analysis.html">state_analysis</a>
      
      <a class="list-group-item" href="../proc/state_init.html">state_init</a>
      
      <a class="list-group-item" href="../proc/svd.html">svd</a>
      
      <a class="list-group-item" href="../proc/update_f.html">update_F</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine state_init(istep)
    
    
	 
</h2>
    
  
    <div class="panel panel-default">
      <div class="panel-heading">
	<h3 class="panel-title">Uses</h3>
      </div>
      <ul class="list-group">
      
      <li class="list-group-item">
	<ul class="list-inline">
	  
	  <li>Kpoint_grid</li>
	  
	  <li>m_os</li>
	  
	  <li>m_new_dm</li>
	  
	  <li>m_proximity_check</li>
	  
	  <li>siesta_options</li>
	  
	  <li>units</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>create_Sparsity_SC</li>
	  
	  <li>m_sparsity_handling</li>
	  
	  <li>m_sparsity_handling</li>
	  
	  <li>m_pivot_methods</li>
	  
	  <li>siesta_geom</li>
	  
	  <li>atomlist</li>
	  
	  <li>alloc</li>
	  
	  <li>m_hsparse</li>
	  
	  <li>m_overlap</li>
	  
	  <li>m_supercell</li>
	  
	  <li>siesta_cml</li>
	  
	  <li>zmatrix</li>
	  
	  <li>m_energies</li>
	  
	  <li>write_subs</li>
	  
	  <li>m_ioxv</li>
	  
	  <li>m_iotdxv</li>
	  
	  <li>m_steps</li>
	  
	  <li>parallel</li>
	  
	  <li>m_spin</li>
	  
	  <li>m_rmaxh</li>
	  
	  <li><a href='../module/m_mixing.html'>m_mixing</a></li>
	  
	  <li><a href='../module/m_mixing_scf.html'>m_mixing_scf</a></li>
	  
	  <li>m_normalize_dm</li>
	  
	  <li>m_eo</li>
	  
	  <li>m_gamma</li>
	  
	  <li>files</li>
	  
	  <li>m_mpi_utils</li>
	  
	  <li>m_mpi_utils</li>
	  
	  <li>domain_decom</li>
	  
	  <li>ldau_specs</li>
	  
	  <li>m_sparse</li>
	  
	  <li>m_ts_kpoints</li>
	  
	  <li>m_ts_charge</li>
	  
	  <li>m_ts_options</li>
	  
	  <li>m_ts_options</li>
	  
	  <li>m_ts_options</li>
	  
	  <li>m_ts_electype</li>
	  
	  <li>m_ts_global_vars</li>
	  
	  <li>sys</li>
	  
	  <li>m_ts_io</li>
	  
	  <li>m_ts_sparse</li>
	  
	  <li>m_ts_tri_init</li>
	  
	  <li>files</li>
	  
	  <li>m_chess</li>
	  
	  <li>iodm_netcdf</li>
	  
	  <li>iodmhs_netcdf</li>
	  
	  <li>class_Sparsity</li>
	  
	  <li>class_dSpData1D</li>
	  
	  <li>class_dSpData2D</li>
	  
	  <li>class_dData2D</li>
	  
	  <li>m_test_io</li>
	  
	  <li>siesta_dicts</li>
	  
	</ul>
      </li>
      
      
      
      <li class="list-group-item">
	<div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~state_init~~UsesGraph Pages: 1 -->
<svg id="procstate_initUsesGraph" width="462pt" height="2254pt"
 viewBox="0.00 0.00 462.00 2254.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_init~~UsesGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 2250)">
<title>proc~~state_init~~UsesGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-2250 458,-2250 458,4 -4,4"/>
<!-- proc~state_init -->
<g id="proc~~state_init~~UsesGraph_node1" class="node"><title>proc~state_init</title>
<polygon fill="none" stroke="black" points="454,-1133 399,-1133 399,-1109 454,-1109 454,-1133"/>
<text text-anchor="middle" x="426.5" y="-1118.6" font-family="Helvetica,sans-Serif" font-size="10.50">state_init</text>
</g>
<!-- alloc -->
<g id="proc~~state_init~~UsesGraph_node2" class="node"><title>alloc</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-2246 280.5,-2246 280.5,-2222 334.5,-2222 334.5,-2246"/>
<text text-anchor="middle" x="307.5" y="-2231.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">alloc</text>
</g>
<!-- proc~state_init&#45;&gt;alloc -->
<g id="proc~~state_init~~UsesGraph_edge1" class="edge"><title>proc~state_init&#45;&gt;alloc</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.592,-1133.23C426.346,-1247.21 429.923,-2121.23 363,-2213 358.441,-2219.25 351.757,-2223.64 344.62,-2226.73"/>
<polygon fill="#000000" stroke="#000000" points="343.048,-2223.57 334.764,-2230.17 345.359,-2230.18 343.048,-2223.57"/>
</g>
<!-- m_ts_electype -->
<g id="proc~~state_init~~UsesGraph_node3" class="node"><title>m_ts_electype</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348.5,-2204 266.5,-2204 266.5,-2180 348.5,-2180 348.5,-2204"/>
<text text-anchor="middle" x="307.5" y="-2189.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_electype</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_electype -->
<g id="proc~~state_init~~UsesGraph_edge2" class="edge"><title>proc~state_init&#45;&gt;m_ts_electype</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.562,-1133.11C426.027,-1244.12 427.391,-2082.91 363,-2171 361.261,-2173.38 359.214,-2175.49 356.952,-2177.36"/>
<polygon fill="#000000" stroke="#000000" points="355.021,-2174.44 348.567,-2182.84 358.852,-2180.3 355.021,-2174.44"/>
</g>
<!-- m_proximity_check -->
<g id="proc~~state_init~~UsesGraph_node4" class="node"><title>m_proximity_check</title>
<polygon fill="#337ab7" stroke="#337ab7" points="359.5,-2162 255.5,-2162 255.5,-2138 359.5,-2138 359.5,-2162"/>
<text text-anchor="middle" x="307.5" y="-2147.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_proximity_check</text>
</g>
<!-- proc~state_init&#45;&gt;m_proximity_check -->
<g id="proc~~state_init~~UsesGraph_edge3" class="edge"><title>proc~state_init&#45;&gt;m_proximity_check</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.53,-1133.31C425.696,-1242.57 424.8,-2044.68 363,-2129 362.436,-2129.77 361.84,-2130.51 361.215,-2131.22"/>
<polygon fill="#000000" stroke="#000000" points="358.805,-2128.68 353.551,-2137.88 363.395,-2133.97 358.805,-2128.68"/>
</g>
<!-- m_ts_io -->
<g id="proc~~state_init~~UsesGraph_node5" class="node"><title>m_ts_io</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-2120 280.5,-2120 280.5,-2096 334.5,-2096 334.5,-2120"/>
<text text-anchor="middle" x="307.5" y="-2105.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_io</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_io -->
<g id="proc~~state_init~~UsesGraph_edge4" class="edge"><title>proc~state_init&#45;&gt;m_ts_io</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.495,-1133.12C425.354,-1239.13 422.281,-2006.34 363,-2087 358.417,-2093.24 351.724,-2097.62 344.585,-2100.7"/>
<polygon fill="#000000" stroke="#000000" points="343.014,-2097.54 334.732,-2104.15 345.326,-2104.15 343.014,-2097.54"/>
</g>
<!-- m_supercell -->
<g id="proc~~state_init~~UsesGraph_node6" class="node"><title>m_supercell</title>
<polygon fill="#337ab7" stroke="#337ab7" points="342.5,-2078 272.5,-2078 272.5,-2054 342.5,-2054 342.5,-2078"/>
<text text-anchor="middle" x="307.5" y="-2063.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_supercell</text>
</g>
<!-- proc~state_init&#45;&gt;m_supercell -->
<g id="proc~~state_init~~UsesGraph_edge5" class="edge"><title>proc~state_init&#45;&gt;m_supercell</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.457,-1133.25C424.992,-1237.08 419.708,-1968.08 363,-2045 360.035,-2049.02 356.191,-2052.27 351.918,-2054.9"/>
<polygon fill="#000000" stroke="#000000" points="350.096,-2051.9 342.686,-2059.47 353.201,-2058.17 350.096,-2051.9"/>
</g>
<!-- m_energies -->
<g id="proc~~state_init~~UsesGraph_node7" class="node"><title>m_energies</title>
<polygon fill="#337ab7" stroke="#337ab7" points="342,-2036 273,-2036 273,-2012 342,-2012 342,-2036"/>
<text text-anchor="middle" x="307.5" y="-2021.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_energies</text>
</g>
<!-- proc~state_init&#45;&gt;m_energies -->
<g id="proc~~state_init~~UsesGraph_edge6" class="edge"><title>proc~state_init&#45;&gt;m_energies</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.417,-1133C424.627,-1233.28 417.203,-1929.72 363,-2003 359.877,-2007.22 355.786,-2010.6 351.247,-2013.29"/>
<polygon fill="#000000" stroke="#000000" points="349.603,-2010.2 342.104,-2017.68 352.634,-2016.51 349.603,-2010.2"/>
</g>
<!-- units -->
<g id="proc~~state_init~~UsesGraph_node8" class="node"><title>units</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1994 280.5,-1994 280.5,-1970 334.5,-1970 334.5,-1994"/>
<text text-anchor="middle" x="307.5" y="-1979.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">units</text>
</g>
<!-- proc~state_init&#45;&gt;units -->
<g id="proc~~state_init~~UsesGraph_edge7" class="edge"><title>proc~state_init&#45;&gt;units</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.372,-1133.04C424.234,-1230.73 414.649,-1891.43 363,-1961 358.387,-1967.21 351.682,-1971.59 344.541,-1974.67"/>
<polygon fill="#000000" stroke="#000000" points="342.971,-1971.51 334.689,-1978.12 345.284,-1978.12 342.971,-1971.51"/>
</g>
<!-- m_overlap -->
<g id="proc~~state_init~~UsesGraph_node9" class="node"><title>m_overlap</title>
<polygon fill="#337ab7" stroke="#337ab7" points="339,-1952 276,-1952 276,-1928 339,-1928 339,-1952"/>
<text text-anchor="middle" x="307.5" y="-1937.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_overlap</text>
</g>
<!-- proc~state_init&#45;&gt;m_overlap -->
<g id="proc~~state_init~~UsesGraph_edge8" class="edge"><title>proc~state_init&#45;&gt;m_overlap</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.322,-1133.04C423.822,-1227.9 412.106,-1853.13 363,-1919 359.312,-1923.95 354.297,-1927.73 348.795,-1930.62"/>
<polygon fill="#000000" stroke="#000000" points="347.055,-1927.56 339.223,-1934.69 349.795,-1934 347.055,-1927.56"/>
</g>
<!-- class_dData2D -->
<g id="proc~~state_init~~UsesGraph_node10" class="node"><title>class_dData2D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="350,-1910 265,-1910 265,-1886 350,-1886 350,-1910"/>
<text text-anchor="middle" x="307.5" y="-1895.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dData2D</text>
</g>
<!-- proc~state_init&#45;&gt;class_dData2D -->
<g id="proc~~state_init~~UsesGraph_edge9" class="edge"><title>proc~state_init&#45;&gt;class_dData2D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.262,-1133.28C423.364,-1226.04 409.525,-1814.87 363,-1877 361.617,-1878.85 360.05,-1880.53 358.342,-1882.07"/>
<polygon fill="#000000" stroke="#000000" points="356.235,-1879.27 350.085,-1887.9 360.273,-1884.99 356.235,-1879.27"/>
</g>
<!-- ldau_specs -->
<g id="proc~~state_init~~UsesGraph_node11" class="node"><title>ldau_specs</title>
<polygon fill="#337ab7" stroke="#337ab7" points="341,-1868 274,-1868 274,-1844 341,-1844 341,-1868"/>
<text text-anchor="middle" x="307.5" y="-1853.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ldau_specs</text>
</g>
<!-- proc~state_init&#45;&gt;ldau_specs -->
<g id="proc~~state_init~~UsesGraph_edge10" class="edge"><title>proc~state_init&#45;&gt;ldau_specs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.202,-1133.16C422.913,-1222.58 407.006,-1776.53 363,-1835 359.646,-1839.46 355.218,-1842.97 350.332,-1845.73"/>
<polygon fill="#000000" stroke="#000000" points="348.794,-1842.59 341.175,-1849.95 351.722,-1848.95 348.794,-1842.59"/>
</g>
<!-- siesta_dicts -->
<g id="proc~~state_init~~UsesGraph_node12" class="node"><title>siesta_dicts</title>
<polygon fill="#337ab7" stroke="#337ab7" points="341.5,-1826 273.5,-1826 273.5,-1802 341.5,-1802 341.5,-1826"/>
<text text-anchor="middle" x="307.5" y="-1811.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_dicts</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_dicts -->
<g id="proc~~state_init~~UsesGraph_edge11" class="edge"><title>proc~state_init&#45;&gt;siesta_dicts</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.129,-1133.26C422.406,-1219.94 404.454,-1738.23 363,-1793 359.793,-1797.24 355.615,-1800.62 350.998,-1803.32"/>
<polygon fill="#000000" stroke="#000000" points="349.257,-1800.27 341.719,-1807.72 352.254,-1806.6 349.257,-1800.27"/>
</g>
<!-- m_chess -->
<g id="proc~~state_init~~UsesGraph_node13" class="node"><title>m_chess</title>
<polygon fill="#337ab7" stroke="#337ab7" points="335,-1784 280,-1784 280,-1760 335,-1760 335,-1784"/>
<text text-anchor="middle" x="307.5" y="-1769.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_chess</text>
</g>
<!-- proc~state_init&#45;&gt;m_chess -->
<g id="proc~~state_init~~UsesGraph_edge13" class="edge"><title>proc~state_init&#45;&gt;m_chess</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.058,-1133.03C421.916,-1215.84 401.961,-1699.85 363,-1751 358.396,-1757.04 351.817,-1761.35 344.814,-1764.42"/>
<polygon fill="#000000" stroke="#000000" points="343.383,-1761.21 335.148,-1767.88 345.743,-1767.8 343.383,-1761.21"/>
</g>
<!-- iodmhs_netcdf -->
<g id="proc~~state_init~~UsesGraph_node14" class="node"><title>iodmhs_netcdf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348.5,-1742 266.5,-1742 266.5,-1718 348.5,-1718 348.5,-1742"/>
<text text-anchor="middle" x="307.5" y="-1727.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">iodmhs_netcdf</text>
</g>
<!-- proc~state_init&#45;&gt;iodmhs_netcdf -->
<g id="proc~~state_init~~UsesGraph_edge14" class="edge"><title>proc~state_init&#45;&gt;iodmhs_netcdf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.959,-1133.24C421.315,-1213.39 399.401,-1661.56 363,-1709 361.353,-1711.15 359.457,-1713.07 357.381,-1714.81"/>
<polygon fill="#000000" stroke="#000000" points="355.073,-1712.13 348.638,-1720.55 358.917,-1717.98 355.073,-1712.13"/>
</g>
<!-- m_gamma -->
<g id="proc~~state_init~~UsesGraph_node15" class="node"><title>m_gamma</title>
<polygon fill="#337ab7" stroke="#337ab7" points="339.5,-1700 275.5,-1700 275.5,-1676 339.5,-1676 339.5,-1700"/>
<text text-anchor="middle" x="307.5" y="-1685.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_gamma</text>
</g>
<!-- proc~state_init&#45;&gt;m_gamma -->
<g id="proc~~state_init~~UsesGraph_edge12" class="edge"><title>proc~state_init&#45;&gt;m_gamma</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.758,-1133.11C427.06,-1205.41 430.434,-1579.84 363,-1667 359.303,-1671.78 354.375,-1675.47 348.99,-1678.32"/>
<polygon fill="#000000" stroke="#000000" points="347.417,-1675.19 339.63,-1682.37 350.198,-1681.61 347.417,-1675.19"/>
</g>
<!-- sparse_matrices -->
<g id="proc~~state_init~~UsesGraph_node16" class="node"><title>sparse_matrices</title>
<polygon fill="#337ab7" stroke="#337ab7" points="353,-1658 262,-1658 262,-1634 353,-1634 353,-1658"/>
<text text-anchor="middle" x="307.5" y="-1643.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sparse_matrices</text>
</g>
<!-- proc~state_init&#45;&gt;sparse_matrices -->
<g id="proc~~state_init~~UsesGraph_edge15" class="edge"><title>proc~state_init&#45;&gt;sparse_matrices</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.629,-1133.07C426.129,-1201.95 425.423,-1545.1 363,-1625 362.313,-1625.88 361.585,-1626.72 360.82,-1627.53"/>
<polygon fill="#000000" stroke="#000000" points="358.586,-1624.83 353.072,-1633.88 363.024,-1630.25 358.586,-1624.83"/>
</g>
<!-- m_ioxv -->
<g id="proc~~state_init~~UsesGraph_node17" class="node"><title>m_ioxv</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1616 280.5,-1616 280.5,-1592 334.5,-1592 334.5,-1616"/>
<text text-anchor="middle" x="307.5" y="-1601.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ioxv</text>
</g>
<!-- proc~state_init&#45;&gt;m_ioxv -->
<g id="proc~~state_init~~UsesGraph_edge16" class="edge"><title>proc~state_init&#45;&gt;m_ioxv</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.476,-1133.34C425.111,-1199.34 420.333,-1510.45 363,-1583 358.246,-1589.02 351.544,-1593.31 344.461,-1596.38"/>
<polygon fill="#000000" stroke="#000000" points="342.964,-1593.19 334.712,-1599.84 345.307,-1599.79 342.964,-1593.19"/>
</g>
<!-- m_os -->
<g id="proc~~state_init~~UsesGraph_node18" class="node"><title>m_os</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1574 280.5,-1574 280.5,-1550 334.5,-1550 334.5,-1574"/>
<text text-anchor="middle" x="307.5" y="-1559.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_os</text>
</g>
<!-- proc~state_init&#45;&gt;m_os -->
<g id="proc~~state_init~~UsesGraph_edge17" class="edge"><title>proc~state_init&#45;&gt;m_os</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.298,-1133.02C424.031,-1194.74 415.425,-1475.55 363,-1541 358.206,-1546.98 351.488,-1551.27 344.402,-1554.33"/>
<polygon fill="#000000" stroke="#000000" points="342.905,-1551.15 334.656,-1557.79 345.251,-1557.74 342.905,-1551.15"/>
</g>
<!-- Kpoint_grid -->
<g id="proc~~state_init~~UsesGraph_node19" class="node"><title>Kpoint_grid</title>
<polygon fill="#337ab7" stroke="#337ab7" points="341,-1532 274,-1532 274,-1508 341,-1508 341,-1532"/>
<text text-anchor="middle" x="307.5" y="-1517.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Kpoint_grid</text>
</g>
<!-- proc~state_init&#45;&gt;Kpoint_grid -->
<g id="proc~~state_init~~UsesGraph_edge18" class="edge"><title>proc~state_init&#45;&gt;Kpoint_grid</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.067,-1133.34C422.779,-1191.85 410.357,-1440.85 363,-1499 359.605,-1503.17 355.279,-1506.51 350.554,-1509.19"/>
<polygon fill="#000000" stroke="#000000" points="348.71,-1506.19 341.112,-1513.57 351.656,-1512.54 348.71,-1506.19"/>
</g>
<!-- m_spin -->
<g id="proc~~state_init~~UsesGraph_node20" class="node"><title>m_spin</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1490 280.5,-1490 280.5,-1466 334.5,-1466 334.5,-1490"/>
<text text-anchor="middle" x="307.5" y="-1475.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_spin</text>
</g>
<!-- proc~state_init&#45;&gt;m_spin -->
<g id="proc~~state_init~~UsesGraph_edge19" class="edge"><title>proc~state_init&#45;&gt;m_spin</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.806,-1133.04C421.471,-1186.97 405.477,-1405.89 363,-1457 358.098,-1462.9 351.337,-1467.14 344.242,-1470.2"/>
<polygon fill="#000000" stroke="#000000" points="342.747,-1467.01 334.503,-1473.67 345.098,-1473.61 342.747,-1467.01"/>
</g>
<!-- sys -->
<g id="proc~~state_init~~UsesGraph_node21" class="node"><title>sys</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1448 280.5,-1448 280.5,-1424 334.5,-1424 334.5,-1448"/>
<text text-anchor="middle" x="307.5" y="-1433.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sys</text>
</g>
<!-- proc~state_init&#45;&gt;sys -->
<g id="proc~~state_init~~UsesGraph_edge20" class="edge"><title>proc~state_init&#45;&gt;sys</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.444,-1133.18C419.898,-1183.05 400.506,-1371.03 363,-1415 358.069,-1420.78 351.354,-1424.98 344.324,-1428.02"/>
<polygon fill="#000000" stroke="#000000" points="342.899,-1424.81 334.678,-1431.5 345.272,-1431.4 342.899,-1424.81"/>
</g>
<!-- domain_decom -->
<g id="proc~~state_init~~UsesGraph_node22" class="node"><title>domain_decom</title>
<polygon fill="#337ab7" stroke="#337ab7" points="350.5,-1406 264.5,-1406 264.5,-1382 350.5,-1382 350.5,-1406"/>
<text text-anchor="middle" x="307.5" y="-1391.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">domain_decom</text>
</g>
<!-- proc~state_init&#45;&gt;domain_decom -->
<g id="proc~~state_init~~UsesGraph_edge21" class="edge"><title>proc~state_init&#45;&gt;domain_decom</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M426.149,-1133C427.621,-1172.58 426.976,-1300.51 363,-1373 361.801,-1374.36 360.503,-1375.63 359.127,-1376.82"/>
<polygon fill="#000000" stroke="#000000" points="356.75,-1374.21 350.521,-1382.78 360.735,-1379.96 356.75,-1374.21"/>
</g>
<!-- m_ts_sparse -->
<g id="proc~~state_init~~UsesGraph_node23" class="node"><title>m_ts_sparse</title>
<polygon fill="#337ab7" stroke="#337ab7" points="344.5,-1364 270.5,-1364 270.5,-1340 344.5,-1340 344.5,-1364"/>
<text text-anchor="middle" x="307.5" y="-1349.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_sparse</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_sparse -->
<g id="proc~~state_init~~UsesGraph_edge22" class="edge"><title>proc~state_init&#45;&gt;m_ts_sparse</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.424,-1133.22C424.544,-1168.61 417.224,-1272.34 363,-1331 360.252,-1333.97 357.036,-1336.53 353.564,-1338.73"/>
<polygon fill="#000000" stroke="#000000" points="351.748,-1335.73 344.53,-1343.48 355.009,-1341.92 351.748,-1335.73"/>
</g>
<!-- m_mpi_utils -->
<g id="proc~~state_init~~UsesGraph_node24" class="node"><title>m_mpi_utils</title>
<polygon fill="#337ab7" stroke="#337ab7" points="342.5,-1322 272.5,-1322 272.5,-1298 342.5,-1298 342.5,-1322"/>
<text text-anchor="middle" x="307.5" y="-1307.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mpi_utils</text>
</g>
<!-- proc~state_init&#45;&gt;m_mpi_utils -->
<g id="proc~~state_init~~UsesGraph_edge23" class="edge"><title>proc~state_init&#45;&gt;m_mpi_utils</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.335,-1133.39C420.818,-1163.98 407.628,-1243.85 363,-1289 359.744,-1292.29 355.916,-1295.08 351.822,-1297.44"/>
<polygon fill="#000000" stroke="#000000" points="350.024,-1294.42 342.557,-1301.94 353.082,-1300.72 350.024,-1294.42"/>
</g>
<!-- m_new_dm -->
<g id="proc~~state_init~~UsesGraph_node25" class="node"><title>m_new_dm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="341.5,-1280 273.5,-1280 273.5,-1256 341.5,-1256 341.5,-1280"/>
<text text-anchor="middle" x="307.5" y="-1265.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_new_dm</text>
</g>
<!-- proc~state_init&#45;&gt;m_new_dm -->
<g id="proc~~state_init~~UsesGraph_edge24" class="edge"><title>proc~state_init&#45;&gt;m_new_dm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M422.639,-1133.21C416.218,-1158.03 398.373,-1214.76 363,-1247 359.396,-1250.28 355.222,-1253.08 350.82,-1255.44"/>
<polygon fill="#000000" stroke="#000000" points="349.174,-1252.35 341.574,-1259.73 352.118,-1258.7 349.174,-1252.35"/>
</g>
<!-- m_steps -->
<g id="proc~~state_init~~UsesGraph_node26" class="node"><title>m_steps</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1238 280.5,-1238 280.5,-1214 334.5,-1214 334.5,-1238"/>
<text text-anchor="middle" x="307.5" y="-1223.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_steps</text>
</g>
<!-- proc~state_init&#45;&gt;m_steps -->
<g id="proc~~state_init~~UsesGraph_edge53" class="edge"><title>proc~state_init&#45;&gt;m_steps</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M419.297,-1133.28C409.596,-1151.35 389.203,-1185.1 363,-1205 357.411,-1209.24 350.862,-1212.73 344.279,-1215.55"/>
<polygon fill="#000000" stroke="#000000" points="342.795,-1212.37 334.719,-1219.23 345.309,-1218.91 342.795,-1212.37"/>
</g>
<!-- class_Sparsity -->
<g id="proc~~state_init~~UsesGraph_node27" class="node"><title>class_Sparsity</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-1196 267,-1196 267,-1172 348,-1172 348,-1196"/>
<text text-anchor="middle" x="307.5" y="-1181.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_Sparsity</text>
</g>
<!-- proc~state_init&#45;&gt;class_Sparsity -->
<g id="proc~~state_init~~UsesGraph_edge26" class="edge"><title>proc~state_init&#45;&gt;class_Sparsity</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M409.668,-1133.09C397.388,-1142.11 379.7,-1154.31 363,-1163 359.703,-1164.72 356.232,-1166.37 352.706,-1167.95"/>
<polygon fill="#000000" stroke="#000000" points="351.163,-1164.8 343.321,-1171.92 353.894,-1171.24 351.163,-1164.8"/>
</g>
<!-- class_dSpData1D -->
<g id="proc~~state_init~~UsesGraph_node28" class="node"><title>class_dSpData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="356,-1154 259,-1154 259,-1130 356,-1130 356,-1154"/>
<text text-anchor="middle" x="307.5" y="-1139.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dSpData1D</text>
</g>
<!-- proc~state_init&#45;&gt;class_dSpData1D -->
<g id="proc~~state_init~~UsesGraph_edge27" class="edge"><title>proc~state_init&#45;&gt;class_dSpData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398.951,-1125.77C389.147,-1127.52 377.617,-1129.59 366.131,-1131.66"/>
<polygon fill="#000000" stroke="#000000" points="365.318,-1128.25 356.094,-1133.46 366.555,-1135.14 365.318,-1128.25"/>
</g>
<!-- m_pivot_methods -->
<g id="proc~~state_init~~UsesGraph_node29" class="node"><title>m_pivot_methods</title>
<polygon fill="#337ab7" stroke="#337ab7" points="356,-1112 259,-1112 259,-1088 356,-1088 356,-1112"/>
<text text-anchor="middle" x="307.5" y="-1097.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_pivot_methods</text>
</g>
<!-- proc~state_init&#45;&gt;m_pivot_methods -->
<g id="proc~~state_init~~UsesGraph_edge28" class="edge"><title>proc~state_init&#45;&gt;m_pivot_methods</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M398.951,-1116.23C389.147,-1114.48 377.617,-1112.41 366.131,-1110.34"/>
<polygon fill="#000000" stroke="#000000" points="366.555,-1106.86 356.094,-1108.54 365.318,-1113.75 366.555,-1106.86"/>
</g>
<!-- iodm_netcdf -->
<g id="proc~~state_init~~UsesGraph_node30" class="node"><title>iodm_netcdf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="343,-1070 272,-1070 272,-1046 343,-1046 343,-1070"/>
<text text-anchor="middle" x="307.5" y="-1055.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">iodm_netcdf</text>
</g>
<!-- proc~state_init&#45;&gt;iodm_netcdf -->
<g id="proc~~state_init~~UsesGraph_edge29" class="edge"><title>proc~state_init&#45;&gt;iodm_netcdf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M409.668,-1108.91C397.388,-1099.89 379.7,-1087.69 363,-1079 359.655,-1077.26 356.132,-1075.58 352.552,-1073.98"/>
<polygon fill="#000000" stroke="#000000" points="353.606,-1070.63 343.032,-1069.96 350.88,-1077.08 353.606,-1070.63"/>
</g>
<!-- atomlist -->
<g id="proc~~state_init~~UsesGraph_node31" class="node"><title>atomlist</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-1028 280.5,-1028 280.5,-1004 334.5,-1004 334.5,-1028"/>
<text text-anchor="middle" x="307.5" y="-1013.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">atomlist</text>
</g>
<!-- proc~state_init&#45;&gt;atomlist -->
<g id="proc~~state_init~~UsesGraph_edge30" class="edge"><title>proc~state_init&#45;&gt;atomlist</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M419.297,-1108.72C409.596,-1090.65 389.203,-1056.9 363,-1037 357.411,-1032.76 350.862,-1029.27 344.279,-1026.45"/>
<polygon fill="#000000" stroke="#000000" points="345.309,-1023.09 334.719,-1022.77 342.795,-1029.63 345.309,-1023.09"/>
</g>
<!-- m_eo -->
<g id="proc~~state_init~~UsesGraph_node32" class="node"><title>m_eo</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-986 280.5,-986 280.5,-962 334.5,-962 334.5,-986"/>
<text text-anchor="middle" x="307.5" y="-971.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_eo</text>
</g>
<!-- proc~state_init&#45;&gt;m_eo -->
<g id="proc~~state_init~~UsesGraph_edge31" class="edge"><title>proc~state_init&#45;&gt;m_eo</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M422.639,-1108.79C416.218,-1083.97 398.373,-1027.24 363,-995 357.663,-990.136 351.077,-986.353 344.351,-983.425"/>
<polygon fill="#000000" stroke="#000000" points="345.116,-979.974 334.524,-979.723 342.648,-986.524 345.116,-979.974"/>
</g>
<!-- m_test_io -->
<g id="proc~~state_init~~UsesGraph_node33" class="node"><title>m_test_io</title>
<polygon fill="#337ab7" stroke="#337ab7" points="337,-944 278,-944 278,-920 337,-920 337,-944"/>
<text text-anchor="middle" x="307.5" y="-929.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_test_io</text>
</g>
<!-- proc~state_init&#45;&gt;m_test_io -->
<g id="proc~~state_init~~UsesGraph_edge32" class="edge"><title>proc~state_init&#45;&gt;m_test_io</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.335,-1108.61C420.818,-1078.02 407.628,-998.15 363,-953 358.416,-948.362 352.695,-944.729 346.699,-941.889"/>
<polygon fill="#000000" stroke="#000000" points="347.755,-938.541 337.172,-938.048 345.137,-945.033 347.755,-938.541"/>
</g>
<!-- module~m_mixing -->
<g id="proc~~state_init~~UsesGraph_node34" class="node"><title>module~m_mixing</title>
<g id="a_proc~~state_init~~UsesGraph_node34"><a xlink:href=".././module/m_mixing.html" xlink:title="m_mixing">
<polygon fill="#337ab7" stroke="#337ab7" points="216,-444 158,-444 158,-420 216,-420 216,-444"/>
<text text-anchor="middle" x="187" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mixing</text>
</a>
</g>
</g>
<!-- proc~state_init&#45;&gt;module~m_mixing -->
<g id="proc~~state_init~~UsesGraph_edge33" class="edge"><title>proc~state_init&#45;&gt;module~m_mixing</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.535,-1108.93C424.972,-1073.52 418.459,-968.756 363,-911 326.884,-873.388 285.294,-913.132 252,-873 198.217,-808.171 189.624,-534.547 188.257,-454.243"/>
<polygon fill="#000000" stroke="#000000" points="191.757,-454.184 188.108,-444.237 184.758,-454.288 191.757,-454.184"/>
</g>
<!-- files -->
<g id="proc~~state_init~~UsesGraph_node35" class="node"><title>files</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-864 280.5,-864 280.5,-840 334.5,-840 334.5,-864"/>
<text text-anchor="middle" x="307.5" y="-849.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">files</text>
</g>
<!-- proc~state_init&#45;&gt;files -->
<g id="proc~~state_init~~UsesGraph_edge34" class="edge"><title>proc~state_init&#45;&gt;files</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.793,-1108.8C426.077,-1070.29 421.968,-949.636 363,-878 357.894,-871.797 350.96,-866.977 343.751,-863.269"/>
<polygon fill="#000000" stroke="#000000" points="345.145,-860.059 334.589,-859.146 342.272,-866.442 345.145,-860.059"/>
</g>
<!-- m_ts_global_vars -->
<g id="proc~~state_init~~UsesGraph_node36" class="node"><title>m_ts_global_vars</title>
<polygon fill="#337ab7" stroke="#337ab7" points="356,-822 259,-822 259,-798 356,-798 356,-822"/>
<text text-anchor="middle" x="307.5" y="-807.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_global_vars</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_global_vars -->
<g id="proc~~state_init~~UsesGraph_edge35" class="edge"><title>proc~state_init&#45;&gt;m_ts_global_vars</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.421,-1108.98C419.783,-1059.79 400.078,-874.344 363,-831 362.147,-830.003 361.241,-829.053 360.29,-828.149"/>
<polygon fill="#000000" stroke="#000000" points="362.32,-825.295 352.232,-822.054 358.097,-830.878 362.32,-825.295"/>
</g>
<!-- m_sparsity_handling -->
<g id="proc~~state_init~~UsesGraph_node37" class="node"><title>m_sparsity_handling</title>
<polygon fill="#337ab7" stroke="#337ab7" points="363,-780 252,-780 252,-756 363,-756 363,-780"/>
<text text-anchor="middle" x="307.5" y="-765.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_sparsity_handling</text>
</g>
<!-- proc~state_init&#45;&gt;m_sparsity_handling -->
<g id="proc~~state_init~~UsesGraph_edge36" class="edge"><title>proc~state_init&#45;&gt;m_sparsity_handling</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.762,-1108.74C421.289,-1054.84 404.95,-839.36 363,-789 362.27,-788.124 361.499,-787.284 360.691,-786.478"/>
<polygon fill="#000000" stroke="#000000" points="362.62,-783.544 352.588,-780.136 358.306,-789.056 362.62,-783.544"/>
</g>
<!-- m_rmaxh -->
<g id="proc~~state_init~~UsesGraph_node38" class="node"><title>m_rmaxh</title>
<polygon fill="#337ab7" stroke="#337ab7" points="336.5,-738 278.5,-738 278.5,-714 336.5,-714 336.5,-738"/>
<text text-anchor="middle" x="307.5" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_rmaxh</text>
</g>
<!-- proc~state_init&#45;&gt;m_rmaxh -->
<g id="proc~~state_init~~UsesGraph_edge37" class="edge"><title>proc~state_init&#45;&gt;m_rmaxh</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.048,-1108.79C422.675,-1050.9 409.919,-804.514 363,-747 358.564,-741.563 352.544,-737.53 346.12,-734.541"/>
<polygon fill="#000000" stroke="#000000" points="347.147,-731.186 336.557,-730.865 344.636,-737.72 347.147,-731.186"/>
</g>
<!-- m_normalize_dm -->
<g id="proc~~state_init~~UsesGraph_node39" class="node"><title>m_normalize_dm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="355,-696 260,-696 260,-672 355,-672 355,-696"/>
<text text-anchor="middle" x="307.5" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_normalize_dm</text>
</g>
<!-- proc~state_init&#45;&gt;m_normalize_dm -->
<g id="proc~~state_init~~UsesGraph_edge38" class="edge"><title>proc~state_init&#45;&gt;m_normalize_dm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.272,-1108.68C423.893,-1046.74 414.868,-769.659 363,-705 362.286,-704.11 361.53,-703.258 360.736,-702.442"/>
<polygon fill="#000000" stroke="#000000" points="362.716,-699.543 352.721,-696.028 358.342,-705.009 362.716,-699.543"/>
</g>
<!-- m_ts_options -->
<g id="proc~~state_init~~UsesGraph_node40" class="node"><title>m_ts_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="345.5,-654 269.5,-654 269.5,-630 345.5,-630 345.5,-654"/>
<text text-anchor="middle" x="307.5" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_options</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_options -->
<g id="proc~~state_init~~UsesGraph_edge39" class="edge"><title>proc~state_init&#45;&gt;m_ts_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.461,-1108.77C425.015,-1043.33 419.887,-734.905 363,-663 360.627,-660.001 357.77,-657.429 354.624,-655.225"/>
<polygon fill="#000000" stroke="#000000" points="356.178,-652.083 345.751,-650.204 352.731,-658.175 356.178,-652.083"/>
</g>
<!-- siesta_options -->
<g id="proc~~state_init~~UsesGraph_node41" class="node"><title>siesta_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="348,-612 267,-612 267,-588 348,-588 348,-612"/>
<text text-anchor="middle" x="307.5" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_options</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_options -->
<g id="proc~~state_init~~UsesGraph_edge40" class="edge"><title>proc~state_init&#45;&gt;siesta_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.617,-1108.58C426.033,-1039.21 424.839,-700.076 363,-621 361.155,-618.641 359.011,-616.547 356.661,-614.688"/>
<polygon fill="#000000" stroke="#000000" points="358.337,-611.607 348.013,-609.23 354.601,-617.527 358.337,-611.607"/>
</g>
<!-- create_Sparsity_SC -->
<g id="proc~~state_init~~UsesGraph_node42" class="node"><title>create_Sparsity_SC</title>
<polygon fill="#337ab7" stroke="#337ab7" points="361,-570 254,-570 254,-546 361,-546 361,-570"/>
<text text-anchor="middle" x="307.5" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">create_Sparsity_SC</text>
</g>
<!-- proc~state_init&#45;&gt;create_Sparsity_SC -->
<g id="proc~~state_init~~UsesGraph_edge41" class="edge"><title>proc~state_init&#45;&gt;create_Sparsity_SC</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.745,-1108.98C426.971,-1037.2 429.982,-665.5 363,-579 362.317,-578.118 361.592,-577.273 360.83,-576.464"/>
<polygon fill="#000000" stroke="#000000" points="363.046,-573.755 353.104,-570.095 358.594,-579.156 363.046,-573.755"/>
</g>
<!-- m_sparse -->
<g id="proc~~state_init~~UsesGraph_node43" class="node"><title>m_sparse</title>
<polygon fill="#337ab7" stroke="#337ab7" points="337.5,-528 277.5,-528 277.5,-504 337.5,-504 337.5,-528"/>
<text text-anchor="middle" x="307.5" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_sparse</text>
</g>
<!-- proc~state_init&#45;&gt;m_sparse -->
<g id="proc~~state_init~~UsesGraph_edge42" class="edge"><title>proc~state_init&#45;&gt;m_sparse</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M424.953,-1108.85C421.274,-1029.24 399.173,-584.111 363,-537 358.947,-531.722 353.391,-527.77 347.369,-524.811"/>
<polygon fill="#000000" stroke="#000000" points="348.254,-521.396 337.669,-520.931 345.654,-527.895 348.254,-521.396"/>
</g>
<!-- siesta_cml -->
<g id="proc~~state_init~~UsesGraph_node44" class="node"><title>siesta_cml</title>
<polygon fill="#337ab7" stroke="#337ab7" points="339,-486 276,-486 276,-462 339,-462 339,-486"/>
<text text-anchor="middle" x="307.5" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_cml</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_cml -->
<g id="proc~~state_init~~UsesGraph_edge43" class="edge"><title>proc~state_init&#45;&gt;siesta_cml</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.042,-1108.79C421.833,-1025.74 401.691,-545.762 363,-495 359.259,-490.092 354.217,-486.331 348.703,-483.448"/>
<polygon fill="#000000" stroke="#000000" points="349.698,-480.068 339.126,-479.38 346.961,-486.511 349.698,-480.068"/>
</g>
<!-- parallel -->
<g id="proc~~state_init~~UsesGraph_node45" class="node"><title>parallel</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-444 280.5,-444 280.5,-420 334.5,-420 334.5,-444"/>
<text text-anchor="middle" x="307.5" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">parallel</text>
</g>
<!-- proc~state_init&#45;&gt;parallel -->
<g id="proc~~state_init~~UsesGraph_edge44" class="edge"><title>proc~state_init&#45;&gt;parallel</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.124,-1108.81C422.367,-1022.65 404.225,-507.437 363,-453 358.328,-446.831 351.599,-442.474 344.454,-439.397"/>
<polygon fill="#000000" stroke="#000000" points="345.202,-435.95 334.607,-435.944 342.885,-442.556 345.202,-435.95"/>
</g>
<!-- module~m_mixing_scf -->
<g id="proc~~state_init~~UsesGraph_node46" class="node"><title>module~m_mixing_scf</title>
<g id="a_proc~~state_init~~UsesGraph_node46"><a xlink:href=".././module/m_mixing_scf.html" xlink:title="m_mixing_scf">
<polygon fill="#337ab7" stroke="#337ab7" points="346.5,-402 268.5,-402 268.5,-378 346.5,-378 346.5,-402"/>
<text text-anchor="middle" x="307.5" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mixing_scf</text>
</a>
</g>
</g>
<!-- proc~state_init&#45;&gt;module~m_mixing_scf -->
<g id="proc~~state_init~~UsesGraph_edge45" class="edge"><title>proc~state_init&#45;&gt;module~m_mixing_scf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.198,-1108.91C422.875,-1019.99 406.776,-469.137 363,-411 360.83,-408.118 358.21,-405.632 355.308,-403.486"/>
<polygon fill="#000000" stroke="#000000" points="356.91,-400.368 346.52,-398.299 353.352,-406.396 356.91,-400.368"/>
</g>
<!-- m_ts_charge -->
<g id="proc~~state_init~~UsesGraph_node47" class="node"><title>m_ts_charge</title>
<polygon fill="#337ab7" stroke="#337ab7" points="345,-360 270,-360 270,-336 345,-336 345,-360"/>
<text text-anchor="middle" x="307.5" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_charge</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_charge -->
<g id="proc~~state_init~~UsesGraph_edge46" class="edge"><title>proc~state_init&#45;&gt;m_ts_charge</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.258,-1108.79C423.327,-1016.51 409.294,-430.794 363,-369 360.54,-365.716 357.495,-362.945 354.113,-360.608"/>
<polygon fill="#000000" stroke="#000000" points="355.593,-357.427 345.149,-355.645 352.202,-363.551 355.593,-357.427"/>
</g>
<!-- m_iotdxv -->
<g id="proc~~state_init~~UsesGraph_node48" class="node"><title>m_iotdxv</title>
<polygon fill="#337ab7" stroke="#337ab7" points="335,-318 280,-318 280,-294 335,-294 335,-318"/>
<text text-anchor="middle" x="307.5" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_iotdxv</text>
</g>
<!-- proc~state_init&#45;&gt;m_iotdxv -->
<g id="proc~~state_init~~UsesGraph_edge47" class="edge"><title>proc~state_init&#45;&gt;m_iotdxv</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.313,-1108.72C423.762,-1013.32 411.823,-392.467 363,-327 358.457,-320.909 351.904,-316.584 344.907,-313.514"/>
<polygon fill="#000000" stroke="#000000" points="345.831,-310.128 335.237,-310.057 343.475,-316.719 345.831,-310.128"/>
</g>
<!-- zmatrix -->
<g id="proc~~state_init~~UsesGraph_node49" class="node"><title>zmatrix</title>
<polygon fill="#337ab7" stroke="#337ab7" points="334.5,-276 280.5,-276 280.5,-252 334.5,-252 334.5,-276"/>
<text text-anchor="middle" x="307.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">zmatrix</text>
</g>
<!-- proc~state_init&#45;&gt;zmatrix -->
<g id="proc~~state_init~~UsesGraph_edge48" class="edge"><title>proc~state_init&#45;&gt;zmatrix</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.364,-1108.7C424.178,-1010.4 414.363,-354.157 363,-285 358.386,-278.788 351.68,-274.413 344.539,-271.333"/>
<polygon fill="#000000" stroke="#000000" points="345.283,-267.885 334.688,-267.883 342.969,-274.491 345.283,-267.885"/>
</g>
<!-- m_hsparse -->
<g id="proc~~state_init~~UsesGraph_node50" class="node"><title>m_hsparse</title>
<polygon fill="#337ab7" stroke="#337ab7" points="340.5,-234 274.5,-234 274.5,-210 340.5,-210 340.5,-234"/>
<text text-anchor="middle" x="307.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_hsparse</text>
</g>
<!-- proc~state_init&#45;&gt;m_hsparse -->
<g id="proc~~state_init~~UsesGraph_edge49" class="edge"><title>proc~state_init&#45;&gt;m_hsparse</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.411,-1108.73C424.577,-1007.77 416.914,-315.861 363,-243 359.607,-238.415 355.074,-234.831 350.066,-232.03"/>
<polygon fill="#000000" stroke="#000000" points="351.235,-228.717 340.681,-227.785 348.35,-235.095 351.235,-228.717"/>
</g>
<!-- siesta_geom -->
<g id="proc~~state_init~~UsesGraph_node51" class="node"><title>siesta_geom</title>
<polygon fill="#337ab7" stroke="#337ab7" points="344,-192 271,-192 271,-168 344,-168 344,-192"/>
<text text-anchor="middle" x="307.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_geom</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_geom -->
<g id="proc~~state_init~~UsesGraph_edge50" class="edge"><title>proc~state_init&#45;&gt;siesta_geom</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.453,-1108.81C424.959,-1005.42 419.475,-277.582 363,-201 360.286,-197.32 356.837,-194.285 352.997,-191.782"/>
<polygon fill="#000000" stroke="#000000" points="354.577,-188.658 344.096,-187.107 351.322,-194.855 354.577,-188.658"/>
</g>
<!-- m_ts_tri_init -->
<g id="proc~~state_init~~UsesGraph_node52" class="node"><title>m_ts_tri_init</title>
<polygon fill="#337ab7" stroke="#337ab7" points="342.5,-150 272.5,-150 272.5,-126 342.5,-126 342.5,-150"/>
<text text-anchor="middle" x="307.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_tri_init</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_tri_init -->
<g id="proc~~state_init~~UsesGraph_edge51" class="edge"><title>proc~state_init&#45;&gt;m_ts_tri_init</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.492,-1108.93C425.322,-1003.36 422.047,-239.318 363,-159 360.04,-154.974 356.2,-151.72 351.929,-149.089"/>
<polygon fill="#000000" stroke="#000000" points="353.213,-145.82 342.698,-144.519 350.107,-152.093 353.213,-145.82"/>
</g>
<!-- write_subs -->
<g id="proc~~state_init~~UsesGraph_node53" class="node"><title>write_subs</title>
<polygon fill="#337ab7" stroke="#337ab7" points="339.5,-108 275.5,-108 275.5,-84 339.5,-84 339.5,-108"/>
<text text-anchor="middle" x="307.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_subs</text>
</g>
<!-- proc~state_init&#45;&gt;write_subs -->
<g id="proc~~state_init~~UsesGraph_edge52" class="edge"><title>proc~state_init&#45;&gt;write_subs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.527,-1108.74C425.664,-999.908 424.566,-200.981 363,-117 359.39,-112.075 354.462,-108.306 349.037,-105.42"/>
<polygon fill="#000000" stroke="#000000" points="350.151,-102.089 339.582,-101.35 347.384,-108.519 350.151,-102.089"/>
</g>
<!-- class_dSpData2D -->
<g id="proc~~state_init~~UsesGraph_node54" class="node"><title>class_dSpData2D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="356,-66 259,-66 259,-42 356,-42 356,-66"/>
<text text-anchor="middle" x="307.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dSpData2D</text>
</g>
<!-- proc~state_init&#45;&gt;class_dSpData2D -->
<g id="proc~~state_init~~UsesGraph_edge25" class="edge"><title>proc~state_init&#45;&gt;class_dSpData2D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.559,-1108.94C425.996,-998.344 427.157,-162.745 363,-75 362.437,-74.2301 361.842,-73.4884 361.218,-72.7739"/>
<polygon fill="#000000" stroke="#000000" points="363.401,-70.0342 353.559,-66.1118 358.807,-75.3157 363.401,-70.0342"/>
</g>
<!-- m_ts_kpoints -->
<g id="proc~~state_init~~UsesGraph_node55" class="node"><title>m_ts_kpoints</title>
<polygon fill="#337ab7" stroke="#337ab7" points="345.5,-24 269.5,-24 269.5,-0 345.5,-0 345.5,-24"/>
<text text-anchor="middle" x="307.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ts_kpoints</text>
</g>
<!-- proc~state_init&#45;&gt;m_ts_kpoints -->
<g id="proc~~state_init~~UsesGraph_edge54" class="edge"><title>proc~state_init&#45;&gt;m_ts_kpoints</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M425.589,-1108.81C426.316,-995.247 429.689,-124.428 363,-33 360.614,-29.7295 357.648,-26.9684 354.339,-24.6373"/>
<polygon fill="#000000" stroke="#000000" points="355.976,-21.5424 345.545,-19.6833 352.54,-27.6412 355.976,-21.5424"/>
</g>
<!-- precision -->
<g id="proc~~state_init~~UsesGraph_node56" class="node"><title>precision</title>
<polygon fill="#337ab7" stroke="#337ab7" points="88.5,-486 33.5,-486 33.5,-462 88.5,-462 88.5,-486"/>
<text text-anchor="middle" x="61" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">precision</text>
</g>
<!-- module~m_mixing&#45;&gt;precision -->
<g id="proc~~state_init~~UsesGraph_edge55" class="edge"><title>module~m_mixing&#45;&gt;precision</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M157.862,-441.53C140.216,-447.507 117.291,-455.272 98.2844,-461.71"/>
<polygon fill="#000000" stroke="#000000" points="97.0997,-458.416 88.7511,-464.939 99.3454,-465.046 97.0997,-458.416"/>
</g>
<!-- class_Fstack_dData1D -->
<g id="proc~~state_init~~UsesGraph_node57" class="node"><title>class_Fstack_dData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="122,-402 -7.10543e-15,-402 -7.10543e-15,-378 122,-378 122,-402"/>
<text text-anchor="middle" x="61" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_Fstack_dData1D</text>
</g>
<!-- module~m_mixing&#45;&gt;class_Fstack_dData1D -->
<g id="proc~~state_init~~UsesGraph_edge56" class="edge"><title>module~m_mixing&#45;&gt;class_Fstack_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M157.862,-422.47C142.929,-417.412 124.216,-411.073 107.296,-405.342"/>
<polygon fill="#000000" stroke="#000000" points="108.177,-401.945 97.5827,-402.052 105.931,-408.575 108.177,-401.945"/>
</g>
<!-- class_dData1D -->
<g id="proc~~state_init~~UsesGraph_node58" class="node"><title>class_dData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="103.5,-444 18.5,-444 18.5,-420 103.5,-420 103.5,-444"/>
<text text-anchor="middle" x="61" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dData1D</text>
</g>
<!-- module~m_mixing&#45;&gt;class_dData1D -->
<g id="proc~~state_init~~UsesGraph_edge57" class="edge"><title>module~m_mixing&#45;&gt;class_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M157.862,-432C144.858,-432 128.985,-432 113.928,-432"/>
<polygon fill="#000000" stroke="#000000" points="113.678,-428.5 103.678,-432 113.678,-435.5 113.678,-428.5"/>
</g>
<!-- module~m_mixing_scf&#45;&gt;module~m_mixing -->
<g id="proc~~state_init~~UsesGraph_edge59" class="edge"><title>module~m_mixing_scf&#45;&gt;module~m_mixing</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M272.543,-402.036C257.956,-407.205 240.852,-413.268 225.858,-418.582"/>
<polygon fill="#000000" stroke="#000000" points="224.614,-415.309 216.358,-421.949 226.953,-421.907 224.614,-415.309"/>
</g>
<!-- module~m_mixing_scf&#45;&gt;class_Fstack_dData1D -->
<g id="proc~~state_init~~UsesGraph_edge58" class="edge"><title>module~m_mixing_scf&#45;&gt;class_Fstack_dData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M268.297,-390C232.038,-390 176.66,-390 132.406,-390"/>
<polygon fill="#000000" stroke="#000000" points="132.281,-386.5 122.281,-390 132.281,-393.5 132.281,-386.5"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="490pt" height="32pt"
 viewBox="0.00 0.00 489.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 485.5,-28 485.5,4 -4,4"/>
<!-- Module -->
<g id="node1" class="node"><title>Module</title>
<polygon fill="#337ab7" stroke="#337ab7" points="54,-24 0,-24 0,-0 54,-0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Module</text>
</g>
<!-- Submodule -->
<g id="node2" class="node"><title>Submodule</title>
<polygon fill="#5bc0de" stroke="#5bc0de" points="139.5,-24 72.5,-24 72.5,-0 139.5,-0 139.5,-24"/>
<text text-anchor="middle" x="106" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Submodule</text>
</g>
<!-- Subroutine -->
<g id="node3" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="222,-24 158,-24 158,-0 222,-0 222,-24"/>
<text text-anchor="middle" x="190" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node4" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="294,-24 240,-24 240,-0 294,-0 294,-24"/>
<text text-anchor="middle" x="267" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="366,-24 312,-24 312,-0 366,-0 366,-24"/>
<text text-anchor="middle" x="339" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="481.5,-24 384.5,-24 384.5,-0 481.5,-0 481.5,-24"/>
<text text-anchor="middle" x="433" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a submodule to the (sub)module which it is
    descended from. Dashed arrows point from a module or program unit to 
    modules which it uses.
    </p>
    </div></div></div></div>
      </li>
      
      </ul>
    </div>
    


    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-istep%7E2"></span>integer</td>
  <td></td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>istep</strong></td><td></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
	<h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
	<div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~state_init~~CallsGraph Pages: 1 -->
<svg id="procstate_initCallsGraph" width="322pt" height="2254pt"
 viewBox="0.00 0.00 322.00 2254.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_init~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 2250)">
<title>proc~~state_init~~CallsGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-2250 318,-2250 318,4 -4,4"/>
<!-- proc~state_init -->
<g id="proc~~state_init~~CallsGraph_node1" class="node"><title>proc~state_init</title>
<polygon fill="none" stroke="black" points="55,-1133 0,-1133 0,-1109 55,-1109 55,-1133"/>
<text text-anchor="middle" x="27.5" y="-1118.6" font-family="Helvetica,sans-Serif" font-size="10.50">state_init</text>
</g>
<!-- ts_sparse_init -->
<g id="proc~~state_init~~CallsGraph_node2" class="node"><title>ts_sparse_init</title>
<polygon fill="#777777" stroke="#777777" points="193.5,-2246 114.5,-2246 114.5,-2222 193.5,-2222 193.5,-2246"/>
<text text-anchor="middle" x="154" y="-2231.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ts_sparse_init</text>
</g>
<!-- proc~state_init&#45;&gt;ts_sparse_init -->
<g id="proc~~state_init~~CallsGraph_edge1" class="edge"><title>proc~state_init&#45;&gt;ts_sparse_init</title>
<path fill="none" stroke="#000000" d="M28.3841,-1133.25C27.408,-1247.4 22.2002,-2122.63 91,-2213 94.7044,-2217.87 99.591,-2221.61 104.999,-2224.5"/>
<polygon fill="#000000" stroke="#000000" points="103.908,-2227.84 114.476,-2228.59 106.679,-2221.41 103.908,-2227.84"/>
</g>
<!-- ucell -->
<g id="proc~~state_init~~CallsGraph_node3" class="node"><title>ucell</title>
<polygon fill="#777777" stroke="#777777" points="181,-2204 127,-2204 127,-2180 181,-2180 181,-2204"/>
<text text-anchor="middle" x="154" y="-2189.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ucell</text>
</g>
<!-- proc~state_init&#45;&gt;ucell -->
<g id="proc~~state_init~~CallsGraph_edge2" class="edge"><title>proc~state_init&#45;&gt;ucell</title>
<path fill="none" stroke="#000000" d="M28.4145,-1133.13C27.734,-1244.3 24.8076,-2084.26 91,-2171 97.3083,-2179.27 107.028,-2184.31 116.914,-2187.37"/>
<polygon fill="#000000" stroke="#000000" points="116.185,-2190.8 126.735,-2189.82 117.881,-2184 116.185,-2190.8"/>
</g>
<!-- setup_kpoint_grid -->
<g id="proc~~state_init~~CallsGraph_node4" class="node"><title>setup_kpoint_grid</title>
<polygon fill="#777777" stroke="#777777" points="202.5,-2162 105.5,-2162 105.5,-2138 202.5,-2138 202.5,-2162"/>
<text text-anchor="middle" x="154" y="-2147.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_kpoint_grid</text>
</g>
<!-- proc~state_init&#45;&gt;setup_kpoint_grid -->
<g id="proc~~state_init~~CallsGraph_edge3" class="edge"><title>proc~state_init&#45;&gt;setup_kpoint_grid</title>
<path fill="none" stroke="#000000" d="M28.4457,-1133.32C28.068,-1242.75 27.4761,-2045.97 91,-2129 92.6616,-2131.17 94.5586,-2133.12 96.6321,-2134.87"/>
<polygon fill="#000000" stroke="#000000" points="95.1116,-2138.06 105.38,-2140.67 98.981,-2132.23 95.1116,-2138.06"/>
</g>
<!-- setup_dmhs_netcdf_file -->
<g id="proc~~state_init~~CallsGraph_node5" class="node"><title>setup_dmhs_netcdf_file</title>
<polygon fill="#777777" stroke="#777777" points="217,-2120 91,-2120 91,-2096 217,-2096 217,-2120"/>
<text text-anchor="middle" x="154" y="-2105.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_dmhs_netcdf_file</text>
</g>
<!-- proc~state_init&#45;&gt;setup_dmhs_netcdf_file -->
<g id="proc~~state_init~~CallsGraph_edge4" class="edge"><title>proc~state_init&#45;&gt;setup_dmhs_netcdf_file</title>
<path fill="none" stroke="#000000" d="M28.481,-1133.14C28.4172,-1239.3 30.0697,-2007.58 91,-2087 91.5902,-2087.77 92.2098,-2088.51 92.8564,-2089.22"/>
<polygon fill="#000000" stroke="#000000" points="90.8095,-2092.08 100.694,-2095.89 95.3459,-2086.75 90.8095,-2092.08"/>
</g>
<!-- ts_write_tshs -->
<g id="proc~~state_init~~CallsGraph_node6" class="node"><title>ts_write_tshs</title>
<polygon fill="#777777" stroke="#777777" points="191.5,-2078 116.5,-2078 116.5,-2054 191.5,-2054 191.5,-2078"/>
<text text-anchor="middle" x="154" y="-2063.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ts_write_tshs</text>
</g>
<!-- proc~state_init&#45;&gt;ts_write_tshs -->
<g id="proc~~state_init~~CallsGraph_edge5" class="edge"><title>proc~state_init&#45;&gt;ts_write_tshs</title>
<path fill="none" stroke="#000000" d="M28.519,-1133.26C28.7839,-1237.25 32.719,-1969.26 91,-2045 95.1909,-2050.45 100.861,-2054.49 107.078,-2057.49"/>
<polygon fill="#000000" stroke="#000000" points="105.882,-2060.78 116.469,-2061.19 108.444,-2054.27 105.882,-2060.78"/>
</g>
<!-- madelung -->
<g id="proc~~state_init~~CallsGraph_node7" class="node"><title>madelung</title>
<polygon fill="#777777" stroke="#777777" points="184,-2036 124,-2036 124,-2012 184,-2012 184,-2036"/>
<text text-anchor="middle" x="154" y="-2021.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">madelung</text>
</g>
<!-- proc~state_init&#45;&gt;madelung -->
<g id="proc~~state_init~~CallsGraph_edge6" class="edge"><title>proc~state_init&#45;&gt;madelung</title>
<path fill="none" stroke="#000000" d="M28.5593,-1133.02C29.1562,-1233.44 35.2986,-1930.85 91,-2003 96.7634,-2010.46 105.305,-2015.3 114.218,-2018.42"/>
<polygon fill="#000000" stroke="#000000" points="113.346,-2021.81 123.922,-2021.18 115.261,-2015.08 113.346,-2021.81"/>
</g>
<!-- bye -->
<g id="proc~~state_init~~CallsGraph_node8" class="node"><title>bye</title>
<polygon fill="#777777" stroke="#777777" points="181,-1994 127,-1994 127,-1970 181,-1970 181,-1994"/>
<text text-anchor="middle" x="154" y="-1979.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">bye</text>
</g>
<!-- proc~state_init&#45;&gt;bye -->
<g id="proc~~state_init~~CallsGraph_edge7" class="edge"><title>proc~state_init&#45;&gt;bye</title>
<path fill="none" stroke="#000000" d="M28.6047,-1133.06C29.5552,-1230.89 37.9284,-1892.51 91,-1961 97.3693,-1969.22 107.106,-1974.25 116.989,-1977.31"/>
<polygon fill="#000000" stroke="#000000" points="116.252,-1980.74 126.802,-1979.77 117.953,-1973.95 116.252,-1980.74"/>
</g>
<!-- mscell -->
<g id="proc~~state_init~~CallsGraph_node9" class="node"><title>mscell</title>
<polygon fill="#777777" stroke="#777777" points="181,-1952 127,-1952 127,-1928 181,-1928 181,-1952"/>
<text text-anchor="middle" x="154" y="-1937.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mscell</text>
</g>
<!-- proc~state_init&#45;&gt;mscell -->
<g id="proc~~state_init~~CallsGraph_edge8" class="edge"><title>proc~state_init&#45;&gt;mscell</title>
<path fill="none" stroke="#000000" d="M28.6545,-1133.06C29.9727,-1228.06 40.547,-1854.15 91,-1919 97.3853,-1927.21 107.127,-1932.23 117.009,-1935.3"/>
<polygon fill="#000000" stroke="#000000" points="116.269,-1938.72 126.82,-1937.76 117.971,-1931.93 116.269,-1938.72"/>
</g>
<!-- dict_repopulate_md -->
<g id="proc~~state_init~~CallsGraph_node10" class="node"><title>dict_repopulate_md</title>
<polygon fill="#777777" stroke="#777777" points="207.5,-1910 100.5,-1910 100.5,-1886 207.5,-1886 207.5,-1910"/>
<text text-anchor="middle" x="154" y="-1895.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dict_repopulate_md</text>
</g>
<!-- proc~state_init&#45;&gt;dict_repopulate_md -->
<g id="proc~~state_init~~CallsGraph_edge9" class="edge"><title>proc~state_init&#45;&gt;dict_repopulate_md</title>
<path fill="none" stroke="#000000" d="M28.7087,-1133C30.4083,-1224.94 43.1544,-1815.78 91,-1877 91.597,-1877.76 92.2231,-1878.5 92.8756,-1879.21"/>
<polygon fill="#000000" stroke="#000000" points="90.8551,-1882.08 100.761,-1885.84 95.3604,-1876.73 90.8551,-1882.08"/>
</g>
<!-- fname_tshs -->
<g id="proc~~state_init~~CallsGraph_node11" class="node"><title>fname_tshs</title>
<polygon fill="#777777" stroke="#777777" points="188,-1868 120,-1868 120,-1844 188,-1844 188,-1868"/>
<text text-anchor="middle" x="154" y="-1853.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">fname_tshs</text>
</g>
<!-- proc~state_init&#45;&gt;fname_tshs -->
<g id="proc~~state_init~~CallsGraph_edge10" class="edge"><title>proc~state_init&#45;&gt;fname_tshs</title>
<path fill="none" stroke="#000000" d="M28.7744,-1133.18C30.8936,-1222.73 45.7986,-1777.45 91,-1835 95.9355,-1841.28 102.837,-1845.7 110.252,-1848.8"/>
<polygon fill="#000000" stroke="#000000" points="109.216,-1852.15 119.81,-1852.07 111.479,-1845.52 109.216,-1852.15"/>
</g>
<!-- proximity_check -->
<g id="proc~~state_init~~CallsGraph_node12" class="node"><title>proximity_check</title>
<polygon fill="#777777" stroke="#777777" points="198.5,-1826 109.5,-1826 109.5,-1802 198.5,-1802 198.5,-1826"/>
<text text-anchor="middle" x="154" y="-1811.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">proximity_check</text>
</g>
<!-- proc~state_init&#45;&gt;proximity_check -->
<g id="proc~~state_init~~CallsGraph_edge11" class="edge"><title>proc~state_init&#45;&gt;proximity_check</title>
<path fill="none" stroke="#000000" d="M28.8395,-1133.01C31.3698,-1218.97 48.3805,-1739.04 91,-1793 93.6546,-1796.36 96.8713,-1799.19 100.427,-1801.56"/>
<polygon fill="#000000" stroke="#000000" points="98.7741,-1804.65 109.234,-1806.33 102.107,-1798.49 98.7741,-1804.65"/>
</g>
<!-- listhptr -->
<g id="proc~~state_init~~CallsGraph_node13" class="node"><title>listhptr</title>
<polygon fill="#777777" stroke="#777777" points="181,-1784 127,-1784 127,-1760 181,-1760 181,-1784"/>
<text text-anchor="middle" x="154" y="-1769.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">listhptr</text>
</g>
<!-- proc~state_init&#45;&gt;listhptr -->
<g id="proc~~state_init~~CallsGraph_edge12" class="edge"><title>proc~state_init&#45;&gt;listhptr</title>
<path fill="none" stroke="#000000" d="M28.919,-1133.04C31.9045,-1215.98 50.9935,-1700.66 91,-1751 97.47,-1759.14 107.235,-1764.14 117.114,-1767.21"/>
<polygon fill="#000000" stroke="#000000" points="116.361,-1770.63 126.913,-1769.68 118.071,-1763.85 116.361,-1770.63"/>
</g>
<!-- setup_ts_kpoint_grid -->
<g id="proc~~state_init~~CallsGraph_node14" class="node"><title>setup_ts_kpoint_grid</title>
<polygon fill="#777777" stroke="#777777" points="210,-1742 98,-1742 98,-1718 210,-1718 210,-1742"/>
<text text-anchor="middle" x="154" y="-1727.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_ts_kpoint_grid</text>
</g>
<!-- proc~state_init&#45;&gt;setup_ts_kpoint_grid -->
<g id="proc~~state_init~~CallsGraph_edge13" class="edge"><title>proc~state_init&#45;&gt;setup_ts_kpoint_grid</title>
<path fill="none" stroke="#000000" d="M29.0179,-1133.26C32.511,-1213.52 53.6295,-1662.32 91,-1709 91.7102,-1709.89 92.4596,-1710.74 93.2439,-1711.55"/>
<polygon fill="#000000" stroke="#000000" points="91.1655,-1714.37 101.135,-1717.96 95.5772,-1708.94 91.1655,-1714.37"/>
</g>
<!-- nsc -->
<g id="proc~~state_init~~CallsGraph_node15" class="node"><title>nsc</title>
<polygon fill="#777777" stroke="#777777" points="181,-1700 127,-1700 127,-1676 181,-1676 181,-1700"/>
<text text-anchor="middle" x="154" y="-1685.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nsc</text>
</g>
<!-- proc~state_init&#45;&gt;nsc -->
<g id="proc~~state_init~~CallsGraph_edge14" class="edge"><title>proc~state_init&#45;&gt;nsc</title>
<path fill="none" stroke="#000000" d="M29.1285,-1133.36C33.1524,-1210.5 56.2427,-1623.94 91,-1667 97.5312,-1675.09 107.314,-1680.08 117.19,-1683.15"/>
<polygon fill="#000000" stroke="#000000" points="116.427,-1686.57 126.98,-1685.63 118.144,-1679.78 116.427,-1686.57"/>
</g>
<!-- nscold -->
<g id="proc~~state_init~~CallsGraph_node16" class="node"><title>nscold</title>
<polygon fill="#777777" stroke="#777777" points="181,-1658 127,-1658 127,-1634 181,-1634 181,-1658"/>
<text text-anchor="middle" x="154" y="-1643.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nscold</text>
</g>
<!-- proc~state_init&#45;&gt;nscold -->
<g id="proc~~state_init~~CallsGraph_edge15" class="edge"><title>proc~state_init&#45;&gt;nscold</title>
<path fill="none" stroke="#000000" d="M28.3209,-1133.11C27.5393,-1202.21 26.9442,-1546.4 91,-1625 97.5154,-1632.99 107.203,-1637.96 116.994,-1641.04"/>
<polygon fill="#000000" stroke="#000000" points="116.151,-1644.44 126.707,-1643.53 117.891,-1637.66 116.151,-1644.44"/>
</g>
<!-- new_dm -->
<g id="proc~~state_init~~CallsGraph_node17" class="node"><title>new_dm</title>
<polygon fill="#777777" stroke="#777777" points="181,-1616 127,-1616 127,-1592 181,-1592 181,-1616"/>
<text text-anchor="middle" x="154" y="-1601.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">new_dm</text>
</g>
<!-- proc~state_init&#45;&gt;new_dm -->
<g id="proc~~state_init~~CallsGraph_edge16" class="edge"><title>proc~state_init&#45;&gt;new_dm</title>
<path fill="none" stroke="#000000" d="M28.4726,-1133.38C28.5704,-1199.6 32.1847,-1511.64 91,-1583 97.5596,-1590.96 107.26,-1595.91 117.05,-1598.99"/>
<polygon fill="#000000" stroke="#000000" points="116.199,-1602.39 126.756,-1601.49 117.944,-1595.61 116.199,-1602.39"/>
</g>
<!-- overlap -->
<g id="proc~~state_init~~CallsGraph_node18" class="node"><title>overlap</title>
<polygon fill="#777777" stroke="#777777" points="181,-1574 127,-1574 127,-1550 181,-1550 181,-1574"/>
<text text-anchor="middle" x="154" y="-1559.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">overlap</text>
</g>
<!-- proc~state_init&#45;&gt;overlap -->
<g id="proc~~state_init~~CallsGraph_edge17" class="edge"><title>proc~state_init&#45;&gt;overlap</title>
<path fill="none" stroke="#000000" d="M28.6524,-1133.06C29.6708,-1194.98 37.2374,-1476.65 91,-1541 97.6122,-1548.91 107.328,-1553.86 117.115,-1556.94"/>
<polygon fill="#000000" stroke="#000000" points="116.257,-1560.33 126.815,-1559.44 118.007,-1553.56 116.257,-1560.33"/>
</g>
<!-- crtsparsity_sc -->
<g id="proc~~state_init~~CallsGraph_node19" class="node"><title>crtsparsity_sc</title>
<polygon fill="#777777" stroke="#777777" points="193,-1532 115,-1532 115,-1508 193,-1508 193,-1532"/>
<text text-anchor="middle" x="154" y="-1517.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">crtsparsity_sc</text>
</g>
<!-- proc~state_init&#45;&gt;crtsparsity_sc -->
<g id="proc~~state_init~~CallsGraph_edge52" class="edge"><title>proc~state_init&#45;&gt;crtsparsity_sc</title>
<path fill="none" stroke="#000000" d="M28.8828,-1133.38C30.9379,-1192.08 42.4545,-1441.83 91,-1499 94.9115,-1503.61 99.8728,-1507.2 105.279,-1510.02"/>
<polygon fill="#000000" stroke="#000000" points="104.12,-1513.33 114.691,-1514.04 106.873,-1506.89 104.12,-1513.33"/>
</g>
<!-- ts_tri_analyze -->
<g id="proc~~state_init~~CallsGraph_node20" class="node"><title>ts_tri_analyze</title>
<polygon fill="#777777" stroke="#777777" points="193.5,-1490 114.5,-1490 114.5,-1466 193.5,-1466 193.5,-1490"/>
<text text-anchor="middle" x="154" y="-1475.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ts_tri_analyze</text>
</g>
<!-- proc~state_init&#45;&gt;ts_tri_analyze -->
<g id="proc~~state_init~~CallsGraph_edge18" class="edge"><title>proc~state_init&#45;&gt;ts_tri_analyze</title>
<path fill="none" stroke="#000000" d="M29.1455,-1133.08C32.2681,-1187.2 47.4787,-1406.78 91,-1457 94.9098,-1461.51 99.8256,-1465.06 105.17,-1467.84"/>
<polygon fill="#000000" stroke="#000000" points="103.898,-1471.1 114.467,-1471.84 106.667,-1464.67 103.898,-1471.1"/>
</g>
<!-- globalize_or -->
<g id="proc~~state_init~~CallsGraph_node21" class="node"><title>globalize_or</title>
<polygon fill="#777777" stroke="#777777" points="189,-1448 119,-1448 119,-1424 189,-1424 189,-1448"/>
<text text-anchor="middle" x="154" y="-1433.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">globalize_or</text>
</g>
<!-- proc~state_init&#45;&gt;globalize_or -->
<g id="proc~~state_init~~CallsGraph_edge19" class="edge"><title>proc~state_init&#45;&gt;globalize_or</title>
<path fill="none" stroke="#000000" d="M29.507,-1133.23C33.8597,-1183.26 52.5966,-1371.81 91,-1415 95.9323,-1420.55 102.383,-1424.63 109.257,-1427.64"/>
<polygon fill="#000000" stroke="#000000" points="108.196,-1430.97 118.79,-1431.1 110.589,-1424.4 108.196,-1430.97"/>
</g>
<!-- isc_off -->
<g id="proc~~state_init~~CallsGraph_node22" class="node"><title>isc_off</title>
<polygon fill="#777777" stroke="#777777" points="181,-1406 127,-1406 127,-1382 181,-1382 181,-1406"/>
<text text-anchor="middle" x="154" y="-1391.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">isc_off</text>
</g>
<!-- proc~state_init&#45;&gt;isc_off -->
<g id="proc~~state_init~~CallsGraph_edge20" class="edge"><title>proc~state_init&#45;&gt;isc_off</title>
<path fill="none" stroke="#000000" d="M29.9843,-1133.3C35.7024,-1178.8 57.6617,-1336.76 91,-1373 97.8522,-1380.45 107.441,-1385.26 117.032,-1388.36"/>
<polygon fill="#000000" stroke="#000000" points="116.349,-1391.8 126.914,-1391.02 118.165,-1385.04 116.349,-1391.8"/>
</g>
<!-- numh -->
<g id="proc~~state_init~~CallsGraph_node23" class="node"><title>numh</title>
<polygon fill="#777777" stroke="#777777" points="181,-1364 127,-1364 127,-1340 181,-1340 181,-1364"/>
<text text-anchor="middle" x="154" y="-1349.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">numh</text>
</g>
<!-- proc~state_init&#45;&gt;numh -->
<g id="proc~~state_init~~CallsGraph_edge21" class="edge"><title>proc~state_init&#45;&gt;numh</title>
<path fill="none" stroke="#000000" d="M28.4565,-1133.08C28.995,-1168.52 35.4469,-1273.33 91,-1331 97.9638,-1338.23 107.502,-1342.97 117.01,-1346.08"/>
<polygon fill="#000000" stroke="#000000" points="116.228,-1349.49 126.797,-1348.76 118.079,-1342.74 116.228,-1349.49"/>
</g>
<!-- xij_offset -->
<g id="proc~~state_init~~CallsGraph_node24" class="node"><title>xij_offset</title>
<polygon fill="#777777" stroke="#777777" points="181.5,-1322 126.5,-1322 126.5,-1298 181.5,-1298 181.5,-1322"/>
<text text-anchor="middle" x="154" y="-1307.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">xij_offset</text>
</g>
<!-- proc~state_init&#45;&gt;xij_offset -->
<g id="proc~~state_init~~CallsGraph_edge22" class="edge"><title>proc~state_init&#45;&gt;xij_offset</title>
<path fill="none" stroke="#000000" d="M29.5034,-1133.06C32.6845,-1163.56 45.2278,-1244.56 91,-1289 98.006,-1295.8 107.293,-1300.4 116.541,-1303.52"/>
<polygon fill="#000000" stroke="#000000" points="115.875,-1306.96 126.451,-1306.34 117.795,-1300.23 115.875,-1306.96"/>
</g>
<!-- outcoor -->
<g id="proc~~state_init~~CallsGraph_node25" class="node"><title>outcoor</title>
<polygon fill="#777777" stroke="#777777" points="181,-1280 127,-1280 127,-1256 181,-1256 181,-1280"/>
<text text-anchor="middle" x="154" y="-1265.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">outcoor</text>
</g>
<!-- proc~state_init&#45;&gt;outcoor -->
<g id="proc~~state_init~~CallsGraph_edge24" class="edge"><title>proc~state_init&#45;&gt;outcoor</title>
<path fill="none" stroke="#000000" d="M31.2528,-1133.33C37.4746,-1158.37 54.97,-1215.5 91,-1247 98.3511,-1253.43 107.752,-1257.91 116.998,-1261.02"/>
<polygon fill="#000000" stroke="#000000" points="116.287,-1264.46 126.867,-1263.89 118.243,-1257.74 116.287,-1264.46"/>
</g>
<!-- newdspdata2d -->
<g id="proc~~state_init~~CallsGraph_node26" class="node"><title>newdspdata2d</title>
<polygon fill="#777777" stroke="#777777" points="195,-1238 113,-1238 113,-1214 195,-1214 195,-1238"/>
<text text-anchor="middle" x="154" y="-1223.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newdspdata2d</text>
</g>
<!-- proc~state_init&#45;&gt;newdspdata2d -->
<g id="proc~~state_init~~CallsGraph_edge25" class="edge"><title>proc~state_init&#45;&gt;newdspdata2d</title>
<path fill="none" stroke="#000000" d="M34.4413,-1133.12C43.9433,-1151.29 64.246,-1185.54 91,-1205 94.8744,-1207.82 99.1541,-1210.28 103.6,-1212.42"/>
<polygon fill="#000000" stroke="#000000" points="102.314,-1215.68 112.885,-1216.39 105.064,-1209.24 102.314,-1215.68"/>
</g>
<!-- get_chess_parameter -->
<g id="proc~~state_init~~CallsGraph_node27" class="node"><title>get_chess_parameter</title>
<polygon fill="#777777" stroke="#777777" points="212.5,-1196 95.5,-1196 95.5,-1172 212.5,-1172 212.5,-1196"/>
<text text-anchor="middle" x="154" y="-1181.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">get_chess_parameter</text>
</g>
<!-- proc~state_init&#45;&gt;get_chess_parameter -->
<g id="proc~~state_init~~CallsGraph_edge26" class="edge"><title>proc~state_init&#45;&gt;get_chess_parameter</title>
<path fill="none" stroke="#000000" d="M44.2308,-1133.29C56.4584,-1142.41 74.1243,-1154.66 91,-1163 94.7822,-1164.87 98.7712,-1166.64 102.828,-1168.3"/>
<polygon fill="#000000" stroke="#000000" points="101.759,-1171.64 112.349,-1171.96 104.273,-1165.1 101.759,-1171.64"/>
</g>
<!-- time_io -->
<g id="proc~~state_init~~CallsGraph_node28" class="node"><title>time_io</title>
<polygon fill="#777777" stroke="#777777" points="181,-1154 127,-1154 127,-1130 181,-1130 181,-1154"/>
<text text-anchor="middle" x="154" y="-1139.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">time_io</text>
</g>
<!-- proc~state_init&#45;&gt;time_io -->
<g id="proc~~state_init~~CallsGraph_edge27" class="edge"><title>proc~state_init&#45;&gt;time_io</title>
<path fill="none" stroke="#000000" d="M55.2084,-1125.51C73.2181,-1128.54 97.1968,-1132.59 116.902,-1135.91"/>
<polygon fill="#000000" stroke="#000000" points="116.32,-1139.36 126.763,-1137.57 117.485,-1132.46 116.32,-1139.36"/>
</g>
<!-- superc -->
<g id="proc~~state_init~~CallsGraph_node29" class="node"><title>superc</title>
<polygon fill="#777777" stroke="#777777" points="181,-1112 127,-1112 127,-1088 181,-1088 181,-1112"/>
<text text-anchor="middle" x="154" y="-1097.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">superc</text>
</g>
<!-- proc~state_init&#45;&gt;superc -->
<g id="proc~~state_init~~CallsGraph_edge28" class="edge"><title>proc~state_init&#45;&gt;superc</title>
<path fill="none" stroke="#000000" d="M55.2084,-1116.49C73.2181,-1113.46 97.1968,-1109.41 116.902,-1106.09"/>
<polygon fill="#000000" stroke="#000000" points="117.485,-1109.54 126.763,-1104.43 116.32,-1102.64 117.485,-1109.54"/>
</g>
<!-- newdspdata1d -->
<g id="proc~~state_init~~CallsGraph_node30" class="node"><title>newdspdata1d</title>
<polygon fill="#777777" stroke="#777777" points="195,-1070 113,-1070 113,-1046 195,-1046 195,-1070"/>
<text text-anchor="middle" x="154" y="-1055.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newdspdata1d</text>
</g>
<!-- proc~state_init&#45;&gt;newdspdata1d -->
<g id="proc~~state_init~~CallsGraph_edge29" class="edge"><title>proc~state_init&#45;&gt;newdspdata1d</title>
<path fill="none" stroke="#000000" d="M44.2308,-1108.71C56.4584,-1099.59 74.1243,-1087.34 91,-1079 94.8395,-1077.1 98.8922,-1075.31 103.012,-1073.63"/>
<polygon fill="#000000" stroke="#000000" points="104.595,-1076.77 112.679,-1069.92 102.088,-1070.23 104.595,-1076.77"/>
</g>
<!-- write_debug -->
<g id="proc~~state_init~~CallsGraph_node31" class="node"><title>write_debug</title>
<polygon fill="#777777" stroke="#777777" points="189.5,-1028 118.5,-1028 118.5,-1004 189.5,-1004 189.5,-1028"/>
<text text-anchor="middle" x="154" y="-1013.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_debug</text>
</g>
<!-- proc~state_init&#45;&gt;write_debug -->
<g id="proc~~state_init~~CallsGraph_edge30" class="edge"><title>proc~state_init&#45;&gt;write_debug</title>
<path fill="none" stroke="#000000" d="M34.4413,-1108.88C43.9433,-1090.71 64.246,-1056.46 91,-1037 96.3076,-1033.14 102.376,-1029.95 108.591,-1027.33"/>
<polygon fill="#000000" stroke="#000000" points="110.253,-1030.45 118.391,-1023.66 107.799,-1023.89 110.253,-1030.45"/>
</g>
<!-- hsparse -->
<g id="proc~~state_init~~CallsGraph_node32" class="node"><title>hsparse</title>
<polygon fill="#777777" stroke="#777777" points="181,-986 127,-986 127,-962 181,-962 181,-986"/>
<text text-anchor="middle" x="154" y="-971.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">hsparse</text>
</g>
<!-- proc~state_init&#45;&gt;hsparse -->
<g id="proc~~state_init~~CallsGraph_edge31" class="edge"><title>proc~state_init&#45;&gt;hsparse</title>
<path fill="none" stroke="#000000" d="M31.2528,-1108.67C37.4746,-1083.63 54.97,-1026.5 91,-995 98.3511,-988.573 107.752,-984.094 116.998,-980.98"/>
<polygon fill="#000000" stroke="#000000" points="118.243,-984.264 126.867,-978.109 116.287,-977.542 118.243,-984.264"/>
</g>
<!-- timer -->
<g id="proc~~state_init~~CallsGraph_node33" class="node"><title>timer</title>
<polygon fill="#777777" stroke="#777777" points="181,-944 127,-944 127,-920 181,-920 181,-944"/>
<text text-anchor="middle" x="154" y="-929.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">timer</text>
</g>
<!-- proc~state_init&#45;&gt;timer -->
<g id="proc~~state_init~~CallsGraph_edge32" class="edge"><title>proc~state_init&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M29.5034,-1108.94C32.6845,-1078.44 45.2278,-997.438 91,-953 98.1411,-946.067 107.652,-941.42 117.076,-938.306"/>
<polygon fill="#000000" stroke="#000000" points="118.082,-941.659 126.762,-935.585 116.188,-934.92 118.082,-941.659"/>
</g>
<!-- ioxv -->
<g id="proc~~state_init~~CallsGraph_node34" class="node"><title>ioxv</title>
<polygon fill="#777777" stroke="#777777" points="181,-902 127,-902 127,-878 181,-878 181,-902"/>
<text text-anchor="middle" x="154" y="-887.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ioxv</text>
</g>
<!-- proc~state_init&#45;&gt;ioxv -->
<g id="proc~~state_init~~CallsGraph_edge33" class="edge"><title>proc~state_init&#45;&gt;ioxv</title>
<path fill="none" stroke="#000000" d="M28.4565,-1108.92C28.995,-1073.48 35.4469,-968.666 91,-911 97.9638,-903.771 107.502,-899.031 117.01,-895.922"/>
<polygon fill="#000000" stroke="#000000" points="118.079,-899.258 126.797,-893.238 116.228,-892.508 118.079,-899.258"/>
</g>
<!-- iotdxv -->
<g id="proc~~state_init~~CallsGraph_node35" class="node"><title>iotdxv</title>
<polygon fill="#777777" stroke="#777777" points="181,-860 127,-860 127,-836 181,-836 181,-860"/>
<text text-anchor="middle" x="154" y="-845.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">iotdxv</text>
</g>
<!-- proc~state_init&#45;&gt;iotdxv -->
<g id="proc~~state_init~~CallsGraph_edge34" class="edge"><title>proc~state_init&#45;&gt;iotdxv</title>
<path fill="none" stroke="#000000" d="M29.9843,-1108.7C35.7024,-1063.2 57.6617,-905.244 91,-869 97.8522,-861.551 107.441,-856.743 117.032,-853.64"/>
<polygon fill="#000000" stroke="#000000" points="118.165,-856.96 126.914,-850.985 116.349,-850.2 118.165,-856.96"/>
</g>
<!-- normalize_dm -->
<g id="proc~~state_init~~CallsGraph_node36" class="node"><title>normalize_dm</title>
<polygon fill="#777777" stroke="#777777" points="194,-818 114,-818 114,-794 194,-794 194,-818"/>
<text text-anchor="middle" x="154" y="-803.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">normalize_dm</text>
</g>
<!-- proc~state_init&#45;&gt;normalize_dm -->
<g id="proc~~state_init~~CallsGraph_edge35" class="edge"><title>proc~state_init&#45;&gt;normalize_dm</title>
<path fill="none" stroke="#000000" d="M29.507,-1108.77C33.8597,-1058.74 52.5966,-870.187 91,-827 94.7759,-822.754 99.442,-819.365 104.506,-816.661"/>
<polygon fill="#000000" stroke="#000000" points="106.211,-819.735 113.947,-812.496 103.385,-813.331 106.211,-819.735"/>
</g>
<!-- delete -->
<g id="proc~~state_init~~CallsGraph_node37" class="node"><title>delete</title>
<polygon fill="#777777" stroke="#777777" points="310.5,-653 256.5,-653 256.5,-629 310.5,-629 310.5,-653"/>
<text text-anchor="middle" x="283.5" y="-638.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">delete</text>
</g>
<!-- proc~state_init&#45;&gt;delete -->
<g id="proc~~state_init~~CallsGraph_edge36" class="edge"><title>proc~state_init&#45;&gt;delete</title>
<path fill="none" stroke="#000000" d="M29.1061,-1108.88C32.0583,-1054.62 46.6394,-834.48 91,-785 130.045,-741.449 170.617,-782.635 217,-747 245.669,-724.974 264.821,-686.53 274.664,-662.492"/>
<polygon fill="#000000" stroke="#000000" points="277.93,-663.75 278.313,-653.162 271.411,-661.2 277.93,-663.75"/>
</g>
<!-- file_exist -->
<g id="proc~~state_init~~CallsGraph_node38" class="node"><title>file_exist</title>
<polygon fill="#777777" stroke="#777777" points="181,-738 127,-738 127,-714 181,-714 181,-738"/>
<text text-anchor="middle" x="154" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">file_exist</text>
</g>
<!-- proc~state_init&#45;&gt;file_exist -->
<g id="proc~~state_init~~CallsGraph_edge37" class="edge"><title>proc~state_init&#45;&gt;file_exist</title>
<path fill="none" stroke="#000000" d="M29.011,-1108.98C31.655,-1051.99 45.464,-809.388 91,-752 97.5839,-743.702 107.291,-738.02 117.08,-734.142"/>
<polygon fill="#000000" stroke="#000000" points="118.447,-737.374 126.783,-730.835 116.189,-730.748 118.447,-737.374"/>
</g>
<!-- sp_to_spglobal -->
<g id="proc~~state_init~~CallsGraph_node39" class="node"><title>sp_to_spglobal</title>
<polygon fill="#777777" stroke="#777777" points="196.5,-696 111.5,-696 111.5,-672 196.5,-672 196.5,-696"/>
<text text-anchor="middle" x="154" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sp_to_spglobal</text>
</g>
<!-- proc~state_init&#45;&gt;sp_to_spglobal -->
<g id="proc~~state_init~~CallsGraph_edge38" class="edge"><title>proc~state_init&#45;&gt;sp_to_spglobal</title>
<path fill="none" stroke="#000000" d="M28.6767,-1108.64C29.8074,-1046.49 37.8108,-768.577 91,-705 94.1607,-701.222 98.0285,-698.121 102.273,-695.577"/>
<polygon fill="#000000" stroke="#000000" points="103.972,-698.642 111.41,-691.097 100.89,-692.357 103.972,-698.642"/>
</g>
<!-- init_val -->
<g id="proc~~state_init~~CallsGraph_node40" class="node"><title>init_val</title>
<polygon fill="#777777" stroke="#777777" points="181,-654 127,-654 127,-630 181,-630 181,-654"/>
<text text-anchor="middle" x="154" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">init_val</text>
</g>
<!-- proc~state_init&#45;&gt;init_val -->
<g id="proc~~state_init~~CallsGraph_edge39" class="edge"><title>proc~state_init&#45;&gt;init_val</title>
<path fill="none" stroke="#000000" d="M28.4885,-1108.73C28.669,-1043.08 32.6437,-733.718 91,-663 97.5642,-655.045 107.266,-650.091 117.055,-647.01"/>
<polygon fill="#000000" stroke="#000000" points="117.95,-650.394 126.761,-644.512 116.205,-643.615 117.95,-650.394"/>
</g>
<!-- sporb_to_spatom -->
<g id="proc~~state_init~~CallsGraph_node41" class="node"><title>sporb_to_spatom</title>
<polygon fill="#777777" stroke="#777777" points="202,-612 106,-612 106,-588 202,-588 202,-612"/>
<text text-anchor="middle" x="154" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sporb_to_spatom</text>
</g>
<!-- proc~state_init&#45;&gt;sporb_to_spatom -->
<g id="proc~~state_init~~CallsGraph_edge40" class="edge"><title>proc~state_init&#45;&gt;sporb_to_spatom</title>
<path fill="none" stroke="#000000" d="M28.3352,-1108.99C27.6333,-1040.43 27.4068,-698.955 91,-621 92.8857,-618.688 95.0366,-616.63 97.3785,-614.797"/>
<polygon fill="#000000" stroke="#000000" points="99.3666,-617.682 105.969,-609.395 95.6401,-611.756 99.3666,-617.682"/>
</g>
<!-- escf -->
<g id="proc~~state_init~~CallsGraph_node42" class="node"><title>escf</title>
<polygon fill="#777777" stroke="#777777" points="181,-570 127,-570 127,-546 181,-546 181,-570"/>
<text text-anchor="middle" x="154" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">escf</text>
</g>
<!-- proc~state_init&#45;&gt;escf -->
<g id="proc~~state_init~~CallsGraph_edge41" class="edge"><title>proc~state_init&#45;&gt;escf</title>
<path fill="none" stroke="#000000" d="M28.2048,-1108.94C26.6833,-1036.93 22.2501,-664.102 91,-579 97.5346,-570.911 107.319,-565.922 117.194,-562.85"/>
<polygon fill="#000000" stroke="#000000" points="118.148,-566.219 126.983,-560.373 116.43,-559.433 118.148,-566.219"/>
</g>
<!-- domaindecom -->
<g id="proc~~state_init~~CallsGraph_node43" class="node"><title>domaindecom</title>
<polygon fill="#777777" stroke="#777777" points="194,-528 114,-528 114,-504 194,-504 194,-528"/>
<text text-anchor="middle" x="154" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">domaindecom</text>
</g>
<!-- proc~state_init&#45;&gt;domaindecom -->
<g id="proc~~state_init~~CallsGraph_edge42" class="edge"><title>proc~state_init&#45;&gt;domaindecom</title>
<path fill="none" stroke="#000000" d="M29.0236,-1108.83C32.5531,-1029.11 53.8642,-583.356 91,-537 94.5971,-532.51 99.1961,-528.974 104.26,-526.192"/>
<polygon fill="#000000" stroke="#000000" points="106.056,-529.223 113.762,-521.952 103.203,-522.831 106.056,-529.223"/>
</g>
<!-- siesta_write_positions -->
<g id="proc~~state_init~~CallsGraph_node44" class="node"><title>siesta_write_positions</title>
<polygon fill="#777777" stroke="#777777" points="212.5,-486 95.5,-486 95.5,-462 212.5,-462 212.5,-486"/>
<text text-anchor="middle" x="154" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_write_positions</text>
</g>
<!-- proc~state_init&#45;&gt;siesta_write_positions -->
<g id="proc~~state_init~~CallsGraph_edge43" class="edge"><title>proc~state_init&#45;&gt;siesta_write_positions</title>
<path fill="none" stroke="#000000" d="M28.934,-1108.77C31.9863,-1025.6 51.2719,-544.954 91,-495 91.7074,-494.111 92.4541,-493.259 93.236,-492.442"/>
<polygon fill="#000000" stroke="#000000" points="95.5711,-495.054 101.111,-486.023 91.1485,-489.629 95.5711,-495.054"/>
</g>
<!-- proc~mixers_history_init -->
<g id="proc~~state_init~~CallsGraph_node45" class="node"><title>proc~mixers_history_init</title>
<g id="a_proc~~state_init~~CallsGraph_node45"><a xlink:href=".././proc/mixers_history_init.html" xlink:title="mixers_history_init">
<polygon fill="#d9534f" stroke="#d9534f" points="204.5,-444 103.5,-444 103.5,-420 204.5,-420 204.5,-444"/>
<text text-anchor="middle" x="154" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mixers_history_init</text>
</a>
</g>
</g>
<!-- proc~state_init&#45;&gt;proc~mixers_history_init -->
<g id="proc~~state_init~~CallsGraph_edge44" class="edge"><title>proc~state_init&#45;&gt;proc~mixers_history_init</title>
<path fill="none" stroke="#000000" d="M28.8526,-1108.79C31.4458,-1022.51 48.6623,-506.577 91,-453 92.2683,-451.395 93.6648,-449.912 95.1651,-448.541"/>
<polygon fill="#000000" stroke="#000000" points="97.3582,-451.275 103.42,-442.586 93.2624,-445.598 97.3582,-451.275"/>
</g>
<!-- volcel -->
<g id="proc~~state_init~~CallsGraph_node46" class="node"><title>volcel</title>
<polygon fill="#777777" stroke="#777777" points="181,-402 127,-402 127,-378 181,-378 181,-402"/>
<text text-anchor="middle" x="154" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">volcel</text>
</g>
<!-- proc~state_init&#45;&gt;volcel -->
<g id="proc~~state_init~~CallsGraph_edge45" class="edge"><title>proc~state_init&#45;&gt;volcel</title>
<path fill="none" stroke="#000000" d="M28.7791,-1108.89C30.9321,-1019.84 46.0359,-468.222 91,-411 97.4248,-402.824 107.177,-397.809 117.058,-394.741"/>
<polygon fill="#000000" stroke="#000000" points="118.018,-398.109 126.863,-392.277 116.312,-391.32 118.018,-398.109"/>
</g>
<!-- val -->
<g id="proc~~state_init~~CallsGraph_node47" class="node"><title>val</title>
<polygon fill="#777777" stroke="#777777" points="181,-360 127,-360 127,-336 181,-336 181,-360"/>
<text text-anchor="middle" x="154" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">val</text>
</g>
<!-- proc~state_init&#45;&gt;val -->
<g id="proc~~state_init~~CallsGraph_edge46" class="edge"><title>proc~state_init&#45;&gt;val</title>
<path fill="none" stroke="#000000" d="M28.7186,-1108.77C30.473,-1016.36 43.443,-429.827 91,-369 97.4048,-360.808 107.152,-355.789 117.033,-352.722"/>
<polygon fill="#000000" stroke="#000000" points="117.994,-356.089 126.841,-350.26 116.29,-349.3 117.994,-356.089"/>
</g>
<!-- attach -->
<g id="proc~~state_init~~CallsGraph_node48" class="node"><title>attach</title>
<polygon fill="#777777" stroke="#777777" points="181,-318 127,-318 127,-294 181,-294 181,-318"/>
<text text-anchor="middle" x="154" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">attach</text>
</g>
<!-- proc~state_init&#45;&gt;attach -->
<g id="proc~~state_init~~CallsGraph_edge47" class="edge"><title>proc~state_init&#45;&gt;attach</title>
<path fill="none" stroke="#000000" d="M28.6629,-1108.7C30.0318,-1013.16 40.8388,-391.448 91,-327 97.3869,-318.794 107.129,-313.771 117.011,-310.705"/>
<polygon fill="#000000" stroke="#000000" points="117.973,-314.072 126.822,-308.244 116.271,-307.282 117.973,-314.072"/>
</g>
<!-- newddata2d -->
<g id="proc~~state_init~~CallsGraph_node49" class="node"><title>newddata2d</title>
<polygon fill="#777777" stroke="#777777" points="189.5,-276 118.5,-276 118.5,-252 189.5,-252 189.5,-276"/>
<text text-anchor="middle" x="154" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newddata2d</text>
</g>
<!-- proc~state_init&#45;&gt;newddata2d -->
<g id="proc~~state_init~~CallsGraph_edge48" class="edge"><title>proc~state_init&#45;&gt;newddata2d</title>
<path fill="none" stroke="#000000" d="M28.6087,-1108.99C29.5908,-1011.63 38.1676,-353.156 91,-285 95.5953,-279.072 101.942,-274.805 108.832,-271.736"/>
<polygon fill="#000000" stroke="#000000" points="110.241,-274.948 118.45,-268.251 107.856,-268.367 110.241,-274.948"/>
</g>
<!-- newsparsity -->
<g id="proc~~state_init~~CallsGraph_node50" class="node"><title>newsparsity</title>
<polygon fill="#777777" stroke="#777777" points="188.5,-234 119.5,-234 119.5,-210 188.5,-210 188.5,-234"/>
<text text-anchor="middle" x="154" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">newsparsity</text>
</g>
<!-- proc~state_init&#45;&gt;newsparsity -->
<g id="proc~~state_init~~CallsGraph_edge49" class="edge"><title>proc~state_init&#45;&gt;newsparsity</title>
<path fill="none" stroke="#000000" d="M28.5651,-1108.71C29.2043,-1007.6 35.5968,-314.735 91,-243 95.8355,-236.739 102.625,-232.33 109.949,-229.229"/>
<polygon fill="#000000" stroke="#000000" points="111.098,-232.536 119.405,-225.96 108.81,-225.92 111.098,-232.536"/>
</g>
<!-- write_zmatrix -->
<g id="proc~~state_init~~CallsGraph_node51" class="node"><title>write_zmatrix</title>
<polygon fill="#777777" stroke="#777777" points="192,-192 116,-192 116,-168 192,-168 192,-192"/>
<text text-anchor="middle" x="154" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_zmatrix</text>
</g>
<!-- proc~state_init&#45;&gt;write_zmatrix -->
<g id="proc~~state_init~~CallsGraph_edge50" class="edge"><title>proc~state_init&#45;&gt;write_zmatrix</title>
<path fill="none" stroke="#000000" d="M28.5227,-1108.79C28.8181,-1005.25 32.9591,-276.402 91,-201 95.0033,-195.799 100.355,-191.876 106.244,-188.919"/>
<polygon fill="#000000" stroke="#000000" points="107.879,-192.033 115.823,-185.023 105.241,-185.549 107.879,-192.033"/>
</g>
<!-- chess_init -->
<g id="proc~~state_init~~CallsGraph_node52" class="node"><title>chess_init</title>
<polygon fill="#777777" stroke="#777777" points="184,-150 124,-150 124,-126 184,-126 184,-150"/>
<text text-anchor="middle" x="154" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">chess_init</text>
</g>
<!-- proc~state_init&#45;&gt;chess_init -->
<g id="proc~~state_init~~CallsGraph_edge51" class="edge"><title>proc~state_init&#45;&gt;chess_init</title>
<path fill="none" stroke="#000000" d="M28.4844,-1108.91C28.4506,-1003.19 30.3104,-238.084 91,-159 96.7415,-151.518 105.276,-146.68 114.188,-143.559"/>
<polygon fill="#000000" stroke="#000000" points="115.232,-146.901 123.894,-140.801 113.318,-140.167 115.232,-146.901"/>
</g>
<!-- setup_dm_netcdf_file -->
<g id="proc~~state_init~~CallsGraph_node53" class="node"><title>setup_dm_netcdf_file</title>
<polygon fill="#777777" stroke="#777777" points="211.5,-108 96.5,-108 96.5,-84 211.5,-84 211.5,-108"/>
<text text-anchor="middle" x="154" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_dm_netcdf_file</text>
</g>
<!-- proc~state_init&#45;&gt;setup_dm_netcdf_file -->
<g id="proc~~state_init~~CallsGraph_edge23" class="edge"><title>proc~state_init&#45;&gt;setup_dm_netcdf_file</title>
<path fill="none" stroke="#000000" d="M28.4491,-1108.73C28.1009,-999.732 27.7171,-199.695 91,-117 91.5892,-116.23 92.208,-115.488 92.8538,-114.773"/>
<polygon fill="#000000" stroke="#000000" points="95.3439,-117.25 100.684,-108.099 90.8033,-111.922 95.3439,-117.25"/>
</g>
<!-- setup_ordern_indexes -->
<g id="proc~~state_init~~CallsGraph_node54" class="node"><title>setup_ordern_indexes</title>
<polygon fill="#777777" stroke="#777777" points="213.5,-66 94.5,-66 94.5,-42 213.5,-42 213.5,-66"/>
<text text-anchor="middle" x="154" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">setup_ordern_indexes</text>
</g>
<!-- proc~state_init&#45;&gt;setup_ordern_indexes -->
<g id="proc~~state_init~~CallsGraph_edge53" class="edge"><title>proc~state_init&#45;&gt;setup_ordern_indexes</title>
<path fill="none" stroke="#000000" d="M28.4177,-1108.92C27.7661,-998.166 25.0491,-161.404 91,-75 91.5883,-74.2293 92.2062,-73.4867 92.8511,-72.771"/>
<polygon fill="#000000" stroke="#000000" points="95.3419,-75.2466 100.675,-66.092 90.797,-69.9227 95.3419,-75.2466"/>
</g>
<!-- re_alloc -->
<g id="proc~~state_init~~CallsGraph_node55" class="node"><title>re_alloc</title>
<polygon fill="#777777" stroke="#777777" points="181,-24 127,-24 127,-0 181,-0 181,-24"/>
<text text-anchor="middle" x="154" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">re_alloc</text>
</g>
<!-- proc~state_init&#45;&gt;re_alloc -->
<g id="proc~~state_init~~CallsGraph_edge54" class="edge"><title>proc~state_init&#45;&gt;re_alloc</title>
<path fill="none" stroke="#000000" d="M28.3872,-1108.79C27.4397,-995.065 22.4419,-123.034 91,-33 97.2997,-24.7269 107.017,-19.685 116.903,-16.6214"/>
<polygon fill="#000000" stroke="#000000" points="117.871,-19.9874 126.726,-14.1708 116.176,-13.1956 117.871,-19.9874"/>
</g>
<!-- proc~mixers_history_init&#45;&gt;delete -->
<g id="proc~~state_init~~CallsGraph_edge55" class="edge"><title>proc~mixers_history_init&#45;&gt;delete</title>
<path fill="none" stroke="#000000" d="M204.525,-443.944C209.097,-446.416 213.368,-449.4 217,-453 263.468,-499.067 277.029,-579.811 280.941,-618.752"/>
<polygon fill="#000000" stroke="#000000" points="277.479,-619.333 281.84,-628.989 284.452,-618.721 277.479,-619.333"/>
</g>
<!-- proc~current_itt -->
<g id="proc~~state_init~~CallsGraph_node56" class="node"><title>proc~current_itt</title>
<g id="a_proc~~state_init~~CallsGraph_node56"><a xlink:href=".././proc/current_itt.html" xlink:title="current_itt">
<polygon fill="#d94e8f" stroke="#d94e8f" points="314,-465 253,-465 253,-441 314,-441 314,-465"/>
<text text-anchor="middle" x="283.5" y="-450.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">current_itt</text>
</a>
</g>
</g>
<!-- proc~mixers_history_init&#45;&gt;proc~current_itt -->
<g id="proc~~state_init~~CallsGraph_edge56" class="edge"><title>proc~mixers_history_init&#45;&gt;proc~current_itt</title>
<path fill="none" stroke="#000000" d="M204.66,-440.179C217.206,-442.246 230.52,-444.439 242.521,-446.415"/>
<polygon fill="#000000" stroke="#000000" points="242.241,-449.916 252.677,-448.088 243.379,-443.009 242.241,-449.916"/>
</g>
<!-- new -->
<g id="proc~~state_init~~CallsGraph_node57" class="node"><title>new</title>
<polygon fill="#777777" stroke="#777777" points="310.5,-423 256.5,-423 256.5,-399 310.5,-399 310.5,-423"/>
<text text-anchor="middle" x="283.5" y="-408.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">new</text>
</g>
<!-- proc~mixers_history_init&#45;&gt;new -->
<g id="proc~~state_init~~CallsGraph_edge57" class="edge"><title>proc~mixers_history_init&#45;&gt;new</title>
<path fill="none" stroke="#000000" d="M204.66,-423.821C218.563,-421.531 233.408,-419.086 246.366,-416.951"/>
<polygon fill="#000000" stroke="#000000" points="247.001,-420.394 256.299,-415.315 245.863,-413.487 247.001,-420.394"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,-0 64,-0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,-0 136,-0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node"><title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,-0 209.5,-0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node"><title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,-0 364,-0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,-0 436,-0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="551.5,-24 454.5,-24 454.5,-0 551.5,-0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <div class="panel panel-default">
      <div class="panel-heading">
	<h3 class="panel-title">Called by</h3>
      </div>
      <div class="panel-body">
	<div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~state_init~~CalledByGraph Pages: 1 -->
<svg id="procstate_initCalledByGraph" width="175pt" height="32pt"
 viewBox="0.00 0.00 175.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_init~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>proc~~state_init~~CalledByGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 171,-28 171,4 -4,4"/>
<!-- proc~state_init -->
<g id="proc~~state_init~~CalledByGraph_node1" class="node"><title>proc~state_init</title>
<polygon fill="none" stroke="black" points="167,-24 112,-24 112,-0 167,-0 167,-24"/>
<text text-anchor="middle" x="139.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">state_init</text>
</g>
<!-- proc~siesta_forces -->
<g id="proc~~state_init~~CalledByGraph_node2" class="node"><title>proc~siesta_forces</title>
<g id="a_proc~~state_init~~CalledByGraph_node2"><a xlink:href=".././proc/siesta_forces.html" xlink:title="siesta_forces">
<polygon fill="#d9534f" stroke="#d9534f" points="76,-24 0,-24 0,-0 76,-0 76,-24"/>
<text text-anchor="middle" x="38" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_forces</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~state_init -->
<g id="proc~~state_init~~CalledByGraph_edge1" class="edge"><title>proc~siesta_forces&#45;&gt;proc~state_init</title>
<path fill="none" stroke="#000000" d="M76.0501,-12C84.4416,-12 93.3497,-12 101.73,-12"/>
<polygon fill="#000000" stroke="#000000" points="101.983,-15.5001 111.983,-12 101.983,-8.5001 101.983,-15.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,-0 64,-0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,-0 136,-0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node"><title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,-0 209.5,-0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node"><title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,-0 364,-0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,-0 436,-0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="551.5,-24 454.5,-24 454.5,-0 551.5,-0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      




















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/state_init.html#src">state_init</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>      <span class="k">subroutine </span><span class="n">state_init</span><span class="p">(</span> <span class="n">istep</span> <span class="p">)</span>
      <span class="k">use </span><span class="n">Kpoint_grid</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">setup_Kpoint_grid</span><span class="p">,</span> <span class="n">nkpnt</span>
      <span class="k">use </span><span class="n">m_os</span><span class="p">,</span>              <span class="n">only</span><span class="p">:</span> <span class="n">file_exist</span>
      <span class="k">use </span><span class="n">m_new_dm</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">new_dm</span>
      <span class="k">use </span><span class="n">m_proximity_check</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">proximity_check</span>
      <span class="k">use </span><span class="n">siesta_options</span>
      <span class="k">use </span><span class="n">units</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Ang</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">listhptr</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Dold</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">DM_2D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Eold</span><span class="p">,</span> <span class="n">Escf</span><span class="p">,</span> <span class="n">EDM_2D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Hold</span><span class="p">,</span> <span class="n">H</span>   <span class="p">,</span> <span class="n">H_2D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">xijo</span><span class="p">,</span> <span class="n">xij_2D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">S</span>   <span class="p">,</span> <span class="n">S_1D</span>

      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">H_kin_1D</span><span class="p">,</span> <span class="n">H_vkb_1D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">H_ldau_2D</span><span class="p">,</span> <span class="n">H_so_2D</span>

      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">sparse_pattern</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">block_dist</span><span class="p">,</span> <span class="n">single_dist</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">DM_history</span>


      <span class="k">use </span><span class="n">create_Sparsity_SC</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">crtSparsity_SC</span>
      <span class="k">use </span><span class="n">m_sparsity_handling</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">SpOrb_to_SpAtom</span>
      <span class="k">use </span><span class="n">m_sparsity_handling</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Sp_to_Spglobal</span>
      <span class="k">use </span><span class="n">m_pivot_methods</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">sp2graphviz</span>

      <span class="k">use </span><span class="n">siesta_geom</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">iphkb</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span>
     <span class="p">&amp;</span>                             <span class="n">rmaxo</span><span class="p">,</span> <span class="n">rmaxkb</span><span class="p">,</span> <span class="n">rmaxv</span><span class="p">,</span> <span class="n">rmaxldau</span><span class="p">,</span>
     <span class="p">&amp;</span>                             <span class="n">lastkb</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">superc</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>                             <span class="n">no_u</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">iza</span><span class="p">,</span> <span class="n">qtots</span>
      <span class="k">use </span><span class="n">alloc</span><span class="p">,</span>             <span class="n">only</span><span class="p">:</span> <span class="n">re_alloc</span><span class="p">,</span> <span class="n">de_alloc</span><span class="p">,</span> <span class="n">alloc_report</span>
      <span class="k">use </span><span class="n">m_hsparse</span><span class="p">,</span>         <span class="n">only</span><span class="p">:</span> <span class="n">hsparse</span>
      <span class="k">use </span><span class="n">m_overlap</span><span class="p">,</span>         <span class="n">only</span><span class="p">:</span> <span class="n">overlap</span>
      <span class="k">use </span><span class="n">m_supercell</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">exact_sc_ag</span>
      <span class="k">use </span><span class="n">siesta_cml</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">cml_p</span><span class="p">,</span> <span class="n">cmlStartStep</span><span class="p">,</span> <span class="n">mainXML</span>
      <span class="k">use </span><span class="n">zmatrix</span><span class="p">,</span>           <span class="n">only</span><span class="p">:</span> <span class="n">lUseZmatrix</span><span class="p">,</span> <span class="n">write_zmatrix</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">Emad</span>
      <span class="k">use </span><span class="n">write_subs</span>
      <span class="k">use </span><span class="n">m_ioxv</span><span class="p">,</span>            <span class="n">only</span><span class="p">:</span> <span class="n">ioxv</span>
      <span class="k">use </span><span class="n">m_iotdxv</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">iotdxv</span>
      <span class="k">use </span><span class="n">m_steps</span>
      <span class="k">use </span><span class="n">parallel</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">IOnode</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">BlockSize</span>
      <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>            <span class="n">only</span><span class="p">:</span> <span class="n">spin</span>
      <span class="k">use </span><span class="n">m_rmaxh</span>
      <span class="k">use </span><span class="n">m_mixing</span><span class="p">,</span>          <span class="n">only</span><span class="p">:</span> <span class="n">mixers_history_init</span>
      <span class="k">use </span><span class="n">m_mixing_scf</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">scf_mixs</span><span class="p">,</span> <span class="n">scf_mix</span>

      <span class="k">use </span><span class="n">m_normalize_dm</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">normalize_dm</span>

      <span class="k">use </span><span class="n">m_eo</span>
      <span class="k">use </span><span class="n">m_gamma</span>
      <span class="k">use </span><span class="n">files</span><span class="p">,</span>             <span class="n">only</span><span class="p">:</span> <span class="n">slabel</span>
      <span class="k">use </span><span class="n">m_mpi_utils</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">globalize_or</span>
      <span class="k">use </span><span class="n">m_mpi_utils</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">globalize_max</span>
      <span class="k">use </span><span class="n">domain_decom</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">domainDecom</span><span class="p">,</span> <span class="n">use_dd</span><span class="p">,</span> <span class="n">use_dd_perm</span>
      <span class="k">use </span><span class="n">ldau_specs</span><span class="p">,</span>        <span class="n">only</span><span class="p">:</span> <span class="n">switch_ldau</span><span class="p">,</span> <span class="n">ldau_init</span>

      <span class="k">use </span><span class="n">m_sparse</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">xij_offset</span>

      <span class="k">use </span><span class="n">m_ts_kpoints</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">setup_ts_kpoint_grid</span>
      <span class="k">use </span><span class="n">m_ts_charge</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">TS_RHOCORR_METHOD</span><span class="p">,</span> <span class="n">TS_RHOCORR_FERMI</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">BTD_method</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">TS_Analyze</span>
      <span class="k">use </span><span class="n">m_ts_options</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">N_Elec</span><span class="p">,</span> <span class="n">Elecs</span><span class="p">,</span> <span class="n">IsVolt</span>
      <span class="k">use </span><span class="n">m_ts_electype</span>
      <span class="k">use </span><span class="n">m_ts_global_vars</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">TSrun</span><span class="p">,</span> <span class="n">TSmode</span><span class="p">,</span> <span class="n">onlyS</span>
      <span class="k">use </span><span class="n">sys</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">bye</span>
      <span class="k">use </span><span class="n">m_ts_io</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">fname_TSHS</span><span class="p">,</span> <span class="n">ts_write_tshs</span>
      <span class="k">use </span><span class="n">m_ts_sparse</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ts_sparse_init</span>
      <span class="k">use </span><span class="n">m_ts_tri_init</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">ts_tri_init</span><span class="p">,</span> <span class="n">ts_tri_analyze</span>
      <span class="k">use </span><span class="n">files</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">slabel</span><span class="p">,</span> <span class="n">label_length</span>
<span class="cp">#ifdef SIESTA__CHESS</span>
      <span class="k">use </span><span class="n">m_chess</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">CheSS_init</span><span class="p">,</span> <span class="n">get_CheSS_parameter</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CDF</span>
      <span class="k">use </span><span class="n">iodm_netcdf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">setup_dm_netcdf_file</span>
      <span class="k">use </span><span class="n">iodmhs_netcdf</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">setup_dmhs_netcdf_file</span>
<span class="cp">#endif</span>
      <span class="k">use </span><span class="n">class_Sparsity</span>
      <span class="k">use </span><span class="n">class_dSpData1D</span>
      <span class="k">use </span><span class="n">class_dSpData2D</span>
      <span class="k">use </span><span class="n">class_dData2D</span>
<span class="cp">#ifdef TEST_IO</span>
      <span class="k">use </span><span class="n">m_test_io</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="k">use </span><span class="n">siesta_dicts</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">dict_repopulate_MD</span>
<span class="cp">#endif</span>

      <span class="k">implicit none</span>

<span class="k">      </span><span class="kt">integer</span>            <span class="kd">::</span> <span class="n">istep</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">veclen</span>      <span class="c">! Length of a unit-cell vector</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">rmax</span>
      <span class="kt">logical</span>            <span class="kd">::</span> <span class="n">cell_can_change</span>
      <span class="kt">integer</span>            <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">iadispl</span><span class="p">,</span> <span class="n">ixdispl</span>
      <span class="kt">logical</span>            <span class="kd">::</span> <span class="n">auxchanged</span>   <span class="c">! Auxiliary supercell changed?</span>
      <span class="kt">logical</span>            <span class="kd">::</span> <span class="n">folding</span><span class="p">,</span> <span class="n">folding1</span>
      <span class="kt">logical</span>            <span class="kd">::</span> <span class="n">foundxv</span>  <span class="c">! dummy for call to ioxv</span>
      <span class="k">external</span>           <span class="kd">::</span>  <span class="n">madelung</span><span class="p">,</span> <span class="n">timer</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">external</span> <span class="kd">::</span> <span class="n">volcel</span>

      <span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">ts_kscell_file</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">ts_kdispl_file</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
      <span class="kt">logical</span>                       <span class="kd">::</span> <span class="n">ts_Gamma_file</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">label_length</span><span class="o">+</span><span class="mi">6</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fname</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">dummyef</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dummyqtot</span><span class="o">=</span><span class="mf">0.0</span>
<span class="cp">#ifdef SIESTA__CHESS</span>
      <span class="kt">integer</span> <span class="kd">::</span> <span class="n">maxnh_kernel</span><span class="p">,</span> <span class="n">maxnh_mult</span><span class="p">,</span> <span class="n">no_l_kernel</span><span class="p">,</span> <span class="n">no_l_mult</span>
      <span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">listh_kernel</span><span class="p">,</span> <span class="n">listh_mult</span>
      <span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">numh_kernel</span><span class="p">,</span> <span class="n">numh_mult</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">chess_value</span>
<span class="cp">#endif</span>
      <span class="k">type</span><span class="p">(</span><span class="n">Sparsity</span><span class="p">)</span> <span class="kd">::</span> <span class="n">g_Sp</span>
      
      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">oname</span>

      <span class="k">type</span><span class="p">(</span><span class="n">dData2D</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tmp_2D</span>


<span class="c">!------------------------------------------------------------------- BEGIN</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;IterGeom&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="cp">#ifdef DEBUG</span>
      <span class="k">call </span><span class="n">write_debug</span><span class="p">(</span> <span class="s1">&#39;  PRE state_init&#39;</span> <span class="p">)</span>
<span class="cp">#endif</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;state_init&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>

      <span class="n">istp</span> <span class="o">=</span> <span class="n">istp</span> <span class="o">+</span> <span class="mi">1</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">      write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(/,t22,a)&#39;</span><span class="p">)</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span>
      <span class="k">select case</span> <span class="p">(</span><span class="n">idyn</span><span class="p">)</span>
      <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">nmove</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a)&#39;</span><span class="p">)</span> <span class="s1">&#39;Single-point calculation&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;Single-Point&#39;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="nb">index</span><span class="o">=</span><span class="n">istp</span><span class="p">)</span>
         <span class="k">else</span>
<span class="k">            if</span> <span class="p">(</span><span class="n">broyden_optim</span><span class="p">)</span> <span class="k">then</span>
<span class="k">               write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin Broyden opt. move = &#39;</span><span class="p">,</span>
     <span class="err">$</span>              <span class="n">istep</span>
            <span class="k">else if</span> <span class="p">(</span><span class="n">fire_optim</span><span class="p">)</span> <span class="k">then</span>
<span class="k">               write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin FIRE opt. move = &#39;</span><span class="p">,</span>
     <span class="err">$</span>              <span class="n">istep</span>
            <span class="k">else</span>
<span class="k">               write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin CG opt. move = &#39;</span><span class="p">,</span>
     <span class="err">$</span>              <span class="n">istep</span>
            <span class="k">end if</span>
<span class="k">            if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;Geom. Optim&#39;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="nb">index</span><span class="o">=</span><span class="n">istp</span><span class="p">)</span>
         <span class="n">endif</span>
         
<span class="c">!        Print Z-matrix coordinates</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">lUseZmatrix</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            call </span><span class="n">write_Zmatrix</span><span class="p">()</span>
         <span class="n">endif</span>
      <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">iquench</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin MD quenched step = &#39;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="n">istep</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;MD-quenched&#39;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
         <span class="k">else</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin MD step = &#39;</span><span class="p">,</span>
     <span class="err">$</span>           <span class="n">istep</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;MD&#39;</span><span class="p">,</span>
     <span class="err">$</span>             <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
         <span class="n">endif</span>
      <span class="k">case</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
         <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin MD step = &#39;</span><span class="p">,</span> <span class="n">istep</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;MD&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
      <span class="k">case</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
          <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin FC step = &#39;</span><span class="p">,</span><span class="n">istep</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;FC&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
          
          <span class="k">if</span> <span class="p">(</span><span class="n">istep</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a)&#39;</span><span class="p">)</span> <span class="s1">&#39;Undisplaced coordinates&#39;</span>
         <span class="k">else</span>
<span class="k">            </span><span class="n">iadispl</span> <span class="o">=</span> <span class="p">(</span><span class="n">istep</span><span class="o">-</span><span class="nb">mod</span><span class="p">(</span><span class="n">istep</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span><span class="o">/</span><span class="mi">6</span><span class="o">+</span><span class="n">ia1</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="nb">mod</span><span class="p">(</span><span class="n">istep</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">ixdispl</span> <span class="o">=</span> <span class="p">(</span><span class="n">ix</span> <span class="o">-</span> <span class="nb">mod</span><span class="p">(</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t26,a,i0,/,t26,a,i1,a,f10.6,a)&#39;</span><span class="p">)</span> <span class="s1">&#39;displace atom &#39;</span><span class="p">,</span>
     <span class="p">&amp;</span>           <span class="n">iadispl</span><span class="p">,</span><span class="s1">&#39;in direction &#39;</span><span class="p">,</span><span class="n">ixdispl</span><span class="p">,</span><span class="s1">&#39; by&#39;</span><span class="p">,</span> <span class="n">dx</span><span class="o">/</span><span class="n">Ang</span><span class="p">,</span><span class="s1">&#39; Ang&#39;</span>
         <span class="n">endif</span>
         
      <span class="k">case</span> <span class="p">(</span><span class="mi">8</span><span class="p">)</span>
         <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i6)&#39;</span><span class="p">)</span> <span class="s1">&#39;Begin Server step = &#39;</span><span class="p">,</span><span class="n">istep</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;FS&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
         
      <span class="k">case</span> <span class="p">(</span><span class="mi">9</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">(</span> <span class="n">istep</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i7)&#39;</span><span class="p">)</span><span class="s1">&#39;Explicit coord. initialization&#39;</span>
         <span class="k">else</span>
<span class="k">            write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i7)&#39;</span><span class="p">)</span><span class="s1">&#39;Explicit coord. step =&#39;</span><span class="p">,</span><span class="n">istep</span>
         <span class="k">end if</span>
<span class="k">         if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;ECS&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
         
      <span class="k">case</span> <span class="p">(</span><span class="mi">10</span><span class="p">)</span>
         <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t25,a,i7)&#39;</span><span class="p">)</span><span class="s1">&#39;LUA coord. step =&#39;</span><span class="p">,</span><span class="n">istep</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartStep</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="s1">&#39;LUA&#39;</span><span class="p">,</span> <span class="nb">index</span><span class="o">=</span><span class="n">istep</span><span class="p">)</span>
         
      <span class="k">end select</span>
<span class="k">      </span>
<span class="k">      write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;(t22,a)&#39;</span><span class="p">)</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span>
      
<span class="c">!     Print atomic coordinates</span>
      <span class="k">call </span><span class="n">outcoor</span><span class="p">(</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">writec</span> <span class="p">)</span>

<span class="c">!     Save structural information in crystallographic format</span>
<span class="c">!     (in file SystemLabel.STRUCT_OUT),</span>
<span class="c">!     canonical Zmatrix (if applicable), and CML record</span>
      
      <span class="k">call </span><span class="n">siesta_write_positions</span><span class="p">(</span><span class="n">moved</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.)</span>
       
      <span class="n">endif</span> <span class="c">! IONode</span>

      <span class="c">! Write the XV file for single-point calculations, so that</span>
      <span class="c">! it is there at the end for those users who rely on it</span>
      <span class="k">call </span><span class="n">ioxv</span><span class="p">(</span> <span class="s1">&#39;write&#39;</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">vcell</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">iza</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> 
     <span class="p">&amp;</span>           <span class="n">foundxv</span><span class="p">)</span>
      <span class="c">! Write TDXV file for TDDFT restart.</span>
      <span class="k">if</span><span class="p">(</span><span class="n">writetdwf</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">td_elec_dyn</span><span class="p">)</span> <span class="k">then</span>
<span class="k">      call </span><span class="n">iotdxv</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">,</span><span class="n">ucell</span><span class="p">,</span><span class="n">vcell</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">isa</span><span class="p">,</span><span class="n">iza</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">va</span><span class="p">,</span><span class="n">foundxv</span><span class="p">)</span>
      <span class="k">end if</span>  

<span class="c">!     Actualize things if variable cell </span>
      <span class="n">auxchanged</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
      <span class="n">cell_can_change</span> <span class="o">=</span> <span class="p">(</span> <span class="n">varcel</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span>
     <span class="p">&amp;</span>                    <span class="p">(</span><span class="n">idyn</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">8</span><span class="p">)</span>  <span class="c">! Force/stress evaluation</span>
     <span class="p">&amp;</span>                  <span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">change_kgrid_in_md</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         </span><span class="n">cell_can_change</span> <span class="o">=</span> <span class="n">cell_can_change</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span>
     <span class="p">&amp;</span>                     <span class="p">(</span><span class="n">idyn</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">3</span><span class="p">)</span>   <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="c">! Parrinello-Rahman</span>
     <span class="p">&amp;</span>                     <span class="p">(</span><span class="n">idyn</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">4</span><span class="p">)</span>   <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="c">! Nose-Parrinello-Rahman</span>
     <span class="p">&amp;</span>                     <span class="p">(</span><span class="n">idyn</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">5</span><span class="p">)</span>        <span class="c">! Anneal</span>
      <span class="n">endif</span>

      <span class="k">if</span> <span class="p">(</span> <span class="n">cell_can_change</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span>
     <span class="p">&amp;</span>     <span class="p">(</span><span class="n">istep</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">inicoor</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">gamma</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>

<span class="c">!       Will print k-points also</span>
        <span class="k">call </span><span class="n">setup_Kpoint_grid</span><span class="p">(</span> <span class="n">ucell</span> <span class="p">)</span>

        <span class="k">call </span><span class="n">setup_ts_kpoint_grid</span><span class="p">(</span> <span class="n">ucell</span> <span class="p">)</span>

        <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span> <span class="n">eo</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">spinor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nkpnt</span><span class="p">,</span> <span class="s1">&#39;eo&#39;</span><span class="p">,</span>
     <span class="p">&amp;</span>                 <span class="s1">&#39;state_init&#39;</span><span class="p">)</span>
        <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span> <span class="n">qo</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">spinor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nkpnt</span><span class="p">,</span> <span class="s1">&#39;qo&#39;</span><span class="p">,</span>
     <span class="p">&amp;</span>                 <span class="s1">&#39;state_init&#39;</span> <span class="p">)</span>

<span class="c">!       Find required supercell</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">gamma</span><span class="p">)</span> <span class="k">then</span>
<span class="k">           </span><span class="n">nsc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else if</span> <span class="p">(</span><span class="n">fixauxcell</span><span class="p">)</span> <span class="k">then</span>
<span class="k">           </span><span class="n">nsc</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">nscold</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span>
<span class="k">           do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">3</span>
              <span class="n">veclen</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">ucell</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ucell</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ucell</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
              <span class="n">nsc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">ceiling</span><span class="p">(</span> <span class="n">rmaxh</span> <span class="o">/</span> <span class="n">veclen</span> <span class="p">)</span>
           <span class="k">end do</span>
<span class="k">           if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">naiveauxcell</span> <span class="p">)</span>
     <span class="p">&amp;</span>          <span class="k">call </span><span class="n">exact_sc_ag</span><span class="p">(</span><span class="n">negl</span><span class="p">,</span><span class="n">ucell</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">isa</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">nsc</span><span class="p">)</span>
        <span class="n">endif</span>

        <span class="n">mscell</span> <span class="o">=</span> <span class="mf">0.0_dp</span>
        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
           <span class="n">mscell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">nsc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
           <span class="k">if</span> <span class="p">(</span><span class="n">nsc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/=</span> <span class="n">nscold</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="n">auxchanged</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
           <span class="n">nscold</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">nsc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">enddo</span>

<span class="c">!       Madelung correction for charged systems </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">charnet</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="mf">0.0_dp</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">madelung</span><span class="p">(</span><span class="n">ucell</span><span class="p">,</span> <span class="nb">shape</span><span class="p">,</span> <span class="n">charnet</span><span class="p">,</span> <span class="n">Emad</span><span class="p">)</span>
        <span class="n">endif</span>

      <span class="n">endif</span>
<span class="c">!     End variable cell actualization</span>

<span class="c">!     Auxiliary supercell</span>
<span class="c">!     Do not move from here, as the coordinates might have changed</span>
<span class="c">!     even if not the unit cell</span>
      <span class="k">call </span><span class="n">superc</span><span class="p">(</span><span class="n">ucell</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">)</span>
<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="k">call </span><span class="n">dict_repopulate_MD</span><span class="p">()</span>
<span class="cp">#endif</span>

<span class="c">!     Print unit cell and compute cell volume</span>
<span class="c">!     Possible BUG: </span>
<span class="c">!     Note that this volume is later used in write_subs and the md output</span>
<span class="c">!     routines, even if the cell later changes.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">call </span><span class="n">outcell</span><span class="p">(</span><span class="n">ucell</span><span class="p">)</span>
      <span class="n">volume_of_some_cell</span> <span class="o">=</span> <span class="n">volcel</span><span class="p">(</span><span class="n">ucell</span><span class="p">)</span>

<span class="c">!     Use largest possible range in program, except hsparse...</span>
<span class="c">!     2 * rmaxv: Vna overlap</span>
<span class="c">!     rmaxo + rmaxkb: Non-local KB action</span>
<span class="c">!     2 * (rmaxo + rmaxldau): Interaction through LDAU projector</span>
<span class="c">!     2.0_dp * (rmaxo+rmaxkb) : Orbital interaction through KB projectors</span>
      <span class="n">rmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="mf">2._dp</span><span class="o">*</span><span class="n">rmaxv</span><span class="p">,</span> <span class="mf">2._dp</span><span class="o">*</span><span class="p">(</span><span class="n">rmaxo</span><span class="o">+</span><span class="n">rmaxldau</span><span class="p">),</span> <span class="n">rmaxo</span><span class="o">+</span><span class="n">rmaxkb</span><span class="p">)</span>

      <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">negl</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">        </span><span class="n">rmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rmax</span><span class="p">,</span> <span class="mf">2.0_dp</span> <span class="o">*</span> <span class="p">(</span><span class="n">rmaxo</span><span class="o">+</span><span class="n">rmaxkb</span><span class="p">)</span> <span class="p">)</span>
      <span class="n">endif</span>

<span class="c">!     Check if any two atoms are unreasonably close</span>
      <span class="k">call </span><span class="n">proximity_check</span><span class="p">(</span><span class="n">rmax</span><span class="p">)</span>

      <span class="c">! Clear history of mixing parameters</span>
      <span class="k">call </span><span class="n">mixers_history_init</span><span class="p">(</span> <span class="n">scf_mixs</span> <span class="p">)</span>
      <span class="n">scf_mix</span> <span class="o">=&gt;</span> <span class="n">scf_mixs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

      <span class="c">! Ensure sparsity pattern is empty</span>
      <span class="k">call </span><span class="n">delete</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">)</span>
      <span class="c">! sadly deleting the sparse pattern does not necessarily</span>
      <span class="c">! mean that the arrays are de-associated.</span>
      <span class="c">! Remember that the reference counter could (in MD)</span>
      <span class="c">! be higher than 1, hence we need to create &quot;fake&quot;</span>
      <span class="c">! containers and let the new&lt;class&gt; delete the old</span>
      <span class="c">! sparsity pattern</span>
      <span class="k">nullify</span><span class="p">(</span><span class="n">numh</span><span class="p">,</span><span class="n">listhptr</span><span class="p">,</span><span class="n">listh</span><span class="p">)</span>
      <span class="k">allocate</span><span class="p">(</span><span class="n">numh</span><span class="p">(</span><span class="n">no_l</span><span class="p">),</span><span class="n">listhptr</span><span class="p">(</span><span class="n">no_l</span><span class="p">))</span>
      <span class="c">! We do not need to allocate listh</span>
      <span class="c">! that will be allocated in hsparse</span>

<span class="cp">#ifdef SIESTA__CHESS</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">isolve</span> <span class="o">==</span> <span class="n">SOLVE_CHESS</span><span class="p">)</span> <span class="k">then</span>
<span class="c">!         Calculate a sparsity pattern with some buffers... Only required</span>
<span class="c">!         for CheSS</span>
          <span class="n">chess_value</span> <span class="o">=</span> <span class="n">get_chess_parameter</span><span class="p">(</span><span class="s1">&#39;chess_buffer_kernel&#39;</span><span class="p">)</span>
          <span class="k">call </span><span class="n">hsparse</span><span class="p">(</span> <span class="n">negl</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">lastkb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">iphKB</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="nb">gamma</span><span class="p">,</span> 
     <span class="p">&amp;</span>              <span class="n">set_xijo</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">folding</span><span class="o">=</span><span class="n">folding1</span><span class="p">,</span>
     <span class="err">$</span>              <span class="n">buffer</span><span class="o">=</span><span class="n">chess_value</span><span class="p">)</span>
          <span class="n">maxnh_kernel</span> <span class="o">=</span> <span class="n">maxnh</span>
          <span class="n">no_l_kernel</span> <span class="o">=</span> <span class="n">no_l</span>
          <span class="k">allocate</span><span class="p">(</span><span class="n">listh_kernel</span><span class="p">(</span><span class="n">maxnh_kernel</span><span class="p">))</span>
          <span class="k">allocate</span><span class="p">(</span><span class="n">numh_kernel</span><span class="p">(</span><span class="n">no_l_kernel</span><span class="p">))</span>
          <span class="n">listh_kernel</span> <span class="o">=</span> <span class="n">listh</span>
          <span class="n">numh_kernel</span> <span class="o">=</span> <span class="n">numh</span>
    
          <span class="n">chess_value</span> <span class="o">=</span> <span class="n">get_chess_parameter</span><span class="p">(</span><span class="s1">&#39;chess_buffer_mult&#39;</span><span class="p">)</span>
          <span class="k">call </span><span class="n">hsparse</span><span class="p">(</span> <span class="n">negl</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span>
     <span class="p">&amp;</span>                  <span class="n">lastkb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">iphKB</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="nb">gamma</span><span class="p">,</span>
     <span class="p">&amp;</span>                  <span class="n">set_xijo</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">folding</span><span class="o">=</span><span class="n">folding1</span><span class="p">,</span>
     <span class="err">$</span>                  <span class="n">buffer</span><span class="o">=</span><span class="n">chess_value</span><span class="p">)</span>
          <span class="n">maxnh_mult</span> <span class="o">=</span> <span class="n">maxnh</span>
          <span class="n">no_l_mult</span> <span class="o">=</span> <span class="n">no_l</span>
          <span class="k">allocate</span><span class="p">(</span><span class="n">listh_mult</span><span class="p">(</span><span class="n">maxnh_mult</span><span class="p">))</span>
          <span class="k">allocate</span><span class="p">(</span><span class="n">numh_mult</span><span class="p">(</span><span class="n">no_l_mult</span><span class="p">))</span>
          <span class="n">listh_mult</span> <span class="o">=</span> <span class="n">listh</span>
          <span class="n">numh_mult</span> <span class="o">=</span> <span class="n">numh</span>
      <span class="k">end if</span>
<span class="cp">#endif /* CHESS */</span>

<span class="c">!     List of nonzero Hamiltonian matrix elements</span>
<span class="c">!     and, if applicable,  vectors between orbital centers</span>

<span class="c">!     Listh and xijo are allocated inside hsparse</span>
<span class="c">!     Note: We always generate xijo now, for COOP and other</span>
<span class="c">!           analyses.</span>
      <span class="k">call </span><span class="n">delete</span><span class="p">(</span><span class="n">xij_2D</span><span class="p">)</span> <span class="c">! as xijo will be reallocated</span>
      <span class="k">nullify</span><span class="p">(</span><span class="n">xijo</span><span class="p">)</span>
      <span class="k">call </span><span class="n">hsparse</span><span class="p">(</span> <span class="n">negl</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">lastkb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">iphKB</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="nb">gamma</span><span class="p">,</span>
     <span class="err">$</span>              <span class="n">set_xijo</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">folding</span><span class="o">=</span><span class="n">folding1</span><span class="p">)</span>
<span class="c">!</span>
<span class="cp">#ifdef SIESTA__CHESS</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">isolve</span> <span class="o">==</span> <span class="n">SOLVE_CHESS</span><span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">CheSS_init</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">maxnh_kernel</span><span class="p">,</span> <span class="n">maxnh_mult</span><span class="p">,</span> 
     <span class="p">&amp;</span>         <span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">no_l_kernel</span><span class="p">,</span> <span class="n">no_l_mult</span><span class="p">,</span> <span class="n">BlockSize</span><span class="p">,</span> 
     <span class="p">&amp;</span>         <span class="n">spin</span><span class="p">%</span><span class="n">spinor</span><span class="p">,</span> <span class="n">qtots</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">listh_kernel</span><span class="p">,</span> <span class="n">listh_mult</span><span class="p">,</span> 
     <span class="p">&amp;</span>         <span class="n">numh</span><span class="p">,</span> <span class="n">numh_kernel</span><span class="p">,</span> <span class="n">numh_mult</span><span class="p">)</span>
          <span class="k">deallocate</span><span class="p">(</span><span class="n">listh_kernel</span><span class="p">)</span>
          <span class="k">deallocate</span><span class="p">(</span><span class="n">numh_kernel</span><span class="p">)</span>
          <span class="k">deallocate</span><span class="p">(</span><span class="n">listh_mult</span><span class="p">)</span>
          <span class="k">deallocate</span><span class="p">(</span><span class="n">numh_mult</span><span class="p">)</span>
      <span class="k">end if</span>
<span class="cp">#endif /* CHESS */</span>
      <span class="k">call </span><span class="n">globalize_or</span><span class="p">(</span><span class="n">folding1</span><span class="p">,</span><span class="n">folding</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">folding</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            print</span> <span class="o">*</span><span class="p">,</span> <span class="s2">&quot;Folding of H and S is implicitly performed&quot;</span>
         <span class="n">endif</span>
      <span class="n">endif</span>
      <span class="c">!</span>
      <span class="c">! If using domain decomposition, redistribute orbitals</span>
      <span class="c">! for this geometry, based on the hsparse info. </span>
      <span class="c">! The first time round, the initial distribution is a</span>
      <span class="c">! simple block one (given by preSetOrbitLimits).</span>
      <span class="c">!</span>
      <span class="c">! Any DM, etc, read from file will be redistributed according</span>
      <span class="c">! to the new pattern. </span>
      <span class="c">! Inherited DMs from a previous geometry cannot be used if the</span>
      <span class="c">! orbital distribution changes. For now, we avoid changing the</span>
      <span class="c">! distribution (the variable use_dd_perm is .true. if domain</span>
      <span class="c">! decomposition is in effect). Names should be changed...</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">use_dd</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">use_dd_perm</span><span class="p">))</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">domainDecom</span><span class="p">(</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">maxnh</span> <span class="p">)</span>  <span class="c">! maxnh intent(in) here</span>
         <span class="n">maxnh</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numh</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">no_l</span><span class="p">))</span>
         <span class="c">! We still need to re-create Julian Gale&#39;s</span>
         <span class="c">! indexing for O(N) in parallel.</span>
         <span class="k">print</span> <span class="s2">&quot;(a5,i3,a20,3i8)&quot;</span><span class="p">,</span>
     <span class="err">$</span>         <span class="s2">&quot;Node: &quot;</span><span class="p">,</span> <span class="n">Node</span><span class="p">,</span> <span class="s2">&quot;no_u, no_l, maxnh: &quot;</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">maxnh</span>
         <span class="k">call </span><span class="n">setup_ordern_indexes</span><span class="p">(</span><span class="n">no_l</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">Nodes</span><span class="p">)</span>
      <span class="n">endif</span>

      <span class="c">! I would like to skip this alloc/move/dealloc/attach</span>
      <span class="c">! by allowing sparsity to have pointer targets.</span>
      <span class="c">! However, this poses a problem with intel compilers,</span>
      <span class="c">! as it apparently errors out when de-allocating a target pointer</span>
      <span class="k">write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;sparsity for geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newSparsity</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">no_l</span><span class="p">,</span><span class="n">no_u</span><span class="p">,</span><span class="n">maxnh</span><span class="p">,</span>
     <span class="p">&amp;</span>     <span class="n">numh</span><span class="p">,</span><span class="n">listhptr</span><span class="p">,</span><span class="n">listh</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">oname</span><span class="p">)</span>
      <span class="k">deallocate</span><span class="p">(</span><span class="n">numh</span><span class="p">,</span><span class="n">listhptr</span><span class="p">,</span><span class="n">listh</span><span class="p">)</span>
      <span class="k">call </span><span class="n">attach</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span> 
     <span class="p">&amp;</span>     <span class="n">n_col</span> <span class="o">=</span> <span class="n">numh</span><span class="p">,</span> <span class="n">list_ptr</span> <span class="o">=</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">list_col</span> <span class="o">=</span> <span class="n">listh</span> <span class="p">)</span>

      <span class="c">! In case the user requests to create the connectivity graph</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">write_GRAPHVIZ</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="k">then</span>
         <span class="c">! first create the unit-cell sparsity pattern</span>
         <span class="k">call </span><span class="n">crtSparsity_SC</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span> <span class="n">g_Sp</span><span class="p">,</span> <span class="n">UC</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
         <span class="c">! next move to global sparsity pattern</span>
         <span class="k">call </span><span class="n">Sp_to_Spglobal</span><span class="p">(</span><span class="n">block_dist</span><span class="p">,</span> <span class="n">g_Sp</span><span class="p">,</span> <span class="n">g_Sp</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">(</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">            if</span> <span class="p">(</span> <span class="n">write_GRAPHVIZ</span> <span class="o">/=</span> <span class="mi">2</span> <span class="p">)</span>
     <span class="p">&amp;</span>           <span class="k">call </span><span class="n">sp2graphviz</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.ORB.gv&#39;</span><span class="p">,</span> <span class="n">g_Sp</span><span class="p">)</span>
            <span class="c">! Convert to atomic </span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">write_GRAPHVIZ</span> <span class="o">/=</span> <span class="mi">1</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">               call </span><span class="n">SpOrb_to_SpAtom</span><span class="p">(</span><span class="n">single_dist</span><span class="p">,</span><span class="n">g_Sp</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">lasto</span><span class="p">,</span><span class="n">g_Sp</span><span class="p">)</span>
               <span class="k">call </span><span class="n">sp2graphviz</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.ATOM.gv&#39;</span><span class="p">,</span> <span class="n">g_Sp</span><span class="p">)</span>
            <span class="k">end if</span>
<span class="k">         end if</span>
<span class="k">         call </span><span class="n">delete</span><span class="p">(</span><span class="n">g_Sp</span><span class="p">)</span>
      <span class="k">end if</span>

             
      <span class="c">! Copy over xijo array (we can first do it here... :( )</span>
      <span class="k">call </span><span class="n">newdData2D</span><span class="p">(</span><span class="n">tmp_2D</span><span class="p">,</span><span class="n">xijo</span><span class="p">,</span><span class="s1">&#39;xijo&#39;</span><span class="p">)</span>
      <span class="k">deallocate</span><span class="p">(</span><span class="n">xijo</span><span class="p">)</span>
      <span class="k">write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;xijo at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData2D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">tmp_2D</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">xij_2D</span><span class="p">,</span> 
     <span class="p">&amp;</span>     <span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="k">call </span><span class="n">delete</span><span class="p">(</span><span class="n">tmp_2D</span><span class="p">)</span> <span class="c">! decrement container...</span>
      <span class="n">xijo</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">xij_2D</span><span class="p">)</span>

      <span class="c">! Calculate the super-cell offsets...</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nb">Gamma</span> <span class="p">)</span> <span class="k">then</span>
         <span class="c">! Here we create the super-cell offsets</span>
         <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span><span class="n">isc_off</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
         <span class="n">isc_off</span><span class="p">(:,:)</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">else</span>
<span class="k">         call </span><span class="n">xij_offset</span><span class="p">(</span><span class="n">ucell</span><span class="p">,</span><span class="n">nsc</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">lasto</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="n">xij_2D</span><span class="p">,</span> <span class="n">isc_off</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">Bcast</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
      <span class="k">end if</span>

      
      <span class="c">! When the user requests to only do an analyzation, we can call</span>
      <span class="c">! appropriate routines and quit</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">TS_Analyze</span> <span class="p">)</span> <span class="k">then</span>

         <span class="c">! Force the creation of the full sparsity pattern</span>
         <span class="k">call </span><span class="n">ts_sparse_init</span><span class="p">(</span><span class="n">slabel</span><span class="p">,</span><span class="n">IsVolt</span><span class="p">,</span> <span class="n">N_Elec</span><span class="p">,</span> <span class="n">Elecs</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="n">ucell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">block_dist</span><span class="p">,</span> <span class="n">sparse_pattern</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="nb">Gamma</span><span class="p">,</span> <span class="n">isc_off</span><span class="p">)</span>

         <span class="c">! create the tri-diagonal matrix</span>
         <span class="k">call </span><span class="n">ts_tri_analyze</span><span class="p">(</span> <span class="n">block_dist</span><span class="p">,</span> <span class="n">sparse_pattern</span> <span class="p">,</span> <span class="n">N_Elec</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">Elecs</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">isc_off</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">BTD_method</span> <span class="p">)</span>

         <span class="c">! Print-out timers</span>
         <span class="k">call </span><span class="n">timer</span><span class="p">(</span><span class="s1">&#39;TS-rgn2tri&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

         <span class="c">! Bye also waits for all processors</span>
         <span class="k">call </span><span class="n">bye</span><span class="p">(</span><span class="s1">&#39;transiesta analyzation performed&#39;</span><span class="p">)</span>
         
      <span class="k">end if</span>


<span class="k">      write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;EDM at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData2D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">EDM</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">EDM_2D</span><span class="p">,</span>
     <span class="p">&amp;</span>     <span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="c">!if (ionode) call print_type(EDM_2D)</span>
      <span class="n">Escf</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">EDM_2D</span><span class="p">)</span>

      <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span><span class="n">Dold</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxnh</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">DM</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Dold&#39;</span><span class="p">,</span>
     <span class="p">.</span>     <span class="n">routine</span><span class="o">=</span><span class="s1">&#39;sparseMat&#39;</span><span class="p">,</span><span class="n">copy</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">shrink</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
      <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span><span class="n">Hold</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxnh</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Hold&#39;</span><span class="p">,</span>
     <span class="p">.</span>     <span class="n">routine</span><span class="o">=</span><span class="s1">&#39;sparseMat&#39;</span><span class="p">,</span><span class="n">copy</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">shrink</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">converge_EDM</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">re_alloc</span><span class="p">(</span><span class="n">Eold</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">maxnh</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">EDM</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Eold&#39;</span><span class="p">,</span>
     <span class="p">.</span>     <span class="n">routine</span><span class="o">=</span><span class="s1">&#39;sparseMat&#39;</span><span class="p">,</span><span class="n">copy</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="n">shrink</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
      <span class="k">end if</span>

<span class="c">!     Allocate/reallocate storage associated with Hamiltonian/Overlap matrix</span>
      <span class="k">write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;H at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData2D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">H_2D</span><span class="p">,</span>
     <span class="p">&amp;</span>                  <span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="c">!if (ionode) call print_type(H_2D)</span>
      <span class="n">H</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">H_2D</span><span class="p">)</span>

      <span class="k">write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;H_vkb at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData1D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">H_vkb_1D</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="c">!if (ionode) call print_type(H_vkb_1D)</span>

      <span class="k">write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;H_kin at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData1D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">H_kin_1D</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="c">!if (ionode) call print_type(H_kin_1D)</span>

      <span class="k">if</span> <span class="p">(</span> <span class="n">switch_ldau</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;H_ldau at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
         <span class="k">call </span><span class="n">newdSpData2D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">spinor</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">block_dist</span><span class="p">,</span><span class="n">H_ldau_2D</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
         
         <span class="c">! Initialize to 0, LDA+U may re-calculate</span>
         <span class="c">!   this matrix sporadically doing the SCF.</span>
         <span class="c">! Hence initialization MUST be performed upon</span>
         <span class="c">! re-allocation.</span>
         <span class="k">call </span><span class="n">init_val</span><span class="p">(</span><span class="n">H_ldau_2D</span><span class="p">)</span>
         <span class="k">if</span> <span class="p">(</span> <span class="n">inicoor</span> <span class="o">/=</span> <span class="n">istep</span> <span class="p">)</span> <span class="k">then</span>
            <span class="c">! Force initialization of the LDA+U</span>
            <span class="c">! when changing geometry</span>
            <span class="c">! For the first geometry this is controlled</span>
            <span class="c">! by the user via an fdf-key</span>
            <span class="n">ldau_init</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
         <span class="k">end if</span>
<span class="k">      end if</span>
<span class="k">      </span>
<span class="k">      if</span> <span class="p">(</span> <span class="n">spin</span><span class="p">%</span><span class="n">SO</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;H_so at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
         <span class="k">call </span><span class="n">newdSpData2D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">spin</span><span class="p">%</span><span class="n">H</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">block_dist</span><span class="p">,</span><span class="n">H_so_2D</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="k">end if</span>

<span class="k">      write</span><span class="p">(</span><span class="n">oname</span><span class="p">,</span><span class="s2">&quot;(a,i0)&quot;</span><span class="p">)</span> <span class="s2">&quot;S at geom step &quot;</span><span class="p">,</span> <span class="n">istep</span>
      <span class="k">call </span><span class="n">newdSpData1D</span><span class="p">(</span><span class="n">sparse_pattern</span><span class="p">,</span><span class="n">block_dist</span><span class="p">,</span><span class="n">S_1D</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">oname</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ionode</span><span class="p">)</span> <span class="k">call </span><span class="n">print_type</span><span class="p">(</span><span class="n">S_1D</span><span class="p">)</span>
      <span class="n">S</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">S_1D</span><span class="p">)</span>

<span class="c">!     Find overlap matrix </span>
      <span class="k">call </span><span class="n">overlap</span><span class="p">(</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span> <span class="n">rmaxo</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">lasto</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">S</span> <span class="p">)</span>


<span class="c">!</span>
<span class="c">!     Here we could also read a Hamiltonian, either to proceed to</span>
<span class="c">!     the analysis section (with nscf=0) or to start a mix-H scf cycle.</span>
<span class="c">!</span>
<span class="c">!     Initialize density matrix</span>
      <span class="c">! The resizing of Dscf is done inside new_dm</span>
      <span class="k">call </span><span class="n">new_DM</span><span class="p">(</span><span class="n">auxchanged</span><span class="p">,</span> <span class="n">DM_history</span><span class="p">,</span> <span class="n">DM_2D</span><span class="p">,</span> <span class="n">EDM_2D</span><span class="p">)</span>
      <span class="n">Dscf</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">DM_2D</span><span class="p">)</span>
      <span class="n">Escf</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">EDM_2D</span><span class="p">)</span>

      <span class="c">! Initialize energy-density matrix to zero for first call to overfsm</span>
      <span class="c">! Only part of Escf is updated in TS, so if it is put as zero here</span>
      <span class="c">! a continuation run gives bad forces.</span>
      <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">TSrun</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">normalize_DM</span><span class="p">(</span> <span class="n">first</span><span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span> <span class="p">)</span>
<span class="c">!$OMP parallel workshare default(shared)</span>
         <span class="n">Escf</span><span class="p">(:,:)</span> <span class="o">=</span> <span class="mf">0.0_dp</span>
<span class="c">!$OMP end parallel workshare</span>
      <span class="k">end if</span>

<span class="cp">#ifdef TEST_IO</span>
      <span class="c">! We test the io-performance here</span>
      <span class="k">call </span><span class="n">time_io</span><span class="p">(</span><span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span><span class="n">H_2D</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="c">!     If onlyS, Save overlap matrix and exit</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">onlyS</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         </span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname_TSHS</span><span class="p">(</span><span class="n">slabel</span><span class="p">,</span> <span class="n">onlyS</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span> <span class="p">)</span>
         <span class="c">! We include H as S, well-knowing that we only write one of</span>
         <span class="c">! them, there is no need to allocate space for no reason!</span>
         <span class="k">call </span><span class="n">ts_write_tshs</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="nb">Gamma</span><span class="p">,</span> <span class="n">ts_Gamma_file</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">ucell</span><span class="p">,</span> <span class="n">nsc</span><span class="p">,</span> <span class="n">isc_off</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">ts_kscell_file</span><span class="p">,</span> <span class="n">ts_kdispl_file</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">xa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="n">H_2D</span><span class="p">,</span> <span class="n">S_1D</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span> 
     <span class="p">&amp;</span>        <span class="n">dummyEf</span><span class="p">,</span> <span class="n">dummyQtot</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
         <span class="k">call </span><span class="n">bye</span><span class="p">(</span> <span class="s1">&#39;Save overlap matrix and exit&#39;</span> <span class="p">)</span> <span class="c">! Exit siesta</span>
         
      <span class="n">endif</span> 

      <span class="c">! In case the user is requesting a Fermi-correction</span>
      <span class="c">! we need to delete the TS_FERMI file after each iteration</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">TSmode</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">TS_RHOCORR_METHOD</span> <span class="o">==</span> <span class="n">TS_RHOCORR_FERMI</span>
     <span class="p">&amp;</span>     <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">IONode</span> <span class="p">)</span> <span class="k">then</span>
          <span class="c">! Delete the TS_FERMI file (enables</span>
          <span class="c">! reading it in and improve on the convergence)</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">file_exist</span><span class="p">(</span><span class="s1">&#39;TS_FERMI&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">             </span><span class="n">i</span> <span class="o">=</span> <span class="mi">23455</span> <span class="c">! this should just not be used any were...</span>
             <span class="c">! Delete the file...</span>
             <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s1">&#39;TS_FERMI&#39;</span><span class="p">)</span>
             <span class="k">close</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">)</span>
          <span class="k">end if</span>
<span class="k">       end if</span>
      
<span class="cp">#ifdef CDF</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">writedm_cdf</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">setup_dm_netcdf_file</span><span class="p">(</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">no_s</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">)</span>
      <span class="n">endif</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">writedm_cdf_history</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">setup_dm_netcdf_file</span><span class="p">(</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">no_s</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">istep</span><span class="p">)</span>
      <span class="n">endif</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">writedmhs_cdf</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">setup_dmhs_netcdf_file</span><span class="p">(</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">no_s</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">s</span><span class="p">)</span>
      <span class="n">endif</span>
      <span class="k">if</span><span class="p">(</span><span class="n">writedmhs_cdf_history</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">setup_dmhs_netcdf_file</span><span class="p">(</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">no_l</span><span class="p">,</span> <span class="n">spin</span><span class="p">%</span><span class="n">H</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">no_s</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">s</span><span class="p">,</span>
     <span class="p">&amp;</span>                              <span class="n">istep</span><span class="p">)</span>
      <span class="n">endif</span>
<span class="cp">#endif</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;state_init&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

      <span class="k">END subroutine </span><span class="n">state_init</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprocs-1">All Procedures</a></h3></div>
  <div id="allprocs-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../proc/compute_dm.html">compute_dm</a>
      
      <a class="list-group-item" href="../proc/current_itt.html">current_itt</a>
      
      <a class="list-group-item" href="../proc/getstackval.html">getstackval</a>
      
      <a class="list-group-item" href="../proc/inverse.html">inverse</a>
      
      <a class="list-group-item" href="../proc/is_next.html">is_next</a>
      
      <a class="list-group-item" href="../proc/mix_method.html">mix_method</a>
      
      <a class="list-group-item" href="../proc/mix_method_variant.html">mix_method_variant</a>
      
      <a class="list-group-item" href="../proc/mixer_init.html">mixer_init</a>
      
      <a class="list-group-item" href="../proc/mixers_history_init.html">mixers_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_init.html">mixers_init</a>
      
      <a class="list-group-item" href="../proc/mixers_print.html">mixers_print</a>
      
      <a class="list-group-item" href="../proc/mixers_print_block.html">mixers_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_reset.html">mixers_reset</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_history_init.html">mixers_scf_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_init.html">mixers_scf_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print.html">mixers_scf_print</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print_block.html">mixers_scf_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_reset.html">mixers_scf_reset</a>
      
      <a class="list-group-item" href="../interface/mixing.html">mixing</a>
      
      <a class="list-group-item" href="../proc/mixing_1d.html">mixing_1d</a>
      
      <a class="list-group-item" href="../proc/mixing_2d.html">mixing_2d</a>
      
      <a class="list-group-item" href="../proc/mixing_calc_next.html">mixing_calc_next</a>
      
      <a class="list-group-item" href="../proc/mixing_coeff.html">mixing_coeff</a>
      
      <a class="list-group-item" href="../proc/mixing_finalize.html">mixing_finalize</a>
      
      <a class="list-group-item" href="../proc/mixing_init.html">mixing_init</a>
      
      <a class="list-group-item" href="../proc/mixing_ncoeff.html">mixing_ncoeff</a>
      
      <a class="list-group-item" href="../proc/mixing_scf_converged.html">mixing_scf_converged</a>
      
      <a class="list-group-item" href="../proc/mixing_step.html">mixing_step</a>
      
      <a class="list-group-item" href="../proc/norm.html">norm</a>
      
      <a class="list-group-item" href="../proc/push_diff.html">push_diff</a>
      
      <a class="list-group-item" href="../proc/push_f.html">push_F</a>
      
      <a class="list-group-item" href="../proc/push_stack_data.html">push_stack_data</a>
      
      <a class="list-group-item" href="../proc/setup_h0.html">setup_H0</a>
      
      <a class="list-group-item" href="../proc/setup_hamiltonian.html">setup_hamiltonian</a>
      
      <a class="list-group-item" href="../proc/siesta_analysis.html">siesta_analysis</a>
      
      <a class="list-group-item" href="../proc/siesta_forces.html">siesta_forces</a>
      
      <a class="list-group-item" href="../proc/stack_check.html">stack_check</a>
      
      <a class="list-group-item" href="../proc/state_analysis.html">state_analysis</a>
      
      <a class="list-group-item" href="../proc/state_init.html">state_init</a>
      
      <a class="list-group-item" href="../proc/svd.html">svd</a>
      
      <a class="list-group-item" href="../proc/update_f.html">update_F</a>
      
    </div>
  </div>
</div>


  </section>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SIESTA was developed by SIESTA Group</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>