<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A first-principles materials simulation code using Density Functional Theory.">
    
    <meta name="author" content="SIESTA Group" >
    <link rel="icon" href="../favicon.png">

    <title>initMeshDistr &ndash; SIESTA</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SIESTA <small>trunk-700--vdikan-edens-710-ford-681</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Program Overview</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>initMeshDistr
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.0% of total for procedures.">85 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/moremeshsubs.F"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/moremeshsubs.f.html'>moremeshsubs.F</a></li>
    
     <li><a href='../module/moremeshsubs.html'>moreMeshSubs</a></li>
    
  
     <li class="active">initMeshDistr</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/initmeshdistr.html#src">initMeshDistr</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine initMeshDistr(iDistr, oDistr, nm, wload)
    
    
   
</h2>
    
  


    
    <p>Computes a new data distribution and the communications needed to
 move data from/to the current distribution to the existing ones.</p>
<p>The limits of the new distributions are stored in the current module
 in <code><a href="../module/moremeshsubs.html#variable-meshdistr">meshDistr</a></code>:</p>
<div class="codehilite"><pre><span></span> meshDistr(oDistr)
 meshCommu(((oDistr-2)*(oDistr-1))/2+1:(oDistr-1)*oDistr/2)
</pre></div>


<p>If this is the first distribution, we split the mesh uniformly among
 the several processes (we only split it in dimensions Y and Z).</p>
<p>For the other data distributions we should split the vector wload.
 The subroutine splitwload will return the limits of the new data
 distribution. The subroutine compMeshComm will return the communications
 needed to move data from/to the current distribution to/from the
 previous ones.</p>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-idistr"></span>integer,</td>
  <td>intent(in),</td>
  <td>optional</td>
  
  <td></td><td>::</td>
  <td><strong>iDistr</strong></td><td><p>Distribution index of the input vector</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-odistr"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>oDistr</strong></td><td><p>The new data distribution index</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-nm"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>nm</strong>(3)</td><td><p>Number of Mesh divisions of each cell vector</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-wload"></span>integer,</td>
  <td>intent(in),</td>
  <td>optional</td>
  
  <td></td><td>::</td>
  <td><strong>wload</strong>(*)</td><td><p>Weights of every point of the mesh using the input distribut      !ion</p></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~initmeshdistr~~CallsGraph Pages: 1 -->
<svg id="procinitmeshdistrCallsGraph" width="275pt" height="242pt"
 viewBox="0.00 0.00 275.00 242.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~initmeshdistr~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 238)">
<title>proc~~initmeshdistr~~CallsGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-238 271,-238 271,4 -4,4"/>
<!-- proc~initmeshdistr -->
<g id="proc~~initmeshdistr~~CallsGraph_node1" class="node"><title>proc~initmeshdistr</title>
<polygon fill="none" stroke="black" points="74,-129 0,-129 0,-105 74,-105 74,-129"/>
<text text-anchor="middle" x="37" y="-114.6" font-family="Helvetica,sans-Serif" font-size="10.50">initMeshDistr</text>
</g>
<!-- re_alloc -->
<g id="proc~~initmeshdistr~~CallsGraph_node2" class="node"><title>re_alloc</title>
<polygon fill="#777777" stroke="#777777" points="164,-171 110,-171 110,-147 164,-147 164,-171"/>
<text text-anchor="middle" x="137" y="-156.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">re_alloc</text>
</g>
<!-- proc~initmeshdistr&#45;&gt;re_alloc -->
<g id="proc~~initmeshdistr~~CallsGraph_edge1" class="edge"><title>proc~initmeshdistr&#45;&gt;re_alloc</title>
<path fill="none" stroke="#000000" d="M66.0829,-129.036C76.8647,-133.656 89.3098,-138.99 100.685,-143.865"/>
<polygon fill="#000000" stroke="#000000" points="99.3586,-147.104 109.929,-147.827 102.116,-140.67 99.3586,-147.104"/>
</g>
<!-- proc~die -->
<g id="proc~~initmeshdistr~~CallsGraph_node3" class="node"><title>proc~die</title>
<g id="a_proc~~initmeshdistr~~CallsGraph_node3"><a xlink:href=".././proc/die.html" xlink:title="die">
<polygon fill="#d9534f" stroke="#d9534f" points="164,-129 110,-129 110,-105 164,-105 164,-129"/>
<text text-anchor="middle" x="137" y="-114.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">die</text>
</a>
</g>
</g>
<!-- proc~initmeshdistr&#45;&gt;proc~die -->
<g id="proc~~initmeshdistr~~CallsGraph_edge2" class="edge"><title>proc~initmeshdistr&#45;&gt;proc~die</title>
<path fill="none" stroke="#000000" d="M74.2131,-117C82.4941,-117 91.2988,-117 99.5881,-117"/>
<polygon fill="#000000" stroke="#000000" points="99.7338,-120.5 109.734,-117 99.7337,-113.5 99.7338,-120.5"/>
</g>
<!-- timer -->
<g id="proc~~initmeshdistr~~CallsGraph_node4" class="node"><title>timer</title>
<polygon fill="#777777" stroke="#777777" points="164,-87 110,-87 110,-63 164,-63 164,-87"/>
<text text-anchor="middle" x="137" y="-72.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">timer</text>
</g>
<!-- proc~initmeshdistr&#45;&gt;timer -->
<g id="proc~~initmeshdistr~~CallsGraph_edge3" class="edge"><title>proc~initmeshdistr&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M66.0829,-104.964C76.8647,-100.344 89.3098,-95.0101 100.685,-90.1349"/>
<polygon fill="#000000" stroke="#000000" points="102.116,-93.3296 109.929,-86.1734 99.3586,-86.8956 102.116,-93.3296"/>
</g>
<!-- io_close -->
<g id="proc~~initmeshdistr~~CallsGraph_node5" class="node"><title>io_close</title>
<polygon fill="#777777" stroke="#777777" points="260.5,-234 206.5,-234 206.5,-210 260.5,-210 260.5,-234"/>
<text text-anchor="middle" x="233.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">io_close</text>
</g>
<!-- proc~die&#45;&gt;io_close -->
<g id="proc~~initmeshdistr~~CallsGraph_edge4" class="edge"><title>proc~die&#45;&gt;io_close</title>
<path fill="none" stroke="#000000" d="M154.79,-129.021C158.05,-131.766 161.292,-134.819 164,-138 184.905,-162.556 177.827,-177.583 200,-201 200.762,-201.805 201.561,-202.593 202.389,-203.364"/>
<polygon fill="#000000" stroke="#000000" points="200.412,-206.265 210.404,-209.788 204.79,-200.803 200.412,-206.265"/>
</g>
<!-- cmlfinishfile -->
<g id="proc~~initmeshdistr~~CallsGraph_node6" class="node"><title>cmlfinishfile</title>
<polygon fill="#777777" stroke="#777777" points="267,-192 200,-192 200,-168 267,-168 267,-192"/>
<text text-anchor="middle" x="233.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cmlfinishfile</text>
</g>
<!-- proc~die&#45;&gt;cmlfinishfile -->
<g id="proc~~initmeshdistr~~CallsGraph_edge5" class="edge"><title>proc~die&#45;&gt;cmlfinishfile</title>
<path fill="none" stroke="#000000" d="M155.57,-129.051C167.946,-137.503 184.929,-149.028 200,-159 201.639,-160.084 203.327,-161.195 205.033,-162.312"/>
<polygon fill="#000000" stroke="#000000" points="203.26,-165.334 213.551,-167.854 207.078,-159.467 203.26,-165.334"/>
</g>
<!-- io_assign -->
<g id="proc~~initmeshdistr~~CallsGraph_node7" class="node"><title>io_assign</title>
<polygon fill="#777777" stroke="#777777" points="262.5,-150 204.5,-150 204.5,-126 262.5,-126 262.5,-150"/>
<text text-anchor="middle" x="233.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">io_assign</text>
</g>
<!-- proc~die&#45;&gt;io_assign -->
<g id="proc~~initmeshdistr~~CallsGraph_edge6" class="edge"><title>proc~die&#45;&gt;io_assign</title>
<path fill="none" stroke="#000000" d="M164.073,-122.794C173.415,-124.87 184.149,-127.255 194.304,-129.512"/>
<polygon fill="#000000" stroke="#000000" points="193.672,-132.957 204.193,-131.71 195.19,-126.123 193.672,-132.957"/>
</g>
<!-- pxfabort -->
<g id="proc~~initmeshdistr~~CallsGraph_node8" class="node"><title>pxfabort</title>
<polygon fill="#777777" stroke="#777777" points="260.5,-108 206.5,-108 206.5,-84 260.5,-84 260.5,-108"/>
<text text-anchor="middle" x="233.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">pxfabort</text>
</g>
<!-- proc~die&#45;&gt;pxfabort -->
<g id="proc~~initmeshdistr~~CallsGraph_edge7" class="edge"><title>proc~die&#45;&gt;pxfabort</title>
<path fill="none" stroke="#000000" d="M164.073,-111.206C174.009,-108.998 185.52,-106.44 196.234,-104.059"/>
<polygon fill="#000000" stroke="#000000" points="197.182,-107.434 206.184,-101.848 195.663,-100.601 197.182,-107.434"/>
</g>
<!-- mpi_abort -->
<g id="proc~~initmeshdistr~~CallsGraph_node9" class="node"><title>mpi_abort</title>
<polygon fill="#777777" stroke="#777777" points="264,-66 203,-66 203,-42 264,-42 264,-66"/>
<text text-anchor="middle" x="233.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mpi_abort</text>
</g>
<!-- proc~die&#45;&gt;mpi_abort -->
<g id="proc~~initmeshdistr~~CallsGraph_edge8" class="edge"><title>proc~die&#45;&gt;mpi_abort</title>
<path fill="none" stroke="#000000" d="M155.57,-104.949C167.946,-96.4974 184.929,-84.9722 200,-75 201.639,-73.9157 203.327,-72.8051 205.033,-71.6882"/>
<polygon fill="#000000" stroke="#000000" points="207.078,-74.5333 213.551,-66.1458 203.26,-68.666 207.078,-74.5333"/>
</g>
<!-- pxfflush -->
<g id="proc~~initmeshdistr~~CallsGraph_node10" class="node"><title>pxfflush</title>
<polygon fill="#777777" stroke="#777777" points="260.5,-24 206.5,-24 206.5,-0 260.5,-0 260.5,-24"/>
<text text-anchor="middle" x="233.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">pxfflush</text>
</g>
<!-- proc~die&#45;&gt;pxfflush -->
<g id="proc~~initmeshdistr~~CallsGraph_edge9" class="edge"><title>proc~die&#45;&gt;pxfflush</title>
<path fill="none" stroke="#000000" d="M154.79,-104.979C158.05,-102.234 161.292,-99.1811 164,-96 184.905,-71.4443 177.827,-56.4166 200,-33 200.762,-32.1951 201.561,-31.4068 202.389,-30.6362"/>
<polygon fill="#000000" stroke="#000000" points="204.79,-33.1971 210.404,-24.2121 200.412,-27.7348 204.79,-33.1971"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,-0 64,-0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,-0 136,-0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node"><title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,-0 209.5,-0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node"><title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,-0 364,-0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,-0 436,-0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="551.5,-24 454.5,-24 454.5,-0 551.5,-0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/initmeshdistr.html#src">initMeshDistr</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>      <span class="k">subroutine </span><span class="n">initMeshDistr</span><span class="p">(</span> <span class="n">iDistr</span><span class="p">,</span> <span class="n">oDistr</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">wload</span> <span class="p">)</span>
<span class="c">!! Computes a new data distribution and the communications needed to</span>
<span class="c">!! move data from/to the current distribution to the existing ones.</span>
<span class="c">!!</span>
<span class="c">!! The limits of the new distributions are stored in the current module</span>
<span class="c">!! in `[[moreMeshSubs(module):meshDistr(variable)]]`:</span>
<span class="c">!!</span>
<span class="c">!!     meshDistr(oDistr)</span>
<span class="c">!!     meshCommu(((oDistr-2)*(oDistr-1))/2+1:(oDistr-1)*oDistr/2)</span>
<span class="c">!!</span>
<span class="c">!! If this is the first distribution, we split the mesh uniformly among</span>
<span class="c">!! the several processes (we only split it in dimensions Y and Z).</span>
<span class="c">!!</span>
<span class="c">!! For the other data distributions we should split the vector wload.</span>
<span class="c">!! The subroutine splitwload will return the limits of the new data</span>
<span class="c">!! distribution. The subroutine compMeshComm will return the communications</span>
<span class="c">!! needed to move data from/to the current distribution to/from the</span>
<span class="c">!! previous ones.</span>

      <span class="k">implicit none</span>
<span class="k">      </span><span class="kt">integer</span><span class="p">,</span> <span class="k">optional</span><span class="p">,</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iDistr</span>
        <span class="c">!!  Distribution index of the input vector</span>
      <span class="kt">integer</span><span class="p">,</span>            <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">oDistr</span>
        <span class="c">!!  The new data distribution index</span>
      <span class="kt">integer</span><span class="p">,</span>            <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nm</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="c">!!  Number of Mesh divisions of each cell vector</span>
      <span class="kt">integer</span><span class="p">,</span> <span class="k">optional</span><span class="p">,</span>  <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">wload</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
        <span class="c">!!  Weights of every point of the mesh using the input distribution</span>

<span class="c">!     Local variables</span>
      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">myName</span> <span class="o">=</span> <span class="n">moduName</span><span class="o">//</span><span class="s1">&#39;initMeshDistr &#39;</span>
      <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">errMsg</span> <span class="o">=</span> <span class="n">myName</span><span class="o">//</span><span class="s1">&#39;ERROR: &#39;</span>
      <span class="kt">integer</span>                     <span class="kd">::</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">PY</span><span class="p">,</span> <span class="n">PZ</span><span class="p">,</span> <span class="n">PP</span><span class="p">,</span> <span class="n">ProcessorZ</span><span class="p">,</span>
     <span class="p">&amp;</span>                               <span class="n">blocY</span><span class="p">,</span> <span class="n">blocZ</span><span class="p">,</span> <span class="n">nremY</span><span class="p">,</span> <span class="n">nremZ</span><span class="p">,</span>
     <span class="p">&amp;</span>                               <span class="n">iniY</span><span class="p">,</span> <span class="n">iniZ</span><span class="p">,</span> <span class="n">dimY</span><span class="p">,</span> <span class="n">dimZ</span><span class="p">,</span> <span class="n">nsize</span>
      <span class="k">type</span><span class="p">(</span><span class="n">meshDisType</span><span class="p">),</span>  <span class="k">pointer</span> <span class="kd">::</span> <span class="n">distr</span>
      <span class="kt">logical</span><span class="p">,</span>               <span class="k">save</span> <span class="kd">::</span> <span class="n">firstime</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
      <span class="kt">integer</span><span class="p">,</span> <span class="k">pointer</span>            <span class="kd">::</span> <span class="n">box</span><span class="p">(:,:,:),</span> <span class="n">mybox</span><span class="p">(:,:)</span>

      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;INITMESH&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>

<span class="c">!     Check the number of mesh distribution</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">oDistr</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">maxDistr</span><span class="p">)</span>
     <span class="p">&amp;</span>  <span class="k">call </span><span class="n">die</span><span class="p">(</span> <span class="n">errMsg</span> <span class="o">//</span> <span class="s1">&#39;oDistr.gt.maxDistr&#39;</span> <span class="p">)</span>

<span class="c">!     Reset data if necessay</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">firstime</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        do </span><span class="n">ii</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxDistr</span>
          <span class="k">nullify</span><span class="p">(</span><span class="n">meshDistr</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">box</span><span class="p">)</span>
          <span class="k">nullify</span><span class="p">(</span><span class="n">meshDistr</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">indexp</span><span class="p">)</span>
          <span class="k">nullify</span><span class="p">(</span><span class="n">meshDistr</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">idop</span><span class="p">)</span>
          <span class="k">nullify</span><span class="p">(</span><span class="n">meshDistr</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">xdop</span><span class="p">)</span>
          <span class="k">nullify</span><span class="p">(</span><span class="n">meshDistr</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">ipa</span><span class="p">)</span>
        <span class="n">enddo</span>
        <span class="k">do </span><span class="n">ii</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">maxDistr</span><span class="o">*</span><span class="p">(</span><span class="n">maxDistr</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
          <span class="k">nullify</span><span class="p">(</span><span class="n">meshCommu</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">src</span><span class="p">)</span>
          <span class="k">nullify</span><span class="p">(</span><span class="n">meshCommu</span><span class="p">(</span><span class="n">ii</span><span class="p">)%</span><span class="n">dst</span><span class="p">)</span>
        <span class="n">enddo</span>
        <span class="k">do </span><span class="n">ii</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxDistr</span>
          <span class="k">do </span><span class="n">jj</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
            <span class="k">nullify</span><span class="p">(</span><span class="n">exteCommu</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">)%</span><span class="n">src</span><span class="p">)</span>
            <span class="k">nullify</span><span class="p">(</span><span class="n">exteCommu</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">)%</span><span class="n">dst</span><span class="p">)</span>
          <span class="n">enddo</span>
        <span class="n">enddo</span>
<span class="cp">#ifdef ASYNCHRONOUS</span>
        <span class="k">nullify</span><span class="p">(</span><span class="n">tBuff1</span><span class="p">)</span>
        <span class="k">nullify</span><span class="p">(</span><span class="n">tBuff2</span><span class="p">)</span>
<span class="cp">#endif</span>
        <span class="n">firstime</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
      <span class="n">endif</span>

      <span class="n">distr</span> <span class="o">=&gt;</span> <span class="n">meshDistr</span><span class="p">(</span><span class="n">oDistr</span><span class="p">)</span>
<span class="c">!     Allocate memory for the current distribution</span>
      <span class="k">nullify</span><span class="p">(</span> <span class="n">distr</span><span class="p">%</span><span class="n">box</span> <span class="p">)</span>
      <span class="k">call </span><span class="n">re_alloc</span><span class="p">(</span> <span class="n">distr</span><span class="p">%</span><span class="n">box</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Nodes</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="s1">&#39;distr%box&#39;</span><span class="p">,</span> <span class="n">moduName</span> <span class="p">)</span>

<span class="c">!     The first distribution should be the uniform distribution</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">oDistr</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        </span><span class="n">ProcessorZ</span> <span class="o">=</span> <span class="n">Nodes</span><span class="o">/</span><span class="n">ProcessorY</span>
        <span class="n">blocY</span> <span class="o">=</span> <span class="p">(</span><span class="n">nm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">ProcessorY</span><span class="p">)</span>
        <span class="n">blocZ</span> <span class="o">=</span> <span class="p">(</span><span class="n">nm</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">ProcessorZ</span><span class="p">)</span>
        <span class="n">nremY</span> <span class="o">=</span> <span class="n">nm</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">blocY</span><span class="o">*</span><span class="n">ProcessorY</span>
        <span class="n">nremZ</span> <span class="o">=</span> <span class="n">nm</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">blocZ</span><span class="o">*</span><span class="n">ProcessorZ</span>

        <span class="n">PP</span>   <span class="o">=</span> <span class="mi">1</span>
        <span class="n">iniY</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">do </span><span class="n">PY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ProcessorY</span>
          <span class="n">dimY</span> <span class="o">=</span> <span class="n">blocY</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">PY</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">nremY</span><span class="p">)</span> <span class="n">dimY</span> <span class="o">=</span> <span class="n">dimY</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="n">iniZ</span> <span class="o">=</span> <span class="mi">1</span>
          <span class="k">do </span><span class="n">PZ</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ProcessorZ</span>
            <span class="n">dimZ</span> <span class="o">=</span> <span class="n">blocZ</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">PZ</span><span class="p">.</span><span class="n">LE</span><span class="p">.</span><span class="n">nremZ</span><span class="p">)</span> <span class="n">dimZ</span> <span class="o">=</span> <span class="n">dimZ</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">distr</span><span class="p">%</span><span class="n">box</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">PP</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">distr</span><span class="p">%</span><span class="n">box</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">PP</span><span class="p">)</span> <span class="o">=</span> <span class="n">nm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">distr</span><span class="p">%</span><span class="n">box</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">PP</span><span class="p">)</span> <span class="o">=</span> <span class="n">iniY</span>
            <span class="n">distr</span><span class="p">%</span><span class="n">box</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">PP</span><span class="p">)</span> <span class="o">=</span> <span class="n">iniY</span> <span class="o">+</span> <span class="n">dimY</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">distr</span><span class="p">%</span><span class="n">box</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">PP</span><span class="p">)</span> <span class="o">=</span> <span class="n">iniZ</span>
            <span class="n">distr</span><span class="p">%</span><span class="n">box</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">PP</span><span class="p">)</span> <span class="o">=</span> <span class="n">iniZ</span> <span class="o">+</span> <span class="n">dimZ</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="n">iniZ</span> <span class="o">=</span> <span class="n">iniZ</span> <span class="o">+</span> <span class="n">dimZ</span>
            <span class="n">PP</span>   <span class="o">=</span> <span class="n">PP</span> <span class="o">+</span> <span class="mi">1</span>
          <span class="n">enddo</span>
          <span class="n">iniY</span> <span class="o">=</span> <span class="n">iniY</span> <span class="o">+</span> <span class="n">dimY</span>
        <span class="n">enddo</span>
      <span class="k">else</span>
<span class="c">!       In order to compute the other data distributions, we should split</span>
<span class="c">!       the vector &quot;wload&quot; among the several processes</span>
<span class="cp">#ifdef MPI</span>
        <span class="k">if</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">iDistr</span><span class="p">)</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span>
     <span class="p">&amp;</span>      <span class="p">.</span><span class="nb">NOT</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">wload</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">die</span><span class="p">(</span> <span class="n">errMsg</span> <span class="o">//</span> <span class="s1">&#39;Wrong parameters&#39;</span> <span class="p">)</span>
        <span class="n">endif</span>

        <span class="k">call </span><span class="n">splitwload</span><span class="p">(</span> <span class="n">Nodes</span><span class="p">,</span> <span class="n">node</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">wload</span><span class="p">,</span>
     <span class="p">&amp;</span>                   <span class="n">meshDistr</span><span class="p">(</span><span class="n">iDistr</span><span class="p">),</span> <span class="n">meshDistr</span><span class="p">(</span><span class="n">oDistr</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">call </span><span class="n">reordMeshNumbering</span><span class="p">(</span> <span class="n">meshDistr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">distr</span> <span class="p">)</span>

<span class="c">!       Precompute the communications needed to move data between the new data</span>
<span class="c">!       distribution and the previous ones.</span>
        <span class="n">jj</span> <span class="o">=</span> <span class="p">((</span><span class="n">oDistr</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">oDistr</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">oDistr</span><span class="o">-</span><span class="mi">1</span>
          <span class="k">call </span><span class="n">compMeshComm</span><span class="p">(</span> <span class="n">meshDistr</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span> <span class="n">distr</span><span class="p">,</span> <span class="n">meshCommu</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span> <span class="p">)</span>
          <span class="n">jj</span> <span class="o">=</span> <span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">enddo</span>
<span class="cp">#endif</span>
      <span class="n">endif</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">Node</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;(a,i3)&quot;</span><span class="p">)</span><span class="s2">&quot;New grid distribution: &quot;</span><span class="p">,</span> <span class="n">oDistr</span>
         <span class="k">do </span><span class="n">PP</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Nodes</span>
            <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;(i12,3x,3(i5,a1,i5))&quot;</span><span class="p">)</span>
     <span class="err">$</span>       <span class="n">PP</span><span class="p">,</span>
     <span class="err">$</span>       <span class="p">(</span><span class="n">distr</span><span class="p">%</span><span class="n">box</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">PP</span><span class="p">),</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">distr</span><span class="p">%</span><span class="n">box</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">PP</span><span class="p">),</span> <span class="n">jj</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
         <span class="n">enddo</span>
      <span class="n">endif</span>

      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;INITMESH&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

      <span class="k">end subroutine </span><span class="n">initMeshDistr</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SIESTA was developed by SIESTA Group</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>