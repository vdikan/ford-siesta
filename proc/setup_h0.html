<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="A first-principles materials simulation code using Density Functional Theory.">
    
    <meta name="author" content="SIESTA Group" >
    <link rel="icon" href="../favicon.png">

    <title>setup_H0 &ndash; SIESTA</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SIESTA <small>trunk-674</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li><a href='../page/index.html'>Program Overview</a></li>
	    
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>setup_H0
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 2.1% of total for procedures.">62 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/setup_H0.F"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li><a href='../sourcefile/setup_h0.f.html'>setup_H0.F</a></li>
  
     <li><a href='../module/m_setup_h0.html'>m_setup_H0</a></li>
  
     <li class="active">setup_H0</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  




















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/setup_h0.html#src">setup_H0</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprocs-0">All Procedures</a></h3></div>
  <div id="allprocs-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../proc/compute_dm.html">compute_dm</a>
      
      <a class="list-group-item" href="../proc/current_itt.html">current_itt</a>
      
      <a class="list-group-item" href="../proc/getstackval.html">getstackval</a>
      
      <a class="list-group-item" href="../proc/inverse.html">inverse</a>
      
      <a class="list-group-item" href="../proc/is_next.html">is_next</a>
      
      <a class="list-group-item" href="../proc/mix_method.html">mix_method</a>
      
      <a class="list-group-item" href="../proc/mix_method_variant.html">mix_method_variant</a>
      
      <a class="list-group-item" href="../proc/mixer_init.html">mixer_init</a>
      
      <a class="list-group-item" href="../proc/mixers_history_init.html">mixers_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_init.html">mixers_init</a>
      
      <a class="list-group-item" href="../proc/mixers_print.html">mixers_print</a>
      
      <a class="list-group-item" href="../proc/mixers_print_block.html">mixers_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_reset.html">mixers_reset</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_history_init.html">mixers_scf_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_init.html">mixers_scf_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print.html">mixers_scf_print</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print_block.html">mixers_scf_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_reset.html">mixers_scf_reset</a>
      
      <a class="list-group-item" href="../interface/mixing.html">mixing</a>
      
      <a class="list-group-item" href="../proc/mixing_1d.html">mixing_1d</a>
      
      <a class="list-group-item" href="../proc/mixing_2d.html">mixing_2d</a>
      
      <a class="list-group-item" href="../proc/mixing_calc_next.html">mixing_calc_next</a>
      
      <a class="list-group-item" href="../proc/mixing_coeff.html">mixing_coeff</a>
      
      <a class="list-group-item" href="../proc/mixing_finalize.html">mixing_finalize</a>
      
      <a class="list-group-item" href="../proc/mixing_init.html">mixing_init</a>
      
      <a class="list-group-item" href="../proc/mixing_ncoeff.html">mixing_ncoeff</a>
      
      <a class="list-group-item" href="../proc/mixing_scf_converged.html">mixing_scf_converged</a>
      
      <a class="list-group-item" href="../proc/mixing_step.html">mixing_step</a>
      
      <a class="list-group-item" href="../proc/norm.html">norm</a>
      
      <a class="list-group-item" href="../proc/push_diff.html">push_diff</a>
      
      <a class="list-group-item" href="../proc/push_f.html">push_F</a>
      
      <a class="list-group-item" href="../proc/push_stack_data.html">push_stack_data</a>
      
      <a class="list-group-item" href="../proc/setup_h0.html">setup_H0</a>
      
      <a class="list-group-item" href="../proc/setup_hamiltonian.html">setup_hamiltonian</a>
      
      <a class="list-group-item" href="../proc/siesta_analysis.html">siesta_analysis</a>
      
      <a class="list-group-item" href="../proc/siesta_forces.html">siesta_forces</a>
      
      <a class="list-group-item" href="../proc/stack_check.html">stack_check</a>
      
      <a class="list-group-item" href="../proc/state_analysis.html">state_analysis</a>
      
      <a class="list-group-item" href="../proc/state_init.html">state_init</a>
      
      <a class="list-group-item" href="../proc/svd.html">svd</a>
      
      <a class="list-group-item" href="../proc/update_f.html">update_F</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine setup_H0(g2max)
    
    
	 
</h2>
    
  
    <div class="panel panel-default">
      <div class="panel-heading">
	<h3 class="panel-title">Uses</h3>
      </div>
      <ul class="list-group">
      
      <li class="list-group-item">
	<ul class="list-inline">
	  
	  <li>siesta_options</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>sparse_matrices</li>
	  
	  <li>siesta_geom</li>
	  
	  <li>atmfuncs</li>
	  
	  <li>atomlist</li>
	  
	  <li>metaforce</li>
	  
	  <li>molecularmechanics</li>
	  
	  <li>m_nlefsm</li>
	  
	  <li>m_kinefsm</li>
	  
	  <li>m_naefs</li>
	  
	  <li>m_dnaefs</li>
	  
	  <li>m_dhscf</li>
	  
	  <li>m_energies</li>
	  
	  <li>m_ntm</li>
	  
	  <li>m_spin</li>
	  
	  <li>spinorbit</li>
	  
	  <li>alloc</li>
	  
	  <li>class_dSpData1D</li>
	  
	  <li>class_dSpData2D</li>
	  
	  <li>m_mpi_utils</li>
	  
	</ul>
      </li>
      
      
      
      <li class="list-group-item">
	<div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~setup_h0~~UsesGraph Pages: 1 -->
<svg id="procsetup_h0UsesGraph" width="212pt" height="830pt"
 viewBox="0.00 0.00 212.00 830.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~setup_h0~~UsesGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 826)">
<title>proc~~setup_h0~~UsesGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-826 208,-826 208,4 -4,4"/>
<!-- proc~setup_h0 -->
<g id="proc~~setup_h0~~UsesGraph_node1" class="node"><title>proc~setup_h0</title>
<polygon fill="none" stroke="black" points="204,-423 146,-423 146,-399 204,-399 204,-423"/>
<text text-anchor="middle" x="175" y="-408.6" font-family="Helvetica,sans-Serif" font-size="10.50">setup_H0</text>
</g>
<!-- m_naefs -->
<g id="proc~~setup_h0~~UsesGraph_node2" class="node"><title>m_naefs</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82,-822 28,-822 28,-798 82,-798 82,-822"/>
<text text-anchor="middle" x="55" y="-807.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_naefs</text>
</g>
<!-- proc~setup_h0&#45;&gt;m_naefs -->
<g id="proc~~setup_h0~~UsesGraph_edge1" class="edge"><title>proc~setup_h0&#45;&gt;m_naefs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M173.51,-423.341C170.955,-481.843 157.41,-730.827 110,-789 105.238,-794.843 98.6366,-799.065 91.681,-802.114"/>
<polygon fill="#000000" stroke="#000000" points="90.321,-798.884 82.1158,-805.586 92.7099,-805.464 90.321,-798.884"/>
</g>
<!-- alloc -->
<g id="proc~~setup_h0~~UsesGraph_node3" class="node"><title>alloc</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82,-780 28,-780 28,-756 82,-756 82,-780"/>
<text text-anchor="middle" x="55" y="-765.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">alloc</text>
</g>
<!-- proc~setup_h0&#45;&gt;alloc -->
<g id="proc~~setup_h0~~UsesGraph_edge2" class="edge"><title>proc~setup_h0&#45;&gt;alloc</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M173.244,-423.041C169.636,-476.97 152.543,-695.878 110,-747 105.178,-752.794 98.5522,-756.995 91.5915,-760.04"/>
<polygon fill="#000000" stroke="#000000" points="90.2325,-756.81 82.03,-763.516 92.6241,-763.389 90.2325,-756.81"/>
</g>
<!-- m_spin -->
<g id="proc~~setup_h0~~UsesGraph_node4" class="node"><title>m_spin</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82,-738 28,-738 28,-714 82,-714 82,-738"/>
<text text-anchor="middle" x="55" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_spin</text>
</g>
<!-- proc~setup_h0&#45;&gt;m_spin -->
<g id="proc~~setup_h0~~UsesGraph_edge3" class="edge"><title>proc~setup_h0&#45;&gt;m_spin</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M172.874,-423.183C168.042,-473.048 147.584,-661.019 110,-705 105.148,-710.678 98.5678,-714.829 91.6702,-717.861"/>
<polygon fill="#000000" stroke="#000000" points="90.3796,-714.606 82.2001,-721.34 92.7937,-721.177 90.3796,-714.606"/>
</g>
<!-- m_dhscf -->
<g id="proc~~setup_h0~~UsesGraph_node5" class="node"><title>m_dhscf</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82,-696 28,-696 28,-672 82,-672 82,-696"/>
<text text-anchor="middle" x="55" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_dhscf</text>
</g>
<!-- proc~setup_h0&#45;&gt;m_dhscf -->
<g id="proc~~setup_h0~~UsesGraph_edge4" class="edge"><title>proc~setup_h0&#45;&gt;m_dhscf</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M174.558,-423.003C175.733,-462.57 174.157,-590.484 110,-663 105.051,-668.594 98.4303,-672.709 91.5237,-675.734"/>
<polygon fill="#000000" stroke="#000000" points="90.2343,-672.479 82.0588,-679.217 92.6523,-679.048 90.2343,-672.479"/>
</g>
<!-- atomlist -->
<g id="proc~~setup_h0~~UsesGraph_node6" class="node"><title>atomlist</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82,-654 28,-654 28,-630 82,-630 82,-654"/>
<text text-anchor="middle" x="55" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">atomlist</text>
</g>
<!-- proc~setup_h0&#45;&gt;atomlist -->
<g id="proc~~setup_h0~~UsesGraph_edge5" class="edge"><title>proc~setup_h0&#45;&gt;atomlist</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M173.816,-423.221C172.628,-458.6 164.432,-562.32 110,-621 104.968,-626.425 98.3686,-630.466 91.5187,-633.471"/>
<polygon fill="#000000" stroke="#000000" points="90.2976,-630.191 82.1461,-636.959 92.7389,-636.751 90.2976,-630.191"/>
</g>
<!-- spinorbit -->
<g id="proc~~setup_h0~~UsesGraph_node7" class="node"><title>spinorbit</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82,-612 28,-612 28,-588 82,-588 82,-612"/>
<text text-anchor="middle" x="55" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">spinorbit</text>
</g>
<!-- proc~setup_h0&#45;&gt;spinorbit -->
<g id="proc~~setup_h0~~UsesGraph_edge6" class="edge"><title>proc~setup_h0&#45;&gt;spinorbit</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M172.704,-423.387C168.868,-453.965 154.866,-533.822 110,-579 104.952,-584.083 98.5333,-587.963 91.8974,-590.916"/>
<polygon fill="#000000" stroke="#000000" points="90.2627,-587.793 82.1538,-594.612 92.7451,-594.338 90.2627,-587.793"/>
</g>
<!-- m_kinefsm -->
<g id="proc~~setup_h0~~UsesGraph_node8" class="node"><title>m_kinefsm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="87,-570 23,-570 23,-546 87,-546 87,-570"/>
<text text-anchor="middle" x="55" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_kinefsm</text>
</g>
<!-- proc~setup_h0&#45;&gt;m_kinefsm -->
<g id="proc~~setup_h0~~UsesGraph_edge7" class="edge"><title>proc~setup_h0&#45;&gt;m_kinefsm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M170.975,-423.2C164.225,-448.011 145.646,-504.722 110,-537 106.047,-540.58 101.415,-543.577 96.5557,-546.08"/>
<polygon fill="#000000" stroke="#000000" points="94.7635,-543.047 87.0478,-550.307 97.6073,-549.443 94.7635,-543.047"/>
</g>
<!-- m_dnaefs -->
<g id="proc~~setup_h0~~UsesGraph_node9" class="node"><title>m_dnaefs</title>
<polygon fill="#337ab7" stroke="#337ab7" points="85,-528 25,-528 25,-504 85,-504 85,-528"/>
<text text-anchor="middle" x="55" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_dnaefs</text>
</g>
<!-- proc~setup_h0&#45;&gt;m_dnaefs -->
<g id="proc~~setup_h0~~UsesGraph_edge9" class="edge"><title>proc~setup_h0&#45;&gt;m_dnaefs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M167.566,-423.266C157.527,-441.315 136.511,-475.042 110,-495 105.429,-498.441 100.224,-501.389 94.8922,-503.894"/>
<polygon fill="#000000" stroke="#000000" points="93.1327,-500.837 85.267,-507.935 95.8423,-507.291 93.1327,-500.837"/>
</g>
<!-- m_energies -->
<g id="proc~~setup_h0~~UsesGraph_node10" class="node"><title>m_energies</title>
<polygon fill="#337ab7" stroke="#337ab7" points="89.5,-486 20.5,-486 20.5,-462 89.5,-462 89.5,-486"/>
<text text-anchor="middle" x="55" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_energies</text>
</g>
<!-- proc~setup_h0&#45;&gt;m_energies -->
<g id="proc~~setup_h0~~UsesGraph_edge11" class="edge"><title>proc~setup_h0&#45;&gt;m_energies</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M157.737,-423.049C145.135,-432.04 127.012,-444.234 110,-453 106.479,-454.814 102.764,-456.567 98.9976,-458.235"/>
<polygon fill="#000000" stroke="#000000" points="97.4667,-455.082 89.6107,-462.191 100.185,-461.532 97.4667,-455.082"/>
</g>
<!-- atmfuncs -->
<g id="proc~~setup_h0~~UsesGraph_node11" class="node"><title>atmfuncs</title>
<polygon fill="#337ab7" stroke="#337ab7" points="83,-444 27,-444 27,-420 83,-420 83,-444"/>
<text text-anchor="middle" x="55" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">atmfuncs</text>
</g>
<!-- proc~setup_h0&#45;&gt;atmfuncs -->
<g id="proc~~setup_h0~~UsesGraph_edge10" class="edge"><title>proc~setup_h0&#45;&gt;atmfuncs</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M145.736,-416.03C130.039,-418.824 110.315,-422.334 93.3598,-425.351"/>
<polygon fill="#000000" stroke="#000000" points="92.4529,-421.958 83.2209,-427.156 93.6795,-428.849 92.4529,-421.958"/>
</g>
<!-- m_ntm -->
<g id="proc~~setup_h0~~UsesGraph_node12" class="node"><title>m_ntm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="82,-402 28,-402 28,-378 82,-378 82,-402"/>
<text text-anchor="middle" x="55" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ntm</text>
</g>
<!-- proc~setup_h0&#45;&gt;m_ntm -->
<g id="proc~~setup_h0~~UsesGraph_edge13" class="edge"><title>proc~setup_h0&#45;&gt;m_ntm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M145.736,-405.97C129.7,-403.116 109.462,-399.514 92.2659,-396.454"/>
<polygon fill="#000000" stroke="#000000" points="92.4751,-392.936 82.0166,-394.63 91.2486,-399.828 92.4751,-392.936"/>
</g>
<!-- m_nlefsm -->
<g id="proc~~setup_h0~~UsesGraph_node13" class="node"><title>m_nlefsm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84.5,-360 25.5,-360 25.5,-336 84.5,-336 84.5,-360"/>
<text text-anchor="middle" x="55" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_nlefsm</text>
</g>
<!-- proc~setup_h0&#45;&gt;m_nlefsm -->
<g id="proc~~setup_h0~~UsesGraph_edge12" class="edge"><title>proc~setup_h0&#45;&gt;m_nlefsm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M157.737,-398.951C145.135,-389.96 127.012,-377.766 110,-369 104.97,-366.408 99.5439,-363.941 94.1379,-361.67"/>
<polygon fill="#000000" stroke="#000000" points="95.1031,-358.286 84.5191,-357.807 92.4946,-364.782 95.1031,-358.286"/>
</g>
<!-- m_mpi_utils -->
<g id="proc~~setup_h0~~UsesGraph_node14" class="node"><title>m_mpi_utils</title>
<polygon fill="#337ab7" stroke="#337ab7" points="90,-318 20,-318 20,-294 90,-294 90,-318"/>
<text text-anchor="middle" x="55" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_mpi_utils</text>
</g>
<!-- proc~setup_h0&#45;&gt;m_mpi_utils -->
<g id="proc~~setup_h0~~UsesGraph_edge15" class="edge"><title>proc~setup_h0&#45;&gt;m_mpi_utils</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M167.566,-398.734C157.527,-380.685 136.511,-346.958 110,-327 106.655,-324.482 102.97,-322.227 99.1441,-320.217"/>
<polygon fill="#000000" stroke="#000000" points="100.596,-317.032 90.0551,-315.962 97.6277,-323.372 100.596,-317.032"/>
</g>
<!-- siesta_geom -->
<g id="proc~~setup_h0~~UsesGraph_node15" class="node"><title>siesta_geom</title>
<polygon fill="#337ab7" stroke="#337ab7" points="91.5,-276 18.5,-276 18.5,-252 91.5,-252 91.5,-276"/>
<text text-anchor="middle" x="55" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_geom</text>
</g>
<!-- proc~setup_h0&#45;&gt;siesta_geom -->
<g id="proc~~setup_h0~~UsesGraph_edge14" class="edge"><title>proc~setup_h0&#45;&gt;siesta_geom</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M170.975,-398.8C164.225,-373.989 145.646,-317.278 110,-285 107.188,-282.453 104.032,-280.201 100.694,-278.212"/>
<polygon fill="#000000" stroke="#000000" points="102.046,-274.973 91.549,-273.54 98.8617,-281.206 102.046,-274.973"/>
</g>
<!-- siesta_options -->
<g id="proc~~setup_h0~~UsesGraph_node16" class="node"><title>siesta_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="95.5,-234 14.5,-234 14.5,-210 95.5,-210 95.5,-234"/>
<text text-anchor="middle" x="55" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_options</text>
</g>
<!-- proc~setup_h0&#45;&gt;siesta_options -->
<g id="proc~~setup_h0~~UsesGraph_edge20" class="edge"><title>proc~setup_h0&#45;&gt;siesta_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M172.704,-398.613C168.868,-368.035 154.866,-288.178 110,-243 108.201,-241.189 106.229,-239.531 104.134,-238.012"/>
<polygon fill="#000000" stroke="#000000" points="105.93,-235.008 95.5626,-232.826 102.306,-240.997 105.93,-235.008"/>
</g>
<!-- molecularmechanics -->
<g id="proc~~setup_h0~~UsesGraph_node17" class="node"><title>molecularmechanics</title>
<polygon fill="#337ab7" stroke="#337ab7" points="110,-192 0,-192 0,-168 110,-168 110,-192"/>
<text text-anchor="middle" x="55" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">molecularmechanics</text>
</g>
<!-- proc~setup_h0&#45;&gt;molecularmechanics -->
<g id="proc~~setup_h0~~UsesGraph_edge16" class="edge"><title>proc~setup_h0&#45;&gt;molecularmechanics</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M173.816,-398.779C172.628,-363.4 164.432,-259.68 110,-201 108.974,-199.894 107.883,-198.845 106.737,-197.851"/>
<polygon fill="#000000" stroke="#000000" points="108.703,-194.954 98.5135,-192.051 104.669,-200.675 108.703,-194.954"/>
</g>
<!-- class_dSpData2D -->
<g id="proc~~setup_h0~~UsesGraph_node18" class="node"><title>class_dSpData2D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="103.5,-150 6.5,-150 6.5,-126 103.5,-126 103.5,-150"/>
<text text-anchor="middle" x="55" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dSpData2D</text>
</g>
<!-- proc~setup_h0&#45;&gt;class_dSpData2D -->
<g id="proc~~setup_h0~~UsesGraph_edge17" class="edge"><title>proc~setup_h0&#45;&gt;class_dSpData2D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M174.558,-398.997C175.733,-359.43 174.157,-231.516 110,-159 109.119,-158.004 108.185,-157.055 107.206,-156.151"/>
<polygon fill="#000000" stroke="#000000" points="109.069,-153.176 98.9439,-150.056 104.914,-158.809 109.069,-153.176"/>
</g>
<!-- class_dSpData1D -->
<g id="proc~~setup_h0~~UsesGraph_node19" class="node"><title>class_dSpData1D</title>
<polygon fill="#337ab7" stroke="#337ab7" points="103.5,-108 6.5,-108 6.5,-84 103.5,-84 103.5,-108"/>
<text text-anchor="middle" x="55" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">class_dSpData1D</text>
</g>
<!-- proc~setup_h0&#45;&gt;class_dSpData1D -->
<g id="proc~~setup_h0~~UsesGraph_edge18" class="edge"><title>proc~setup_h0&#45;&gt;class_dSpData1D</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M172.874,-398.817C168.042,-348.952 147.584,-160.981 110,-117 109.155,-116.011 108.257,-115.068 107.314,-114.169"/>
<polygon fill="#000000" stroke="#000000" points="109.409,-111.365 99.3276,-108.108 105.178,-116.942 109.409,-111.365"/>
</g>
<!-- sparse_matrices -->
<g id="proc~~setup_h0~~UsesGraph_node20" class="node"><title>sparse_matrices</title>
<polygon fill="#337ab7" stroke="#337ab7" points="100.5,-66 9.5,-66 9.5,-42 100.5,-42 100.5,-66"/>
<text text-anchor="middle" x="55" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sparse_matrices</text>
</g>
<!-- proc~setup_h0&#45;&gt;sparse_matrices -->
<g id="proc~~setup_h0~~UsesGraph_edge19" class="edge"><title>proc~setup_h0&#45;&gt;sparse_matrices</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M173.244,-398.959C169.636,-345.03 152.543,-126.122 110,-75 109.168,-73.9997 108.281,-73.0469 107.349,-72.1392"/>
<polygon fill="#000000" stroke="#000000" points="109.478,-69.3615 99.4209,-66.0296 105.205,-74.9061 109.478,-69.3615"/>
</g>
<!-- metaforce -->
<g id="proc~~setup_h0~~UsesGraph_node21" class="node"><title>metaforce</title>
<polygon fill="#337ab7" stroke="#337ab7" points="85.5,-24 24.5,-24 24.5,-0 85.5,-0 85.5,-24"/>
<text text-anchor="middle" x="55" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">metaforce</text>
</g>
<!-- proc~setup_h0&#45;&gt;metaforce -->
<g id="proc~~setup_h0~~UsesGraph_edge8" class="edge"><title>proc~setup_h0&#45;&gt;metaforce</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M173.51,-398.659C170.955,-340.157 157.41,-91.1728 110,-33 106.092,-28.2046 100.945,-24.5013 95.38,-21.6421"/>
<polygon fill="#000000" stroke="#000000" points="96.3389,-18.2479 85.7649,-17.5834 93.6166,-24.6968 96.3389,-18.2479"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="490pt" height="32pt"
 viewBox="0.00 0.00 489.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 485.5,-28 485.5,4 -4,4"/>
<!-- Module -->
<g id="node1" class="node"><title>Module</title>
<polygon fill="#337ab7" stroke="#337ab7" points="54,-24 0,-24 0,-0 54,-0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Module</text>
</g>
<!-- Submodule -->
<g id="node2" class="node"><title>Submodule</title>
<polygon fill="#5bc0de" stroke="#5bc0de" points="139.5,-24 72.5,-24 72.5,-0 139.5,-0 139.5,-24"/>
<text text-anchor="middle" x="106" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Submodule</text>
</g>
<!-- Subroutine -->
<g id="node3" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="222,-24 158,-24 158,-0 222,-0 222,-24"/>
<text text-anchor="middle" x="190" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node4" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="294,-24 240,-24 240,-0 294,-0 294,-24"/>
<text text-anchor="middle" x="267" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="366,-24 312,-24 312,-0 366,-0 366,-24"/>
<text text-anchor="middle" x="339" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="481.5,-24 384.5,-24 384.5,-0 481.5,-0 481.5,-24"/>
<text text-anchor="middle" x="433" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a submodule to the (sub)module which it is
    descended from. Dashed arrows point from a module or program unit to 
    modules which it uses.
    </p>
    </div></div></div></div>
      </li>
      
      </ul>
    </div>
    


    
    <p>Computes non-self-consistent part of the Hamiltonian
 and initializes data structures on the grid.
</p><div class="alert alert-warning" role="alert"><h4>Warning</h4><p>What exactly IS the nscf H?</p></div>
<p>Self-energy of isolated ions
<pre></p>
<p>Eions = 0.0_dp
do ia = 1,na_u
is = isa(ia)
Eions = Eions + uion(is)
enddo
</pre>
<p>Neutral-atom: energy
</p><div class="alert alert-info" role="alert"><h4>Note</h4><p>In these routines, flag is defined
  to tell them NOT to compute
  forces and stresses in this first pass, only energies.
</p></div>
<p><pre></p>
<p>call naefs(na_u, na_s, scell, xa, indxua, rmaxv, &amp;
isa, Ena, dummy_fa, dummy_stress, &amp;
forces_and_stress=.false.)
call dnaefs(na_u, na_s, scell, xa, indxua, rmaxv, &amp;
isa, DEna, dummy_fa, dummy_stress, &amp;
forces_and_stress=.false.)
Ena = Ena + DEna
</pre>
<p>Metadynamics energy:
 Add on force field contribution to energy:
 Now we compute matrix elements of the Kinetic and Non-local
  parts of H</p>
<p>Kinetic: matrix elements only
<pre></p>
<p>H_val =&gt; val(H_kin_1D)</p>
<p>H_val(:) = 0.0_dp</p>
<p>call kinefsm(na_u, na_s, no_s, scell, xa, indxua, rmaxo, &amp;
maxnh, maxnh, lasto, iphorb, isa, &amp;
numh, listhptr, listh, numh, listhptr, listh, &amp;
1, &amp;
dummy_dm, dummy_E, dummy_fa, dummy_stress, &amp;
H_val, &amp;
matrix_elements_only=.true.)
</pre>
<p>Non-local-pseudop:  matrix elements only
<pre></p>
<p>H_val =&gt; val(H_vkb_1D)</p>
<p>H_val(:) = 0.0_dp</p>
<p>call nlefsm(scell, na_u, na_s, isa, xa, indxua, &amp;
maxnh, maxnh, lasto, lastkb, iphorb, iphKB, &amp;
numh, listhptr, listh, numh, listhptr, listh, &amp;
1, &amp;
dummy_dm, dummy_E, dummy_fa, dummy_stress, &amp;
H_val, &amp;
matrix_elements_only=.true.)
</pre>
<p></p><div class="alert alert-info" role="alert"><h4>Note</h4><p>If in the future the spin-orbit routine is able to compute
  forces and stresses, then "last" will be needed. If we are not
  computing forces and stresses, calling it in the first iteratio      !n
  should be enough.
</p></div>
<p>
<p><pre></p>
<p>if ( spin%SO ) then
H_so =&gt; val(H_so_2D)</p>
<p>H_so = 0._dp</p>
<p>call spinorb(no_u,no_l,iaorb,iphorb,isa,indxuo, &amp;
maxnh,numh,listhptr,listh,Dscf,H_so,Eso)
else
Eso = 0._dp
end if
</pre>
<p>This will take care of possible changes to the mesh and atomic-r      !elated
mesh structures for geometry changes:
<pre></p>
<p>g2max = g2cut
call dhscf_init( spin%Grid, no_s, iaorb, iphorb, &amp;
no_l, no_u, na_u, na_s, &amp;
isa, xa, indxua, ucell, &amp;
mscell, G2max, ntm, &amp;
maxnh, numh, listhptr, listh, datm, &amp;
dummy_fa, dummy_stress)
</pre>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-g2max"></span>real(kind=dp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>g2max</strong></td><td></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
	<h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
	<div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~setup_h0~~CallsGraph Pages: 1 -->
<svg id="procsetup_h0CallsGraph" width="173pt" height="536pt"
 viewBox="0.00 0.00 173.00 536.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~setup_h0~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 532)">
<title>proc~~setup_h0~~CallsGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-532 169,-532 169,4 -4,4"/>
<!-- proc~setup_h0 -->
<g id="proc~~setup_h0~~CallsGraph_node1" class="node"><title>proc~setup_h0</title>
<polygon fill="none" stroke="black" points="58,-276 3.55271e-15,-276 3.55271e-15,-252 58,-252 58,-276"/>
<text text-anchor="middle" x="29" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50">setup_H0</text>
</g>
<!-- isa -->
<g id="proc~~setup_h0~~CallsGraph_node2" class="node"><title>isa</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-528 102.5,-528 102.5,-504 156.5,-504 156.5,-528"/>
<text text-anchor="middle" x="129.5" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">isa</text>
</g>
<!-- proc~setup_h0&#45;&gt;isa -->
<g id="proc~~setup_h0~~CallsGraph_edge1" class="edge"><title>proc~setup_h0&#45;&gt;isa</title>
<path fill="none" stroke="#000000" d="M30.3189,-276.148C31.8677,-312.916 40.9346,-424.78 94,-495 94.5549,-495.734 95.1435,-496.448 95.761,-497.143"/>
<polygon fill="#000000" stroke="#000000" points="93.4632,-499.783 103.258,-503.823 98.1201,-494.557 93.4632,-499.783"/>
</g>
<!-- naefs -->
<g id="proc~~setup_h0~~CallsGraph_node3" class="node"><title>naefs</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-486 102.5,-486 102.5,-462 156.5,-462 156.5,-486"/>
<text text-anchor="middle" x="129.5" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">naefs</text>
</g>
<!-- proc~setup_h0&#45;&gt;naefs -->
<g id="proc~~setup_h0~~CallsGraph_edge2" class="edge"><title>proc~setup_h0&#45;&gt;naefs</title>
<path fill="none" stroke="#000000" d="M31.2654,-276.438C35.133,-308.859 49.3906,-397.297 94,-453 94.5945,-453.742 95.2228,-454.465 95.8797,-455.168"/>
<polygon fill="#000000" stroke="#000000" points="93.9054,-458.086 103.772,-461.945 98.4656,-452.775 93.9054,-458.086"/>
</g>
<!-- spinorb -->
<g id="proc~~setup_h0~~CallsGraph_node4" class="node"><title>spinorb</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-444 102.5,-444 102.5,-420 156.5,-420 156.5,-444"/>
<text text-anchor="middle" x="129.5" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">spinorb</text>
</g>
<!-- proc~setup_h0&#45;&gt;spinorb -->
<g id="proc~~setup_h0~~CallsGraph_edge3" class="edge"><title>proc~setup_h0&#45;&gt;spinorb</title>
<path fill="none" stroke="#000000" d="M32.5943,-276.003C38.9272,-302.925 57.4049,-369.049 94,-411 94.7375,-411.845 95.5176,-412.667 96.332,-413.465"/>
<polygon fill="#000000" stroke="#000000" points="94.3987,-416.404 104.369,-419.988 98.81,-410.968 94.3987,-416.404"/>
</g>
<!-- val -->
<g id="proc~~setup_h0~~CallsGraph_node5" class="node"><title>val</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-402 102.5,-402 102.5,-378 156.5,-378 156.5,-402"/>
<text text-anchor="middle" x="129.5" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">val</text>
</g>
<!-- proc~setup_h0&#45;&gt;val -->
<g id="proc~~setup_h0~~CallsGraph_edge4" class="edge"><title>proc~setup_h0&#45;&gt;val</title>
<path fill="none" stroke="#000000" d="M35.139,-276.284C44.403,-297.301 65.6115,-340.629 94,-369 94.9206,-369.92 95.8892,-370.817 96.8938,-371.69"/>
<polygon fill="#000000" stroke="#000000" points="95.0125,-374.654 105.106,-377.874 99.2233,-369.062 95.0125,-374.654"/>
</g>
<!-- write_debug -->
<g id="proc~~setup_h0~~CallsGraph_node6" class="node"><title>write_debug</title>
<polygon fill="#777777" stroke="#777777" points="165,-360 94,-360 94,-336 165,-336 165,-360"/>
<text text-anchor="middle" x="129.5" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_debug</text>
</g>
<!-- proc~setup_h0&#45;&gt;write_debug -->
<g id="proc~~setup_h0~~CallsGraph_edge5" class="edge"><title>proc~setup_h0&#45;&gt;write_debug</title>
<path fill="none" stroke="#000000" d="M41.0427,-276.47C53.2401,-289.846 73.8341,-311.279 94,-327 95.3687,-328.067 96.7952,-329.124 98.2556,-330.163"/>
<polygon fill="#000000" stroke="#000000" points="96.5576,-333.237 106.823,-335.86 100.434,-327.408 96.5576,-333.237"/>
</g>
<!-- meta -->
<g id="proc~~setup_h0~~CallsGraph_node7" class="node"><title>meta</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-318 102.5,-318 102.5,-294 156.5,-294 156.5,-318"/>
<text text-anchor="middle" x="129.5" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">meta</text>
</g>
<!-- proc~setup_h0&#45;&gt;meta -->
<g id="proc~~setup_h0~~CallsGraph_edge6" class="edge"><title>proc~setup_h0&#45;&gt;meta</title>
<path fill="none" stroke="#000000" d="M58.2261,-276.036C69.0629,-280.656 81.5716,-285.99 93.005,-290.865"/>
<polygon fill="#000000" stroke="#000000" points="91.7243,-294.124 102.296,-294.827 94.4699,-287.685 91.7243,-294.124"/>
</g>
<!-- timer -->
<g id="proc~~setup_h0~~CallsGraph_node8" class="node"><title>timer</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-276 102.5,-276 102.5,-252 156.5,-252 156.5,-276"/>
<text text-anchor="middle" x="129.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">timer</text>
</g>
<!-- proc~setup_h0&#45;&gt;timer -->
<g id="proc~~setup_h0~~CallsGraph_edge7" class="edge"><title>proc~setup_h0&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M58.2261,-264C68.7378,-264 80.8226,-264 91.9731,-264"/>
<polygon fill="#000000" stroke="#000000" points="92.2958,-267.5 102.296,-264 92.2958,-260.5 92.2958,-267.5"/>
</g>
<!-- uion -->
<g id="proc~~setup_h0~~CallsGraph_node9" class="node"><title>uion</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-234 102.5,-234 102.5,-210 156.5,-210 156.5,-234"/>
<text text-anchor="middle" x="129.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">uion</text>
</g>
<!-- proc~setup_h0&#45;&gt;uion -->
<g id="proc~~setup_h0~~CallsGraph_edge8" class="edge"><title>proc~setup_h0&#45;&gt;uion</title>
<path fill="none" stroke="#000000" d="M58.2261,-251.964C69.0629,-247.344 81.5716,-242.01 93.005,-237.135"/>
<polygon fill="#000000" stroke="#000000" points="94.4699,-240.315 102.296,-233.173 91.7243,-233.876 94.4699,-240.315"/>
</g>
<!-- kinefsm -->
<g id="proc~~setup_h0~~CallsGraph_node10" class="node"><title>kinefsm</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-192 102.5,-192 102.5,-168 156.5,-168 156.5,-192"/>
<text text-anchor="middle" x="129.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">kinefsm</text>
</g>
<!-- proc~setup_h0&#45;&gt;kinefsm -->
<g id="proc~~setup_h0~~CallsGraph_edge9" class="edge"><title>proc~setup_h0&#45;&gt;kinefsm</title>
<path fill="none" stroke="#000000" d="M41.0427,-251.53C53.2401,-238.154 73.8341,-216.721 94,-201 95.3687,-199.933 96.7952,-198.876 98.2556,-197.837"/>
<polygon fill="#000000" stroke="#000000" points="100.434,-200.592 106.823,-192.14 96.5576,-194.763 100.434,-200.592"/>
</g>
<!-- nlefsm -->
<g id="proc~~setup_h0~~CallsGraph_node11" class="node"><title>nlefsm</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-150 102.5,-150 102.5,-126 156.5,-126 156.5,-150"/>
<text text-anchor="middle" x="129.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">nlefsm</text>
</g>
<!-- proc~setup_h0&#45;&gt;nlefsm -->
<g id="proc~~setup_h0~~CallsGraph_edge10" class="edge"><title>proc~setup_h0&#45;&gt;nlefsm</title>
<path fill="none" stroke="#000000" d="M35.139,-251.716C44.403,-230.699 65.6115,-187.371 94,-159 94.9206,-158.08 95.8892,-157.183 96.8938,-156.31"/>
<polygon fill="#000000" stroke="#000000" points="99.2233,-158.938 105.106,-150.126 95.0125,-153.346 99.2233,-158.938"/>
</g>
<!-- dnaefs -->
<g id="proc~~setup_h0~~CallsGraph_node12" class="node"><title>dnaefs</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-108 102.5,-108 102.5,-84 156.5,-84 156.5,-108"/>
<text text-anchor="middle" x="129.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dnaefs</text>
</g>
<!-- proc~setup_h0&#45;&gt;dnaefs -->
<g id="proc~~setup_h0~~CallsGraph_edge11" class="edge"><title>proc~setup_h0&#45;&gt;dnaefs</title>
<path fill="none" stroke="#000000" d="M32.5943,-251.997C38.9272,-225.075 57.4049,-158.951 94,-117 94.7375,-116.155 95.5176,-115.333 96.332,-114.535"/>
<polygon fill="#000000" stroke="#000000" points="98.81,-117.032 104.369,-108.012 94.3987,-111.596 98.81,-117.032"/>
</g>
<!-- dhscf_init -->
<g id="proc~~setup_h0~~CallsGraph_node13" class="node"><title>dhscf_init</title>
<polygon fill="#777777" stroke="#777777" points="158.5,-66 100.5,-66 100.5,-42 158.5,-42 158.5,-66"/>
<text text-anchor="middle" x="129.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dhscf_init</text>
</g>
<!-- proc~setup_h0&#45;&gt;dhscf_init -->
<g id="proc~~setup_h0~~CallsGraph_edge12" class="edge"><title>proc~setup_h0&#45;&gt;dhscf_init</title>
<path fill="none" stroke="#000000" d="M31.2654,-251.562C35.133,-219.141 49.3906,-130.703 94,-75 94.5945,-74.2577 95.2228,-73.5351 95.8797,-72.8322"/>
<polygon fill="#000000" stroke="#000000" points="98.4656,-75.2251 103.772,-66.0552 93.9054,-69.9142 98.4656,-75.2251"/>
</g>
<!-- twobody -->
<g id="proc~~setup_h0~~CallsGraph_node14" class="node"><title>twobody</title>
<polygon fill="#777777" stroke="#777777" points="156.5,-24 102.5,-24 102.5,-0 156.5,-0 156.5,-24"/>
<text text-anchor="middle" x="129.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">twobody</text>
</g>
<!-- proc~setup_h0&#45;&gt;twobody -->
<g id="proc~~setup_h0~~CallsGraph_edge13" class="edge"><title>proc~setup_h0&#45;&gt;twobody</title>
<path fill="none" stroke="#000000" d="M30.3189,-251.852C31.8677,-215.084 40.9346,-103.22 94,-33 94.5549,-32.2658 95.1435,-31.5516 95.761,-30.8574"/>
<polygon fill="#000000" stroke="#000000" points="98.1201,-33.4433 103.258,-24.1775 93.4632,-28.2171 98.1201,-33.4433"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,-0 64,-0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,-0 136,-0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node"><title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,-0 209.5,-0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node"><title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,-0 364,-0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,-0 436,-0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="551.5,-24 454.5,-24 454.5,-0 551.5,-0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      




















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/setup_h0.html#src">setup_H0</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>      <span class="k">subroutine </span><span class="n">setup_H0</span><span class="p">(</span><span class="n">G2max</span><span class="p">)</span>
      <span class="c">!! Computes non-self-consistent part of the Hamiltonian</span>
      <span class="c">!! and initializes data structures on the grid.</span>
      <span class="c">!!@warning </span>
      <span class="c">!! What exactly IS the nscf H?</span>

      <span class="k">USE </span><span class="n">siesta_options</span><span class="p">,</span>  <span class="n">only</span><span class="p">:</span> <span class="n">g2cut</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">H_kin_1D</span><span class="p">,</span> <span class="n">H_vkb_1D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">H_so_2D</span>
      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Dscf</span>

      <span class="k">use </span><span class="n">sparse_matrices</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">listh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">maxnh</span>
      <span class="k">use </span><span class="n">siesta_geom</span>
      <span class="k">use </span><span class="n">atmfuncs</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">uion</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">iaorb</span><span class="p">,</span> <span class="n">iphkb</span><span class="p">,</span> <span class="n">indxuo</span><span class="p">,</span> <span class="n">datm</span><span class="p">,</span>
     <span class="p">&amp;</span>                    <span class="n">lastkb</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">rmaxv</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span>
     <span class="p">&amp;</span>                    <span class="n">rmaxo</span><span class="p">,</span> <span class="n">no_l</span>
      <span class="k">use </span><span class="n">metaforce</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">lMetaForce</span><span class="p">,</span> <span class="n">meta</span>
      <span class="k">use </span><span class="n">molecularmechanics</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">twobody</span>
      <span class="k">use </span><span class="n">m_nlefsm</span><span class="p">,</span>     <span class="n">only</span><span class="p">:</span> <span class="n">nlefsm</span>
      <span class="k">use </span><span class="n">m_kinefsm</span><span class="p">,</span>    <span class="n">only</span><span class="p">:</span> <span class="n">kinefsm</span>
      <span class="k">use </span><span class="n">m_naefs</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">naefs</span>
      <span class="k">use </span><span class="n">m_dnaefs</span><span class="p">,</span>     <span class="n">only</span><span class="p">:</span> <span class="n">dnaefs</span>
      <span class="k">use </span><span class="n">m_dhscf</span><span class="p">,</span>      <span class="n">only</span><span class="p">:</span> <span class="n">dhscf_init</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span>   <span class="n">only</span><span class="p">:</span> <span class="n">Eions</span><span class="p">,</span> <span class="n">Ena</span><span class="p">,</span> <span class="n">DEna</span><span class="p">,</span> <span class="n">Emm</span><span class="p">,</span> <span class="n">Emeta</span><span class="p">,</span> <span class="n">Eso</span>
      <span class="k">use </span><span class="n">m_ntm</span>
      <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>       <span class="n">only</span><span class="p">:</span> <span class="n">spin</span>
      <span class="k">use </span><span class="n">spinorbit</span><span class="p">,</span>    <span class="n">only</span><span class="p">:</span> <span class="n">spinorb</span>
      <span class="k">use </span><span class="n">alloc</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">re_alloc</span><span class="p">,</span> <span class="n">de_alloc</span>
      <span class="k">use </span><span class="n">class_dSpData1D</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">val</span>
      <span class="k">use </span><span class="n">class_dSpData2D</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">val</span>

<span class="cp">#ifdef MPI</span>
      <span class="k">use </span><span class="n">m_mpi_utils</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">globalize_sum</span>
<span class="cp">#endif</span>

      <span class="k">implicit none</span>
<span class="k">      </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">g2max</span>

      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dummy_stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dummy_fa</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">dummy_dm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dummy_E</span>
      <span class="kt">integer</span>  <span class="kd">::</span> <span class="n">ia</span><span class="p">,</span> <span class="k">is</span>

<span class="k">      </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">H_val</span><span class="p">(:),</span> <span class="n">H_so</span><span class="p">(:,:)</span>

<span class="cp">#ifdef DEBUG</span>
      <span class="k">call </span><span class="n">write_debug</span><span class="p">(</span> <span class="s1">&#39;    PRE setup_H0&#39;</span> <span class="p">)</span>
<span class="cp">#endif</span>

<span class="c">!----------------------------------------------------------------------BEGIN</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span><span class="s1">&#39;Setup_H0&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

      <span class="c">!!Self-energy of isolated ions</span>
      <span class="c">!!@code</span>
      <span class="n">Eions</span> <span class="o">=</span> <span class="mf">0.0_dp</span>
      <span class="k">do </span><span class="n">ia</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">na_u</span>
        <span class="k">is</span> <span class="o">=</span> <span class="n">isa</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="n">Eions</span> <span class="o">=</span> <span class="n">Eions</span> <span class="o">+</span> <span class="n">uion</span><span class="p">(</span><span class="k">is</span><span class="p">)</span>
      <span class="n">enddo</span>
      <span class="c">!!@endcode</span>


      <span class="c">!! Neutral-atom: energy</span>
      <span class="c">!!@note</span>
      <span class="c">!* In these routines, flag is defined</span>
      <span class="c">!  to tell them NOT to compute</span>
      <span class="c">!  forces and stresses in this first pass, only energies.</span>
      <span class="c">!!@endnote</span>
      <span class="c">!!@code</span>
      <span class="k">call </span><span class="n">naefs</span><span class="p">(</span><span class="n">na_u</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span> <span class="n">rmaxv</span><span class="p">,</span>
     <span class="p">&amp;</span>           <span class="n">isa</span><span class="p">,</span> <span class="n">Ena</span><span class="p">,</span> <span class="n">dummy_fa</span><span class="p">,</span> <span class="n">dummy_stress</span><span class="p">,</span>
     <span class="p">&amp;</span>           <span class="n">forces_and_stress</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.)</span>
      <span class="k">call </span><span class="n">dnaefs</span><span class="p">(</span><span class="n">na_u</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span> <span class="n">rmaxv</span><span class="p">,</span>
     <span class="p">&amp;</span>            <span class="n">isa</span><span class="p">,</span> <span class="n">DEna</span><span class="p">,</span> <span class="n">dummy_fa</span><span class="p">,</span> <span class="n">dummy_stress</span><span class="p">,</span>
     <span class="p">&amp;</span>            <span class="n">forces_and_stress</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.)</span>
      <span class="n">Ena</span> <span class="o">=</span> <span class="n">Ena</span> <span class="o">+</span> <span class="n">DEna</span>
      <span class="c">!!@endcode</span>

      <span class="c">!! Metadynamics energy:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">lMetaForce</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">meta</span><span class="p">(</span><span class="n">xa</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">ucell</span><span class="p">,</span><span class="n">Emeta</span><span class="p">,</span><span class="n">dummy_fa</span><span class="p">,</span><span class="n">dummy_stress</span><span class="p">,</span>
     <span class="err">$</span>           <span class="p">.</span><span class="n">false</span><span class="p">.,.</span><span class="n">false</span><span class="p">.)</span>
      <span class="n">endif</span>

      <span class="c">!! Add on force field contribution to energy:</span>
      <span class="k">call </span><span class="n">twobody</span><span class="p">(</span> <span class="n">na_u</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">isa</span><span class="p">,</span><span class="n">ucell</span><span class="p">,</span><span class="n">Emm</span><span class="p">,</span>
     <span class="p">&amp;</span>              <span class="n">ifa</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fa</span><span class="o">=</span><span class="n">dummy_fa</span><span class="p">,</span><span class="n">istr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">stress</span><span class="o">=</span><span class="n">dummy_stress</span><span class="p">)</span>


      <span class="c">!* Now we compute matrix elements of the Kinetic and Non-local</span>
      <span class="c">!  parts of H</span>

      <span class="c">!! Kinetic: matrix elements only</span>
      <span class="c">!!@code</span>
      <span class="n">H_val</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">H_kin_1D</span><span class="p">)</span>
<span class="c">!$OMP parallel workshare default(shared)</span>
      <span class="n">H_val</span><span class="p">(:)</span> <span class="o">=</span> <span class="mf">0.0_dp</span>
<span class="c">!$OMP end parallel workshare</span>
      <span class="k">call </span><span class="n">kinefsm</span><span class="p">(</span><span class="n">na_u</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">scell</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span> <span class="n">rmaxo</span><span class="p">,</span>
     <span class="p">&amp;</span>             <span class="n">maxnh</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span>
     <span class="p">&amp;</span>             <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span>
     <span class="p">&amp;</span>             <span class="mi">1</span><span class="p">,</span>
     <span class="p">&amp;</span>             <span class="n">dummy_dm</span><span class="p">,</span> <span class="n">dummy_E</span><span class="p">,</span> <span class="n">dummy_fa</span><span class="p">,</span> <span class="n">dummy_stress</span><span class="p">,</span>
     <span class="p">&amp;</span>             <span class="n">H_val</span><span class="p">,</span>
     <span class="p">&amp;</span>             <span class="n">matrix_elements_only</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
      <span class="c">!!@endcode</span>

      <span class="c">!! Non-local-pseudop:  matrix elements only</span>
      <span class="c">!!@code</span>
      <span class="n">H_val</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">H_vkb_1D</span><span class="p">)</span>
<span class="c">!$OMP parallel workshare default(shared)</span>
      <span class="n">H_val</span><span class="p">(:)</span> <span class="o">=</span> <span class="mf">0.0_dp</span>
<span class="c">!$OMP end parallel workshare</span>
      <span class="k">call </span><span class="n">nlefsm</span><span class="p">(</span><span class="n">scell</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span>
     <span class="p">&amp;</span>            <span class="n">maxnh</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">lastkb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">iphKB</span><span class="p">,</span>
     <span class="p">&amp;</span>            <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span>
     <span class="p">&amp;</span>            <span class="mi">1</span><span class="p">,</span>
     <span class="p">&amp;</span>            <span class="n">dummy_dm</span><span class="p">,</span> <span class="n">dummy_E</span><span class="p">,</span> <span class="n">dummy_fa</span><span class="p">,</span> <span class="n">dummy_stress</span><span class="p">,</span>
     <span class="p">&amp;</span>            <span class="n">H_val</span><span class="p">,</span>
     <span class="p">&amp;</span>            <span class="n">matrix_elements_only</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
      <span class="c">!!@endcode</span>


      <span class="c">!!@note</span>
      <span class="c">!* If in the future the spin-orbit routine is able to compute</span>
      <span class="c">!  forces and stresses, then &quot;last&quot; will be needed. If we are not</span>
      <span class="c">!  computing forces and stresses, calling it in the first iteration</span>
      <span class="c">!  should be enough.</span>
      <span class="c">!!@endnote</span>

      <span class="c">!!@code</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">spin</span><span class="p">%</span><span class="n">SO</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">         </span><span class="n">H_so</span> <span class="o">=&gt;</span> <span class="n">val</span><span class="p">(</span><span class="n">H_so_2D</span><span class="p">)</span>
<span class="c">!$OMP parallel workshare default(shared)</span>
         <span class="n">H_so</span> <span class="o">=</span> <span class="mf">0._dp</span>
<span class="c">!$OMP end parallel workshare</span>
         <span class="k">call </span><span class="n">spinorb</span><span class="p">(</span><span class="n">no_u</span><span class="p">,</span><span class="n">no_l</span><span class="p">,</span><span class="n">iaorb</span><span class="p">,</span><span class="n">iphorb</span><span class="p">,</span><span class="n">isa</span><span class="p">,</span><span class="n">indxuo</span><span class="p">,</span>
     <span class="p">&amp;</span>        <span class="n">maxnh</span><span class="p">,</span><span class="n">numh</span><span class="p">,</span><span class="n">listhptr</span><span class="p">,</span><span class="n">listh</span><span class="p">,</span><span class="n">Dscf</span><span class="p">,</span><span class="n">H_so</span><span class="p">,</span><span class="n">Eso</span><span class="p">)</span>
      <span class="k">else</span>
<span class="k">         </span><span class="n">Eso</span> <span class="o">=</span> <span class="mf">0._dp</span>
      <span class="k">end if</span>
      <span class="c">!!@endcode</span>


      <span class="c">!!This will take care of possible changes to the mesh and atomic-related</span>
      <span class="c">!!mesh structures for geometry changes:</span>
      <span class="c">!!@code</span>
      <span class="n">g2max</span> <span class="o">=</span> <span class="n">g2cut</span>
      <span class="k">call </span><span class="n">dhscf_init</span><span class="p">(</span> <span class="n">spin</span><span class="p">%</span><span class="n">Grid</span><span class="p">,</span> <span class="n">no_s</span><span class="p">,</span> <span class="n">iaorb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span>
     <span class="p">&amp;</span>                 <span class="n">no_l</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">na_s</span><span class="p">,</span>
     <span class="p">&amp;</span>                 <span class="n">isa</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">indxua</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span>
     <span class="p">&amp;</span>                 <span class="n">mscell</span><span class="p">,</span> <span class="n">G2max</span><span class="p">,</span> <span class="n">ntm</span><span class="p">,</span>
     <span class="p">&amp;</span>                 <span class="n">maxnh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">datm</span><span class="p">,</span>
     <span class="p">&amp;</span>                 <span class="n">dummy_fa</span><span class="p">,</span> <span class="n">dummy_stress</span><span class="p">)</span>
      <span class="c">!!@endcode</span>

      <span class="k">call </span><span class="n">timer</span><span class="p">(</span><span class="s1">&#39;Setup_H0&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="cp">#ifdef DEBUG</span>
      <span class="k">call </span><span class="n">write_debug</span><span class="p">(</span> <span class="s1">&#39;    POS setup_H0&#39;</span> <span class="p">)</span>
<span class="cp">#endif</span>

<span class="c">!---------------------------------------------------------------------- END</span>
      <span class="k">END subroutine </span><span class="n">setup_H0</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprocs-1">All Procedures</a></h3></div>
  <div id="allprocs-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../proc/compute_dm.html">compute_dm</a>
      
      <a class="list-group-item" href="../proc/current_itt.html">current_itt</a>
      
      <a class="list-group-item" href="../proc/getstackval.html">getstackval</a>
      
      <a class="list-group-item" href="../proc/inverse.html">inverse</a>
      
      <a class="list-group-item" href="../proc/is_next.html">is_next</a>
      
      <a class="list-group-item" href="../proc/mix_method.html">mix_method</a>
      
      <a class="list-group-item" href="../proc/mix_method_variant.html">mix_method_variant</a>
      
      <a class="list-group-item" href="../proc/mixer_init.html">mixer_init</a>
      
      <a class="list-group-item" href="../proc/mixers_history_init.html">mixers_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_init.html">mixers_init</a>
      
      <a class="list-group-item" href="../proc/mixers_print.html">mixers_print</a>
      
      <a class="list-group-item" href="../proc/mixers_print_block.html">mixers_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_reset.html">mixers_reset</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_history_init.html">mixers_scf_history_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_init.html">mixers_scf_init</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print.html">mixers_scf_print</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_print_block.html">mixers_scf_print_block</a>
      
      <a class="list-group-item" href="../proc/mixers_scf_reset.html">mixers_scf_reset</a>
      
      <a class="list-group-item" href="../interface/mixing.html">mixing</a>
      
      <a class="list-group-item" href="../proc/mixing_1d.html">mixing_1d</a>
      
      <a class="list-group-item" href="../proc/mixing_2d.html">mixing_2d</a>
      
      <a class="list-group-item" href="../proc/mixing_calc_next.html">mixing_calc_next</a>
      
      <a class="list-group-item" href="../proc/mixing_coeff.html">mixing_coeff</a>
      
      <a class="list-group-item" href="../proc/mixing_finalize.html">mixing_finalize</a>
      
      <a class="list-group-item" href="../proc/mixing_init.html">mixing_init</a>
      
      <a class="list-group-item" href="../proc/mixing_ncoeff.html">mixing_ncoeff</a>
      
      <a class="list-group-item" href="../proc/mixing_scf_converged.html">mixing_scf_converged</a>
      
      <a class="list-group-item" href="../proc/mixing_step.html">mixing_step</a>
      
      <a class="list-group-item" href="../proc/norm.html">norm</a>
      
      <a class="list-group-item" href="../proc/push_diff.html">push_diff</a>
      
      <a class="list-group-item" href="../proc/push_f.html">push_F</a>
      
      <a class="list-group-item" href="../proc/push_stack_data.html">push_stack_data</a>
      
      <a class="list-group-item" href="../proc/setup_h0.html">setup_H0</a>
      
      <a class="list-group-item" href="../proc/setup_hamiltonian.html">setup_hamiltonian</a>
      
      <a class="list-group-item" href="../proc/siesta_analysis.html">siesta_analysis</a>
      
      <a class="list-group-item" href="../proc/siesta_forces.html">siesta_forces</a>
      
      <a class="list-group-item" href="../proc/stack_check.html">stack_check</a>
      
      <a class="list-group-item" href="../proc/state_analysis.html">state_analysis</a>
      
      <a class="list-group-item" href="../proc/state_init.html">state_init</a>
      
      <a class="list-group-item" href="../proc/svd.html">svd</a>
      
      <a class="list-group-item" href="../proc/update_f.html">update_F</a>
      
    </div>
  </div>
</div>


  </section>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SIESTA was developed by SIESTA Group</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>