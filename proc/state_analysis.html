<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A first-principles materials simulation code using Density Functional Theory.">
    
    <meta name="author" content="SIESTA Group" >
    <link rel="icon" href="../favicon.png">

    <title>state_analysis &ndash; SIESTA</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SIESTA <small>trunk-674--vdikan-ford-681</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Program Overview</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>state_analysis
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.9% of total for procedures.">100 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/state_analysis.F"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/state_analysis.f.html'>state_analysis.F</a></li>
    
     <li><a href='../module/m_state_analysis.html'>m_state_analysis</a></li>
    
  
     <li class="active">state_analysis</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/state_analysis.html#src">state_analysis</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine state_analysis(istep)
    
    
   
</h2>
    
  
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Uses</h3>
      </div>
      <ul class="list-group">
      
      <li class="list-group-item">
  <ul class="list-inline">
    
    <li>siesta_cml</li>
    
    <li>m_born_charge</li>
    
    <li>parallel</li>
    
    <li>m_wallclock</li>
    
    <li>zmatrix</li>
    
    <li>atomlist</li>
    
    <li>atomlist</li>
    
    <li>m_spin</li>
    
    <li>m_fixed</li>
    
    <li>sparse_matrices</li>
    
    <li>siesta_geom</li>
    
    <li>siesta_options</li>
    
    <li>units</li>
    
    <li>m_stress</li>
    
    <li>m_energies</li>
    
    <li>m_energies</li>
    
    <li>m_ntm</li>
    
    <li>m_forces</li>
    
    <li>m_energies</li>
    
    <li>m_intramol_pressure</li>
    
    <li>flook_siesta</li>
    
  </ul>
      </li>
      
      
      
      <li class="list-group-item">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: proc~~state_analysis~~UsesGraph Pages: 1 -->
<svg id="procstate_analysisUsesGraph" width="238pt" height="746pt"
 viewBox="0.00 0.00 238.00 746.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_analysis~~UsesGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 742)">
<title>proc~~state_analysis~~UsesGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-742 234,-742 234,4 -4,4"/>
<!-- proc~state_analysis -->
<g id="proc~~state_analysis~~UsesGraph_node1" class="node">
<title>proc~state_analysis</title>
<polygon fill="none" stroke="#000000" points="230,-381 150,-381 150,-357 230,-357 230,-381"/>
<text text-anchor="middle" x="190" y="-366.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">state_analysis</text>
</g>
<!-- atomlist -->
<g id="proc~~state_analysis~~UsesGraph_node2" class="node">
<title>atomlist</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-738 30,-738 30,-714 84,-714 84,-738"/>
<text text-anchor="middle" x="57" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">atomlist</text>
</g>
<!-- proc~state_analysis&#45;&gt;atomlist -->
<g id="proc~~state_analysis~~UsesGraph_edge3" class="edge">
<title>proc~state_analysis&#45;&gt;atomlist</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.8051,-381.0772C183.2311,-435.1617 158.1745,-654.6468 114,-705 108.6208,-711.1316 101.2891,-715.475 93.6756,-718.5511"/>
<polygon fill="#000000" stroke="#000000" points="92.366,-715.299 84.0071,-721.8089 94.6012,-721.9326 92.366,-715.299"/>
</g>
<!-- m_fixed -->
<g id="proc~~state_analysis~~UsesGraph_node3" class="node">
<title>m_fixed</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-696 30,-696 30,-672 84,-672 84,-696"/>
<text text-anchor="middle" x="57" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_fixed</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_fixed -->
<g id="proc~~state_analysis~~UsesGraph_edge4" class="edge">
<title>proc~state_analysis&#45;&gt;m_fixed</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.3653,-381.2204C181.4535,-431.2325 153.1702,-619.702 114,-663 108.5776,-668.9938 101.2932,-673.281 93.7476,-676.3461"/>
<polygon fill="#000000" stroke="#000000" points="92.506,-673.0715 84.1707,-679.6116 94.7652,-679.697 92.506,-673.0715"/>
</g>
<!-- parallel -->
<g id="proc~~state_analysis~~UsesGraph_node4" class="node">
<title>parallel</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-654 30,-654 30,-630 84,-630 84,-654"/>
<text text-anchor="middle" x="57" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">parallel</text>
</g>
<!-- proc~state_analysis&#45;&gt;parallel -->
<g id="proc~~state_analysis~~UsesGraph_edge2" class="edge">
<title>proc~state_analysis&#45;&gt;parallel</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.7886,-381.2982C179.392,-426.7727 148.2249,-584.6546 114,-621 108.459,-626.8843 101.127,-631.1275 93.5729,-634.1849"/>
<polygon fill="#000000" stroke="#000000" points="92.3331,-630.9098 84.0038,-637.4576 94.5984,-637.5331 92.3331,-630.9098"/>
</g>
<!-- sparse_matrices -->
<g id="proc~~state_analysis~~UsesGraph_node5" class="node">
<title>sparse_matrices</title>
<polygon fill="#337ab7" stroke="#337ab7" points="102.5,-612 11.5,-612 11.5,-588 102.5,-588 102.5,-612"/>
<text text-anchor="middle" x="57" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">sparse_matrices</text>
</g>
<!-- proc~state_analysis&#45;&gt;sparse_matrices -->
<g id="proc~~state_analysis~~UsesGraph_edge5" class="edge">
<title>proc~state_analysis&#45;&gt;sparse_matrices</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.1045,-381.0584C185.8407,-416.4412 171.5451,-521.1231 114,-579 112.9079,-580.0984 111.7534,-581.1399 110.5475,-582.1274"/>
<polygon fill="#000000" stroke="#000000" points="108.3086,-579.4147 101.9536,-587.8919 112.2081,-585.228 108.3086,-579.4147"/>
</g>
<!-- units -->
<g id="proc~~state_analysis~~UsesGraph_node6" class="node">
<title>units</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-570 30,-570 30,-546 84,-546 84,-570"/>
<text text-anchor="middle" x="57" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">units</text>
</g>
<!-- proc~state_analysis&#45;&gt;units -->
<g id="proc~~state_analysis~~UsesGraph_edge6" class="edge">
<title>proc~state_analysis&#45;&gt;units</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.8728,-381.0231C181.8762,-411.4567 162.0406,-492.2924 114,-537 108.3208,-542.2852 101.1989,-546.2669 93.9323,-549.2579"/>
<polygon fill="#000000" stroke="#000000" points="92.3159,-546.1171 84.0556,-552.7519 94.6504,-552.7164 92.3159,-546.1171"/>
</g>
<!-- m_stress -->
<g id="proc~~state_analysis~~UsesGraph_node7" class="node">
<title>m_stress</title>
<polygon fill="#337ab7" stroke="#337ab7" points="85,-528 29,-528 29,-504 85,-504 85,-528"/>
<text text-anchor="middle" x="57" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_stress</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_stress -->
<g id="proc~~state_analysis~~UsesGraph_edge7" class="edge">
<title>proc~state_analysis&#45;&gt;m_stress</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M185.7936,-381.2642C176.6437,-406.1918 152.6002,-463.1082 114,-495 108.2987,-499.7104 101.4439,-503.416 94.4953,-506.3137"/>
<polygon fill="#000000" stroke="#000000" points="93.2388,-503.0466 85.0613,-509.783 95.6548,-509.6164 93.2388,-503.0466"/>
</g>
<!-- siesta_geom -->
<g id="proc~~state_analysis~~UsesGraph_node8" class="node">
<title>siesta_geom</title>
<polygon fill="#337ab7" stroke="#337ab7" points="93.5,-486 20.5,-486 20.5,-462 93.5,-462 93.5,-486"/>
<text text-anchor="middle" x="57" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_geom</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_geom -->
<g id="proc~~state_analysis~~UsesGraph_edge8" class="edge">
<title>proc~state_analysis&#45;&gt;siesta_geom</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M181.8476,-381.2737C169.2743,-399.3326 143.4954,-433.0724 114,-453 110.51,-455.3579 106.7217,-457.4912 102.8131,-459.4126"/>
<polygon fill="#000000" stroke="#000000" points="101.2806,-456.2634 93.5583,-463.5172 104.1186,-462.6623 101.2806,-456.2634"/>
</g>
<!-- m_wallclock -->
<g id="proc~~state_analysis~~UsesGraph_node9" class="node">
<title>m_wallclock</title>
<polygon fill="#337ab7" stroke="#337ab7" points="92,-444 22,-444 22,-420 92,-420 92,-444"/>
<text text-anchor="middle" x="57" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_wallclock</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_wallclock -->
<g id="proc~~state_analysis~~UsesGraph_edge12" class="edge">
<title>proc~state_analysis&#45;&gt;m_wallclock</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M170.1084,-381.0849C155.0213,-389.9799 133.6047,-402.0343 114,-411 109.9524,-412.8511 105.6902,-414.6625 101.3942,-416.3971"/>
<polygon fill="#000000" stroke="#000000" points="100.0514,-413.164 92.0057,-420.0573 102.594,-419.6859 100.0514,-413.164"/>
</g>
<!-- m_spin -->
<g id="proc~~state_analysis~~UsesGraph_node10" class="node">
<title>m_spin</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-402 30,-402 30,-378 84,-378 84,-402"/>
<text text-anchor="middle" x="57" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_spin</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_spin -->
<g id="proc~~state_analysis~~UsesGraph_edge9" class="edge">
<title>proc~state_analysis&#45;&gt;m_spin</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M149.7347,-375.3577C132.1331,-378.1369 111.6113,-381.3772 94.354,-384.102"/>
<polygon fill="#000000" stroke="#000000" points="93.4179,-380.7064 84.0861,-385.7232 94.5097,-387.6207 93.4179,-380.7064"/>
</g>
<!-- siesta_options -->
<g id="proc~~state_analysis~~UsesGraph_node11" class="node">
<title>siesta_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="97.5,-360 16.5,-360 16.5,-336 97.5,-336 97.5,-360"/>
<text text-anchor="middle" x="57" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_options</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_options -->
<g id="proc~~state_analysis~~UsesGraph_edge10" class="edge">
<title>proc~state_analysis&#45;&gt;siesta_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M149.7347,-362.6423C136.4457,-360.5441 121.4922,-358.183 107.5357,-355.9793"/>
<polygon fill="#000000" stroke="#000000" points="108.011,-352.5111 97.5875,-354.4085 106.9192,-359.4254 108.011,-352.5111"/>
</g>
<!-- m_born_charge -->
<g id="proc~~state_analysis~~UsesGraph_node12" class="node">
<title>m_born_charge</title>
<polygon fill="#337ab7" stroke="#337ab7" points="101,-318 13,-318 13,-294 101,-294 101,-318"/>
<text text-anchor="middle" x="57" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_born_charge</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_born_charge -->
<g id="proc~~state_analysis~~UsesGraph_edge11" class="edge">
<title>proc~state_analysis&#45;&gt;m_born_charge</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M170.1084,-356.9151C155.0213,-348.0201 133.6047,-335.9657 114,-327 110.1158,-325.2236 106.0339,-323.4838 101.9142,-321.8132"/>
<polygon fill="#000000" stroke="#000000" points="102.8959,-318.4391 92.3079,-318.0568 100.3465,-324.9584 102.8959,-318.4391"/>
</g>
<!-- m_energies -->
<g id="proc~~state_analysis~~UsesGraph_node13" class="node">
<title>m_energies</title>
<polygon fill="#337ab7" stroke="#337ab7" points="91.5,-276 22.5,-276 22.5,-252 91.5,-252 91.5,-276"/>
<text text-anchor="middle" x="57" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_energies</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_energies -->
<g id="proc~~state_analysis~~UsesGraph_edge1" class="edge">
<title>proc~state_analysis&#45;&gt;m_energies</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M181.8476,-356.7263C169.2743,-338.6674 143.4954,-304.9276 114,-285 110.0048,-282.3008 105.6187,-279.8959 101.1086,-277.7663"/>
<polygon fill="#000000" stroke="#000000" points="102.3338,-274.4838 91.7627,-273.7755 99.5849,-280.9215 102.3338,-274.4838"/>
</g>
<!-- flook_siesta -->
<g id="proc~~state_analysis~~UsesGraph_node14" class="node">
<title>flook_siesta</title>
<polygon fill="#337ab7" stroke="#337ab7" points="91.5,-234 22.5,-234 22.5,-210 91.5,-210 91.5,-234"/>
<text text-anchor="middle" x="57" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">flook_siesta</text>
</g>
<!-- proc~state_analysis&#45;&gt;flook_siesta -->
<g id="proc~~state_analysis~~UsesGraph_edge13" class="edge">
<title>proc~state_analysis&#45;&gt;flook_siesta</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M185.7936,-356.7358C176.6437,-331.8082 152.6002,-274.8918 114,-243 110.0366,-239.7254 105.5156,-236.9364 100.7932,-234.5668"/>
<polygon fill="#000000" stroke="#000000" points="102.1204,-231.3271 91.5572,-230.5096 99.3051,-237.736 102.1204,-231.3271"/>
</g>
<!-- siesta_cml -->
<g id="proc~~state_analysis~~UsesGraph_node15" class="node">
<title>siesta_cml</title>
<polygon fill="#337ab7" stroke="#337ab7" points="88.5,-192 25.5,-192 25.5,-168 88.5,-168 88.5,-192"/>
<text text-anchor="middle" x="57" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_cml</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_cml -->
<g id="proc~~state_analysis~~UsesGraph_edge14" class="edge">
<title>proc~state_analysis&#45;&gt;siesta_cml</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.8728,-356.9769C181.8762,-326.5433 162.0406,-245.7076 114,-201 109.4994,-196.8116 104.0926,-193.4418 98.4259,-190.7349"/>
<polygon fill="#000000" stroke="#000000" points="99.3384,-187.3267 88.7578,-186.7779 96.6868,-193.805 99.3384,-187.3267"/>
</g>
<!-- zmatrix -->
<g id="proc~~state_analysis~~UsesGraph_node16" class="node">
<title>zmatrix</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-150 30,-150 30,-126 84,-126 84,-150"/>
<text text-anchor="middle" x="57" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">zmatrix</text>
</g>
<!-- proc~state_analysis&#45;&gt;zmatrix -->
<g id="proc~~state_analysis~~UsesGraph_edge15" class="edge">
<title>proc~state_analysis&#45;&gt;zmatrix</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.1045,-356.9416C185.8407,-321.5588 171.5451,-216.8769 114,-159 108.3535,-153.3209 101.0414,-149.1633 93.5487,-146.1241"/>
<polygon fill="#000000" stroke="#000000" points="94.668,-142.8078 84.0732,-142.8423 92.377,-149.4223 94.668,-142.8078"/>
</g>
<!-- m_ntm -->
<g id="proc~~state_analysis~~UsesGraph_node17" class="node">
<title>m_ntm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-108 30,-108 30,-84 84,-84 84,-108"/>
<text text-anchor="middle" x="57" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ntm</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_ntm -->
<g id="proc~~state_analysis~~UsesGraph_edge16" class="edge">
<title>proc~state_analysis&#45;&gt;m_ntm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.7886,-356.7018C179.392,-311.2273 148.2249,-153.3454 114,-117 108.459,-111.1157 101.127,-106.8725 93.5729,-103.8151"/>
<polygon fill="#000000" stroke="#000000" points="94.5984,-100.4669 84.0038,-100.5424 92.3331,-107.0902 94.5984,-100.4669"/>
</g>
<!-- m_intramol_pressure -->
<g id="proc~~state_analysis~~UsesGraph_node18" class="node">
<title>m_intramol_pressure</title>
<polygon fill="#337ab7" stroke="#337ab7" points="114,-66 0,-66 0,-42 114,-42 114,-66"/>
<text text-anchor="middle" x="57" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_intramol_pressure</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_intramol_pressure -->
<g id="proc~~state_analysis~~UsesGraph_edge17" class="edge">
<title>proc~state_analysis&#45;&gt;m_intramol_pressure</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.3653,-356.7796C181.4535,-306.7675 153.1702,-118.298 114,-75 113.1046,-74.0102 112.1583,-73.0669 111.1686,-72.168"/>
<polygon fill="#000000" stroke="#000000" points="112.9912,-69.1657 102.8469,-66.1091 108.871,-74.8247 112.9912,-69.1657"/>
</g>
<!-- m_forces -->
<g id="proc~~state_analysis~~UsesGraph_node19" class="node">
<title>m_forces</title>
<polygon fill="#337ab7" stroke="#337ab7" points="85.5,-24 28.5,-24 28.5,0 85.5,0 85.5,-24"/>
<text text-anchor="middle" x="57" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_forces</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_forces -->
<g id="proc~~state_analysis~~UsesGraph_edge18" class="edge">
<title>proc~state_analysis&#45;&gt;m_forces</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.8051,-356.9228C183.2311,-302.8383 158.1745,-83.3532 114,-33 109.0272,-27.3317 102.3858,-23.1915 95.3958,-20.168"/>
<polygon fill="#000000" stroke="#000000" points="96.3662,-16.7974 85.7718,-16.6986 93.9922,-23.3826 96.3662,-16.7974"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="490pt" height="32pt"
 viewBox="0.00 0.00 489.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 485.5,-28 485.5,4 -4,4"/>
<!-- Module -->
<g id="node1" class="node">
<title>Module</title>
<polygon fill="#337ab7" stroke="#337ab7" points="54,-24 0,-24 0,0 54,0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Module</text>
</g>
<!-- Submodule -->
<g id="node2" class="node">
<title>Submodule</title>
<polygon fill="#5bc0de" stroke="#5bc0de" points="139.5,-24 72.5,-24 72.5,0 139.5,0 139.5,-24"/>
<text text-anchor="middle" x="106" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Submodule</text>
</g>
<!-- Subroutine -->
<g id="node3" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="222,-24 158,-24 158,0 222,0 222,-24"/>
<text text-anchor="middle" x="190" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Subroutine</text>
</g>
<!-- Function -->
<g id="node4" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="294,-24 240,-24 240,0 294,0 294,-24"/>
<text text-anchor="middle" x="267" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Function</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="366,-24 312,-24 312,0 366,0 366,-24"/>
<text text-anchor="middle" x="339" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="481.5,-24 384.5,-24 384.5,0 481.5,0 481.5,-24"/>
<text text-anchor="middle" x="433" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a submodule to the (sub)module which it is
    descended from. Dashed arrows point from a module or program unit to 
    modules which it uses.
    </p>
    </div></div></div></div>
      </li>
      
      </ul>
    </div>
    


    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-istep"></span>integer</td>
  <td></td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>istep</strong></td><td></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: proc~~state_analysis~~CallsGraph Pages: 1 -->
<svg id="procstate_analysisCallsGraph" width="275pt" height="956pt"
 viewBox="0.00 0.00 275.00 956.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_analysis~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 952)">
<title>proc~~state_analysis~~CallsGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-952 271,-952 271,4 -4,4"/>
<!-- proc~state_analysis -->
<g id="proc~~state_analysis~~CallsGraph_node1" class="node">
<title>proc~state_analysis</title>
<polygon fill="none" stroke="#000000" points="80,-486 0,-486 0,-462 80,-462 80,-486"/>
<text text-anchor="middle" x="40" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">state_analysis</text>
</g>
<!-- update_freee -->
<g id="proc~~state_analysis~~CallsGraph_node2" class="node">
<title>update_freee</title>
<polygon fill="#777777" stroke="#777777" points="229.5,-948 153.5,-948 153.5,-924 229.5,-924 229.5,-948"/>
<text text-anchor="middle" x="191.5" y="-933.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update_freee</text>
</g>
<!-- proc~state_analysis&#45;&gt;update_freee -->
<g id="proc~~state_analysis~~CallsGraph_edge1" class="edge">
<title>proc~state_analysis&#45;&gt;update_freee</title>
<path fill="none" stroke="#000000" d="M40.3969,-486.3151C42.7225,-550.8218 56.602,-849.3026 116,-915 123.1911,-922.9538 133.1103,-928.0006 143.3962,-931.1764"/>
<polygon fill="#000000" stroke="#000000" points="142.7401,-934.6207 153.2933,-933.6819 144.4581,-927.8348 142.7401,-934.6207"/>
</g>
<!-- volcel -->
<g id="proc~~state_analysis~~CallsGraph_node3" class="node">
<title>volcel</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-906 164.5,-906 164.5,-882 218.5,-882 218.5,-906"/>
<text text-anchor="middle" x="191.5" y="-891.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">volcel</text>
</g>
<!-- proc~state_analysis&#45;&gt;volcel -->
<g id="proc~~state_analysis~~CallsGraph_edge2" class="edge">
<title>proc~state_analysis&#45;&gt;volcel</title>
<path fill="none" stroke="#000000" d="M40.6408,-486.3328C44.0436,-547.1152 61.9241,-814.2347 116,-873 125.7639,-883.6106 140.3838,-889.035 154.1653,-891.7486"/>
<polygon fill="#000000" stroke="#000000" points="154.0294,-895.2691 164.4464,-893.3364 155.0978,-888.3511 154.0294,-895.2691"/>
</g>
<!-- update_freeeharris -->
<g id="proc~~state_analysis~~CallsGraph_node4" class="node">
<title>update_freeeharris</title>
<polygon fill="#777777" stroke="#777777" points="243,-864 140,-864 140,-840 243,-840 243,-864"/>
<text text-anchor="middle" x="191.5" y="-849.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">update_freeeharris</text>
</g>
<!-- proc~state_analysis&#45;&gt;update_freeeharris -->
<g id="proc~~state_analysis~~CallsGraph_edge3" class="edge">
<title>proc~state_analysis&#45;&gt;update_freeeharris</title>
<path fill="none" stroke="#000000" d="M40.9251,-486.1523C45.4647,-542.6478 67.1656,-779.0642 116,-831 120.1197,-835.3813 125.0676,-838.8757 130.4351,-841.6588"/>
<polygon fill="#000000" stroke="#000000" points="129.2239,-844.9482 139.7919,-845.7021 132.0006,-838.5224 129.2239,-844.9482"/>
</g>
<!-- cmlstartmodule -->
<g id="proc~~state_analysis~~CallsGraph_node5" class="node">
<title>cmlstartmodule</title>
<polygon fill="#777777" stroke="#777777" points="234,-822 149,-822 149,-798 234,-798 234,-822"/>
<text text-anchor="middle" x="191.5" y="-807.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">cmlstartmodule</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmlstartmodule -->
<g id="proc~~state_analysis~~CallsGraph_edge4" class="edge">
<title>proc~state_analysis&#45;&gt;cmlstartmodule</title>
<path fill="none" stroke="#000000" d="M41.2905,-486.1045C47.095,-538.3458 72.4185,-743.8865 116,-789 122.3865,-795.611 130.6607,-800.1952 139.3814,-803.362"/>
<polygon fill="#000000" stroke="#000000" points="138.3657,-806.7113 148.9513,-806.2707 140.4014,-800.0138 138.3657,-806.7113"/>
</g>
<!-- siesta_write_forces -->
<g id="proc~~state_analysis~~CallsGraph_node6" class="node">
<title>siesta_write_forces</title>
<polygon fill="#777777" stroke="#777777" points="243.5,-780 139.5,-780 139.5,-756 243.5,-756 243.5,-780"/>
<text text-anchor="middle" x="191.5" y="-765.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_write_forces</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_write_forces -->
<g id="proc~~state_analysis~~CallsGraph_edge5" class="edge">
<title>proc~state_analysis&#45;&gt;siesta_write_forces</title>
<path fill="none" stroke="#000000" d="M41.7662,-486.0809C48.9782,-533.829 77.6415,-708.6502 116,-747 120.029,-751.0281 124.76,-754.3002 129.8556,-756.956"/>
<polygon fill="#000000" stroke="#000000" points="128.7834,-760.307 139.3485,-761.1009 131.5845,-753.8918 128.7834,-760.307"/>
</g>
<!-- cartesianforce_to_zmatforce -->
<g id="proc~~state_analysis~~CallsGraph_node7" class="node">
<title>cartesianforce_to_zmatforce</title>
<polygon fill="#777777" stroke="#777777" points="265.5,-738 117.5,-738 117.5,-714 265.5,-714 265.5,-738"/>
<text text-anchor="middle" x="191.5" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">cartesianforce_to_zmatforce</text>
</g>
<!-- proc~state_analysis&#45;&gt;cartesianforce_to_zmatforce -->
<g id="proc~~state_analysis~~CallsGraph_edge6" class="edge">
<title>proc~state_analysis&#45;&gt;cartesianforce_to_zmatforce</title>
<path fill="none" stroke="#000000" d="M42.447,-486.248C51.2963,-529.385 82.864,-673.372 116,-705 117.1379,-706.0862 118.3271,-707.117 119.5606,-708.0954"/>
<polygon fill="#000000" stroke="#000000" points="117.9912,-711.2523 128.2702,-713.8201 121.8361,-705.4027 117.9912,-711.2523"/>
</g>
<!-- cmladdproperty -->
<g id="proc~~state_analysis~~CallsGraph_node8" class="node">
<title>cmladdproperty</title>
<polygon fill="#777777" stroke="#777777" points="235,-696 148,-696 148,-672 235,-672 235,-696"/>
<text text-anchor="middle" x="191.5" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">cmladdproperty</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmladdproperty -->
<g id="proc~~state_analysis~~CallsGraph_edge7" class="edge">
<title>proc~state_analysis&#45;&gt;cmladdproperty</title>
<path fill="none" stroke="#000000" d="M41.2317,-486.2688C45.2699,-519.8371 61.178,-613.9509 116,-663 122.3403,-668.6726 130.0878,-672.827 138.1769,-675.8663"/>
<polygon fill="#000000" stroke="#000000" points="137.1744,-679.2204 147.7657,-678.9462 139.3151,-672.5557 137.1744,-679.2204"/>
</g>
<!-- write_debug -->
<g id="proc~~state_analysis~~CallsGraph_node9" class="node">
<title>write_debug</title>
<polygon fill="#777777" stroke="#777777" points="227,-654 156,-654 156,-630 227,-630 227,-654"/>
<text text-anchor="middle" x="191.5" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">write_debug</text>
</g>
<!-- proc~state_analysis&#45;&gt;write_debug -->
<g id="proc~~state_analysis~~CallsGraph_edge8" class="edge">
<title>proc~state_analysis&#45;&gt;write_debug</title>
<path fill="none" stroke="#000000" d="M42.8112,-486.3967C49.8927,-514.729 71.187,-584.5786 116,-621 124.5684,-627.9639 135.2919,-632.623 145.943,-635.7387"/>
<polygon fill="#000000" stroke="#000000" points="145.0876,-639.1325 155.6402,-638.188 146.8018,-632.3456 145.0876,-639.1325"/>
</g>
<!-- slua_call -->
<g id="proc~~state_analysis~~CallsGraph_node10" class="node">
<title>slua_call</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-612 164.5,-612 164.5,-588 218.5,-588 218.5,-612"/>
<text text-anchor="middle" x="191.5" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">slua_call</text>
</g>
<!-- proc~state_analysis&#45;&gt;slua_call -->
<g id="proc~~state_analysis~~CallsGraph_edge9" class="edge">
<title>proc~state_analysis&#45;&gt;slua_call</title>
<path fill="none" stroke="#000000" d="M45.3866,-486.1231C55.7765,-508.0873 80.7159,-554.4558 116,-579 127.2805,-586.8469 141.4119,-591.7709 154.3888,-594.8568"/>
<polygon fill="#000000" stroke="#000000" points="153.9682,-598.3443 164.472,-596.9584 155.3966,-591.4916 153.9682,-598.3443"/>
</g>
<!-- born_charge -->
<g id="proc~~state_analysis~~CallsGraph_node11" class="node">
<title>born_charge</title>
<polygon fill="#777777" stroke="#777777" points="228,-570 155,-570 155,-546 228,-546 228,-570"/>
<text text-anchor="middle" x="191.5" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">born_charge</text>
</g>
<!-- proc~state_analysis&#45;&gt;born_charge -->
<g id="proc~~state_analysis~~CallsGraph_edge10" class="edge">
<title>proc~state_analysis&#45;&gt;born_charge</title>
<path fill="none" stroke="#000000" d="M51.7222,-486.4863C65.7274,-500.6972 90.4842,-523.6605 116,-537 125.0427,-541.7275 135.2672,-545.4874 145.2048,-548.4409"/>
<polygon fill="#000000" stroke="#000000" points="144.4224,-551.8556 154.9925,-551.1316 146.278,-545.106 144.4224,-551.8556"/>
</g>
<!-- va -->
<g id="proc~~state_analysis~~CallsGraph_node12" class="node">
<title>va</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-528 164.5,-528 164.5,-504 218.5,-504 218.5,-528"/>
<text text-anchor="middle" x="191.5" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">va</text>
</g>
<!-- proc~state_analysis&#45;&gt;va -->
<g id="proc~~state_analysis~~CallsGraph_edge11" class="edge">
<title>proc~state_analysis&#45;&gt;va</title>
<path fill="none" stroke="#000000" d="M80.2015,-485.145C103.1592,-491.5095 131.7508,-499.4359 154.2061,-505.6611"/>
<polygon fill="#000000" stroke="#000000" points="153.4778,-509.0911 164.0494,-508.3899 155.3479,-502.3456 153.4778,-509.0911"/>
</g>
<!-- timer -->
<g id="proc~~state_analysis~~CallsGraph_node13" class="node">
<title>timer</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-486 164.5,-486 164.5,-462 218.5,-462 218.5,-486"/>
<text text-anchor="middle" x="191.5" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">timer</text>
</g>
<!-- proc~state_analysis&#45;&gt;timer -->
<g id="proc~~state_analysis~~CallsGraph_edge12" class="edge">
<title>proc~state_analysis&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M80.2015,-474C103.0557,-474 131.4933,-474 153.9023,-474"/>
<polygon fill="#000000" stroke="#000000" points="154.0494,-477.5001 164.0494,-474 154.0494,-470.5001 154.0494,-477.5001"/>
</g>
<!-- remove_intramol_pressure -->
<g id="proc~~state_analysis~~CallsGraph_node14" class="node">
<title>remove_intramol_pressure</title>
<polygon fill="#777777" stroke="#777777" points="262,-444 121,-444 121,-420 262,-420 262,-444"/>
<text text-anchor="middle" x="191.5" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">remove_intramol_pressure</text>
</g>
<!-- proc~state_analysis&#45;&gt;remove_intramol_pressure -->
<g id="proc~~state_analysis~~CallsGraph_edge13" class="edge">
<title>proc~state_analysis&#45;&gt;remove_intramol_pressure</title>
<path fill="none" stroke="#000000" d="M80.2015,-462.855C98.0426,-457.909 119.2863,-452.0196 138.4083,-446.7185"/>
<polygon fill="#000000" stroke="#000000" points="139.4837,-450.0524 148.1852,-444.0081 137.6136,-443.3069 139.4837,-450.0524"/>
</g>
<!-- fixed -->
<g id="proc~~state_analysis~~CallsGraph_node15" class="node">
<title>fixed</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-402 164.5,-402 164.5,-378 218.5,-378 218.5,-402"/>
<text text-anchor="middle" x="191.5" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">fixed</text>
</g>
<!-- proc~state_analysis&#45;&gt;fixed -->
<g id="proc~~state_analysis~~CallsGraph_edge14" class="edge">
<title>proc~state_analysis&#45;&gt;fixed</title>
<path fill="none" stroke="#000000" d="M51.7222,-461.5137C65.7274,-447.3028 90.4842,-424.3395 116,-411 127.8921,-404.7829 141.8281,-400.2391 154.4676,-397.0022"/>
<polygon fill="#000000" stroke="#000000" points="155.34,-400.3925 164.2626,-394.6795 153.7248,-393.5814 155.34,-400.3925"/>
</g>
<!-- print_spin -->
<g id="proc~~state_analysis~~CallsGraph_node16" class="node">
<title>print_spin</title>
<polygon fill="#777777" stroke="#777777" points="221,-360 162,-360 162,-336 221,-336 221,-360"/>
<text text-anchor="middle" x="191.5" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">print_spin</text>
</g>
<!-- proc~state_analysis&#45;&gt;print_spin -->
<g id="proc~~state_analysis~~CallsGraph_edge15" class="edge">
<title>proc~state_analysis&#45;&gt;print_spin</title>
<path fill="none" stroke="#000000" d="M45.3866,-461.8769C55.7765,-439.9127 80.7159,-393.5442 116,-369 126.558,-361.6557 139.6134,-356.8719 151.8823,-353.759"/>
<polygon fill="#000000" stroke="#000000" points="152.9328,-357.1108 161.931,-351.5177 151.4089,-350.2787 152.9328,-357.1108"/>
</g>
<!-- mulliken -->
<g id="proc~~state_analysis~~CallsGraph_node17" class="node">
<title>mulliken</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-318 164.5,-318 164.5,-294 218.5,-294 218.5,-318"/>
<text text-anchor="middle" x="191.5" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">mulliken</text>
</g>
<!-- proc~state_analysis&#45;&gt;mulliken -->
<g id="proc~~state_analysis~~CallsGraph_edge16" class="edge">
<title>proc~state_analysis&#45;&gt;mulliken</title>
<path fill="none" stroke="#000000" d="M42.8112,-461.6033C49.8927,-433.271 71.187,-363.4214 116,-327 126.8533,-318.1791 141.1641,-313.0562 154.4057,-310.0837"/>
<polygon fill="#000000" stroke="#000000" points="155.0822,-313.5178 164.2482,-308.2042 153.7692,-306.6421 155.0822,-313.5178"/>
</g>
<!-- kin_stress -->
<g id="proc~~state_analysis~~CallsGraph_node18" class="node">
<title>kin_stress</title>
<polygon fill="#777777" stroke="#777777" points="222,-276 161,-276 161,-252 222,-252 222,-276"/>
<text text-anchor="middle" x="191.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">kin_stress</text>
</g>
<!-- proc~state_analysis&#45;&gt;kin_stress -->
<g id="proc~~state_analysis~~CallsGraph_edge17" class="edge">
<title>proc~state_analysis&#45;&gt;kin_stress</title>
<path fill="none" stroke="#000000" d="M41.2317,-461.7312C45.2699,-428.1629 61.178,-334.0491 116,-285 125.6807,-276.3387 138.6422,-271.2169 151.0908,-268.1993"/>
<polygon fill="#000000" stroke="#000000" points="151.7916,-271.6285 160.8918,-266.2029 150.3944,-264.7693 151.7916,-271.6285"/>
</g>
<!-- amass -->
<g id="proc~~state_analysis~~CallsGraph_node19" class="node">
<title>amass</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-234 164.5,-234 164.5,-210 218.5,-210 218.5,-234"/>
<text text-anchor="middle" x="191.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">amass</text>
</g>
<!-- proc~state_analysis&#45;&gt;amass -->
<g id="proc~~state_analysis~~CallsGraph_edge18" class="edge">
<title>proc~state_analysis&#45;&gt;amass</title>
<path fill="none" stroke="#000000" d="M42.447,-461.752C51.2963,-418.615 82.864,-274.628 116,-243 126.2738,-233.1938 140.723,-227.8931 154.234,-225.0541"/>
<polygon fill="#000000" stroke="#000000" points="155.0334,-228.4682 164.2984,-223.3291 153.8508,-221.5688 155.0334,-228.4682"/>
</g>
<!-- moments -->
<g id="proc~~state_analysis~~CallsGraph_node20" class="node">
<title>moments</title>
<polygon fill="#777777" stroke="#777777" points="220,-192 163,-192 163,-168 220,-168 220,-192"/>
<text text-anchor="middle" x="191.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">moments</text>
</g>
<!-- proc~state_analysis&#45;&gt;moments -->
<g id="proc~~state_analysis~~CallsGraph_edge19" class="edge">
<title>proc~state_analysis&#45;&gt;moments</title>
<path fill="none" stroke="#000000" d="M41.7662,-461.9191C48.9782,-414.171 77.6415,-239.3498 116,-201 125.8139,-191.1883 139.7931,-185.8616 153.0605,-183.0034"/>
<polygon fill="#000000" stroke="#000000" points="153.74,-186.4377 162.9866,-181.2655 152.5328,-179.5426 153.74,-186.4377"/>
</g>
<!-- eggbox -->
<g id="proc~~state_analysis~~CallsGraph_node21" class="node">
<title>eggbox</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-150 164.5,-150 164.5,-126 218.5,-126 218.5,-150"/>
<text text-anchor="middle" x="191.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">eggbox</text>
</g>
<!-- proc~state_analysis&#45;&gt;eggbox -->
<g id="proc~~state_analysis~~CallsGraph_edge20" class="edge">
<title>proc~state_analysis&#45;&gt;eggbox</title>
<path fill="none" stroke="#000000" d="M41.2905,-461.8955C47.095,-409.6542 72.4185,-204.1135 116,-159 125.9431,-148.7073 140.4618,-143.3275 154.1173,-140.561"/>
<polygon fill="#000000" stroke="#000000" points="154.9872,-143.966 164.3014,-138.9167 153.8714,-137.0555 154.9872,-143.966"/>
</g>
<!-- wallclock -->
<g id="proc~~state_analysis~~CallsGraph_node22" class="node">
<title>wallclock</title>
<polygon fill="#777777" stroke="#777777" points="219,-108 164,-108 164,-84 219,-84 219,-108"/>
<text text-anchor="middle" x="191.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">wallclock</text>
</g>
<!-- proc~state_analysis&#45;&gt;wallclock -->
<g id="proc~~state_analysis~~CallsGraph_edge21" class="edge">
<title>proc~state_analysis&#45;&gt;wallclock</title>
<path fill="none" stroke="#000000" d="M40.9251,-461.8477C45.4647,-405.3522 67.1656,-168.9358 116,-117 125.7291,-106.6531 140.0778,-101.2527 153.6609,-98.4852"/>
<polygon fill="#000000" stroke="#000000" points="154.4966,-101.8956 163.8095,-96.8438 153.3789,-94.9854 154.4966,-101.8956"/>
</g>
<!-- cmlendmodule -->
<g id="proc~~state_analysis~~CallsGraph_node23" class="node">
<title>cmlendmodule</title>
<polygon fill="#777777" stroke="#777777" points="232.5,-66 150.5,-66 150.5,-42 232.5,-42 232.5,-66"/>
<text text-anchor="middle" x="191.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">cmlendmodule</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmlendmodule -->
<g id="proc~~state_analysis~~CallsGraph_edge22" class="edge">
<title>proc~state_analysis&#45;&gt;cmlendmodule</title>
<path fill="none" stroke="#000000" d="M40.6408,-461.6672C44.0436,-400.8848 61.9241,-133.7653 116,-75 122.564,-67.8668 131.3226,-63.0775 140.5457,-59.88"/>
<polygon fill="#000000" stroke="#000000" points="141.6073,-63.2167 150.2529,-57.0925 139.6752,-56.4886 141.6073,-63.2167"/>
</g>
<!-- siesta_write_stress_pressure -->
<g id="proc~~state_analysis~~CallsGraph_node24" class="node">
<title>siesta_write_stress_pressure</title>
<polygon fill="#777777" stroke="#777777" points="267,-24 116,-24 116,0 267,0 267,-24"/>
<text text-anchor="middle" x="191.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_write_stress_pressure</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_write_stress_pressure -->
<g id="proc~~state_analysis~~CallsGraph_edge23" class="edge">
<title>proc~state_analysis&#45;&gt;siesta_write_stress_pressure</title>
<path fill="none" stroke="#000000" d="M40.3969,-461.6849C42.7225,-397.1782 56.602,-98.6974 116,-33 116.8982,-32.0066 117.8389,-31.0585 118.8176,-30.1537"/>
<polygon fill="#000000" stroke="#000000" points="121.0833,-32.8296 126.9878,-24.0326 116.8861,-27.2275 121.0833,-32.8296"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,0 64,0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,0 136,0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,0 209.5,0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,0 364,0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,0 436,0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="551.5,-24 454.5,-24 454.5,0 551.5,0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Called by</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: proc~~state_analysis~~CalledByGraph Pages: 1 -->
<svg id="procstate_analysisCalledByGraph" width="200pt" height="32pt"
 viewBox="0.00 0.00 200.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_analysis~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>proc~~state_analysis~~CalledByGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 196,-28 196,4 -4,4"/>
<!-- proc~state_analysis -->
<g id="proc~~state_analysis~~CalledByGraph_node1" class="node">
<title>proc~state_analysis</title>
<polygon fill="none" stroke="#000000" points="192,-24 112,-24 112,0 192,0 192,-24"/>
<text text-anchor="middle" x="152" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">state_analysis</text>
</g>
<!-- proc~siesta_forces -->
<g id="proc~~state_analysis~~CalledByGraph_node2" class="node">
<title>proc~siesta_forces</title>
<g id="a_proc~~state_analysis~~CalledByGraph_node2"><a xlink:href=".././proc/siesta_forces.html" xlink:title="siesta_forces">
<polygon fill="#d9534f" stroke="#d9534f" points="76,-24 0,-24 0,0 76,0 76,-24"/>
<text text-anchor="middle" x="38" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">siesta_forces</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~state_analysis -->
<g id="proc~~state_analysis~~CalledByGraph_edge1" class="edge">
<title>proc~siesta_forces&#45;&gt;proc~state_analysis</title>
<path fill="none" stroke="#000000" d="M76.2775,-12C84.3711,-12 93.0312,-12 101.4976,-12"/>
<polygon fill="#000000" stroke="#000000" points="101.6776,-15.5001 111.6775,-12 101.6775,-8.5001 101.6776,-15.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,0 64,0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,0 136,0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,0 209.5,0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,0 364,0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,0 436,0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="551.5,-24 454.5,-24 454.5,0 551.5,0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/state_analysis.html#src">state_analysis</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>      <span class="k">subroutine </span><span class="n">state_analysis</span><span class="p">(</span> <span class="n">istep</span> <span class="p">)</span>
      <span class="k">use </span><span class="n">siesta_cml</span>
      <span class="k">use </span><span class="n">m_born_charge</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">born_charge</span>
      <span class="k">use </span><span class="n">parallel</span><span class="p">,</span>      <span class="n">only</span> <span class="p">:</span> <span class="n">IOnode</span>
      <span class="k">use </span><span class="n">m_wallclock</span><span class="p">,</span>   <span class="n">only</span> <span class="p">:</span> <span class="n">wallclock</span>
      <span class="k">use </span><span class="n">zmatrix</span><span class="p">,</span>       <span class="n">only</span> <span class="p">:</span> <span class="n">lUseZmatrix</span><span class="p">,</span> <span class="n">iofaZmat</span><span class="p">,</span>
     <span class="p">&amp;</span>                          <span class="n">CartesianForce_to_ZmatForce</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span>      <span class="n">only</span> <span class="p">:</span> <span class="n">iaorb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">amass</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">lasto</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span>      <span class="n">only</span> <span class="p">:</span> <span class="n">indxuo</span>
      <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>        <span class="n">only</span> <span class="p">:</span> <span class="n">nspin</span><span class="p">,</span> <span class="n">SpOrb</span>
      <span class="k">use </span><span class="n">m_fixed</span><span class="p">,</span>       <span class="n">only</span> <span class="p">:</span> <span class="n">fixed</span>
      <span class="k">use </span><span class="n">sparse_matrices</span>
      <span class="k">use </span><span class="n">siesta_geom</span>

      <span class="k">USE </span><span class="n">siesta_options</span>
      <span class="k">use </span><span class="n">units</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">amu</span><span class="p">,</span> <span class="n">eV</span>
      <span class="k">use </span><span class="n">m_stress</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Etot</span><span class="p">,</span> <span class="n">FreeE</span><span class="p">,</span> <span class="n">Eharrs</span><span class="p">,</span> <span class="n">FreeEHarris</span><span class="p">,</span> <span class="n">Entropy</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Ebs</span><span class="p">,</span> <span class="n">Ef</span>
      <span class="k">use </span><span class="n">m_ntm</span>
      <span class="k">use </span><span class="n">m_forces</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">update_FreeE</span><span class="p">,</span> <span class="n">update_FreeEHarris</span>
      <span class="k">use </span><span class="n">m_intramol_pressure</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">remove_intramol_pressure</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="k">use </span><span class="n">flook_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">slua_call</span><span class="p">,</span> <span class="n">LUA_FORCES</span>
<span class="cp">#endif</span>

      <span class="k">implicit none</span>

<span class="k">      </span><span class="kt">integer</span>  <span class="kd">::</span> <span class="n">istep</span>
      <span class="kt">integer</span>  <span class="kd">::</span> <span class="n">ia</span><span class="p">,</span> <span class="n">jx</span><span class="p">,</span> <span class="n">ix</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">volume</span>
      <span class="kt">logical</span>  <span class="kd">::</span> <span class="n">eggbox_block</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span> <span class="c">! Read eggbox info from data file?</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qspin</span>
      
      <span class="k">external</span> <span class="kd">::</span> <span class="n">eggbox</span><span class="p">,</span> <span class="n">mulliken</span><span class="p">,</span> <span class="n">moments</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">external</span> <span class="kd">::</span> <span class="n">volcel</span>

<span class="c">!------------------------------------------------------------------------- BEGIN</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;state_analysis&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="cp">#ifdef DEBUG</span>
      <span class="k">call </span><span class="n">write_debug</span><span class="p">(</span> <span class="s1">&#39;  PRE state_analysis&#39;</span> <span class="p">)</span>
<span class="cp">#endif</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">cmlStartModule</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;SCF Finalization&#39;</span><span class="p">)</span>   
      <span class="n">endif</span>

<span class="c">!     Write final Kohn-Sham and Free Energy</span>
      
      <span class="n">FreeE</span>       <span class="o">=</span> <span class="n">Etot</span> <span class="o">-</span> <span class="n">Temp</span> <span class="o">*</span> <span class="n">Entropy</span>
      <span class="n">FreeEHarris</span> <span class="o">=</span> <span class="n">Eharrs</span> <span class="o">-</span> <span class="n">Temp</span> <span class="o">*</span> <span class="n">Entropy</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartPropertyList</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span>
     <span class="p">&amp;</span>                        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Energies and spin&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">harrisfun</span><span class="p">)</span>
     <span class="p">&amp;</span>      <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;(/a,f14.4)&quot;</span><span class="p">)</span>  <span class="s1">&#39;siesta: E_KS(eV) =        &#39;</span><span class="p">,</span> <span class="n">Etot</span><span class="o">/</span><span class="n">eV</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">then</span>
<span class="k">           call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">Etot</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span>
     <span class="p">&amp;</span>       <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:E_KS&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:eV&#39;</span><span class="p">,</span> 
     <span class="p">.</span>       <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r6&#39;</span><span class="p">)</span>
           <span class="k">call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">FreeE</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span>
     <span class="p">&amp;</span>       <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:FreeE&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:eV&#39;</span><span class="p">,</span> 
     <span class="p">.</span>       <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r6&#39;</span><span class="p">)</span>
           <span class="k">call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">Ebs</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span>
     <span class="p">&amp;</span>       <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:Ebs&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:eV&#39;</span><span class="p">,</span> 
     <span class="p">.</span>       <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r6&#39;</span><span class="p">)</span>
           <span class="k">call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">Ef</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span>
     <span class="p">&amp;</span>       <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:E_Fermi&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:eV&#39;</span><span class="p">,</span> 
     <span class="p">.</span>       <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r6&#39;</span><span class="p">)</span>
        <span class="n">endif</span>
      <span class="n">endif</span>

<span class="c">!     Substract egg box effect from energy</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">eggbox_block</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">eggbox</span><span class="p">(</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">ntm</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span> <span class="n">Etot</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">eggbox_block</span> <span class="p">)</span>
        <span class="n">FreeE</span>  <span class="o">=</span> <span class="n">Etot</span> <span class="o">-</span> <span class="n">Temp</span> <span class="o">*</span> <span class="n">Entropy</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span>
     <span class="p">&amp;</span>    <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;(/a,f14.4)&quot;</span><span class="p">)</span> <span class="s1">&#39;siesta: E_KS - E_eggbox = &#39;</span><span class="p">,</span><span class="n">Etot</span><span class="o">/</span><span class="n">eV</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">Etot</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span>
     <span class="p">&amp;</span>         <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:E_KS_egg&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:eV&#39;</span><span class="p">,</span> 
     <span class="p">.</span>         <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r6&#39;</span><span class="p">)</span>
      <span class="n">endif</span>

      <span class="k">call </span><span class="n">update_FreeE</span><span class="p">(</span> <span class="n">Temp</span> <span class="p">)</span>
      <span class="k">call </span><span class="n">update_FreeEHarris</span><span class="p">(</span> <span class="n">Temp</span> <span class="p">)</span>
      <span class="k">call </span><span class="n">print_spin</span><span class="p">(</span><span class="n">qspin</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlEndPropertyList</span><span class="p">(</span> <span class="n">mainXML</span> <span class="p">)</span>

<span class="c">!     Substract egg box effect from the forces </span>
      <span class="k">if</span> <span class="p">(</span><span class="n">eggbox_block</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">eggbox</span><span class="p">(</span><span class="s1">&#39;forces&#39;</span><span class="p">,</span><span class="n">ucell</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">isa</span><span class="p">,</span><span class="n">ntm</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">fa</span><span class="p">,</span><span class="n">Etot</span><span class="p">,</span><span class="n">eggbox_block</span><span class="p">)</span>
      <span class="n">endif</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">call </span><span class="n">write_raw_efs</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">fa</span><span class="p">,</span><span class="n">FreeE</span><span class="p">)</span>

<span class="c">!     Compute stress without internal molecular pressure</span>
      <span class="k">call </span><span class="n">remove_intramol_pressure</span><span class="p">(</span><span class="n">ucell</span><span class="p">,</span><span class="n">stress</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">fa</span><span class="p">,</span><span class="n">mstress</span><span class="p">)</span>

<span class="c">!     Impose constraints to atomic movements by changing forces ...........</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">RemoveIntraMolecularPressure</span><span class="p">)</span> <span class="k">then</span>
<span class="c">!        Consider intramolecular pressure-removal as another</span>
<span class="c">!        kind of constraint</span>
         <span class="k">call </span><span class="n">fixed</span><span class="p">(</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">mstress</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">amass</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">cstress</span><span class="p">,</span> <span class="n">cfa</span><span class="p">,</span> <span class="n">ntcon</span> <span class="p">,</span> 
     <span class="p">&amp;</span>               <span class="n">magnitude_usage</span> <span class="o">=</span> <span class="n">idyn</span><span class="o">==</span><span class="mi">0</span> <span class="p">)</span>
      <span class="k">else</span>
<span class="k">         call </span><span class="n">fixed</span><span class="p">(</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">stress</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">amass</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">cstress</span><span class="p">,</span> <span class="n">cfa</span><span class="p">,</span> <span class="n">ntcon</span> <span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">magnitude_usage</span> <span class="o">=</span> <span class="n">idyn</span><span class="o">==</span><span class="mi">0</span> <span class="p">)</span>
      <span class="n">endif</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="c">! We call it right after using the</span>
      <span class="c">! geometry constraints.</span>
      <span class="c">! In that way we can use both methods on top</span>
      <span class="c">! of each other!</span>
      <span class="c">! The easy, already implemented methods in fixed,</span>
      <span class="c">! and custom ones in Lua :)</span>
      <span class="k">call </span><span class="n">slua_call</span><span class="p">(</span><span class="n">LUA</span><span class="p">,</span> <span class="n">LUA_FORCES</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="c">!     Calculate and output Zmatrix forces</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">lUseZmatrix</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">idyn</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">CartesianForce_to_ZmatForce</span><span class="p">(</span><span class="n">na_u</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">fa</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">call </span><span class="n">iofaZmat</span><span class="p">()</span>
      <span class="n">endif</span>

<span class="c">!     Compute kinetic contribution to stress</span>
      <span class="n">kin_stress</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_dp</span>
      <span class="n">volume</span> <span class="o">=</span> <span class="n">volcel</span><span class="p">(</span><span class="n">ucell</span><span class="p">)</span>
      <span class="k">do </span><span class="n">ia</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">na_u</span>
        <span class="k">do </span><span class="n">jx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
          <span class="k">do </span><span class="n">ix</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
            <span class="n">kin_stress</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">jx</span><span class="p">)</span> <span class="o">=</span> <span class="n">kin_stress</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">jx</span><span class="p">)</span> <span class="o">-</span>
     <span class="p">&amp;</span>             <span class="n">amu</span> <span class="o">*</span> <span class="n">amass</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span> <span class="o">*</span> <span class="n">va</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">ia</span><span class="p">)</span> <span class="o">*</span> <span class="n">va</span><span class="p">(</span><span class="n">jx</span><span class="p">,</span><span class="n">ia</span><span class="p">)</span> <span class="o">/</span> <span class="n">volume</span>
          <span class="n">enddo</span>
        <span class="n">enddo</span>
      <span class="n">enddo</span>
<span class="c">!     Add kinetic term to stress tensor</span>
      <span class="n">tstress</span> <span class="o">=</span> <span class="n">stress</span> <span class="o">+</span> <span class="n">kin_stress</span>

<span class="c">!     Force output </span>
      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">siesta_write_forces</span><span class="p">(</span><span class="n">istep</span><span class="p">)</span>
        <span class="k">call </span><span class="n">siesta_write_stress_pressure</span><span class="p">()</span>
        <span class="k">call </span><span class="n">wallclock</span><span class="p">(</span><span class="s1">&#39;--- end of geometry step&#39;</span><span class="p">)</span>
      <span class="n">endif</span>

<span class="c">!     Mulliken population analysis </span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">SpOrb</span> <span class="p">)</span> <span class="k">then</span>
<span class="k">          call </span><span class="n">moments</span><span class="p">(</span> <span class="n">mullipop</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span>
     <span class="p">.</span>                  <span class="n">listh</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">iaorb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span>
     <span class="p">.</span>                  <span class="n">indxuo</span> <span class="p">)</span>
      <span class="k">else</span>
<span class="k">       call </span><span class="n">mulliken</span><span class="p">(</span> <span class="n">mullipop</span><span class="p">,</span> <span class="n">nspin</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span>
     <span class="p">&amp;</span>                <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> 
     <span class="p">&amp;</span>                <span class="n">lasto</span><span class="p">,</span> <span class="n">iaorb</span><span class="p">,</span> <span class="n">iphorb</span> <span class="p">)</span>
      <span class="n">endif</span>
<span class="c">!</span>
<span class="c">!     Call the born effective charge routine only in those steps (even) </span>
<span class="c">!     in which the dx  is positive.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">bornz</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">istep</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">born_charge</span><span class="p">()</span>
      <span class="n">endif</span>

<span class="c">!     End the xml module corresponding to the analysis</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">cmlEndModule</span><span class="p">(</span><span class="n">mainXML</span><span class="p">)</span>         
      <span class="n">endif</span> 
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;state_analysis&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="c">!--------------------------------------------------------------------------- END</span>
      <span class="k">END subroutine </span><span class="n">state_analysis</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SIESTA was developed by SIESTA Group</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>