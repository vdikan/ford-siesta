<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="A first-principles materials simulation code using Density Functional Theory.">
    
    <meta name="author" content="SIESTA Group" >
    <link rel="icon" href="../favicon.png">

    <title>state_analysis &ndash; SIESTA</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SIESTA <small>trunk-700--vdikan-edens-708-ford-681</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>Program Overview</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>state_analysis
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.6% of total for procedures.">99 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/state_analysis.F"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/state_analysis.f.html'>state_analysis.F</a></li>
    
     <li><a href='../module/m_state_analysis.html'>m_state_analysis</a></li>
    
  
     <li class="active">state_analysis</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/state_analysis.html#src">state_analysis</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine state_analysis(istep)
    
    
   
</h2>
    
  
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Uses</h3>
      </div>
      <ul class="list-group">
      
      <li class="list-group-item">
  <ul class="list-inline">
    
    <li>siesta_cml</li>
    
    <li>m_born_charge</li>
    
    <li>parallel</li>
    
    <li>m_wallclock</li>
    
    <li>zmatrix</li>
    
    <li>atomlist</li>
    
    <li>atomlist</li>
    
    <li>m_spin</li>
    
    <li>m_fixed</li>
    
    <li>sparse_matrices</li>
    
    <li>siesta_geom</li>
    
    <li>siesta_options</li>
    
    <li>units</li>
    
    <li>m_stress</li>
    
    <li>m_energies</li>
    
    <li>m_energies</li>
    
    <li>m_ntm</li>
    
    <li>m_forces</li>
    
    <li>m_energies</li>
    
    <li>m_intramol_pressure</li>
    
    <li>flook_siesta</li>
    
  </ul>
      </li>
      
      
      
      <li class="list-group-item">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~state_analysis~~UsesGraph Pages: 1 -->
<svg id="procstate_analysisUsesGraph" width="238pt" height="746pt"
 viewBox="0.00 0.00 238.00 746.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_analysis~~UsesGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 742)">
<title>proc~~state_analysis~~UsesGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-742 234,-742 234,4 -4,4"/>
<!-- proc~state_analysis -->
<g id="proc~~state_analysis~~UsesGraph_node1" class="node"><title>proc~state_analysis</title>
<polygon fill="none" stroke="black" points="230,-381 150,-381 150,-357 230,-357 230,-381"/>
<text text-anchor="middle" x="190" y="-366.6" font-family="Helvetica,sans-Serif" font-size="10.50">state_analysis</text>
</g>
<!-- siesta_options -->
<g id="proc~~state_analysis~~UsesGraph_node2" class="node"><title>siesta_options</title>
<polygon fill="#337ab7" stroke="#337ab7" points="97.5,-738 16.5,-738 16.5,-714 97.5,-714 97.5,-738"/>
<text text-anchor="middle" x="57" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_options</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_options -->
<g id="proc~~state_analysis~~UsesGraph_edge1" class="edge"><title>proc~state_analysis&#45;&gt;siesta_options</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.837,-381.07C182.404,-435.122 157.929,-654.489 114,-705 111.785,-707.546 109.231,-709.785 106.458,-711.752"/>
<polygon fill="#000000" stroke="#000000" points="104.505,-708.838 97.6063,-716.879 108.014,-714.895 104.505,-708.838"/>
</g>
<!-- m_fixed -->
<g id="proc~~state_analysis~~UsesGraph_node3" class="node"><title>m_fixed</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-696 30,-696 30,-672 84,-672 84,-696"/>
<text text-anchor="middle" x="57" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_fixed</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_fixed -->
<g id="proc~~state_analysis~~UsesGraph_edge2" class="edge"><title>proc~state_analysis&#45;&gt;m_fixed</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.611,-381.16C191.142,-425.122 190.481,-577.693 114,-663 108.59,-669.034 101.274,-673.341 93.7168,-676.412"/>
<polygon fill="#000000" stroke="#000000" points="92.4745,-673.138 84.1405,-679.68 94.735,-679.763 92.4745,-673.138"/>
</g>
<!-- flook_siesta -->
<g id="proc~~state_analysis~~UsesGraph_node4" class="node"><title>flook_siesta</title>
<polygon fill="#337ab7" stroke="#337ab7" points="91.5,-654 22.5,-654 22.5,-630 91.5,-630 91.5,-654"/>
<text text-anchor="middle" x="57" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">flook_siesta</text>
</g>
<!-- proc~state_analysis&#45;&gt;flook_siesta -->
<g id="proc~~state_analysis~~UsesGraph_edge3" class="edge"><title>proc~state_analysis&#45;&gt;flook_siesta</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.992,-381.076C188.308,-420.867 180.787,-549.402 114,-621 110.237,-625.034 105.625,-628.298 100.677,-630.937"/>
<polygon fill="#000000" stroke="#000000" points="99.2106,-627.759 91.5203,-635.047 102.077,-634.146 99.2106,-627.759"/>
</g>
<!-- siesta_geom -->
<g id="proc~~state_analysis~~UsesGraph_node5" class="node"><title>siesta_geom</title>
<polygon fill="#337ab7" stroke="#337ab7" points="93.5,-612 20.5,-612 20.5,-588 93.5,-588 93.5,-612"/>
<text text-anchor="middle" x="57" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_geom</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_geom -->
<g id="proc~~state_analysis~~UsesGraph_edge4" class="edge"><title>proc~state_analysis&#45;&gt;siesta_geom</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.152,-381.04C185.031,-416.371 171.168,-520.924 114,-579 110.757,-582.294 106.949,-585.077 102.87,-587.428"/>
<polygon fill="#000000" stroke="#000000" points="101.092,-584.401 93.6224,-591.914 104.147,-590.699 101.092,-584.401"/>
</g>
<!-- sparse_matrices -->
<g id="proc~~state_analysis~~UsesGraph_node6" class="node"><title>sparse_matrices</title>
<polygon fill="#337ab7" stroke="#337ab7" points="102.5,-570 11.5,-570 11.5,-546 102.5,-546 102.5,-570"/>
<text text-anchor="middle" x="57" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">sparse_matrices</text>
</g>
<!-- proc~state_analysis&#45;&gt;sparse_matrices -->
<g id="proc~~state_analysis~~UsesGraph_edge5" class="edge"><title>proc~state_analysis&#45;&gt;sparse_matrices</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M186.935,-381.004C181.097,-411.394 161.694,-492.135 114,-537 112.726,-538.198 111.377,-539.33 109.969,-540.398"/>
<polygon fill="#000000" stroke="#000000" points="107.936,-537.543 101.362,-545.851 111.682,-543.456 107.936,-537.543"/>
</g>
<!-- siesta_cml -->
<g id="proc~~state_analysis~~UsesGraph_node7" class="node"><title>siesta_cml</title>
<polygon fill="#337ab7" stroke="#337ab7" points="88.5,-528 25.5,-528 25.5,-504 88.5,-504 88.5,-528"/>
<text text-anchor="middle" x="57" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_cml</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_cml -->
<g id="proc~~state_analysis~~UsesGraph_edge6" class="edge"><title>proc~state_analysis&#45;&gt;siesta_cml</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M184.88,-381.246C175.907,-406.14 152.28,-462.997 114,-495 109.356,-498.883 103.923,-502.086 98.3013,-504.718"/>
<polygon fill="#000000" stroke="#000000" points="96.6925,-501.595 88.7681,-508.627 99.3484,-508.071 96.6925,-501.595"/>
</g>
<!-- atomlist -->
<g id="proc~~state_analysis~~UsesGraph_node8" class="node"><title>atomlist</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-486 30,-486 30,-462 84,-462 84,-486"/>
<text text-anchor="middle" x="57" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">atomlist</text>
</g>
<!-- proc~state_analysis&#45;&gt;atomlist -->
<g id="proc~~state_analysis~~UsesGraph_edge7" class="edge"><title>proc~state_analysis&#45;&gt;atomlist</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M180.978,-381.257C168.6,-399.296 143.198,-433.009 114,-453 107.815,-457.234 100.666,-460.751 93.5872,-463.617"/>
<polygon fill="#000000" stroke="#000000" points="92.2445,-460.382 84.0761,-467.129 94.6694,-466.948 92.2445,-460.382"/>
</g>
<!-- m_forces -->
<g id="proc~~state_analysis~~UsesGraph_node9" class="node"><title>m_forces</title>
<polygon fill="#337ab7" stroke="#337ab7" points="85.5,-444 28.5,-444 28.5,-420 85.5,-420 85.5,-444"/>
<text text-anchor="middle" x="57" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_forces</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_forces -->
<g id="proc~~state_analysis~~UsesGraph_edge8" class="edge"><title>proc~state_analysis&#45;&gt;m_forces</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M169.376,-381.073C154.49,-389.962 133.356,-402.014 114,-411 108.067,-413.754 101.662,-416.425 95.3778,-418.886"/>
<polygon fill="#000000" stroke="#000000" points="93.7942,-415.743 85.686,-422.563 96.2773,-422.288 93.7942,-415.743"/>
</g>
<!-- m_born_charge -->
<g id="proc~~state_analysis~~UsesGraph_node10" class="node"><title>m_born_charge</title>
<polygon fill="#337ab7" stroke="#337ab7" points="101,-402 13,-402 13,-378 101,-378 101,-402"/>
<text text-anchor="middle" x="57" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_born_charge</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_born_charge -->
<g id="proc~~state_analysis~~UsesGraph_edge9" class="edge"><title>proc~state_analysis&#45;&gt;m_born_charge</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M149.696,-375.301C137.683,-377.226 124.263,-379.378 111.477,-381.427"/>
<polygon fill="#000000" stroke="#000000" points="110.716,-378.005 101.397,-383.043 111.824,-384.916 110.716,-378.005"/>
</g>
<!-- m_energies -->
<g id="proc~~state_analysis~~UsesGraph_node11" class="node"><title>m_energies</title>
<polygon fill="#337ab7" stroke="#337ab7" points="91.5,-360 22.5,-360 22.5,-336 91.5,-336 91.5,-360"/>
<text text-anchor="middle" x="57" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_energies</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_energies -->
<g id="proc~~state_analysis~~UsesGraph_edge10" class="edge"><title>proc~state_analysis&#45;&gt;m_energies</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M149.696,-362.699C134.487,-360.261 117.023,-357.462 101.444,-354.964"/>
<polygon fill="#000000" stroke="#000000" points="101.948,-351.501 91.5205,-353.374 100.84,-358.412 101.948,-351.501"/>
</g>
<!-- m_stress -->
<g id="proc~~state_analysis~~UsesGraph_node12" class="node"><title>m_stress</title>
<polygon fill="#337ab7" stroke="#337ab7" points="85,-318 29,-318 29,-294 85,-294 85,-318"/>
<text text-anchor="middle" x="57" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_stress</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_stress -->
<g id="proc~~state_analysis~~UsesGraph_edge11" class="edge"><title>proc~state_analysis&#45;&gt;m_stress</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M169.376,-356.927C154.49,-348.038 133.356,-335.986 114,-327 107.799,-324.121 101.083,-321.334 94.5275,-318.782"/>
<polygon fill="#000000" stroke="#000000" points="95.708,-315.486 85.1163,-315.227 93.2347,-322.035 95.708,-315.486"/>
</g>
<!-- m_wallclock -->
<g id="proc~~state_analysis~~UsesGraph_node13" class="node"><title>m_wallclock</title>
<polygon fill="#337ab7" stroke="#337ab7" points="92,-276 22,-276 22,-252 92,-252 92,-276"/>
<text text-anchor="middle" x="57" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_wallclock</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_wallclock -->
<g id="proc~~state_analysis~~UsesGraph_edge12" class="edge"><title>proc~state_analysis&#45;&gt;m_wallclock</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M180.978,-356.743C168.6,-338.704 143.198,-304.991 114,-285 110.083,-282.318 105.779,-279.924 101.351,-277.801"/>
<polygon fill="#000000" stroke="#000000" points="102.74,-274.589 92.1727,-273.818 99.9529,-281.01 102.74,-274.589"/>
</g>
<!-- m_spin -->
<g id="proc~~state_analysis~~UsesGraph_node14" class="node"><title>m_spin</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-234 30,-234 30,-210 84,-210 84,-234"/>
<text text-anchor="middle" x="57" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_spin</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_spin -->
<g id="proc~~state_analysis~~UsesGraph_edge13" class="edge"><title>proc~state_analysis&#45;&gt;m_spin</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M184.88,-356.754C175.907,-331.86 152.28,-275.003 114,-243 108.14,-238.101 101.024,-234.283 93.857,-231.33"/>
<polygon fill="#000000" stroke="#000000" points="94.7605,-227.935 84.1663,-227.819 92.3757,-234.516 94.7605,-227.935"/>
</g>
<!-- units -->
<g id="proc~~state_analysis~~UsesGraph_node15" class="node"><title>units</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-192 30,-192 30,-168 84,-168 84,-192"/>
<text text-anchor="middle" x="57" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">units</text>
</g>
<!-- proc~state_analysis&#45;&gt;units -->
<g id="proc~~state_analysis~~UsesGraph_edge14" class="edge"><title>proc~state_analysis&#45;&gt;units</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M186.935,-356.996C181.097,-326.606 161.694,-245.865 114,-201 108.332,-195.669 101.184,-191.659 93.9084,-188.654"/>
<polygon fill="#000000" stroke="#000000" points="94.6288,-185.196 84.0341,-185.15 92.2876,-191.793 94.6288,-185.196"/>
</g>
<!-- m_intramol_pressure -->
<g id="proc~~state_analysis~~UsesGraph_node16" class="node"><title>m_intramol_pressure</title>
<polygon fill="#337ab7" stroke="#337ab7" points="114,-150 0,-150 0,-126 114,-126 114,-150"/>
<text text-anchor="middle" x="57" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_intramol_pressure</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_intramol_pressure -->
<g id="proc~~state_analysis~~UsesGraph_edge15" class="edge"><title>proc~state_analysis&#45;&gt;m_intramol_pressure</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.152,-356.96C185.031,-321.629 171.168,-217.076 114,-159 112.907,-157.89 111.751,-156.838 110.541,-155.841"/>
<polygon fill="#000000" stroke="#000000" points="112.157,-152.71 101.908,-150.028 108.247,-158.516 112.157,-152.71"/>
</g>
<!-- m_ntm -->
<g id="proc~~state_analysis~~UsesGraph_node17" class="node"><title>m_ntm</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-108 30,-108 30,-84 84,-84 84,-108"/>
<text text-anchor="middle" x="57" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">m_ntm</text>
</g>
<!-- proc~state_analysis&#45;&gt;m_ntm -->
<g id="proc~~state_analysis~~UsesGraph_edge16" class="edge"><title>proc~state_analysis&#45;&gt;m_ntm</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M188.992,-356.924C188.308,-317.133 180.787,-188.598 114,-117 108.522,-111.127 101.243,-106.887 93.75,-103.827"/>
<polygon fill="#000000" stroke="#000000" points="94.86,-100.508 84.2652,-100.551 92.5741,-107.124 94.86,-100.508"/>
</g>
<!-- parallel -->
<g id="proc~~state_analysis~~UsesGraph_node18" class="node"><title>parallel</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-66 30,-66 30,-42 84,-42 84,-66"/>
<text text-anchor="middle" x="57" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">parallel</text>
</g>
<!-- proc~state_analysis&#45;&gt;parallel -->
<g id="proc~~state_analysis~~UsesGraph_edge17" class="edge"><title>proc~state_analysis&#45;&gt;parallel</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M189.611,-356.84C191.142,-312.878 190.481,-160.307 114,-75 108.59,-68.9661 101.274,-64.6594 93.7168,-61.5877"/>
<polygon fill="#000000" stroke="#000000" points="94.735,-58.237 84.1405,-58.3202 92.4745,-64.862 94.735,-58.237"/>
</g>
<!-- zmatrix -->
<g id="proc~~state_analysis~~UsesGraph_node19" class="node"><title>zmatrix</title>
<polygon fill="#337ab7" stroke="#337ab7" points="84,-24 30,-24 30,-0 84,-0 84,-24"/>
<text text-anchor="middle" x="57" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">zmatrix</text>
</g>
<!-- proc~state_analysis&#45;&gt;zmatrix -->
<g id="proc~~state_analysis~~UsesGraph_edge18" class="edge"><title>proc~state_analysis&#45;&gt;zmatrix</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.837,-356.93C182.404,-302.878 157.929,-83.5108 114,-33 108.682,-26.8852 101.402,-22.547 93.8496,-19.4704"/>
<polygon fill="#000000" stroke="#000000" points="94.8603,-16.1173 84.2659,-16.2094 92.6054,-22.7442 94.8603,-16.1173"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="490pt" height="32pt"
 viewBox="0.00 0.00 489.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 485.5,-28 485.5,4 -4,4"/>
<!-- Module -->
<g id="node1" class="node"><title>Module</title>
<polygon fill="#337ab7" stroke="#337ab7" points="54,-24 0,-24 0,-0 54,-0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Module</text>
</g>
<!-- Submodule -->
<g id="node2" class="node"><title>Submodule</title>
<polygon fill="#5bc0de" stroke="#5bc0de" points="139.5,-24 72.5,-24 72.5,-0 139.5,-0 139.5,-24"/>
<text text-anchor="middle" x="106" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Submodule</text>
</g>
<!-- Subroutine -->
<g id="node3" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="222,-24 158,-24 158,-0 222,-0 222,-24"/>
<text text-anchor="middle" x="190" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node4" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="294,-24 240,-24 240,-0 294,-0 294,-24"/>
<text text-anchor="middle" x="267" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="366,-24 312,-24 312,-0 366,-0 366,-24"/>
<text text-anchor="middle" x="339" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="481.5,-24 384.5,-24 384.5,-0 481.5,-0 481.5,-24"/>
<text text-anchor="middle" x="433" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a submodule to the (sub)module which it is
    descended from. Dashed arrows point from a module or program unit to 
    modules which it uses.
    </p>
    </div></div></div></div>
      </li>
      
      </ul>
    </div>
    


    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-istep%7E3"></span>integer</td>
  <td></td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>istep</strong></td><td></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~state_analysis~~CallsGraph Pages: 1 -->
<svg id="procstate_analysisCallsGraph" width="275pt" height="956pt"
 viewBox="0.00 0.00 275.00 956.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_analysis~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 952)">
<title>proc~~state_analysis~~CallsGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-952 271,-952 271,4 -4,4"/>
<!-- proc~state_analysis -->
<g id="proc~~state_analysis~~CallsGraph_node1" class="node"><title>proc~state_analysis</title>
<polygon fill="none" stroke="black" points="80,-486 0,-486 0,-462 80,-462 80,-486"/>
<text text-anchor="middle" x="40" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50">state_analysis</text>
</g>
<!-- amass -->
<g id="proc~~state_analysis~~CallsGraph_node2" class="node"><title>amass</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-948 164.5,-948 164.5,-924 218.5,-924 218.5,-948"/>
<text text-anchor="middle" x="191.5" y="-933.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">amass</text>
</g>
<!-- proc~state_analysis&#45;&gt;amass -->
<g id="proc~~state_analysis~~CallsGraph_edge1" class="edge"><title>proc~state_analysis&#45;&gt;amass</title>
<path fill="none" stroke="#000000" d="M41.3712,-486.31C43.5614,-550.79 56.8107,-849.159 116,-915 125.665,-925.751 140.363,-931.174 154.157,-933.85"/>
<polygon fill="#000000" stroke="#000000" points="154.02,-937.369 164.431,-935.402 155.066,-930.447 154.02,-937.369"/>
</g>
<!-- va -->
<g id="proc~~state_analysis~~CallsGraph_node3" class="node"><title>va</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-906 164.5,-906 164.5,-882 218.5,-882 218.5,-906"/>
<text text-anchor="middle" x="191.5" y="-891.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">va</text>
</g>
<!-- proc~state_analysis&#45;&gt;va -->
<g id="proc~~state_analysis~~CallsGraph_edge2" class="edge"><title>proc~state_analysis&#45;&gt;va</title>
<path fill="none" stroke="#000000" d="M41.6119,-486.328C44.872,-547.085 62.1218,-814.103 116,-873 125.685,-883.588 140.253,-888.996 153.944,-891.705"/>
<polygon fill="#000000" stroke="#000000" points="153.729,-895.213 164.148,-893.29 154.804,-888.296 153.729,-895.213"/>
</g>
<!-- volcel -->
<g id="proc~~state_analysis~~CallsGraph_node4" class="node"><title>volcel</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-864 164.5,-864 164.5,-840 218.5,-840 218.5,-864"/>
<text text-anchor="middle" x="191.5" y="-849.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">volcel</text>
</g>
<!-- proc~state_analysis&#45;&gt;volcel -->
<g id="proc~~state_analysis~~CallsGraph_edge3" class="edge"><title>proc~state_analysis&#45;&gt;volcel</title>
<path fill="none" stroke="#000000" d="M41.8929,-486.147C46.2826,-542.619 67.3529,-778.944 116,-831 125.797,-841.484 140.383,-846.876 154.059,-849.599"/>
<polygon fill="#000000" stroke="#000000" points="153.822,-853.105 164.244,-851.202 154.91,-846.19 153.822,-853.105"/>
</g>
<!-- moments -->
<g id="proc~~state_analysis~~CallsGraph_node5" class="node"><title>moments</title>
<polygon fill="#777777" stroke="#777777" points="220,-822 163,-822 163,-798 220,-798 220,-822"/>
<text text-anchor="middle" x="191.5" y="-807.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">moments</text>
</g>
<!-- proc~state_analysis&#45;&gt;moments -->
<g id="proc~~state_analysis~~CallsGraph_edge4" class="edge"><title>proc~state_analysis&#45;&gt;moments</title>
<path fill="none" stroke="#000000" d="M42.2538,-486.099C47.8995,-538.318 72.5958,-743.778 116,-789 125.64,-799.043 139.677,-804.397 152.975,-807.212"/>
<polygon fill="#000000" stroke="#000000" points="152.469,-810.676 162.914,-808.906 153.644,-803.776 152.469,-810.676"/>
</g>
<!-- kin_stress -->
<g id="proc~~state_analysis~~CallsGraph_node6" class="node"><title>kin_stress</title>
<polygon fill="#777777" stroke="#777777" points="222,-780 161,-780 161,-756 222,-756 222,-780"/>
<text text-anchor="middle" x="191.5" y="-765.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">kin_stress</text>
</g>
<!-- proc~state_analysis&#45;&gt;kin_stress -->
<g id="proc~~state_analysis~~CallsGraph_edge5" class="edge"><title>proc~state_analysis&#45;&gt;kin_stress</title>
<path fill="none" stroke="#000000" d="M40.4493,-486.101C39.2158,-528.449 41.0043,-671.505 116,-747 125.266,-756.328 138.332,-761.593 150.94,-764.539"/>
<polygon fill="#000000" stroke="#000000" points="150.392,-767.997 160.871,-766.437 151.706,-761.122 150.392,-767.997"/>
</g>
<!-- siesta_write_forces -->
<g id="proc~~state_analysis~~CallsGraph_node7" class="node"><title>siesta_write_forces</title>
<polygon fill="#777777" stroke="#777777" points="243.5,-738 139.5,-738 139.5,-714 243.5,-714 243.5,-738"/>
<text text-anchor="middle" x="191.5" y="-723.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_write_forces</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_write_forces -->
<g id="proc~~state_analysis~~CallsGraph_edge6" class="edge"><title>proc~state_analysis&#45;&gt;siesta_write_forces</title>
<path fill="none" stroke="#000000" d="M41.1577,-486.094C42.3313,-524.172 51.2617,-642.75 116,-705 120.056,-708.9 124.779,-712.087 129.841,-714.688"/>
<polygon fill="#000000" stroke="#000000" points="128.683,-718 139.25,-718.767 131.467,-711.578 128.683,-718"/>
</g>
<!-- cartesianforce_to_zmatforce -->
<g id="proc~~state_analysis~~CallsGraph_node8" class="node"><title>cartesianforce_to_zmatforce</title>
<polygon fill="#777777" stroke="#777777" points="265.5,-696 117.5,-696 117.5,-672 265.5,-672 265.5,-696"/>
<text text-anchor="middle" x="191.5" y="-681.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cartesianforce_to_zmatforce</text>
</g>
<!-- proc~state_analysis&#45;&gt;cartesianforce_to_zmatforce -->
<g id="proc~~state_analysis~~CallsGraph_edge7" class="edge"><title>proc~state_analysis&#45;&gt;cartesianforce_to_zmatforce</title>
<path fill="none" stroke="#000000" d="M42.1707,-486.255C46.0413,-519.788 61.4747,-613.821 116,-663 117.338,-664.207 118.74,-665.344 120.196,-666.417"/>
<polygon fill="#000000" stroke="#000000" points="118.701,-669.608 129.049,-671.88 122.376,-663.65 118.701,-669.608"/>
</g>
<!-- print_spin -->
<g id="proc~~state_analysis~~CallsGraph_node9" class="node"><title>print_spin</title>
<polygon fill="#777777" stroke="#777777" points="221,-654 162,-654 162,-630 221,-630 221,-654"/>
<text text-anchor="middle" x="191.5" y="-639.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">print_spin</text>
</g>
<!-- proc~state_analysis&#45;&gt;print_spin -->
<g id="proc~~state_analysis~~CallsGraph_edge8" class="edge"><title>proc~state_analysis&#45;&gt;print_spin</title>
<path fill="none" stroke="#000000" d="M43.732,-486.383C50.6315,-514.687 71.4718,-584.482 116,-621 126.167,-629.338 139.445,-634.37 151.971,-637.405"/>
<polygon fill="#000000" stroke="#000000" points="151.279,-640.836 161.781,-639.436 152.698,-633.981 151.279,-640.836"/>
</g>
<!-- wallclock -->
<g id="proc~~state_analysis~~CallsGraph_node10" class="node"><title>wallclock</title>
<polygon fill="#777777" stroke="#777777" points="219,-612 164,-612 164,-588 219,-588 219,-612"/>
<text text-anchor="middle" x="191.5" y="-597.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">wallclock</text>
</g>
<!-- proc~state_analysis&#45;&gt;wallclock -->
<g id="proc~~state_analysis~~CallsGraph_edge9" class="edge"><title>proc~state_analysis&#45;&gt;wallclock</title>
<path fill="none" stroke="#000000" d="M46.2798,-486.111C56.4745,-508.057 80.9943,-554.396 116,-579 127.104,-586.805 141.043,-591.72 153.851,-594.81"/>
<polygon fill="#000000" stroke="#000000" points="153.296,-598.271 163.804,-596.918 154.746,-591.422 153.296,-598.271"/>
</g>
<!-- siesta_write_stress_pressure -->
<g id="proc~~state_analysis~~CallsGraph_node11" class="node"><title>siesta_write_stress_pressure</title>
<polygon fill="#777777" stroke="#777777" points="267,-570 116,-570 116,-546 267,-546 267,-570"/>
<text text-anchor="middle" x="191.5" y="-555.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_write_stress_pressure</text>
</g>
<!-- proc~state_analysis&#45;&gt;siesta_write_stress_pressure -->
<g id="proc~~state_analysis~~CallsGraph_edge10" class="edge"><title>proc~state_analysis&#45;&gt;siesta_write_stress_pressure</title>
<path fill="none" stroke="#000000" d="M52.5428,-486.478C66.3401,-500.682 90.749,-523.638 116,-537 119.675,-538.944 123.549,-540.726 127.522,-542.355"/>
<polygon fill="#000000" stroke="#000000" points="126.328,-545.645 136.92,-545.885 128.789,-539.092 126.328,-545.645"/>
</g>
<!-- remove_intramol_pressure -->
<g id="proc~~state_analysis~~CallsGraph_node12" class="node"><title>remove_intramol_pressure</title>
<polygon fill="#777777" stroke="#777777" points="262,-528 121,-528 121,-504 262,-504 262,-528"/>
<text text-anchor="middle" x="191.5" y="-513.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">remove_intramol_pressure</text>
</g>
<!-- proc~state_analysis&#45;&gt;remove_intramol_pressure -->
<g id="proc~~state_analysis~~CallsGraph_edge11" class="edge"><title>proc~state_analysis&#45;&gt;remove_intramol_pressure</title>
<path fill="none" stroke="#000000" d="M80.2794,-485.035C97.8866,-489.982 118.912,-495.888 137.856,-501.21"/>
<polygon fill="#000000" stroke="#000000" points="136.97,-504.597 147.544,-503.932 138.863,-497.858 136.97,-504.597"/>
</g>
<!-- slua_call -->
<g id="proc~~state_analysis~~CallsGraph_node13" class="node"><title>slua_call</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-486 164.5,-486 164.5,-462 218.5,-462 218.5,-486"/>
<text text-anchor="middle" x="191.5" y="-471.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">slua_call</text>
</g>
<!-- proc~state_analysis&#45;&gt;slua_call -->
<g id="proc~~state_analysis~~CallsGraph_edge12" class="edge"><title>proc~state_analysis&#45;&gt;slua_call</title>
<path fill="none" stroke="#000000" d="M80.2794,-474C103.133,-474 131.745,-474 154.089,-474"/>
<polygon fill="#000000" stroke="#000000" points="154.186,-477.5 164.186,-474 154.186,-470.5 154.186,-477.5"/>
</g>
<!-- update_freeeharris -->
<g id="proc~~state_analysis~~CallsGraph_node14" class="node"><title>update_freeeharris</title>
<polygon fill="#777777" stroke="#777777" points="243,-444 140,-444 140,-420 243,-420 243,-444"/>
<text text-anchor="middle" x="191.5" y="-429.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">update_freeeharris</text>
</g>
<!-- proc~state_analysis&#45;&gt;update_freeeharris -->
<g id="proc~~state_analysis~~CallsGraph_edge13" class="edge"><title>proc~state_analysis&#45;&gt;update_freeeharris</title>
<path fill="none" stroke="#000000" d="M80.2794,-462.965C97.8866,-458.018 118.912,-452.112 137.856,-446.79"/>
<polygon fill="#000000" stroke="#000000" points="138.863,-450.142 147.544,-444.068 136.97,-443.403 138.863,-450.142"/>
</g>
<!-- update_freee -->
<g id="proc~~state_analysis~~CallsGraph_node15" class="node"><title>update_freee</title>
<polygon fill="#777777" stroke="#777777" points="229.5,-402 153.5,-402 153.5,-378 229.5,-378 229.5,-402"/>
<text text-anchor="middle" x="191.5" y="-387.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">update_freee</text>
</g>
<!-- proc~state_analysis&#45;&gt;update_freee -->
<g id="proc~~state_analysis~~CallsGraph_edge14" class="edge"><title>proc~state_analysis&#45;&gt;update_freee</title>
<path fill="none" stroke="#000000" d="M52.5428,-461.522C66.3401,-447.318 90.749,-424.362 116,-411 124.551,-406.475 134.184,-402.834 143.615,-399.939"/>
<polygon fill="#000000" stroke="#000000" points="144.652,-403.283 153.316,-397.184 142.74,-396.549 144.652,-403.283"/>
</g>
<!-- born_charge -->
<g id="proc~~state_analysis~~CallsGraph_node16" class="node"><title>born_charge</title>
<polygon fill="#777777" stroke="#777777" points="228,-360 155,-360 155,-336 228,-336 228,-360"/>
<text text-anchor="middle" x="191.5" y="-345.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">born_charge</text>
</g>
<!-- proc~state_analysis&#45;&gt;born_charge -->
<g id="proc~~state_analysis~~CallsGraph_edge15" class="edge"><title>proc~state_analysis&#45;&gt;born_charge</title>
<path fill="none" stroke="#000000" d="M46.2798,-461.889C56.4745,-439.943 80.9943,-393.604 116,-369 124.665,-362.91 135.055,-358.579 145.288,-355.502"/>
<polygon fill="#000000" stroke="#000000" points="146.226,-358.874 154.989,-352.919 144.425,-352.11 146.226,-358.874"/>
</g>
<!-- cmladdproperty -->
<g id="proc~~state_analysis~~CallsGraph_node17" class="node"><title>cmladdproperty</title>
<polygon fill="#777777" stroke="#777777" points="235,-318 148,-318 148,-294 235,-294 235,-318"/>
<text text-anchor="middle" x="191.5" y="-303.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cmladdproperty</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmladdproperty -->
<g id="proc~~state_analysis~~CallsGraph_edge16" class="edge"><title>proc~state_analysis&#45;&gt;cmladdproperty</title>
<path fill="none" stroke="#000000" d="M43.732,-461.617C50.6315,-433.313 71.4718,-363.518 116,-327 122.427,-321.729 130.097,-317.78 138.034,-314.82"/>
<polygon fill="#000000" stroke="#000000" points="139.339,-318.077 147.784,-311.68 137.192,-311.415 139.339,-318.077"/>
</g>
<!-- cmlstartmodule -->
<g id="proc~~state_analysis~~CallsGraph_node18" class="node"><title>cmlstartmodule</title>
<polygon fill="#777777" stroke="#777777" points="234,-276 149,-276 149,-252 234,-252 234,-276"/>
<text text-anchor="middle" x="191.5" y="-261.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cmlstartmodule</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmlstartmodule -->
<g id="proc~~state_analysis~~CallsGraph_edge17" class="edge"><title>proc~state_analysis&#45;&gt;cmlstartmodule</title>
<path fill="none" stroke="#000000" d="M42.1707,-461.745C46.0413,-428.212 61.4747,-334.179 116,-285 122.598,-279.049 130.757,-274.772 139.231,-271.7"/>
<polygon fill="#000000" stroke="#000000" points="140.347,-275.018 148.865,-268.719 138.278,-268.331 140.347,-275.018"/>
</g>
<!-- mulliken -->
<g id="proc~~state_analysis~~CallsGraph_node19" class="node"><title>mulliken</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-234 164.5,-234 164.5,-210 218.5,-210 218.5,-234"/>
<text text-anchor="middle" x="191.5" y="-219.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">mulliken</text>
</g>
<!-- proc~state_analysis&#45;&gt;mulliken -->
<g id="proc~~state_analysis~~CallsGraph_edge18" class="edge"><title>proc~state_analysis&#45;&gt;mulliken</title>
<path fill="none" stroke="#000000" d="M41.1577,-461.906C42.3313,-423.828 51.2617,-305.25 116,-243 126.266,-233.128 140.801,-227.831 154.31,-225.013"/>
<polygon fill="#000000" stroke="#000000" points="155.081,-228.432 164.354,-223.306 153.909,-221.531 155.081,-228.432"/>
</g>
<!-- eggbox -->
<g id="proc~~state_analysis~~CallsGraph_node20" class="node"><title>eggbox</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-192 164.5,-192 164.5,-168 218.5,-168 218.5,-192"/>
<text text-anchor="middle" x="191.5" y="-177.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">eggbox</text>
</g>
<!-- proc~state_analysis&#45;&gt;eggbox -->
<g id="proc~~state_analysis~~CallsGraph_edge19" class="edge"><title>proc~state_analysis&#45;&gt;eggbox</title>
<path fill="none" stroke="#000000" d="M40.4493,-461.899C39.2158,-419.551 41.0043,-276.495 116,-201 126.037,-190.896 140.533,-185.559 154.075,-182.773"/>
<polygon fill="#000000" stroke="#000000" points="154.861,-186.191 164.155,-181.104 153.717,-179.285 154.861,-186.191"/>
</g>
<!-- timer -->
<g id="proc~~state_analysis~~CallsGraph_node21" class="node"><title>timer</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-150 164.5,-150 164.5,-126 218.5,-126 218.5,-150"/>
<text text-anchor="middle" x="191.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">timer</text>
</g>
<!-- proc~state_analysis&#45;&gt;timer -->
<g id="proc~~state_analysis~~CallsGraph_edge20" class="edge"><title>proc~state_analysis&#45;&gt;timer</title>
<path fill="none" stroke="#000000" d="M42.2538,-461.901C47.8995,-409.682 72.5958,-204.222 116,-159 125.936,-148.648 140.545,-143.278 154.2,-140.535"/>
<polygon fill="#000000" stroke="#000000" points="155.041,-143.945 164.363,-138.911 153.936,-137.033 155.041,-143.945"/>
</g>
<!-- cmlendmodule -->
<g id="proc~~state_analysis~~CallsGraph_node22" class="node"><title>cmlendmodule</title>
<polygon fill="#777777" stroke="#777777" points="232.5,-108 150.5,-108 150.5,-84 232.5,-84 232.5,-108"/>
<text text-anchor="middle" x="191.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cmlendmodule</text>
</g>
<!-- proc~state_analysis&#45;&gt;cmlendmodule -->
<g id="proc~~state_analysis~~CallsGraph_edge21" class="edge"><title>proc~state_analysis&#45;&gt;cmlendmodule</title>
<path fill="none" stroke="#000000" d="M41.8929,-461.853C46.2826,-405.381 67.3529,-169.056 116,-117 122.605,-109.932 131.388,-105.178 140.6,-101.996"/>
<polygon fill="#000000" stroke="#000000" points="141.635,-105.341 150.282,-99.2184 139.705,-98.612 141.635,-105.341"/>
</g>
<!-- write_debug -->
<g id="proc~~state_analysis~~CallsGraph_node23" class="node"><title>write_debug</title>
<polygon fill="#777777" stroke="#777777" points="227,-66 156,-66 156,-42 227,-42 227,-66"/>
<text text-anchor="middle" x="191.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">write_debug</text>
</g>
<!-- proc~state_analysis&#45;&gt;write_debug -->
<g id="proc~~state_analysis~~CallsGraph_edge22" class="edge"><title>proc~state_analysis&#45;&gt;write_debug</title>
<path fill="none" stroke="#000000" d="M41.6119,-461.672C44.872,-400.915 62.1218,-133.897 116,-75 123.857,-66.411 134.927,-61.2301 146.136,-58.1344"/>
<polygon fill="#000000" stroke="#000000" points="146.963,-61.536 155.945,-55.9174 145.419,-54.7082 146.963,-61.536"/>
</g>
<!-- fixed -->
<g id="proc~~state_analysis~~CallsGraph_node24" class="node"><title>fixed</title>
<polygon fill="#777777" stroke="#777777" points="218.5,-24 164.5,-24 164.5,-0 218.5,-0 218.5,-24"/>
<text text-anchor="middle" x="191.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">fixed</text>
</g>
<!-- proc~state_analysis&#45;&gt;fixed -->
<g id="proc~~state_analysis~~CallsGraph_edge23" class="edge"><title>proc~state_analysis&#45;&gt;fixed</title>
<path fill="none" stroke="#000000" d="M41.3712,-461.69C43.5614,-397.21 56.8107,-98.8406 116,-33 125.665,-22.2492 140.363,-16.8255 154.157,-14.1503"/>
<polygon fill="#000000" stroke="#000000" points="155.066,-17.5527 164.431,-12.5976 154.02,-10.6313 155.066,-17.5527"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,-0 64,-0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,-0 136,-0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node"><title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,-0 209.5,-0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node"><title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,-0 364,-0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,-0 436,-0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="551.5,-24 454.5,-24 454.5,-0 551.5,-0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Called by</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: proc~~state_analysis~~CalledByGraph Pages: 1 -->
<svg id="procstate_analysisCalledByGraph" width="200pt" height="32pt"
 viewBox="0.00 0.00 200.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~state_analysis~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>proc~~state_analysis~~CalledByGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 196,-28 196,4 -4,4"/>
<!-- proc~state_analysis -->
<g id="proc~~state_analysis~~CalledByGraph_node1" class="node"><title>proc~state_analysis</title>
<polygon fill="none" stroke="black" points="192,-24 112,-24 112,-0 192,-0 192,-24"/>
<text text-anchor="middle" x="152" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">state_analysis</text>
</g>
<!-- proc~siesta_forces -->
<g id="proc~~state_analysis~~CalledByGraph_node2" class="node"><title>proc~siesta_forces</title>
<g id="a_proc~~state_analysis~~CalledByGraph_node2"><a xlink:href=".././proc/siesta_forces.html" xlink:title="siesta_forces">
<polygon fill="#d9534f" stroke="#d9534f" points="76,-24 0,-24 0,-0 76,-0 76,-24"/>
<text text-anchor="middle" x="38" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">siesta_forces</text>
</a>
</g>
</g>
<!-- proc~siesta_forces&#45;&gt;proc~state_analysis -->
<g id="proc~~state_analysis~~CalledByGraph_edge1" class="edge"><title>proc~siesta_forces&#45;&gt;proc~state_analysis</title>
<path fill="none" stroke="#000000" d="M76.2944,-12C84.4376,-12 93.177,-12 101.706,-12"/>
<polygon fill="#000000" stroke="#000000" points="101.951,-15.5001 111.951,-12 101.951,-8.5001 101.951,-15.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="560pt" height="32pt"
 viewBox="0.00 0.00 559.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 555.5,-28 555.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,-0 64,-0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,-0 136,-0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node"><title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.5,-24 154.5,-24 154.5,-0 209.5,-0 209.5,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node"><title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,-0 364,-0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,-0 436,-0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="551.5,-24 454.5,-24 454.5,-0 551.5,-0 551.5,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/state_analysis.html#src">state_analysis</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>      <span class="k">subroutine </span><span class="n">state_analysis</span><span class="p">(</span> <span class="n">istep</span> <span class="p">)</span>
      <span class="k">use </span><span class="n">siesta_cml</span>
      <span class="k">use </span><span class="n">m_born_charge</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">born_charge</span>
      <span class="k">use </span><span class="n">parallel</span><span class="p">,</span>      <span class="n">only</span> <span class="p">:</span> <span class="n">IOnode</span>
      <span class="k">use </span><span class="n">m_wallclock</span><span class="p">,</span>   <span class="n">only</span> <span class="p">:</span> <span class="n">wallclock</span>
      <span class="k">use </span><span class="n">zmatrix</span><span class="p">,</span>       <span class="n">only</span> <span class="p">:</span> <span class="n">lUseZmatrix</span><span class="p">,</span> <span class="n">iofaZmat</span><span class="p">,</span>
     <span class="p">&amp;</span>                          <span class="n">CartesianForce_to_ZmatForce</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span>      <span class="n">only</span> <span class="p">:</span> <span class="n">iaorb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span> <span class="n">amass</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">lasto</span>
      <span class="k">use </span><span class="n">atomlist</span><span class="p">,</span>      <span class="n">only</span> <span class="p">:</span> <span class="n">indxuo</span>
      <span class="k">use </span><span class="n">m_spin</span><span class="p">,</span>        <span class="n">only</span> <span class="p">:</span> <span class="n">spin</span>
      <span class="k">use </span><span class="n">m_fixed</span><span class="p">,</span>       <span class="n">only</span> <span class="p">:</span> <span class="n">fixed</span>
      <span class="k">use </span><span class="n">sparse_matrices</span>
      <span class="k">use </span><span class="n">siesta_geom</span>

      <span class="k">USE </span><span class="n">siesta_options</span>
      <span class="k">use </span><span class="n">units</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">amu</span><span class="p">,</span> <span class="n">eV</span>
      <span class="k">use </span><span class="n">m_stress</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Etot</span><span class="p">,</span> <span class="n">FreeE</span><span class="p">,</span> <span class="n">Eharrs</span><span class="p">,</span> <span class="n">FreeEHarris</span><span class="p">,</span> <span class="n">Entropy</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">Ebs</span><span class="p">,</span> <span class="n">Ef</span>
      <span class="k">use </span><span class="n">m_ntm</span>
      <span class="k">use </span><span class="n">m_forces</span>
      <span class="k">use </span><span class="n">m_energies</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">update_FreeE</span><span class="p">,</span> <span class="n">update_FreeEHarris</span>
      <span class="k">use </span><span class="n">m_intramol_pressure</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">remove_intramol_pressure</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="k">use </span><span class="n">flook_siesta</span><span class="p">,</span> <span class="n">only</span> <span class="p">:</span> <span class="n">slua_call</span><span class="p">,</span> <span class="n">LUA_FORCES</span>
<span class="cp">#endif</span>

      <span class="k">implicit none</span>

<span class="k">      </span><span class="kt">integer</span>  <span class="kd">::</span> <span class="n">istep</span>
      <span class="kt">integer</span>  <span class="kd">::</span> <span class="n">ia</span><span class="p">,</span> <span class="n">jx</span><span class="p">,</span> <span class="n">ix</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">volume</span>
      <span class="kt">logical</span>  <span class="kd">::</span> <span class="n">eggbox_block</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span> <span class="c">! Read eggbox info from data file?</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qspin</span>
      
      <span class="k">external</span> <span class="kd">::</span> <span class="n">eggbox</span><span class="p">,</span> <span class="n">mulliken</span><span class="p">,</span> <span class="n">moments</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span> <span class="k">external</span> <span class="kd">::</span> <span class="n">volcel</span>

<span class="c">!------------------------------------------------------------------------- BEGIN</span>
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;state_analysis&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="cp">#ifdef DEBUG</span>
      <span class="k">call </span><span class="n">write_debug</span><span class="p">(</span> <span class="s1">&#39;  PRE state_analysis&#39;</span> <span class="p">)</span>
<span class="cp">#endif</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">cmlStartModule</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;SCF Finalization&#39;</span><span class="p">)</span>   
      <span class="n">endif</span>

<span class="c">!     Write final Kohn-Sham and Free Energy</span>
      
      <span class="n">FreeE</span>       <span class="o">=</span> <span class="n">Etot</span> <span class="o">-</span> <span class="n">Temp</span> <span class="o">*</span> <span class="n">Entropy</span>
      <span class="n">FreeEHarris</span> <span class="o">=</span> <span class="n">Eharrs</span> <span class="o">-</span> <span class="n">Temp</span> <span class="o">*</span> <span class="n">Entropy</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlStartPropertyList</span><span class="p">(</span><span class="n">mainXML</span><span class="p">,</span>
     <span class="p">&amp;</span>                        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Energies and spin&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">harrisfun</span><span class="p">)</span>
     <span class="p">&amp;</span>      <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;(/a,f14.4)&quot;</span><span class="p">)</span>  <span class="s1">&#39;siesta: E_KS(eV) =        &#39;</span><span class="p">,</span> <span class="n">Etot</span><span class="o">/</span><span class="n">eV</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">then</span>
<span class="k">           call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">Etot</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span>
     <span class="p">&amp;</span>       <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:E_KS&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:eV&#39;</span><span class="p">,</span> 
     <span class="p">.</span>       <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r6&#39;</span><span class="p">)</span>
           <span class="k">call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">FreeE</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span>
     <span class="p">&amp;</span>       <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:FreeE&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:eV&#39;</span><span class="p">,</span> 
     <span class="p">.</span>       <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r6&#39;</span><span class="p">)</span>
           <span class="k">call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">Ebs</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span>
     <span class="p">&amp;</span>       <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:Ebs&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:eV&#39;</span><span class="p">,</span> 
     <span class="p">.</span>       <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r6&#39;</span><span class="p">)</span>
           <span class="k">call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">Ef</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span>
     <span class="p">&amp;</span>       <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:E_Fermi&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:eV&#39;</span><span class="p">,</span> 
     <span class="p">.</span>       <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r6&#39;</span><span class="p">)</span>
        <span class="n">endif</span>
      <span class="n">endif</span>

<span class="c">!     Substract egg box effect from energy</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">eggbox_block</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">eggbox</span><span class="p">(</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">ntm</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span> <span class="n">Etot</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">eggbox_block</span> <span class="p">)</span>
        <span class="n">FreeE</span>  <span class="o">=</span> <span class="n">Etot</span> <span class="o">-</span> <span class="n">Temp</span> <span class="o">*</span> <span class="n">Entropy</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span>
     <span class="p">&amp;</span>    <span class="k">write</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s2">&quot;(/a,f14.4)&quot;</span><span class="p">)</span> <span class="s1">&#39;siesta: E_KS - E_eggbox = &#39;</span><span class="p">,</span><span class="n">Etot</span><span class="o">/</span><span class="n">eV</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlAddProperty</span><span class="p">(</span><span class="n">xf</span><span class="o">=</span><span class="n">mainXML</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">Etot</span><span class="o">/</span><span class="n">eV</span><span class="p">,</span>
     <span class="p">&amp;</span>         <span class="n">dictref</span><span class="o">=</span><span class="s1">&#39;siesta:E_KS_egg&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;siestaUnits:eV&#39;</span><span class="p">,</span> 
     <span class="p">.</span>         <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r6&#39;</span><span class="p">)</span>
      <span class="n">endif</span>

      <span class="k">call </span><span class="n">update_FreeE</span><span class="p">(</span> <span class="n">Temp</span> <span class="p">)</span>
      <span class="k">call </span><span class="n">update_FreeEHarris</span><span class="p">(</span> <span class="n">Temp</span> <span class="p">)</span>
      <span class="k">call </span><span class="n">print_spin</span><span class="p">(</span><span class="n">qspin</span><span class="p">)</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">call </span><span class="n">cmlEndPropertyList</span><span class="p">(</span> <span class="n">mainXML</span> <span class="p">)</span>

<span class="c">!     Substract egg box effect from the forces </span>
      <span class="k">if</span> <span class="p">(</span><span class="n">eggbox_block</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">eggbox</span><span class="p">(</span><span class="s1">&#39;forces&#39;</span><span class="p">,</span><span class="n">ucell</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">isa</span><span class="p">,</span><span class="n">ntm</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">fa</span><span class="p">,</span><span class="n">Etot</span><span class="p">,</span><span class="n">eggbox_block</span><span class="p">)</span>
      <span class="n">endif</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">call </span><span class="n">write_raw_efs</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">fa</span><span class="p">,</span><span class="n">FreeE</span><span class="p">)</span>

<span class="c">!     Compute stress without internal molecular pressure</span>
      <span class="k">call </span><span class="n">remove_intramol_pressure</span><span class="p">(</span><span class="n">ucell</span><span class="p">,</span><span class="n">stress</span><span class="p">,</span><span class="n">na_u</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">fa</span><span class="p">,</span><span class="n">mstress</span><span class="p">)</span>

<span class="c">!     Impose constraints to atomic movements by changing forces ...........</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">RemoveIntraMolecularPressure</span><span class="p">)</span> <span class="k">then</span>
<span class="c">!        Consider intramolecular pressure-removal as another</span>
<span class="c">!        kind of constraint</span>
         <span class="k">call </span><span class="n">fixed</span><span class="p">(</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">mstress</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">amass</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">cstress</span><span class="p">,</span> <span class="n">cfa</span><span class="p">,</span> <span class="n">ntcon</span> <span class="p">,</span> 
     <span class="p">&amp;</span>               <span class="n">magnitude_usage</span> <span class="o">=</span> <span class="n">idyn</span><span class="o">==</span><span class="mi">0</span> <span class="p">)</span>
      <span class="k">else</span>
<span class="k">         call </span><span class="n">fixed</span><span class="p">(</span> <span class="n">ucell</span><span class="p">,</span> <span class="n">stress</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">amass</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">cstress</span><span class="p">,</span> <span class="n">cfa</span><span class="p">,</span> <span class="n">ntcon</span> <span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">magnitude_usage</span> <span class="o">=</span> <span class="n">idyn</span><span class="o">==</span><span class="mi">0</span> <span class="p">)</span>
      <span class="n">endif</span>

<span class="cp">#ifdef SIESTA__FLOOK</span>
      <span class="c">! We call it right after using the</span>
      <span class="c">! geometry constraints.</span>
      <span class="c">! In that way we can use both methods on top</span>
      <span class="c">! of each other!</span>
      <span class="c">! The easy, already implemented methods in fixed,</span>
      <span class="c">! and custom ones in Lua :)</span>
      <span class="k">call </span><span class="n">slua_call</span><span class="p">(</span><span class="n">LUA</span><span class="p">,</span> <span class="n">LUA_FORCES</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="c">!     Calculate and output Zmatrix forces</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">lUseZmatrix</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">idyn</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">CartesianForce_to_ZmatForce</span><span class="p">(</span><span class="n">na_u</span><span class="p">,</span><span class="n">xa</span><span class="p">,</span><span class="n">fa</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">call </span><span class="n">iofaZmat</span><span class="p">()</span>
      <span class="n">endif</span>

<span class="c">!     Compute kinetic contribution to stress</span>
      <span class="n">kin_stress</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_dp</span>
      <span class="n">volume</span> <span class="o">=</span> <span class="n">volcel</span><span class="p">(</span><span class="n">ucell</span><span class="p">)</span>
      <span class="k">do </span><span class="n">ia</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">na_u</span>
        <span class="k">do </span><span class="n">jx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
          <span class="k">do </span><span class="n">ix</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
            <span class="n">kin_stress</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">jx</span><span class="p">)</span> <span class="o">=</span> <span class="n">kin_stress</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">jx</span><span class="p">)</span> <span class="o">-</span>
     <span class="p">&amp;</span>             <span class="n">amu</span> <span class="o">*</span> <span class="n">amass</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span> <span class="o">*</span> <span class="n">va</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">ia</span><span class="p">)</span> <span class="o">*</span> <span class="n">va</span><span class="p">(</span><span class="n">jx</span><span class="p">,</span><span class="n">ia</span><span class="p">)</span> <span class="o">/</span> <span class="n">volume</span>
          <span class="n">enddo</span>
        <span class="n">enddo</span>
      <span class="n">enddo</span>
<span class="c">!     Add kinetic term to stress tensor</span>
      <span class="n">tstress</span> <span class="o">=</span> <span class="n">stress</span> <span class="o">+</span> <span class="n">kin_stress</span>

<span class="c">!     Force output </span>
      <span class="k">if</span> <span class="p">(</span><span class="n">IOnode</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">siesta_write_forces</span><span class="p">(</span><span class="n">istep</span><span class="p">)</span>
        <span class="k">call </span><span class="n">siesta_write_stress_pressure</span><span class="p">()</span>
        <span class="k">call </span><span class="n">wallclock</span><span class="p">(</span><span class="s1">&#39;--- end of geometry step&#39;</span><span class="p">)</span>
      <span class="n">endif</span>

<span class="c">!     Population and moment analysis </span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">spin</span><span class="p">%</span><span class="n">SO</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">orbmoms</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">moments</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span> <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span>
     <span class="p">.</span>           <span class="n">listh</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span> <span class="n">lasto</span><span class="p">,</span> <span class="n">iaorb</span><span class="p">,</span> <span class="n">iphorb</span><span class="p">,</span>
     <span class="p">.</span>           <span class="n">indxuo</span> <span class="p">)</span>
      <span class="n">endif</span>
      <span class="c">! Call this unconditionally</span>
      <span class="k">call </span><span class="n">mulliken</span><span class="p">(</span> <span class="n">mullipop</span><span class="p">,</span> <span class="n">na_u</span><span class="p">,</span> <span class="n">no_u</span><span class="p">,</span> <span class="n">maxnh</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">numh</span><span class="p">,</span> <span class="n">listhptr</span><span class="p">,</span> <span class="n">listh</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">Dscf</span><span class="p">,</span> <span class="n">isa</span><span class="p">,</span>
     <span class="p">&amp;</span>               <span class="n">lasto</span><span class="p">,</span> <span class="n">iaorb</span><span class="p">,</span> <span class="n">iphorb</span> <span class="p">)</span>
<span class="c">!</span>
<span class="c">!     Call the born effective charge routine only in those steps (even) </span>
<span class="c">!     in which the dx  is positive.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">bornz</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">istep</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="mi">0</span><span class="p">))</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">born_charge</span><span class="p">()</span>
      <span class="n">endif</span>

<span class="c">!     End the xml module corresponding to the analysis</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cml_p</span><span class="p">)</span> <span class="k">then</span>
<span class="k">         call </span><span class="n">cmlEndModule</span><span class="p">(</span><span class="n">mainXML</span><span class="p">)</span>         
      <span class="n">endif</span> 
      <span class="k">call </span><span class="n">timer</span><span class="p">(</span> <span class="s1">&#39;state_analysis&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>

<span class="c">!--------------------------------------------------------------------------- END</span>
      <span class="k">END subroutine </span><span class="n">state_analysis</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 <a rel="license" href="http://www.gnu.org/licenses/old-licenses/fdl-1.2.en.html">GNU Free Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SIESTA was developed by SIESTA Group</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>